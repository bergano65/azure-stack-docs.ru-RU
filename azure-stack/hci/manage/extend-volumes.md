---
title: Расширение томов в Azure Stack HCI
description: Сведения о том, как изменять размер томов в Azure Stack HCI с помощью Windows Admin Center и PowerShell.
author: khdownie
ms.author: v-kedow
ms.topic: article
ms.date: 03/10/2020
ms.openlocfilehash: 703931b0dccb533b2b924847eb3302f0efa46d1a
ms.sourcegitcommit: 900332596d0bb473d82b1d1a28c3fe3aa6522add
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/11/2020
ms.locfileid: "79089286"
---
# <a name="extending-volumes-in-storage-spaces-direct"></a>Расширение томов в Локальных дисковых пространствах
> Область применения: Windows Server 2019

В этой статье приведены инструкции по изменению размера томов в кластере [Локальных дисковых пространств](/windows-server/storage/storage-spaces/storage-spaces-direct-overview) с помощью Windows Admin Center.

> [!WARNING]
> **Не поддерживается изменение размера базового хранилища, используемого для Локальных дисковых пространств.** Если вы используете Локальные дисковые пространства в виртуализированной среде хранения, в том числе в Azure, любое изменение размера или характеристик устройств хранения, используемых виртуальными машинами, не поддерживается и приведет к недоступности данных. Вместо этого воспользуйтесь статьей [Добавление серверов или дисков](/windows-server/storage/storage-spaces/add-nodes), чтобы добавить дополнительную емкость перед расширением томов.

Посмотрите краткое видео о том, как изменить размер тома.

> [!VIDEO https://www.youtube-nocookie.com/embed/hqyBzipBoTI]

## <a name="extending-volumes-using-windows-admin-center"></a>Расширение томов с помощью Windows Admin Center

1. В Windows Admin Center подключитесь к кластеру Локальных дисковых пространств и выберите элемент **Тома** на панели **Инструменты**.
2. На странице **Тома** выберите вкладку **Учет** и щелкните тот том, который вы решили изменить.

    На странице сведений о томе указана емкость хранилища для тома. Страницу сведений о томах также можно открыть непосредственно из панели мониторинга. На панели мониторинга в области оповещений выберите оповещение, которое уведомляет о нехватке объема хранилища для тома, а затем щелкните **Перейти к тому**.

4. В верхней части страницы сведений о томе выберите **Изменить размер**.
5. Введите новый размер, который больше прежнего, а затем щелкните **Изменить размер**.

    На странице сведений о томе появится новая емкость хранилища для тома, а на панели мониторинга исчезнет оповещение.

## <a name="extending-volumes-using-powershell"></a>Расширение томов с помощью PowerShell

### <a name="capacity-in-the-storage-pool"></a>Емкость пула носителей

Прежде чем изменить размер тома, убедитесь, что в пуле носителей есть достаточно ресурсов для нового занимаемого объема. Например, при изменении размера тома с трехсторонним зеркальным отображением с 1 ТБ до 2 ТБ его занимаемый объем вырастет с 3 ТБ до 6 ТБ. Чтобы такое изменение размера прошло успешно, в пуле носителей должно быть не менее (6-3) = 3 ТБ доступной емкости.

### <a name="familiarity-with-volumes-in-storage-spaces"></a>Общие сведения о томах в дисковых пространствах

В Локальных дисковых пространствах каждый том состоит из нескольких объектов, составляющих стек: общий том кластера (CSV) или просто "том"; сегмент; диск или виртуальный диск; один или несколько уровней хранилища (если применимо). Чтобы изменить размер тома, придется изменить размер нескольких объектов из этого стека.

![Тома в SMAPI](media/extend-volumes/volumes-in-smapi.png)

Чтобы ознакомиться с этими объектами, попробуйте запустить командлеты PowerShell **Get-** с названием объекта на английском языке.

Пример:

```PowerShell
Get-VirtualDisk
```

Чтобы отслеживать связи между объектами в стеке, передайте выходные данные командлета **Get-** в следующий.

Например, так можно перейти от виртуального диска к соответствующему тому:

```PowerShell
Get-VirtualDisk <FriendlyName> | Get-Disk | Get-Partition | Get-Volume 
```

### <a name="step-1--resize-the-virtual-disk"></a>Шаг 1. Изменение размера виртуального диска

Виртуальный диск может использовать или не использовать уровни хранилища в зависимости от того, как он был создан.

Чтобы проверить это, выполните следующий командлет:

```PowerShell
Get-VirtualDisk <FriendlyName> | Get-StorageTier 
```

Если этот командлет ничего не возвращает, значит, виртуальный диск не использует уровни хранилища.

#### <a name="no-storage-tiers"></a>Нет уровней хранилища

Если у виртуального диска нет уровней хранилища, его размер можно изменить напрямую командлетом **Resize-VirtualDisk**.

Укажите новый размер в параметре **-Size**.

```PowerShell
Get-VirtualDisk <FriendlyName> | Resize-VirtualDisk -Size <Size>
```

При изменении размера **VirtualDisk** для него автоматически изменяется размер объекта **Disk**.

![Resize-VirtualDisk](media/extend-volumes/Resize-VirtualDisk.gif)

#### <a name="with-storage-tiers"></a>Есть уровни хранилища

Если у виртуального диска есть уровни хранилища, размер каждого уровня отдельно можно изменить командлетом **Resize-StorageTier**.

Получите имена уровней хранилища, отслеживая связи для виртуального диска.

```PowerShell
Get-VirtualDisk <FriendlyName> | Get-StorageTier | Select FriendlyName
```

Затем для каждого уровня укажите новый размер в параметре **-Size**.

```PowerShell
Get-StorageTier <FriendlyName> | Resize-StorageTier -Size <Size>
```

> [!TIP]
> Если эти уровни размещены на разных физических носителях (например, **MediaType = SSD** и **MediaType = HDD**), вам придется предоставить в пуле носителей достаточный объем каждого типа носителей с учетом нового занимаемого объема на каждом уровне.

При изменении размера **StorageTier** для него автоматически изменяется размер **VirtualDisk** и **Disk**.

![Resize-StorageTier](media/extend-volumes/Resize-StorageTier.gif)

### <a name="step-2--resize-the-partition"></a>Шаг 2. Изменение размера сегмента

Теперь измените размер сегмента с помощью командлета **Resize-Partition**. Виртуальный диск должн быть разделен на два сегмента, из которых один имеет состояние Reserved (зарезервирован) и не должен изменяться, а второй доступен для изменения и имеет параметры **PartitionNumber = 2** и **Type = Basic**.

Укажите новый размер в параметре **-Size**. Мы рекомендуем указать максимальный поддерживаемый размер, как указано ниже.

```PowerShell
# Choose virtual disk
$VirtualDisk = Get-VirtualDisk <FriendlyName>

# Get its partition
$Partition = $VirtualDisk | Get-Disk | Get-Partition | Where PartitionNumber -Eq 2

# Resize to its maximum supported size 
$Partition | Resize-Partition -Size ($Partition | Get-PartitionSupportedSize).SizeMax
```

При изменении размера **Partition** для него автоматически изменяется размер **Volume** и **ClusterSharedVolume**.

![Resize-Partition](media/extend-volumes/Resize-Partition.gif)

Вот и все!

> [!TIP]
> Вы можете убедиться, что размер тома изменился, с помощью командлета **Get-Volume**.

## <a name="next-steps"></a>Дальнейшие действия

Пошаговые инструкции по другим важным задачам управления хранилищем вы найдете в следующих статьях:

- [Планирование томов в Локальных дисковых пространствах](/windows-server/storage/storage-spaces/plan-volumes)
- [Создание томов в Локальных дисковых пространствах](/windows-server/storage/storage-spaces/create-volumes)
- [Удаление томов в Локальных дисковых пространствах](/windows-server/storage/storage-spaces/delete-volumes)