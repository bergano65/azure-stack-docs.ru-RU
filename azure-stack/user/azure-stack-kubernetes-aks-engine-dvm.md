---
title: Перемещение кластера элементов Marketplace в обработчик AKS в Azure Stack Hub
description: Узнайте, как переместить кластер элементов Marketplace в обработчик AKS в Azure Stack Hub.
author: mattbriggs
ms.topic: article
ms.date: 3/19/2020
ms.author: mabrigg
ms.reviewer: waltero
ms.lastreviewed: 3/19/2020
ms.openlocfilehash: f15c870a1b256ffa546672a3abde2fc68f9baa4f
ms.sourcegitcommit: 17be49181c8ec55e01d7a55c441afe169627d268
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/21/2020
ms.locfileid: "80069009"
---
# <a name="move-your-marketplace-item-cluster-to-the-aks-engine-on-azure-stack-hub"></a>Перемещение кластера элементов Marketplace в обработчик AKS в Azure Stack Hub

Элемент Kubernetes Azure Stack Hub Marketplace использует шаблон Azure Resource Manager для развертывания виртуальной машины развертывания для скачивания и установки обработчика AKS и создания модели API входных данных, используемой для описания кластера, после запуска обработчика AKS на виртуальной машине и развертывания кластера. В этой статье показано, как получить доступ к обработчику AKS и соответствующим файлам, чтобы их можно было использовать для выполнения операций обновления и масштабирования в кластере Kubernetes.

## <a name="access-aks-engine-in-the-dvm"></a>Доступ к обработчику AKS в виртуальной машине развертывания

После успешного завершения развертывания, инициированного элементом Kubernetes Azure Stack Hub Marketplace, вы можете найти обработчик AKS, который использовался для развертывания кластера, установленного в виртуальной машине развертывания, созданной в указанной для кластера группе ресурсов. Эта виртуальная машина не является частью кластера Kubernetes и создается в собственной виртуальной сети. Ниже описано, как найти виртуальную машину и обнаружить в ней обработчик AKS:

1.  Откройте пользовательский портал Azure Stack Hub и выберите группу ресурсов, указанную для кластера Kubernetes.
2.  В группе ресурсов найдите виртуальную машину развертывания. Имя начинается с префикса: **vmd-** .
3.  Выберите виртуальную машину развертывания. В разделе "Обзор" ** найдите общедоступный IP-адрес. Используйте этот адрес и консольное приложение, например Putty, чтобы установить сеанс SSH для виртуальной машины.
4.  В сеансе на виртуальной машине развертывания обработчик AKS можно найти по пути `./var/lib/waagent/custom-script/download/0/bin/aks-engine`.
5.  Укажите файл `.json`, описывающий кластеры, используемые в качестве входных данных в AKS Engine. Файл по состоянию на `/var/lib/waagent/custom-script/download/0/bin/azurestack.json`. Обратите внимание, что файл содержит учетные данные субъекта-службы, используемые для развертывания кластера. Если вы решили сохранить файл, постарайтесь переместить его в защищенное хранилище.
6.  Выходной каталог, созданный обработчиком AKS, можно найти по пути `/var/lib/waagent/custom-script/download/0/_output/<resource group name>`. В этом каталоге найдите выходной `apimodel.json` по пути `/var/lib/waagent/custom-script/download/0/bin/apimodel.json`. В каталоге и файле `apimodel.json` содержатся все созданные сертификаты, ключи и учетные данные, необходимые для развертывания кластера Kubernetes. Храните эти ресурсы в безопасном месте.
7.  Выберите файл конфигурации Kubernetes, который часто называют файлом **kubeconfig**, по пути `$HOME/<output dir>/kubeconfig/kubeconfing.<location>.json`, где **\<location>** соответствует идентификатору расположения Azure Stack Hub. Этот файл полезен, если вы планируете настроить **kubectl** для доступа к кластеру Kubernetes.

## <a name="use-the-aks-engine-with-your-newly-created-cluster"></a>Использование обработчика AKS с созданным кластером

Сохраните в безопасном месте файл aks-engine, входной файл apimodel.json, выходной каталог и выходной файл apimodel.json. Вы можете использовать двоичный и выходной файл `apimodel.json` обработчика AKS на любой виртуальной машине Linux.

1.  Чтобы продолжить использовать обработчика AKS, выполните такие операции, как **обновление** и **масштабирование**, скопируйте двоичный файл **aks-engine** на целевой виртуальной машине. Если вы используете ту же **vmd-** машину в каталоге.

2.  Создайте каталог с именем кластера или с другим мнемотехническим именем, которое ссылается на новый кластер, и сохраните в нем выходной файл apimodel.json. Убедитесь, что это защищенное место, так как файл содержит учетные данные. После этого AKS Engine можно запустить для выполнения таких операций, как [масштабирование](azure-stack-kubernetes-aks-engine-scale.md) или [обновление](azure-stack-kubernetes-aks-engine-upgrade.md)

## <a name="next-steps"></a>Дальнейшие действия

- См. сведения об [обработчике AKS в Azure Stack Hub](azure-stack-kubernetes-aks-engine-overview.md).  
- [Устранение неполадок с обработчиком AKS в Azure Stack Hub](azure-stack-kubernetes-aks-engine-troubleshoot.md)  

