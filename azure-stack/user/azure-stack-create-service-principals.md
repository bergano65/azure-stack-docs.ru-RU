---
title: Создание субъекта-службы для Azure Stack | Документация Майкрософт
description: Описывается создание субъекта-службы, который можно использовать в Azure Resource Manager в сочетании с управлением доступом на основе ролей для управления доступом к ресурсам.
services: azure-resource-manager
documentationcenter: na
author: mattbriggs
manager: femila
ms.service: azure-resource-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/15/2019
ms.author: mabrigg
ms.reviewer: thoroet
ms.lastreviewed: 12/12/2018
ms.openlocfilehash: 3860f8dcc99f3505fe2f838e75f5e8f09b78aefe
ms.sourcegitcommit: 8cb2b567e9914d4d07e754d95c0864aa55868579
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2019
ms.locfileid: "65855378"
---
# <a name="give-applications-access-to-azure-stack-resources-by-creating-service-principals"></a>Предоставление приложениям доступа к ресурсам Azure Stack за счет создания субъектов-служб

*Область применения: интегрированные системы Azure Stack и Пакет средств разработки Azure Stack*

Вы можете предоставить приложению доступ к ресурсам Azure Stack, создав субъект-службу, который использует Azure Resource Manager. Субъект-служба позволяет делегировать конкретные разрешения с помощью [управления доступом на основе ролей](azure-stack-manage-permissions.md).

Рекомендуется использовать субъекты-службы для ваших приложений. Субъекты-службы рекомендуется использовать для запуска приложения с вашими учетными данными по следующим причинам:

* Для субъекта-службы можно назначить разрешения, которые отличаются от ваших разрешений учетной записи. Как правило, разрешения субъекта-службы ограничены именно теми разрешениями, которые необходимы приложению для его работы.
* В случае изменения роли или обязанностей изменять учетные данные приложения не требуется.
* Можно использовать сертификат, чтобы автоматизировать проверку подлинности при выполнении автоматического сценария.

## <a name="example-scenario"></a>Пример сценария

У вас есть приложение для управления конфигурацией, которому необходимо составить перечень ресурсов Azure с помощью Azure Resource Manager. Вы можете создать субъект-службу и назначить ему роль "Читатель". Эта роль предоставляет приложению доступ только для чтения к ресурсам Azure.

## <a name="getting-started"></a>Начало работы

В этой статье описаны действия для выполнения следующих задач:

* Создание субъекта-службы для приложения.
* Регистрация приложения и создание ключа проверки подлинности.
* Назначение роли для приложения.

Способ создания субъекта-службы определяется тем, как настроен каталог Active Directory для Azure Stack. Выберите один из следующих вариантов:

* Создание субъекта-службы в [Azure Active Directory (Azure AD)](azure-stack-create-service-principals.md#create-service-principal-for-azure-ad).
* Создание субъекта-службы в [службах федерации Active Directory (AD FS)](azure-stack-create-service-principals.md#create-service-principal-for-ad-fs).

Действия для назначения роли для субъекта-службы аналогичны в Azure AD и AD FS. После создания субъекта-службы вы можете [делегировать разрешения](azure-stack-create-service-principals.md), назначив роль для этого субъекта-службы.

## <a name="create-service-principal-for-azure-ad"></a>Создание субъекта-службы для Azure AD

Если Azure Stack использует Azure AD в качестве хранилища удостоверений, можно создать субъект-службу, выполнив те же действия в Azure с помощью портала Microsoft Azure.

> [!NOTE]
> Перед созданием субъекта-службы проверьте, что у вас есть [необходимые разрешения Azure AD](/azure/active-directory/develop/howto-create-service-principal-portal#required-permissions).

### <a name="create-service-principal"></a>Создание субъекта-службы

Чтобы создать субъект-службу для приложения, выполните следующие действия:

1. Войдите в учетную запись Azure через [портал Azure](https://portal.azure.com).
2. Последовательно выберите элементы **Azure Active Directory** > **Регистрация приложений** > **Новая регистрация**.
3. Введите имя.
4. Выберите **Поддерживаемые типы учетных записей**.
5.  Добавьте URI для приложения. В качестве типа создаваемого приложения выберите **Web** (Веб-приложение). Выбрав нужные значения, нажмите кнопку **Зарегистрировать**.

Субъект-служба для приложения создан.

### <a name="get-credentials"></a>Получение учетных данных

При использовании программного входа в систему вам потребуются идентификатор приложения и ключ проверки подлинности. Для получения этих значений:

1. В Active Directory в разделе **регистрации приложений** выберите нужное приложение.

2. Скопируйте **идентификатор приложения** и сохраните его в коде приложения. В примерах приложений в качестве **идентификатора приложения** используется **идентификатор клиента**.

     ![Идентификатор приложения](./media/azure-stack-create-service-principals/image12.png)
3. Чтобы создать ключ проверки подлинности, выберите **Certificates & Secrets** (Сертификаты и секреты).

4. Выберите **New client secret** (Создать секрет клиента).

5. Введите описание, срок действия ключа и нажмите **Add** (Добавить). 

6. После этого отобразится значение секрета. Запишите это значение, так как вы не сможете получить его позже. Сохраните значение ключа, чтобы приложение могло получить к нему доступ.

![Предупреждение о значении ключа для сохраненного ключа.](./media/azure-stack-create-service-principals/image15.png)

Последний шаг — [назначение роли для приложения](azure-stack-create-service-principals.md).

## <a name="create-service-principal-for-ad-fs"></a>Создание субъекта-службы для AD FS

При развертывании Azure Stack с использованием AD FS в качестве хранилища удостоверений можно использовать PowerShell для решения следующих задач:

* Создание субъекта-службы.
* Назначение роли для субъекта-службы.
* Вход с помощью удостоверения субъекта-службы.

Дополнительные сведения о создании субъекта-службы см. в разделе [Создание субъекта-службы для AD FS](../operator/azure-stack-create-service-principals.md#manage-service-principal-for-ad-fs).

## <a name="assign-the-service-principal-to-a-role"></a>Назначение роли для субъекта-службы

Чтобы обеспечить доступ к ресурсам в подписке, необходимо назначить приложению роль. Укажите, какая роль предоставит приложению необходимые разрешения. Дополнительные сведения о доступных ролях см. в статье [RBAC: встроенные роли](/azure/role-based-access-control/built-in-roles).

> [!NOTE]
> Вы можете задать область действия роли на уровне подписки, группы ресурсов или ресурса. Разрешения наследуют более низкие уровни области действия. Например, приложение с ролью "Читатель" для группы ресурсов может считывать все ресурсы в группе ресурсов.

Чтобы назначить роль для субъекта-службы, выполните следующие действия.

1. На портале Azure Stack перейдите на уровень области действия, которой вы хотите назначить приложение. Например, чтобы назначить роль в области действия подписки выберите **Подписки**.

2. Выберите подписку, для которой хотите назначить приложение. В этом примере это подписка Visual Studio Enterprise.

     ![Выбор подписки Visual Studio Enterprise для назначения](./media/azure-stack-create-service-principals/image16.png)

3. В качестве подписки выберите **Управление доступом (IAM)**.

4. Выберите **Добавить назначение ролей**.

5. Выберите роль, которая будет назначена приложению.

6. Найдите приложение и выберите его.

7. Нажмите кнопку **ОК**, чтобы завершить назначение роли. Вы увидите свое приложение в списке пользователей, назначенных выбранной роли для этой области действия.

Итак, вы создали субъект-службу и назначили ему роль. Теперь ваше приложение может обращаться к ресурсам Azure Stack.

## <a name="next-steps"></a>Дополнительная информация

[Управление разрешениями пользователей](azure-stack-manage-permissions.md)
