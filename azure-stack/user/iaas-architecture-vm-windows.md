---
title: Запуск виртуальной машины Windows в Azure Stack | Документация Майкрософт
description: Узнайте, как запустить виртуальную машину Windows в Azure Stack.
services: azure-stack
author: mattbriggs
ms.service: azure-stack
ms.topic: how-to
ms.date: 11/11/2019
ms.author: mabrigg
ms.reviewer: kivenkat
ms.lastreviewed: 11/01/2019
ms.openlocfilehash: 5f9d8de7c08e8cfa0ad2af9bcb8f898fc32848a3
ms.sourcegitcommit: 7817d61fa34ac4f6410ce6f8ac11d292e1ad807c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/02/2019
ms.locfileid: "74690219"
---
# <a name="run-a-windows-virtual-machine-on-azure-stack"></a>Запуск виртуальной машины Windows в Azure Stack

Для подготовки к работе виртуальной машины в Azure Stack, помимо самой виртуальной машины, требуются некоторые дополнительные компоненты, такие как сеть и хранилище ресурсов. Рекомендации по запуску виртуальных машин Windows в Azure.

![Архитектура для виртуальной машины Windows в Azure Stack](./media/iaas-architecture-vm-windows/image1.png)

## <a name="resource-group"></a>группа ресурсов.

[Группа ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview) представляет собой логический контейнер, содержащий связанные ресурсы Azure Stack. Как правило, группы ресурсов создаются в зависимости от времени существования ресурсов и пользователя, который ими управляет.

Поместите тесно связанные ресурсы с одинаковым жизненным циклом в одну [группу ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview). Группы ресурсов позволяют развертывать и отслеживать несколько ресурсов как одну группу, для которой, помимо прочего, можно отслеживать выставляемые счета. Можно также удалить ресурсы в виде набора, что очень удобно для тестирования развернутых служб. Присвойте понятные имена ресурсам, чтобы упростить поиск определенного ресурса и получить сведения о его роли. Дополнительные сведения см. в руководстве по [рекомендуемым соглашениям об именовании ресурсов Azure](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).

## <a name="virtual-machine"></a>Виртуальная машина

Виртуальную машину можно подготовить на основе списка опубликованных образов, пользовательского управляемого образа или файла виртуального жесткого диска (VHD), передав его в хранилище BLOB-объектов Azure Stack.

Azure Stack предлагает различные размеры виртуальных машин в Azure. Дополнительные сведения см. в статье [Размеры виртуальных машин, поддерживаемые в Azure Stack](https://docs.microsoft.com/azure-stack/user/azure-stack-vm-sizes). При перемещении имеющейся рабочей нагрузки в Azure Stack выберите начальный размер виртуальной машины, который точнее всего соответствует характеристикам локальных серверов/Azure. Затем измерьте производительность фактической рабочей нагрузки по таким показателям, как потребление ЦП, памяти и дисковых операций ввода-вывода в секунду, и при необходимости измените размер.

## <a name="disks"></a>Диски

Цена зависит от производительности подготовленного диска. Скорость выполнения операций ввода-вывода в секунду и пропускная способность (т. е. скорость передачи данных) зависят от размера виртуальной машины. Поэтому во время подготовки диска следует учитывать все эти факторы.

Дисковые операции ввода-вывода в секунду в Azure Stack зависят от [размера виртуальной машины](https://docs.microsoft.com/azure-stack/user/azure-stack-vm-sizes), а не от типа диска. Это означает, что для виртуальной машины серии Standard_Fs, независимо от того, выбираете ли вы SSD или HDD для типа диска, ограничение операций ввода-вывода в секунду для одного дополнительного диска с данными составляет 2300 операций ввода-вывода в секунду. Установленное ограничение операций ввода-вывода в секунду является пределом (максимально возможным) для предотвращения "шумных соседей". Это не гарантирует количество операций ввода-вывода в секунду, которое вы получаете для определенного размера виртуальной машины.

Мы также рекомендуем использовать [Управляемые диски](https://docs.microsoft.com/azure-stack/user/azure-stack-managed-disk-considerations). Благодаря автоматической обработке хранилища управляемые диски упрощают процесс управления дисками. Управляемым дискам не требуется учетная запись хранения. Просто укажите размер и тип диска, и он будет развернут как высокодоступный ресурс.

Диск операционной системы — это диск VHD, расположенный в хранилище BLOB-объектов Azure Stack, поэтому он работает, даже если хост-компьютер отключен. Кроме того, рекомендуем создать один или несколько [дисков данных](https://docs.microsoft.com/azure-stack/user/azure-stack-manage-vm-disks) на постоянных виртуальных жестких дисках, которые используются для данных приложений. Если это возможно, устанавливайте приложения на диск данных, а не на диск операционной системы. Для работы некоторых устаревших приложений может потребоваться установить компоненты на диске С. В этом случае вы можете [изменить размер диска ОС](https://docs.microsoft.com/azure/virtual-machines/virtual-machines-windows-expand-os-disk), используя PowerShell.

Виртуальная машина создается с временным диском (в Windows это диск D:). Этот диск хранится на временном томе в инфраструктуре хранилища Azure Stack. Он может быть удален во время перезагрузки и других событий жизненного цикла виртуальной машины. Используйте этот диск только для временных данных, таких как данные страниц или файлы подкачки.

## <a name="network"></a>Сеть

Сетевые компоненты включают приведенные ниже ресурсы.

-   **Виртуальная сеть**. Каждая виртуальная машина развертывается в виртуальной сети, которую можно разделить на несколько подсетей.

-   **Сетевой интерфейс (сетевой адаптер)** . Сетевой адаптер обеспечивает взаимодействие виртуальной машины и виртуальной сети. Если для виртуальной машины требуется несколько сетевых адаптеров, помните, что их максимально возможное число зависит от [размера каждой виртуальной машины](https://docs.microsoft.com/azure-stack/user/azure-stack-vm-sizes).

-   **Общедоступный IP-адрес / VIP**. Общедоступный IP-адрес используется для обмена данными с виртуальной машиной — например, через удаленный рабочий стол. Общедоступный IP-адрес может быть динамическим или статическим. По умолчанию используется динамический IP-адрес.

-   Зарезервируйте [статический IP-адрес](https://docs.microsoft.com/azure/virtual-network/virtual-networks-reserved-public-ip), если вам нужен постоянный IP-адрес, например, для создания записи типа А в DNS или добавления IP-адреса в список надежных адресов.

-   Можно также создать полное доменное имя для IP-адреса. Затем вы сможете зарегистрировать в DNS [запись CNAME](https://en.wikipedia.org/wiki/CNAME_record), которая указывает на полное доменное имя. Дополнительные сведения см. в руководстве по [созданию полного доменного имени на портале Azure](https://docs.microsoft.com/azure/virtual-machines/virtual-machines-windows-portal-create-fqdn).

-   **Группа безопасности сети**. Группы безопасности сети позволяют разрешать или запрещать сетевой трафик к виртуальным машинам. Группы безопасности сети могут быть связаны с подсетями или отдельными экземплярами виртуальных машин.

Все группы безопасности сети содержат набор [правил по умолчанию](https://docs.microsoft.com/azure/virtual-network/security-overview#default-security-rules), включая правило, которое блокирует весь входящий интернет-трафик. Правила по умолчанию нельзя удалить, но их можно переопределить другими правилами. Чтобы разрешить интернет-трафик, создайте правила, разрешающие входящий трафик для определенных портов, например, это может быть порт 80 для протокола HTTP. Чтобы включить доступ по протоколу RDP, добавьте правило группы безопасности сети, которое разрешает входящий трафик через TCP-порт 3389.

## <a name="operations"></a>Операции

**Диагностика.** Включите мониторинг и диагностику, в том числе базовые метрики работоспособности, а также ведение журналов инфраструктуры диагностики и [диагностику загрузки](https://azure.microsoft.com/blog/boot-diagnostics-for-virtual-machines-v2/). Если виртуальную машину невозможно загрузить, для обнаружения неисправностей можно использовать диагностику загрузки. Создайте учетную запись службы хранилища Azure для хранения журналов. Учетной записи локально избыточного хранилища достаточно для хранения журналов диагностики. Дополнительные сведения см. в статье о [включении мониторинга и диагностики](https://docs.microsoft.com/azure-stack/user/azure-stack-metrics-azure-data).

**Доступность** Виртуальная машина может перезагружаться из-за планового обслуживания, запланированного оператором Azure Stack. Чтобы добиться высокого уровня доступности рабочих систем с несколькими виртуальными машинами в Azure, виртуальные машины размещаются в [группе доступности](https://docs.microsoft.com/azure/virtual-machines/windows/manage-availability#configure-multiple-virtual-machines-in-an-availability-set-for-redundancy), которая распределяет их между несколькими доменами сбоя и доменами обновления. При меньшем масштабе Azure Stack Hub неисправный домен в группе доступности определяется как один узел в единице масштабирования.  

Инфраструктура Azure Stack Hub уже устойчива к сбоям, но базовая технология (отказоустойчивая кластеризация) по-прежнему приводит к некоторому времени простоя виртуальных машин на поврежденном физическом сервере в случае сбоя оборудования. Azure Stack Hub поддерживает группы доступности с максимально тремя доменами сбоя, что гарантирует согласованность с Azure.

|                   |             |
|-------------------|-------------|
| **Домены сбоя** | Виртуальные машины, размещенные в группе доступности, физически изолированы друг от друга и как можно более равномерно распределяются по нескольким доменам сбоя (узлы Azure Stack Hub). В случае сбоя оборудования виртуальные машины домена со сбоем будут перезапущены в других доменах со сбоем. Они будут храниться в отдельных доменах со сбоем из других виртуальных машин, но, по возможности, в той же группе доступности. После восстановления работоспособности оборудования виртуальные машины перераспределяются, что обеспечивает высокий уровень доступности. |
| **Домены обновления**| Домены обновления — это еще одна концепция Azure, обеспечивающая высокий уровень доступности в группах доступности. Домен обновления — это логическая группа базового оборудования, которое может одновременно обслуживаться. Во время планового обслуживания виртуальные машины в одном домене обновления перезапускаются вместе. При создании клиентом виртуальных машин в группе доступности платформа Azure автоматически распределяет их между такими доменами обновления. <br>В Azure Stack Hub виртуальные машины в реальном времени переносятся на другие доступные узлы в кластере до обновления их базового узла. Так как во время обновления узла клиент не простаивает, функция обновления домена в Azure Stack Hub существует только для совместимости с шаблонами Azure. Для виртуальных машин в группе доступности будет отображаться значение 0 в качестве номера домена обновления на портале. |

**Резервные копии**. Рекомендации по защите виртуальных машин IaaS Azure Stack см. в этой статье.

**Остановка виртуальной машины.** Azure различает состояния "Остановлена" и "Освобождена". Вы оплачиваете использование остановленных виртуальных машин, но не оплачиваете освобожденные виртуальные машины. На портале Azure Stack кнопка **Stop** (Прервать) освобождает виртуальную машину. Если вы войдете в виртуальную машину и завершите работу операционной системы, виртуальная машина будет остановлена, а **не** освобождена, поэтому с вас по-прежнему будет взиматься плата.

**Удаление виртуальной машины**. Если вы удалите виртуальную машину, диски виртуальной машины останутся. Это означает, что вы можете удалить виртуальную машину без потери данных. Тем не менее плата за хранение по-прежнему будет взиматься. Чтобы удалить диск виртуальной машины, удалите объект управляемого диска. Чтобы предотвратить случайное удаление, используйте *блокировку ресурсов*. Так вы сможете заблокировать всю группу или отдельные ресурсы (например, виртуальную машину).

## <a name="security-considerations"></a>Вопросы безопасности

Подключите виртуальные машины к [Центру безопасности Azure](https://docs.microsoft.com/azure/security-center/quick-onboard-azure-stack), чтобы получить полное представление о состоянии безопасности ваших ресурсов Azure. Центр безопасности отслеживает потенциальные проблемы безопасности, а также обеспечивает полное представление о состоянии системы безопасности развертывания. Центр безопасности настраивается на уровне подписки Azure. Включите сбор данных безопасности, как описано в кратком руководстве [Переход подписки Azure в ценовую категорию "Стандартный" Центра безопасности Azure](https://docs.microsoft.com/azure/security-center/security-center-get-started). Когда сбор данных включен, центр безопасности автоматически проверяет все виртуальные машины, созданные для этой подписки.

**Управление исправлениями**. Сведения о настройке управления исправлениями на виртуальной машине см. в [этой](https://docs.microsoft.com/azure-stack/user/vm-update-management) статье. Если эта функция включена, центр безопасности проверяет наличие необходимых обновлений для системы безопасности и критических обновлений. Установите для виртуальной машины [параметры групповой политики](https://docs.microsoft.com/windows-server/administration/windows-server-update-services/deploy/4-configure-group-policy-settings-for-automatic-updates), разрешающие автоматическое обновление системы.

**Антивредоносная программа**. Если эта функция включена, то Центр безопасности проверяет, установлена ли антивредоносное ПО. Центр безопасности позволяет также установить антивредоносное ПО с помощью портала Azure.

**Контроль доступа**. Используйте [управление доступом на основе ролей (RBAC)](https://docs.microsoft.com/azure/active-directory/role-based-access-control-what-is) для управления доступом к ресурсам Azure. RBAC позволяет назначить роли авторизации участникам команды DevOps. Например, роль "Читатель" позволяет просматривать ресурсы Azure, но не позволяет создавать и удалять их или управлять ими. Некоторые разрешения относятся к типу ресурса Azure. Например, роль "Участник виртуальных машин" позволяет перезапустить виртуальную машину или отменить ее выделение, сбросить пароль администратора, создать новую виртуальную машину и т. д. Для этой архитектуры могут оказаться полезными и другие [встроенные роли RBAC](https://docs.microsoft.com/azure/active-directory/role-based-access-built-in-roles), например [пользователь DevTest Labs](https://docs.microsoft.com/azure/active-directory/role-based-access-built-in-roles#devtest-labs-user) и [Участник сетей](https://docs.microsoft.com/azure/active-directory/role-based-access-built-in-roles#network-contributor).

> [!Note]  
> RBAC не ограничивает действия, которые может выполнять пользователь, вошедший в виртуальную машину. Эти разрешения определяются типом учетной записи в гостевой ОС.

**Журналы аудита**. Просматривать действия по подготовке и другие события для виртуальной машины можно с помощью [журналов действий](https://docs.microsoft.com/azure-stack/user/azure-stack-metrics-azure-data?#activity-log).

**Шифрование данных**. Azure Stack использует 128-разрядное шифрование AES BitLocker для защиты неактивных данных пользователя и инфраструктуры в подсистеме хранения. Дополнительные сведения см. в статье [Шифрование неактивных данных в Azure Stack](https://docs.microsoft.com/azure-stack/operator/azure-stack-security-bitlocker).


## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения о виртуальных машинах Azure Stack см. в [этой статье](azure-stack-vm-considerations.md).  
- Дополнительные сведения о шаблонах для облака Azure см. в статье [Конструктивные шаблоны облачных решений](https://docs.microsoft.com/azure/architecture/patterns).
