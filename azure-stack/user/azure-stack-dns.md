---
title: DNS в Azure Stack Hub
description: Узнайте об использовании DNS в Azure Stack Hub и о том, как создать зоны DNS и управлять ими.
author: sethmanheim
ms.topic: article
ms.date: 01/24/2020
ms.author: sethm
ms.lastreviewed: 01/05/2019
ms.openlocfilehash: dd2b00ced084f4a069626f56d37eec1cdae238d6
ms.sourcegitcommit: fd5d217d3a8adeec2f04b74d4728e709a4a95790
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76884838"
---
# <a name="use-dns-in-azure-stack-hub"></a>Использование DNS в Azure Stack Hub

Azure Stack Hub поддерживает следующие возможности Azure DNS:

* Разрешение DNS-имен узлов.
* Создание зон и записей DNS и управление ими с помощью API.

## <a name="support-for-dns-hostname-resolution"></a>Разрешение DNS-имен узлов

Можно указать метку DNS-имени домена для ресурсов общедоступных IP-адресов. Azure Stack Hub использует имя метки **domainnamelabel.location.cloudapp.azurestack.external** и сопоставляет его с общедоступным IP-адресом на DNS-серверах, управляемых Azure Stack Hub.

Например, если вы создадите в локальном расположении Azure Stack Hub ресурс с общедоступным IP-адресом и укажете для него метку доменного имени **contoso**, то [полное доменное имя (FQDN)](https://en.wikipedia.org/wiki/Fully_qualified_domain_name) **contoso.local.cloudapp.azurestack.external** будет разрешаться общедоступному IP-адресу этого ресурса. Это полное доменное имя можно использовать для создания записи CNAME личного домена, которая указывает на общедоступный IP-адрес в Azure Stack Hub.

Дополнительные сведения о разрешении имен см. в статье [Разрешение DNS](/azure/dns/dns-for-azure-services?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

> [!IMPORTANT]
> Каждая создаваемая метка доменного имени должна быть уникальной в пределах своего расположения в Azure Stack Hub.

На следующем снимке экрана показано диалоговое окно **Создать общедоступный IP-адрес** для создания общедоступного IP-адреса с помощью портала.

![Создание общедоступного IP-адреса](media/azure-stack-dns/image01.png)

### <a name="example-scenario"></a>Пример сценария

Предположим, что запросы от веб-приложения обрабатывает подсистема балансировки нагрузки. В зоне действия подсистемы балансировки нагрузки имеется веб-сайт, выполняемый на одной или нескольких виртуальных машинах. Вы можете обращаться к веб-сайту с балансировкой нагрузки по доменному имени вместо IP-адреса.

## <a name="create-and-manage-dns-zones-and-records-using-the-apis"></a>Создание зон и записей DNS и управление ими с помощью API

В Azure Stack Hub вы можете создавать зоны и записи DNS и управлять ими.

Azure Stack Hub, как и Azure, предоставляет службу DNS. Интерфейсы API этой службы совпадают с интерфейсами API службы Azure DNS.  Размещая домены в службе DNS Azure Stack Hub, вы можете управлять своими записями DNS с помощью тех же учетных данных, API и инструментов. Кроме того, можно оплачивать их использование и получать помощь, как и для других служб Azure.

Инфраструктура DNS в Azure Stack Hub более компактна, чем ее аналог в Azure. Размер и расположение развертывания Azure Stack Hub влияет на область, масштаб и производительность службы DNS. Это также означает, что показатели производительности, доступности, глобального распространения и высокого уровня доступности будут зависеть от конкретного развертывания.

## <a name="comparison-with-azure-dns"></a>Сравнение с Azure DNS

DNS в Azure Stack Hub похож на DNS в Azure, но существуют некоторые важные отличия между ними.

* **Записи AAAA не поддерживаются**. Azure Stack Hub не поддерживает записи типа AAAA, так как Azure Stack Hub не поддерживает IPv6-адреса. Это ключевое различие между службами DNS в Azure и Azure Stack Hub.

* **Мультитенантность не поддерживается**. Служба DNS в Azure Stack Hub не является мультитенантной. Разные клиенты не могут создать одинаковые зоны DNS. Успешной будет только первая попытка создать зону, а все последующие запросы завершатся ошибкой. Это еще одно ключевое различие между службами DNS в Azure и Azure Stack Hub.

* **Теги, метаданные и теги ETag**. Существует несколько незначительных различий в том, как Azure Stack Hub обрабатывает теги, метаданные, теги ETag и ограничения.

Чтобы узнать больше о Azure DNS, ознакомьтесь с [зонами и записями DNS](/azure/dns/dns-zones-records).

### <a name="tags"></a>Теги

Служба DNS в Azure Stack Hub поддерживает использование тегов Azure Resource Manager в ресурсах зоны DNS. Он не поддерживает теги в наборах записей DNS. Вместо этого в наборе записей DNS можно использовать **метаданные**, как описано в следующем разделе.

### <a name="metadata"></a>Метаданные

Вместо тегов для наборов записей служба DNS в Azure Stack Hub поддерживает создание заметок с помощью *метаданных*. Так же как и теги, метаданные позволяют связывать пары "имя — значение" с каждым набором записей. Например, метаданные позволяют указать назначение каждого набора записей. В отличие от тегов, метаданные нельзя использовать, чтобы обеспечить отфильтрованное представление счетов Azure, и указывать в политике Azure Resource Manager.

### <a name="etags"></a>Теги Etag

Предположим, что два человека или два процесса пробуют изменить запись DNS одновременно. У какого из них это получится? И будет ли этот человек или процесс знать, что они заменили изменения кого-то другого?

Служба DNS в Azure Stack Hub использует теги *ETag* для безопасной обработки параллельных изменений одного ресурса. Теги ETag не связаны с *тегами* Azure Resource Manager. С каждым ресурсом DNS (зоной или набором записей) связан Etag. При извлечении ресурса также передается его значение Etag. При обновлении ресурса вы можете вернуть ETag, чтобы служба DNS в Azure Stack Hub могла сопоставить его с ETag на сервере. Так как каждое обновление ресурса приводит к повторному созданию Etag, несовпадение Etag указывает на параллельное изменение. Теги Etag можно также использовать при создании ресурса для проверки того, что ресурс не существует.

По умолчанию командлеты PowerShell для Azure Stack Hub DNS используют теги ETag для защиты от одновременных изменений зон и наборов записей. Чтобы отменить эти проверки ETag, укажите необязательный параметр `-Overwrite`. При отсутствии проверок ETag все изменения, которые были внесены одновременно, перезаписываются.

На уровне REST API службы DNS в Azure Stack Hub теги ETag указываются с помощью заголовков HTTP. Их поведение описывается в следующей таблице:

| Заголовок | Поведение|
|--------|---------|
| None   | PUT всегда завершается успешно (без проверок Etag).|
| If-match| PUT завершается успешно, только если ресурс существует и Etag совпадает.|
| If-match *| PUT завершается успешно, только если ресурс существует.|
| If-none-match*| PUT завершается успешно, только если ресурс не существует.|

### <a name="limits"></a>Ограничения

При использовании службы DNS в Azure Stack Hub по умолчанию применяются следующие ограничения:

| Ресурс| Ограничение по умолчанию|
|---------|--------------|
| Зон на подписку| 100|
| Наборов записей на зону| 5000|
| Записей на набор записей| 20|

## <a name="next-steps"></a>Дальнейшие действия

* [Использование iDNS в Azure Stack Hub](azure-stack-understanding-dns.md)
