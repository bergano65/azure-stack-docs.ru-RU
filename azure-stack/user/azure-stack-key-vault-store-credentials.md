---
title: Хранение учетных данных субъект-службы Azure Stack в Key Vault | Документация Майкрософт
description: Узнайте, как Key Vault хранит учетные данные субъект-службы в Azure Stack
services: azure-stack
documentationcenter: ''
author: WenJason
manager: digimobile
editor: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
origin.date: 01/16/2019
ms.date: 02/18/2019
ms.author: v-jay
ms.lastreviewed: 01/16/2019
ms.openlocfilehash: d4bc560a1c607d4a12cfb3d08ffeacf9b5d2196a
ms.sourcegitcommit: 0973dddb81db03cf07c8966ad66526d775ced8b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "64310862"
---
# <a name="store-service-principal-credentials-in-key-vault"></a>Хранение учетных данных субъект-службы в Key Vault

Для разработки приложений в Azure Stack обычно требуется создать субъект-службу и использовать эти учетные данные для проверки подлинности перед развертыванием. Тем не менее в большинстве случаев сохраненные учетные данные для субъект-службы неправильно расположены. В этой статье описывается, как создать субъект-службу и сохранить значения в Azure Key Vault для последующего извлечения.

Дополнительные сведения о Key Vault см. в [этой статье](azure-stack-key-vault-intro.md).

## <a name="prerequisites"></a>Предварительные требования

- Подписка на предложение, включающее службу Azure Key Vault.
- Среда PowerShell должна быть настроена для использования с Azure Stack.

## <a name="key-vault-in-azure-stack"></a>Key Vault в Azure Stack

Key Vault в Azure Stack помогает защитить криптографические ключи и секреты, используемые облачными приложениями и службами. С помощью Key Vault можно зашифровать ключи и секреты.

Чтобы создать хранилище ключей, выполните следующие действия.

1. Войдите на портал Azure Stack.

2. На панели мониторинга выберите **+ Создать ресурс**, затем **Безопасность и идентификация**, а затем **Key Vault**.

   ![Создание хранилища ключей](media/azure-stack-key-vault-store-credentials/create-key-vault.png)

3. В области **создания Key Vault** назначьте **Имя** для хранилища ключей. Имена хранилища могут содержать только буквы, цифры и дефис (-). Имена не должны начинаться с цифры.

4. Выберите подписку из списка доступных подписок.

5. Выберите существующую группу ресурсов или создайте новую.

6. Выберите ценовую категорию.

7. Выберите одну из существующих политик доступа или создайте новую. Политика доступа позволяет предоставлять пользователю, приложению или группе безопасности права на операции с хранилищем.

8. При необходимости выберите политику расширенного доступа, чтобы обеспечить доступ к функциям.

9. Настройте параметров, нажмите кнопку **ОК**, а затем — **Создать**. Начинается развертывание хранилища ключей.

## <a name="create-a-service-principal"></a>Создание субъекта-службы

1. Войдите в учетную запись Azure через портал Azure.

2. Выберите **Azure Active Directory**, затем **Регистрация приложений**, а затем — **Добавить**.

3. Укажите имя и URL-адрес для приложения. Выберите тип создаваемого приложения: **веб-приложение или API** или **собственное приложение**. Выбрав нужные значения, нажмите кнопку **Создать**.

4. Выберите **Active Directory**, затем **Регистрация приложений** и выберите свое приложение.

5. Скопируйте **идентификатор приложения** и сохраните его в коде приложения. В примерах приложений в качестве **идентификатора приложения** используется **идентификатор клиента**.

6. Чтобы создать ключ проверки подлинности, щелкните **Ключи**.

7. Введите описание и срок действия ключа.

8. Щелкните **Сохранить**.

9. Скопируйте **ключ**, который станет доступен после нажатия **Сохранить**.

## <a name="store-the-service-principal-inside-key-vault"></a>Хранение субъект-службы в Key Vault

1. Войдите на пользовательский портал для Stack Azure, выберите созданное ранее хранилище ключей, затем щелкните плитку **Секреты**.

2. На панели **Секрет** выберите **Создать или импортировать**.

3. На панели **Создать секрет** из списка параметров выберите **Вручную**. Если вы создали субъект-службу с помощью сертификатов, в раскрывающемся списке нужно выбрать сертификаты, а затем загрузить файл.

4. Введите **идентификатор приложения**, скопированный из субъект-службы, в качестве имени вашего ключа. Имя ключа может содержать только буквы, цифры и дефис (-).

5. Вставьте значение вашего ключа из субъект-службы во вкладку **Значение**.

6. Выберите **Субъект-службу** для **Типа содержимого**.

7. Задайте для своего ключа значения **даты активации** и **срока действия**.

8. Нажмите кнопку **Создать**, чтобы начать развертывание.

Когда секрет будет создан, в нем будут храниться сведения о субъект-службе. Вы можете выбрать его в любое время в области **Секреты**, чтобы просмотреть или изменить свойства. В разделе свойств содержится идентификатор ключа — универсальный код ресурса (URI), который используют внешние приложения для доступа к этому секрету.

## <a name="next-steps"></a>Дополнительная информация

- [Предоставление приложениям доступа к ресурсам Azure Stack за счет создания субъектов-служб](azure-stack-create-service-principals.md)
- [Управление Key Vault в Azure Stack с помощью портала](azure-stack-key-vault-manage-portal.md)  
- [Управление Key Vault в Azure Stack с помощью PowerShell](azure-stack-key-vault-manage-powershell.md)