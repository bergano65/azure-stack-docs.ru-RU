---
title: Развертывание блокчейн-сети Ethereum в Azure Stack Hub
description: Из этого руководства вы узнаете, как развертывать и настраивать блокчейн-сети консорциума Ethereum в Azure Stack Hub с помощью пользовательских шаблонов решений.
author: PatAltimore
ms.author: patricka
ms.date: 06/03/2019
ms.topic: tutorial
ms.reviewer: seyadava
ms.lastreviewed: 06/03/2019
ms.openlocfilehash: a0a13af01fc539788d76377f357ca28db9b05234
ms.sourcegitcommit: 4ac711ec37c6653c71b126d09c1f93ec4215a489
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2020
ms.locfileid: "77703083"
---
# <a name="deploy-an-ethereum-blockchain-network-on-azure-stack-hub"></a>Развертывание блокчейн-сети Ethereum в Azure Stack Hub

Шаблон решения Ethereum должен помочь проще и быстрее развертывать и настраивать сеть блокчейна со множеством членов консорциума Ethereum с минимальными понятиями об Azure и Ethereum.

Небольшой объем входных пользовательских данных и развертывание одним щелчком на клиентском портале Azure Stack Hub позволяют каждому участнику подготовить участок сети. Используемый участок сети для каждого участника включает три компонента:

1. набор узлов транзакций с балансировкой нагрузки, с помощью которого приложение или пользователь могут взаимодействовать для отправки транзакций;
2. набор узлов интеллектуального анализа для записи транзакций;
3. сетевой виртуальный модуль (NVA).

На следующем этапе добавляется подключение NVA для создания полностью настроенной блокчейн-сети со множеством участников.

Настройка

- Выберите архитектуру развертывания.
- Разверните изолированную сеть, сеть лидера или участника консорциума.

## <a name="prerequisites"></a>Предварительные требования

Загрузите самые новые элементы [из Marketplace](../operator/azure-stack-download-azure-marketplace-item.md):

- Ubuntu Server 16.04 LTS
- Windows Server 2016
- Настраиваемый скрипт для Linux 2.0
- Расширение Custom Script в ОС Windows

Дополнительные сведения о сценариях блокчейна см. в статье о [консорциуме Proof-of-Authority в Ethereum](/azure/blockchain/templates/ethereum-poa-deployment).

## <a name="deployment-architecture"></a>Архитектура развертывания

Этот шаблон решения можно развернуть для одного или множества участников сети консорциума Ethereum. Виртуальная сеть подключена к топологии цепочки с помощью виртуальных сетевых модулей и ресурсов подключения.

## <a name="deployment-use-cases"></a>Варианты использования развертывания

Шаблон консорциума Ethereum можно развернуть для лидера, а участники могут присоединяться разными способами. Ниже описаны проверенные нами способы подключения:

- Во многоузловой системе Azure Stack Hub с помощью Azure AD или AD FS развертывание для лидера и участника выполняется с использованием одной и той же подписки или с разными подписками.
- В одноузловой системе Azure Stack Hub (с Azure AD) развертывание для лидера и участника выполняется с использованием одной подписки.

### <a name="standalone-and-consortium-leader-deployment"></a>Автономное развертывание и развертывание ведущего консорциума

Расположение первого члена в сети настраивается в шаблоне ведущего консорциума. 

1. Скачайте [шаблон лидера из GitHub](https://aka.ms/aa6z619).
2. Чтобы выполнить развертывание на основе пользовательского шаблона, на портале клиента Azure Stack Hub выберите **+ Создать ресурс > Развертывание шаблона**.
3. Чтобы изменить новый настраиваемый шаблон, выберите **Изменить шаблон**.
4. На панели редактирования справа скопируйте и вставьте шаблон ведущего JSON, который был загружен ранее.
    
    ![Изменение шаблона ведущего](./media/azure-stack-ethereum/edit-leader-template.png)

5. Щелкните **Сохранить**.
6. Выберите **Изменить параметры** и завершите настройку параметров шаблона для развертывания.
    
    ![Изменение параметров шаблона ведущего](./media/azure-stack-ethereum/edit-leader-parameters.png)

    Имя параметра | Описание | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    NAMEPREFIX | Строка используется в качестве основы для именования развернутых ресурсов. | От 1 до 6 буквенно-цифровых символов. | eth
    AUTHTYPE | Метод аутентификации на виртуальной машине. | Пароль или открытый ключ SSH. | Пароль
    ADMINUSERNAME | Имя администратора для каждой развернутой виртуальной машины. | 1–64 знака. | gethadmin
    ADMINPASSWORD (Authentication type = Password)| Пароль учетной записи администратора для каждой развернутой виртуальной машины. Пароль должен содержать три следующих элемента: одна строчная буква, одна прописная буква, одна цифра и один специальный знак. <br />Хотя все виртуальные машины изначально имеют одинаковый пароль, вы можете изменить пароль после инициализации.|12–72 знака. |
    ADMINSSHKEY (Authentication type = sshPublicKey) | Ключ защищенной оболочки, используемый для удаленного входа. | |
    GENESISBLOCK | Строка формата JSON, представляющая пользовательский первичный блок.  Указание значения для этого параметра не является обязательным. | |
    ETHEREUMACCOUNTPSSWD | Пароль администратора, используемый для защиты учетной записи Ethereum. | |
    ETHEREUMACCOUNTPASSPHRASE | Парольная фраза, используемая для создания закрытого ключа, связана с учетной записью Ethereum. | |
    ETHEREUMNETWORKID | Идентификатор сети консорциума. | Используйте любое значение от 5 до 999 999 999. | 72
    CONSORTIUMMEMBERID | Идентификатор, который связан с каждым членом консорциума в сети.   | Он должен обладать уникальным значением. | 0
    NUMMININGNODES | Количество узлов майнинга. | От 2 до 15. | 2
    MNNODEVMSIZE | Размер виртуальной машины узлов майнинга. | | Standard_A1
    MNSTORAGEACCOUNTTYPE | Производительность хранилища узлов майнинга. | | Standard_LRS
    NUMTXNODES | Количество транзакционных узлов. | От 1 до 5. | 1
    TXNODEVMSIZE | Размер виртуальной машины транзакционных узлов. | | Standard_A1
    TXSTORAGEACCOUNTTYPE | Производительность хранилища транзакционных узлов. | | Standard_LRS
    BASEURL | Базовый URL-адрес, который необходим для получения шаблонов развертывания. | Используйте значение по умолчанию, если настраивать шаблоны развертывания нет необходимости. | 

7. Щелкните **ОК**.
8. На панели **Настраиваемое развертывание** укажите **Подписку**, **Группу ресурсов** и **Расположение группы ресурсов**.
    
    ![Параметры развертывания ведущего](./media/azure-stack-ethereum/leader-deployment-parameters.png)

    Имя параметра | Описание | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    Подписка | Подписка, для которой необходимо развернуть сеть консорциума. | | Подписка потребления
    Группа ресурсов | Группа ресурсов, куда будет развертываться сеть консорциума. | | EthereumResources
    Расположение | Регион Azure для группы ресурсов. | | local

8. Нажмите кнопку **создания**.

Для развертывания может потребоваться 20 минут и более.

По завершении развертывания просмотрите сводку по развертыванию **Microsoft.Template** в разделе развертывания группы ресурсов. В сводке содержатся выходные значения, с помощью которых можно объединить участников консорциума.

Чтобы проверить развертывание для лидера, перейдите на сайт администрирования лидера. Адрес сайта администрирования можно найти в разделе выходных данных развертывания **Microsoft.Template**.  

![Сводка по развертыванию ведущего](./media/azure-stack-ethereum/ethereum-node-status.png)

### <a name="joining-consortium-member-deployment"></a>Развертывание присоединения членов консорциума

1. Скачайте [шаблон участников консорциума из GitHub](https://aka.ms/aa6zkua).
2. Чтобы выполнить развертывание на основе пользовательского шаблона, на портале клиента Azure Stack Hub выберите **+ Создать ресурс > Развертывание шаблона**.
3. Чтобы изменить новый настраиваемый шаблон, выберите **Изменить шаблон**.
4. На панели редактирования, справа, скопируйте и вставьте шаблон ведущего JSON, который был загружен ранее.
5. Щелкните **Сохранить**.
6. Выберите **Изменить параметры** и завершите настройку параметров шаблона для развертывания.

    Имя параметра | Описание | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    NAMEPREFIX | Строка используется в качестве основы для именования развернутых ресурсов. | От 1 до 6 буквенно-цифровых символов. | eth
    AUTHTYPE | Метод аутентификации на виртуальной машине | Пароль или открытый ключ SSH. | Пароль
    ADMINUSERNAME | Имя администратора для каждой развернутой виртуальной машины | 1–64 знака. | gethadmin
    ADMINPASSWORD (Authentication type = Password)| Пароль учетной записи администратора для каждой развернутой виртуальной машины. Пароль должен содержать три следующих элемента: одна строчная буква, одна прописная буква, одна цифра и один специальный знак. <br />Хотя все виртуальные машины изначально имеют одинаковый пароль, вы можете изменить пароль после инициализации.|12–72 знака. |
    ADMINSSHKEY (Authentication type = sshPublicKey) | Ключ защищенной оболочки, используемый для удаленного входа. | |
    CONSORTIUMMEMBERID | Идентификатор, который связан с каждым членом консорциума в сети.   | Он должен обладать уникальным значением. | 0
    NUMMININGNODES | Количество узлов майнинга. | От 2 до 15. | 2
    MNNODEVMSIZE | Размер виртуальной машины узлов майнинга. | | Standard_A1
    MNSTORAGEACCOUNTTYPE | Производительность хранилища узлов майнинга. | | Standard_LRS
    NUMTXNODES | Количество транзакционных узлов. | От 1 до 5. | 1
    TXNODEVMSIZE | Размер виртуальной машины транзакционных узлов. | | Standard_A1
    TXSTORAGEACCOUNTTYPE | Производительность хранилища транзакционных узлов. | | Standard_LRS
    CONSORTIUMDATA | URL-адрес, указывающий на данные конфигурации соответствующего консорциума, предоставляемые развертыванием другого участника. Это значение можно найти в выходных данных развертывания ведущего. | |
    REMOTEMEMBERVNETADDRESSSPACE | IP-адрес NVA ведущего. Это значение можно найти в выходных данных развертывания ведущего. | | 
    REMOTEMEMBERNVAPUBLICIP | IP-адрес NVA ведущего. Это значение можно найти в выходных данных развертывания ведущего. | | 
    CONNECTIONSHAREDKEY | Предварительно заданный секретный ключ между членами сети консорциума, которые устанавливают соединение. | |
    BASEURL | Базовый URL-адрес шаблона. | Используйте значение по умолчанию, если настраивать шаблоны развертывания нет необходимости. | 

7. Щелкните **ОК**.
8. На панели **Настраиваемое развертывание** укажите **Подписку**, **Группу ресурсов** и **Расположение группы ресурсов**.

    Имя параметра | Описание | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    Подписка | Подписка, для которой необходимо развернуть сеть консорциума. | | Подписка потребления
    Группа ресурсов | Группа ресурсов, куда будет развертываться сеть консорциума. | | MemberResources
    Расположение | Регион Azure для группы ресурсов. | | local

8. Нажмите кнопку **создания**.

Для развертывания может потребоваться 20 минут и более.

По завершении развертывания просмотрите сводку по развертыванию **Microsoft.Template** в разделе развертывания группы ресурсов. В сводке содержатся выходные значения, с помощью которых можно объединить участников консорциума.

Чтобы проверить развертывание члена, необходимо перейти на сайты администрирования членов. Адрес сайта администрирования можно найти в выходном разделе развертывания **Microsoft.Template**.

![Сводная информация по развертыванию члена](./media/azure-stack-ethereum/ethereum-node-status-2.png)

Член узла находится в состоянии **Не запущен** (как указано на рисунке). Участник узла находится в этом состоянии, так как подключение между лидерами и участниками установить не удалось. Подключение между ведущим и членами является двусторонним. При развертывании членов подключение между членом и ведущим создается автоматически. Чтобы создать подключение между лидером и членом, необходимо выполнить следующие действия.

### <a name="connect-member-and-leader"></a>Подключение члена и ведущего

При помощи этого шаблона создается подключение между ведущим и удаленным членом. 

1. Скачайте [шаблон подключения лидера и участников из GitHub](https://aka.ms/aa6zdyt).
2. Чтобы выполнить развертывание на основе пользовательского шаблона, на портале клиента Azure Stack Hub выберите **+ Создать ресурс > Развертывание шаблона**.
3. Чтобы изменить новый настраиваемый шаблон, выберите **Изменить шаблон**.
4. На панели редактирования, справа, скопируйте и вставьте шаблон ведущего JSON, который был загружен ранее.
    
    ![Изменение шаблона подключения](./media/azure-stack-ethereum/edit-connect-template.png)

5. Щелкните **Сохранить**.
6. Выберите **Изменить параметры** и завершите настройку параметров шаблона для развертывания.
    
    ![Изменение параметров шаблона подключения](./media/azure-stack-ethereum/edit-connect-parameters.png)

    Имя параметра | Описание | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    MEMBERNAMEPREFIX | Префикс в имени ведущего. Это значение можно найти в выходных данных развертывания ведущего.  | От 1 до 6 буквенно-цифровых символов. | |
    MEMBERROUTETABLENAME | Имя таблицы маршрута ведущего. Это значение можно найти в выходных данных развертывания ведущего. |  | 
    REMOTEMEMBERVNETADDRESSSPACE | Адресное пространство члена. Это значение можно найти в выводе развертывания члена. | |
    CONNECTIONSHAREDKEY | Предварительно заданный секретный ключ между членами сети консорциума, которые устанавливают соединение.  | |
    REMOTEMEMBERNVAPUBLICIP | IP-адрес NVA члена. Это значение можно найти в выводе развертывания члена. | |
    MEMBERNVAPRIVATEIP | Частный IP-адрес NVA ведущего. Это значение можно найти в выходных данных развертывания ведущего. | |
    LOCATION | Расположение среды Azure Stack Hub. | | local
    BASEURL | Базовый URL-адрес шаблона. | Используйте значение по умолчанию, если настраивать шаблоны развертывания нет необходимости. | 

7. Щелкните **ОК**.
8. На панели **Настраиваемое развертывание** укажите **Подписку**, **Группу ресурсов** и **Расположение группы ресурсов**.
    
    ![Параметры развертывания подключения](./media/azure-stack-ethereum/connect-deployment-parameters.png)

    Имя параметра | Описание | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    Подписка | Подписка ведущего. | | Подписка потребления
    Группа ресурсов | Группа ресурсов ведущего. | | EthereumResources
    Расположение | Регион Azure для группы ресурсов. | | local

8. Нажмите кнопку **создания**.

После завершения развертывания необходимо подождать несколько минут, прежде чем ведущий и члены смогут установить подключение. Чтобы проверить развертывание, обновите сайт администрирования члена. Состояние узла члена должно измениться на "Выполняется".

![Проверка развертывания](./media/azure-stack-ethereum/ethererum-node-status-3.png)

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об Ethereum и Azure см. в статье [Блокчейн-технология и приложения](https://azure.microsoft.com/solutions/blockchain/).
