---
title: Гибридное решение для реализации шаблона определения посещаемости на основе искусственного интеллекта с использованием Azure и Azure Stack
description: Узнайте, как использовать службы Azure и Azure Stack для реализации шаблона определения посещаемости на основе искусственного интеллекта для анализа трафика розничного магазина.
services: azure-stack
documentationcenter: ''
author: BryanLa
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 10/01/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 09/23/2019
ms.openlocfilehash: 32533b063d4c42b740825923e9e2b5692ec03728
ms.sourcegitcommit: bbf3edbfc07603d2c23de44240933c07976ea550
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2019
ms.locfileid: "71714636"
---
# <a name="footfall-detection-solution"></a>Решение для определения посещаемости

В этой статье представлен обзор решения для реализации шаблона определения посещаемости на основе искусственного интеллекта. Этот шаблон полезен для анализа трафика посетителей в розничных магазинах. Решение создает полезные сведения на основе реальных действий, используя Azure, Azure Stack и пакет средств разработки для искусственного интеллекта Пользовательского визуального распознавания.

## <a name="context-and-problem"></a>Контекст и проблема

Магазины Contoso хотят получать полезные сведения о том, как клиенты получают имеющиеся продукты в соответствии со схемой магазина. Они не могут разместить сотрудников в каждом отделе, а на просмотр группой аналитиков всего материала с камер магазина уйдет много времени. Кроме того, ни один из их магазинов не имеет достаточной пропускной способности для потоковой передачи видео со всех своих камер в облако для анализа. 

Компания Contoso хочет найти ненавязчивый защищенный способ определения демографических данных, постоянных клиентов и их реакции на витрины и продукты.

## <a name="solution"></a>Решение

Это решение для розничной аналитики использует многоуровневый подход к формированию выводов на пограничных устройствах. При использовании пакета средств разработки для искусственного интеллекта Пользовательского визуального распознавания для анализа в частном Azure Stack, на котором запущены Azure Cognitive Services, отправляются только изображения с человеческими лицами. Анонимные статистические данные со всех магазинов отправляются в Azure для агрегирования и визуализации в Power BI. Объединение пограничных и общедоступных облаков позволяет Contoso использовать преимущества современных технологий искусственного интеллекта. В то же время такое решение соответствует корпоративным политикам и учитывает конфиденциальность клиентов.

[![Шаблон определения посещаемости](media/hybrid-pattern-ai-footfall-detection/solution-architecture.png)](media/hybrid-pattern-ai-footfall-detection/solution-architecture.png)

Ниже приведены общие принципы работы решения. 

1. Пакет разработки для искусственного интеллекта Пользовательского визуального распознавания получает настройки из центра Интернета вещей, который устанавливает среду выполнения IoT Edge и модель машинного обучения.
2. Если модель видит человека, она делает снимок и отправляет его в хранилище BLOB-объектов Azure Stack. 
3. Служба BLOB-объектов активирует Функцию Azure в Azure Stack. 
4. Функция Azure вызывает контейнер с API Распознавания лиц для получения демографических данных и данных распознавания эмоций из изображения.
5. Данные обезличиваются и отправляются в концентратор событий Azure.
6. Концентратор событий отправляет данные в Stream Analytics.
7. Stream Analytics выполняет статистическую обработку данных и отправляет их в Power BI.

## <a name="components"></a>Компоненты

Это решение использует следующие компоненты.

| Слой | Компонент | ОПИСАНИЕ |
|----------|-----------|-------------|
| Оборудование в магазине | [Пакет разработки для искусственного интеллекта Пользовательского визуального распознавания](https://azure.github.io/Vision-AI-DevKit-Pages/) | Обеспечивает фильтрацию снимков в магазине с помощью локальной модели машинного обучения, которая фиксирует только изображения людей для анализа. Безопасная подготовка и обновление с помощью Центра Интернета вещей.<br><br>|
| Azure Stack | [Служба приложений](../operator/azure-stack-app-service-overview.md) | Поставщик ресурсов службы приложений предоставляет основу для пограничных компонентов, включая компоненты размещения и управления для веб-приложений, API и функций. |
| | Кластер [обработчика](https://github.com/Azure/aks-engine) Службы Azure Kubernetes (AKS). | Поставщик ресурсов AKS с кластером обработчика AKS, развернутым в Azure Stack, предоставляет масштабируемый отказоустойчивый механизм для запуска контейнера API Распознавания лиц. |
| | [Контейнеры API Распознавания лиц](/azure/cognitive-services/face/face-how-to-install-containers) Cognitive Services в Azure| Поставщик ресурсов Azure Cognitive Services с контейнерами API Распознавания лиц предоставляет демографические данные, данные распознавания эмоций и уникальные определения посетителей в закрытой сети Contoso. |
| | Хранилище BLOB-объектов | Изображения, полученные из пакета средств разработки для искусственного интеллекта, отправляются в хранилище BLOB-объектов Azure Stack. |
| | Функции Azure | Функция Azure, выполняемая в Azure Stack, получает входные данные из хранилища BLOB-объектов и управляет взаимодействиями с API Распознавания лиц. Она выдает анонимные данные в концентратор событий, расположенный в Azure.<br><br>|
| Azure |  |  |
|  | [Центры событий Azure](/azure/event-hubs/) | Концентраторы событий Azure предоставляют масштабируемую платформу для приема анонимных данных, которые корректно интегрируются с Azure Stream Analytics. |
|  | [Azure Stream Analytics](/azure/stream-analytics/) | Задание Azure Stream Analytics выполняет статистическую обработку анонимных данных и группирует их в 15-секундные окна для визуализации. |
|  | [Microsoft Power BI](https://powerbi.microsoft.com/) | Power BI предоставляет простой в использовании интерфейс панели мониторинга для просмотра выходных данных Azure Stream Analytics. |

## <a name="issues-and-considerations"></a>Проблемы и рекомендации

При принятии решения о реализации этого шаблона необходимо учитывать следующие моменты.

### <a name="scalability"></a>Масштабируемость 

Чтобы это решение можно было масштабировать на несколько камер и расположений, необходимо убедиться, что все компоненты могут справиться с повышенной нагрузкой. Может потребоваться выполнить следующие действия:

- Увеличение числа единиц потоковой передачи Stream Analytics.
- Масштабирование развертывания API Распознавания лиц.
- Увеличение пропускной способности концентраторов событий.
- В крайних случаях может потребоваться перенести данные из Функций Azure на виртуальную машину.

### <a name="availability"></a>Доступность

Так как это решение распределено по уровням, важно подумать о том, как справляться с сетевыми сбоями или отключениями электропитания. В зависимости от бизнес-потребностей может быть целесообразно реализовать механизм, который локально кэширует изображения, а затем перенаправляет их в Azure Stack при возобновлении подключения. Если расположение достаточно велико, лучше всего развернуть в этом расположении Data Box Edge с контейнером API Распознавания лиц.

### <a name="manageability"></a>Управляемость

Это решение может масштабироваться на множество устройств и расположений, что может оказаться неудобным. [Службы Интернета вещей Azure](/azure/iot-fundamentals/) можно использовать для автоматического перевода новых расположений и устройств в оперативный режим и их обновления. 

### <a name="security"></a>Безопасность

Это решение собирает изображения клиентов, уделяя особое внимание безопасности. Убедитесь, что все учетные записи хранения защищены с помощью соответствующих политик доступа и что ключи периодически меняются. Убедитесь, что для учетных записей хранения и концентраторов событий имеются политики хранения, соответствующие корпоративным и правительственным нормам конфиденциальности. Кроме того, следите за уровнями доступа, чтобы каждый пользователь, которому необходим доступ к системе, мог просмотреть только те данные, которые необходимы ему по должности.

## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения о связанных шаблонах, используемых в этом решении, см. в статье [Deploy a staged data analytics solution to Azure Stack](azure-stack-solution-staged-data.md) (Развертывание решения аналитики промежуточных данных в Azure Stack). 
- Дополнительные сведения о пакете разработки для искусственного интеллекта Пользовательского визуального распознавания см. в [этой статье](https://azure.github.io/Vision-AI-DevKit-Pages/). 
- Скачайте и разверните [пример внедрения решения для анализа посещаемости](https://github.com/Azure-Samples/azure-intelligent-edge-patterns/tree/master/footfall-analysis). Вы узнаете, как получать полезные сведения на основе реальных действий, используя Azure, Azure Stack и пакет средств разработки для искусственного интеллекта Пользовательского визуального распознавания.   
