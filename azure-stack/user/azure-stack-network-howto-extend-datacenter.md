---
title: Сведения о расширении центра обработки данных в Azure Stack | Документация Майкрософт
description: Узнайте, как расширить центр обработки данных в Azure Stack.
services: azure-stack
author: mattbriggs
ms.service: azure-stack
ms.topic: how-to
ms.date: 10/19/2019
ms.author: mabrigg
ms.reviewer: sijuman
ms.lastreviewed: 10/19/2019
ms.openlocfilehash: 94a9398a68be06d4735e2c082e8dc0a02281b6eb
ms.sourcegitcommit: 58e1911a54ba249a82fa048c7798dadedb95462b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73064969"
---
# <a name="how-to-extend-the-data-center-on-azure-stack"></a>Сведения о расширении центра обработки данных в Azure Stack

*Область применения: интегрированные системы Azure Stack и Пакет средств разработки Azure Stack*

В этой статье приводятся сведения об инфраструктуре хранилища Azure Stack, которые помогут решить, как интегрировать Azure Stack с существующей сетевой средой. Пространство хранилища в Azure Stack ограничено. Хранилище можно интегрировать с хранилищем за пределами Azure Stack и в локальный центр обработки данных. После общего обсуждения вопроса о расширении вашего центра обработки данных в статье представлены два различных сценария. Вы можете подключиться к серверу хранилища файлов Windows. Также можно подключиться к серверу iSCSI Windows.

## <a name="overview-of-extending-storage-to-azure-stack"></a>Общие сведения о расширении хранилища для Azure Stack

На схеме показан сценарий, при котором одна виртуальная машина, выполняющая рабочую нагрузку, подключается к внешнему (к виртуальной машине и самому Azure Stack) хранилищу и использует его для чтения/записи данных и т. д. В этой статье вы сосредоточитесь на простом извлечении файлов, однако вы можете расширить этот пример для более сложных сценариев, таких как удаленное хранение файлов баз данных.

![Расширение хранилища Azure Stack](./media/azure-stack-network-howto-extend-datacenter/image1.png)

На схеме видно, что виртуальная машина в системе Azure Stack была развернута с несколькими сетевыми картами. Как с точки зрения избыточности, так и с точки зрения рекомендуемого хранилища, важно иметь несколько путей между целью и конечным пунктом. Ситуация усложняется, когда у виртуальных машин в Azure Stack есть общедоступные и частные IP-адреса, как в Azure. Если для доступа к виртуальной машине необходимо внешнее хранилище, это можно сделать только через общедоступный IP-адрес, поскольку частные IP-адреса в основном используются в системах Azure Stack, в виртуальных сетях и подсетях. Внешнее хранилище не сможет взаимодействовать с пространством частного IP-адреса виртуальной машины, если оно не будет проходить через VPN типа "сеть-сеть" для подключения к самой виртуальной сети. Таким образом, в этом примере основное внимание уделяется обмену данными через пространство общедоступного IP-адреса. Обратите внимание, что на графике видно, что в пространстве общедоступного IP-адреса существует 2 различные общедоступные подсети пула IP-адресов. По умолчанию, Azure Stack требует всего один пул для общедоступного IP-адреса, но для избыточной маршрутизации необходимо добавить второй пул. Вы можете остановится на модели с общедоступными IP-адресами с того же пула через несколько виртуальных сетевых карт, поскольку выбрать IP-адрес из определенного пула невозможно.

В этом примере можно предположить, что маршрутизация между границами устройств и внешним хранилищем выполнена, и трафик может правильно проходить через сеть. Например, не имеет значения, является ли магистраль на 1 GbE, 10 GbE, 25 GbE или даже быстрее, однако это важно учитывать при планировании интеграции, чтобы удовлетворить потребности в производительности любых приложений, имеющих доступ к этому внешнему хранилищу.

## <a name="connect-to-a-windows-server-file-server-storage"></a>Подключение к хранилищу файловых серверов Windows Server

В этом сценарии вы развернете и настроите виртуальную машину Windows Server 2019 в Azure Stack и подготовите ее к подключению к внешнему файловому серверу, на котором также может работать Windows Server 2019. При необходимости установите ключевые функции, такие как SMB Multichannel для оптимизации производительности и подключения между виртуальной машиной и внешним накопителем.

### <a name="deploy-the-windows-server-2019-vm-on-azure-stack"></a>Развертывание виртуальной машины Windows Server 2019 в Azure Stack

1.  На**портале администратора Azure Stack**, если предположить, что эта система была правильно зарегистрирована и подключена к рынку, выберите **Управление Marketplace,** , а затем, если у вас еще нет образа Windows Server 2019, выберите **Добавить из Azure** и выполните поиск **Windows Server 2019**, добавив образ **Центр обработки данных Windows Server 2019**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image2.png)

    Загрузка образа Windows Server 2019 может занять некоторое время.

2.  Получив образ Windows Server 2019 в среде Azure Stack, войдите на пользовательский портал Azure Stack**.

3.  После входа на пользовательский портал Azure Stack убедитесь, что у вас есть [подписка на предложение](https://docs.microsoft.com/azure-stack/operator/azure-stack-subscribe-plan-provision-vm?view=azs-1908), позволяющее предоставлять ресурсы IaaS (вычисления, хранилище и сеть).

4.  Получив доступ к подписке, вернитесь на **панель мониторинга** на пользовательском портале Azure Stack, выберите **Создать ресурс**, **Вычисления**, а затем — **элемент коллекции Центра обработки данных Windows Server 2019**.

5.  В колонке **Основы** :

    a.  **Имя.** VM001

    b.  **Username**: localadmin

    c.  **Пароль** и **Подтвердите пароль**: \<пароль по вашему выбору>

    d.  **Подписка**: \<Подписка по вашему выбору, с ресурсами вычислений/хранения/сети>

    д. **Группа ресурсов.** Создать новый: Тестирование хранилища

    Е.  Нажмите кнопку **ОК**

6.  В колонке **Выбор размера** выберите **Standard_F8s_v2**.

7.  В колонке **Настройки** выберите **Виртуальная сеть** и в колонке **Создать виртуальную сеть**, настройте адресное пространство на **10.10.10.0/23**, обновите диапазон адресов подсети на **10.10.10.0/24** и нажмите **OK**.

8.  Выберите **Общедоступный IP-адрес**, а в колонке **Создать общедоступный IP-адрес** выберите колонку **Статический**.

9.  В разделе **Выберите общедоступные входящие порты** выберите **RDP (3389)** .

10. Оставьте значения по умолчанию, а затем нажмите **OK**.
    
    ![](./media/azure-stack-network-howto-extend-datacenter/image3.png)

11. Прочитайте сводку, дождитесь подтверждения, затем выберите **OK**, чтобы начать развертывание. Развертывание должно завершиться примерно через 10 минут.

12. После завершения развертывания в разделе **Ресурс** выберите имя виртуальной машины, **VM001**, чтобы перейти к колонке *Обзор*.
    
    ![](./media/azure-stack-network-howto-extend-datacenter/image4.png)

13. В разделе "DNS-имя" выберите **Настроить**, укажите метку DNS-имени **vm001** и нажмите **Сохранить**, а затем выберите **VM001** в строке навигации, чтобы вернуться к колонке *Обзор*.

14. В правой части колонки "Обзор" выберите **storagetesting-vnet/default** в тексте виртуальной сети или подсети.

15. В колонке "storagetesting-vnet" выберите **Подсети** затем **Добавить подсеть**, после чего в колонке "Новая подсеть" введите следующие сведения: 

    a.  **Имя**: subnet2

    b.  **Диапазон адресов (блок CIDR)** . 10.10.11.0/24

    c. **Группа безопасности сети**: Нет

    d.  **Таблица маршрутов**. Нет

    д. Нажмите кнопку **ОК**.

16. После сохранения выберите **VM001** в строке навигации, чтобы вернуться к колонке обзора.

17. Выберите **Сети**.

18. Выберите **Подключить сетевой интерфейс** а затем выберите **Создать сетевой интерфейс**.

19. В колонке **Создание сетевого интерфейса**:

    a.  **Имя**: vm001nic2

    b.  **Подсеть.** Убедитесь, что подсеть: 10.10.11.0/24

    c. **Группа безопасности сети**. VM001 — NSG

    d.  **Группа ресурсов**: storagetesting

20. После успешного создания выберите **VM001** в строке навигации и выберите **Остановить**, чтобы завершить работу виртуальной машины.

21. После остановки (освобождения) виртуальной машины выберите **Сеть**, нажмите **Подключить сетевой интерфейс**, выберите **vm001nic2**, а затем нажмите **ОК**. Через несколько секунд вы добавите в виртуальную машину дополнительный сетевой адаптер.

22. В колонке **Сеть** перейдите на вкладку **vm001nic2**, а затем выберите **Сетевой интерфейс: vm001nic2**.

23. В колонке интерфейса vm001nic выберите **конфигурации IP-адресов** и в центре колонки выберите **ipconfig1**.

24. В колонке параметров "ipconfig1" выберите **Включено** для общедоступного IP-адреса и выберите **Настроить обязательные параметры**, **Создать,** и введите "vm001nic2pip" в поле имя, выберите **Статический**, нажмите **ОК**, а затем **Сохранить**.

25. После успешного сохранения вернитесь в колонку "Обзор VM001" и выберите **Запустить**, чтобы запустить настроенную виртуальную машину Windows Server 2019.

### <a name="configure-the-windows-server-2019-file-server-storage"></a>Настройка хранилища файлового сервера Windows Server 2019

В первом примере выполняется проверка конфигурации, в которой файловый сервер Windows Server 2019 является виртуальной машиной, работающей на Hyper-V. Эта виртуальная машина будет настроена с использованием восьми виртуальных процессоров, одного VHDX-файла и, что наиболее важно, двух виртуальных сетевых адаптеров. В идеальном сценарии эти сетевые адаптеры будут иметь разные маршрутизируемые подсети, но в этом тесте они будут иметь сетевые адаптеры в одной подсети.

![](./media/azure-stack-network-howto-extend-datacenter/image5.png)

Для файлового сервера это может быть Windows Server 2016 или 2019, физический или виртуальный, работающий в Hyper-V, VMware или альтернативная платформа на ваше усмотрение. Ключевым моментом здесь является подключение к системе Azure Stack и обратно, однако предпочтительно иметь несколько путей между источником и получателем, поскольку это обеспечивает дополнительную надежность и позволяет использовать более совершенные возможности для повышения производительности, такие как SMB Multichannel.

Обновите файловый сервер, используя последние накопительные обновления и исправления, перезагрузку, прежде чем продолжить настройку файловых ресурсов.

После обновления и перезагрузки этот сервер можно настроить в качестве файлового сервера.

1) На компьютере с файловым сервером запустите **ipconfig/all** из **CMD** и запишите **DNS-сервер**, который использует ваш файловый сервер.

2)  Откройте **Диспетчер сервера** и выберите **Управление**, затем **Добавить роли и возможности**.

3)  Выберите **Далее**, затем **Установка на основе ролей или функций** и просмотрите выбранные элементы, пока не достигнете страницы **Выбрать роли сервера**.

4)  Разверните **Файловые службы и службы хранилища**, разверните **Файлы и службы iSCSI** и установите флажок **Файловый сервер**. После завершения закройте **Диспетчер сервера**.

5)  Откройте **Диспетчер сервера** снова и выберите **Файловые службы и службы хранилища**.

6)  Выберите **Общие ресурсы**.

7)  В поле **Общие ресурсы**выберите ссылку, **чтобы создать общую папку, запустите мастер создания общего ресурса**.

8)  В поле **Мастер создания общего ресурса** выберите **Общий ресурс SMB — быстрый профиль**, затем выберите **Далее** и перейдите к мастеру, выбрав команду **C:\\\\. Том**.

9)  Присвойте имя общему ресурсу, **TestStorage** затем выберите **Далее**.

10) Вернитесь в **Мастер создания общего ресурса**, последовательно выберите **Далее**, **Создать**, **Закрыть**.

Теперь вы создали свой файловый ресурс на вашем файловом сервере.

### <a name="testing-file-storage-performance-and-connectivity"></a>Тестирование производительности файлового хранилища и возможностей подключения

Чтобы проверить связь и выполнить некоторые элементарные тесты, войдите на пользовательский портал Azure Stack в системе **Azure Stack** и перейдите в колонку **Обзор** для **VM001**.

1)  Выберите **Подключить**, чтобы установить RDP-подключение к VM001.

2)  Для взаимодействия через Hostname вы собираетесь изменить **Узлы** файла. Однако в рабочей среде DNS будет оптимально настроена таким образом, что имена будут разрешены автоматически. Также можно использовать IP-адреса. Но в нашем примере вы измените файл **Узлы**.

3)  Откройте **Блокнот**, убедитесь, что выполняете **Запуск от имени администратора**.

4)  После открытия Блокнота выберите **Файл**, **Открыть** и перейдите в раздел c:\\Windows\System32\Drivers\etc\, и выберите **Все файлы** в правом нижнем углу открытого диалогового окна. Выберите файл **Узлы** и нажмите **Открыть**.

5)  Измените файл узлов, добавив IP-адрес и DNS-имя для файлового сервера.

    ![](./media/azure-stack-network-howto-extend-datacenter/image6.png)

6)  Сохраните файл и закройте Блокнот.

7)  Откройте **CMD** и выполните проверку связи по имени файлового сервера, который вы ввели в файл узлов. Он должен вернуть IP-адрес одного из сетевых адаптеров на файловом сервере, поэтому вручную протестируйте связь с другим адаптером с помощью проверки связи по IP-адресу.

## <a name="connect-to-a-windows-server-iscsi-target-server"></a>Подключение к целевому серверу iSCSI Windows Server

В этом сценарии вы развернете и настроите виртуальную машину Windows Server 2019 в Azure Stack и подготовите ее к подключению к целевому серверу iSCSI, на котором также будет работать Windows Server 2019.

> [!Note]  
> Если вы уже выполнили сценарий, переходите к настройке компьютеров.

### <a name="deploy-the-windows-server-2019-vm-on-azure-stack"></a>Развертывание виртуальной машины Windows Server 2019 в Azure Stack

Если вы еще не развернули виртуальную машину Windows Server 2019 в Azure Stack, выполните действия, описанные в разделе [Развертывание виртуальной машины Windows Server 2019 в Azure Stack](#deploy-the-windows-server-2019-vm-on-azure-stack). Затем можно настроить целевой сервер iSCSI Windows Server 2019.

### <a name="configure-the-windows-server-2019-iscsi-target"></a>Настройка целевого сервера iSCSI Windows Server 2019

В целях этого второго сценария проверьте конфигурацию, в которой целевой сервер iSCSI Windows Server 2019 является виртуальной машиной, работающей в Hyper-V. Эта виртуальная машина будет настроена с использованием восьми виртуальных процессоров, одного VHDX-файла и, что наиболее важно, двух виртуальных сетевых адаптеров. В идеальном сценарии эти сетевые адаптеры будут иметь разные маршрутизируемые подсети, но в этом тесте вы будете иметь сетевые адаптеры в одной подсети.

![](./media/azure-stack-network-howto-extend-datacenter/image5.png)

Для целевого сервера iSCSI это может быть Windows Server 2016 или 2019, физический или виртуальный, работающий в Hyper-V, VMware или альтернативная платформа на ваше усмотрение. Ключевым моментом здесь является подключение к системе Azure Stack и обратно, однако предпочтительно иметь несколько путей между источником и получателем, поскольку это обеспечивает дополнительную надежность и пропускную способность.

Обновите файловый сервер, используя последние накопительные обновления и исправления, перезагрузку, прежде чем продолжить настройку целевого сервера iSCSI.

После обновления и перезагрузки этот сервер можно настроить в качестве целевого сервера iSCSI.

## <a name="next-steps"></a>Дальнейшие действия

[Сети Azure Stack: различия и рекомендации](azure-stack-network-differences.md)  