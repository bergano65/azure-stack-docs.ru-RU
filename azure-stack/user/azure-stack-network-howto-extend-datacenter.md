---
title: Расширение центра обработки данных в Azure Stack Hub
description: Узнайте, как расширить центр обработки данных в Azure Stack Hub.
author: mattbriggs
ms.topic: how-to
ms.date: 12/13/2019
ms.author: mabrigg
ms.reviewer: sijuman
ms.lastreviewed: 12/13/2019
ms.openlocfilehash: fd851b4d25d188c03fe09793986901e28a00a6a5
ms.sourcegitcommit: fd5d217d3a8adeec2f04b74d4728e709a4a95790
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76884676"
---
# <a name="extending-storage-to-azure-stack-hub"></a>Расширение хранилища в Azure Stack Hub

В этой статье приводятся сведения об инфраструктуре хранилища Azure Stack Hub, которые помогут выбрать метод интеграции Azure Stack Hub с существующей сетевой средой. После общего обсуждения вопроса о расширении вашего центра обработки данных в статье представлены два разных сценария. Вы можете подключиться к серверу хранилища файлов Windows. Также можно подключиться к серверу iSCSI Windows.

## <a name="overview-of-extending-storage-to-azure-stack-hub"></a>Общие сведения о расширении хранилища в Azure Stack Hub

В некоторых сценариях данных, расположенных в общедоступном облаке, недостаточно. Возможно, имеется зависимая от задержек виртуализированная рабочая нагрузка базы данных с большим объемом вычислений, а время приема-передачи в общедоступное облако может повлиять на производительность рабочей нагрузки базы данных. Возможно, есть локальные данные, хранящиеся на файловом сервере, запоминающем устройстве, подключаемом к сети, или в массиве хранения iSCSI, которые должны быть доступны локальным рабочим нагрузкам, и их нужно размещать в локальной среде в соответствии с нормативными и корпоративными требованиями. Это лишь два сценария, в которых данные находятся в локальной среде, что очень важно для многих организаций.

Итак, что мешает просто разместить эти данные в учетных записях хранения в Azure Stack Hub или внутри виртуализированных файловых серверов, работающих в системе Azure Stack Hub? В отличие от Azure, хранилище Azure Stack Hub ограничено. Емкость, доступная для использования, полностью зависит от емкости каждого узла, которую вы приобрели, а также от количества имеющихся узлов. А поскольку Azure Stack Hub — это гиперконвергентное решение, то для увеличения емкости хранилища в соответствии с требованиями к потреблению вам придется увеличить и объем вычислительных ресурсов за счет добавления узлов. Это может быть неэкономично, особенно если требуется дополнительная емкость для холодного архивного хранилища, которую можно добавить по низкой стоимости за пределами системы Azure Stack Hub.

Это подталкивает к сценарию, который будет рассмотрен ниже. Как можно просто и эффективно подключить системы Azure Stack Hub (работающие в Azure Stack Hub виртуализированные рабочие нагрузки) к системам хранения за пределами Azure Stack Hub через сеть.

### <a name="design-for-extending-storage"></a>Схема расширения хранилища

На этой схеме показан сценарий, в котором одна виртуальная машина, выполняющая рабочую нагрузку, подключается к внешнему (относительно виртуальной машины и Azure Stack Hub) хранилищу и использует его для чтения, записи данных и других операций. В этой статье вы сосредоточитесь на простом извлечении файлов, однако вы можете расширить этот пример для более сложных сценариев, таких как удаленное хранение файлов баз данных.

![](./media/azure-stack-network-howto-extend-datacenter/image1.png)

На схеме видно, что виртуальная машина в системе Azure Stack Hub развернута с несколькими сетевыми адаптерами. Как с точки зрения избыточности, так и с точки зрения рекомендуемого хранилища важно иметь несколько путей между целью и конечным пунктом. Ситуация усложняется, когда у виртуальных машин в Azure Stack Hub есть одновременно общедоступные и частные IP-адреса, как в Azure. Внешнее хранилище может обращаться к виртуальной машине только по общедоступному IP-адресу, поскольку частные IP-адреса используются внутри систем Azure Stack Hub, ее виртуальных сетей и подсетей. Внешнее хранилище не сможет взаимодействовать с диапазоном частных IP-адресов виртуальной машины, если оно не будет проходить через VPN типа "сеть —сеть" для подключения к самой виртуальной сети. Таким образом, в этом примере основное внимание уделяется обмену данными через диапазон общедоступных IP-адресов. Обратите внимание, что на схеме видно, что в диапазоне общедоступных IP-адресов есть 2 различные общедоступные подсети пула IP-адресов. По умолчанию Azure Stack Hub требуется всего один пул для общедоступного IP-адреса, но для избыточной маршрутизации может потребоваться второй пул. Так как невозможно выбрать IP-адрес из определенного пула, на данный момент вы вполне можете остановиться на модели с общедоступными IP-адресами из того же пула в нескольких виртуальных сетевых картах.

В контексте этого обсуждения можно предположить, что маршрутизация между границами устройств и внешним хранилищем выполнена, и трафик может правильно проходить через сеть. Например, не имеет значения, какова скорость магистрали (1 GbE, 10 GbE, 25 GbE или даже быстрее), но это важно учитывать при планировании интеграции, чтобы удовлетворить потребности в производительности любых приложений, имеющих доступ к этому внешнему хранилищу.

## <a name="connect-to-a-windows-server-iscsi-target"></a>Подключение к цели iSCSI Windows Server

В этом сценарии мы развернем и настроим виртуальную машину Windows Server 2019 в Azure Stack Hub и подготовим ее к подключению к целевому объекту iSCSI, в котором также будет работать Windows Server 2019. При необходимости мы включим ключевые функции, такие как MPIO, для оптимизации производительности и подключения между виртуальной машиной и внешним накопителем.

### <a name="deploy-the-windows-server-2019-vm-on-azure-stack-hub"></a>Развертывание виртуальной машины Windows Server 2019 в Azure Stack Hub

1.  На **портале администратора Azure Stack Hub**, если система была правильно зарегистрирована и подключена к Marketplace, выберите **Marketplace Management** (Управление Marketplace). Если у вас нет образа Windows Server 2019, выберите **Add from Azure** (Добавить из Azure), выполните поиск по фразе **Windows Server 2019** и добавьте образ **Windows Server 2019 Datacenter**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image2.png)

    Загрузка образа Windows Server 2019 может занять некоторое время.

2.  Получив образ Windows Server 2019 в среде Azure Stack Hub, войдите на **пользовательский портал Azure Stack Hub**.

3.  После входа на пользовательский портал Azure Stack Hub убедитесь, что у вас есть [подписка на предложение](https://docs.microsoft.com/azure-stack/operator/azure-stack-subscribe-plan-provision-vm?view=azs-1908), позволяющее предоставлять ресурсы IaaS (вычисления, хранилище и сеть).

4.  Получив доступ к подписке, вернитесь на **панель мониторинга** на пользовательском портале Azure Stack Hub, выберите **Создать ресурс**, **Вычисления**, а затем — **элемент коллекции Центра обработки данных Windows Server 2019**.

5.  В колонке **Основы** введите следующие сведения:

    а.  **Name** (Имя). VM001

    b.  **Username**: localadmin

    c.  **Пароль** и **Подтвердите пароль**: \<пароль по вашему выбору>

    d.  **Подписка**: \<подписка по вашему выбору с ресурсами вычислений/хранения/сети>

    д)  **Группа ресурсов**: storagetesting (создать)

    е)  Нажмите кнопку **ОК**.

6.  В колонке **Выбор размера** выберите **Standard_F8s_v2** и **Выбрать**.

7.  В колонке **Настройки** выберите **Виртуальная сеть** и в колонке **Создать виртуальную сеть**, настройте адресное пространство на **10.10.10.0/23**, обновите диапазон адресов подсети на **10.10.10.0/24** и нажмите **OK**.

8.  Выберите **Общедоступный IP-адрес**, а в колонке **Создать общедоступный IP-адрес** щелкните переключатель **Статический**.

9.  В раскрывающемся списке **Выберите общедоступные входящие порты** выберите **RDP (3389)** .

10. Оставьте значения по умолчанию, а затем нажмите **OK**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image3.png)

11. Прочитайте сводку, дождитесь подтверждения, затем выберите **OK**, чтобы начать развертывание. Развертывание должно завершиться примерно через 10 минут.

12. После завершения развертывания в разделе **Ресурс** выберите имя виртуальной машины, **VM001**, чтобы открыть колонку **Обзор**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image4.png)

13. В разделе "DNS-имя" выберите **Настроить**, укажите метку DNS-имени **vm001** и нажмите кнопку **Сохранить**, а затем выберите **VM001**.

14. В правой части колонки "Обзор" выберите **storagetesting-vnet/default** в тексте виртуальной сети или подсети.

15. В колонке "storagetesting-vnet" выберите **Подсети**, затем **Добавить подсеть**, после чего в колонке "Новая подсеть" введите следующие сведения, а затем нажмите кнопку **ОК**:

    а.  **Имя**: subnet2

    b.  **Диапазон адресов (блок CIDR)** . 10.10.11.0/24

    c.  **Группа безопасности сети**: None

    d.  **Таблица маршрутов**. None

16. После сохранения выберите **VM001**.

17. В левой части колонки обзора выберите **Сетевые подключения**.

18. Выберите **Подключить сетевой интерфейс** а затем выберите **Создать сетевой интерфейс**.

19. В колонке **Создать сетевой интерфейс** задайте следующие параметры.

    а.  **Имя**: vm001nic2

    b.  **Подсеть.** Убедитесь, что подсеть: 10.10.11.0/24

    c.  **Группа безопасности сети**. VM001 — NSG

    d. **Группа ресурсов**: storagetesting

20. После успешного подключения выберите **VM001** и **Остановить**, чтобы завершить работу виртуальной машины.

21. После остановки (освобождения) виртуальной машины в левой части колонки обзора выберите **Сеть**, щелкните **Подключить сетевой интерфейс**, выберите **vm001nic2**, а затем нажмите кнопку **ОК**. Через несколько секунд в виртуальную машину будет добавлен дополнительный сетевой адаптер.

22. Оставаясь в колонке **Сеть**, выберите вкладку **vm001nic2**, а затем — **Сетевой интерфейс: vm001nic2**.

23. В колонке интерфейса vm001nic выберите **конфигурации IP-адресов** и в центре колонки выберите **ipconfig1**.

24. В колонке параметров "ipconfig1" выберите **Включено** для общедоступного IP-адреса и выберите **Настроить обязательные параметры**, **Создать,** и введите "vm001nic2pip" в поле имя, выберите **Статический**, нажмите **ОК**, а затем **Сохранить**.

25. После успешного сохранения вернитесь в колонку "Обзор VM001" и выберите **Запустить**, чтобы запустить настроенную виртуальную машину Windows Server 2019.

26. После запуска **установите сеанс RDP** в VM001.

27. После подключения в виртуальной машине откройте **CMD** (с правами администратора) и введите **hostname**, чтобы получить имя компьютера операционной системы. **Оно должно совпадать с VM001**. Запомните это имя.

### <a name="configure-second-network-adapter-on-windows-server-2019-vm-on-azure-stack-hub"></a>Настройка второго сетевого адаптера в виртуальной машине Windows Server 2019 в Azure Stack Hub

Azure Stack Hub назначает шлюз по умолчанию для первого (основного) сетевого интерфейса, подключенного к виртуальной машине. Azure Stack Hub не назначает шлюз по умолчанию для второго (дополнительного) сетевого интерфейса, подключенного к виртуальной машине. Таким образом, невозможно по умолчанию связываться с ресурсами, к которым подключен дополнительный сетевой интерфейс вне подсети. Дополнительные сетевые интерфейсы могут взаимодействовать с ресурсами за пределами их подсети, однако шаги для обеспечения взаимодействия различаются для разных операционных систем.

1.  Если вы еще не открыли подключение, установите подключение RDP к **VM001**.

2.  Откройте **CMD** с правами администратора и выполните команду **route print**, которая должна возвращать два интерфейса (сетевые адаптеры Hyper-V) в этой виртуальной машине.

    ![](./media/azure-stack-network-howto-extend-datacenter/image5.png)

3.  Теперь выполните команду **ipconfig**, чтобы узнать, какой IP-адрес назначен дополнительному сетевому интерфейсу. В этом примере для интерфейса 6 назначен адрес 10.10.11.4. Для дополнительного сетевого интерфейса не возвращен адрес шлюза по умолчанию.

    ![](./media/azure-stack-network-howto-extend-datacenter/image6.png)

4.  Для маршрутизации всего трафика, предназначенного для адресов за пределами подсети дополнительного сетевого интерфейса, в подсеть шлюза выполните следующую команду из **CMD:** .

    ```CMD  
    route add -p 0.0.0.0 MASK 0.0.0.0 <ipaddress> METRIC 5015 IF <interface>
    ```

    `<ipaddress>` — это адрес .1 текущей подсети, а `<interface>` — номер интерфейса.

    ![](./media/azure-stack-network-howto-extend-datacenter/image7.png)

5.  Чтобы убедиться, что добавленный маршрут находится в таблице маршрутизации, введите команду **route print**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image8.png)

6.  Вы также можете проверить исходящий трафик, выполнив команду ping:  
    `ping 8.8.8.8 -S 10.10.11.4`  
    Флаг `-S` позволяет указать адрес источника, в данном случае 10.10.11.4 — IP-адрес сетевого адаптера, у которого теперь есть шлюз по умолчанию.

7.  Закройте**CMD**.

### <a name="configure-the-windows-server-2019-iscsi-target"></a>Настройка цели iSCSI Windows Server 2019

Для этого сценария вы проверите конфигурацию, в которой целевым объектом iSCSI Windows Server 2019 является виртуальная машина в Hyper-V за пределами среды Azure Stack Hub. Эта виртуальная машина будет настроена с использованием 8 виртуальных процессоров, одного VHDX-файла и, что важнее всего, 2 виртуальных сетевых адаптеров. В идеальном сценарии эти сетевые адаптеры будут иметь разные маршрутизируемые подсети, но в этом тесте они будут иметь сетевые адаптеры в одной подсети.

![](./media/azure-stack-network-howto-extend-datacenter/image9.png)

Для сервера цели iSCSI это может быть Windows Server 2016 или 2019, физический или виртуальный, работающий в Hyper-V, VMware или альтернативное устройство на ваше усмотрение, такое как выделенная физическая сеть SAN iSCSI. Ключевым моментом здесь является двустороннее подключение к системе Azure Stack Hub. Но предпочтительно иметь несколько путей между источником и получателем, так как это обеспечивает дополнительную надежность и позволяет применять лучшие возможности для повышения производительности, например MPIO.

Советуем обновить цель iSCSI Windows Server 2019, используя при необходимости последние накопительные обновления и исправления, перезагрузку, прежде чем продолжить настройку файловых ресурсов.

После обновления и перезагрузки этот сервер можно настроить в качестве цели iSCSI.

1.  Откройте **Диспетчер сервера** и выберите **Управление**, затем **Добавить роли и возможности**.

2.  После этого выберите **Далее**, затем **Установка ролей или компонентов** и просмотрите выбранные элементы, пока не достигнете страницы **Выбор ролей сервера**.

3.  Разверните **Файловые службы и службы хранилища**, а затем **File & iSCSI Services** (Файловые службы и службы iSCSI) и установите флажок **Сервер цели iSCSI**, примите запросы на добавление новых компонентов, а затем выполняйте шаги до завершения.

    ![](./media/azure-stack-network-howto-extend-datacenter/image10.png)

    После завершения закройте **диспетчер сервера**.

4.  Откройте **проводник**, перейдите к диску C:\\ и **создайте папку** с именем **iSCSI**.

5.  Повторно откройте **диспетчер сервера** и выберите **Файловые службы и службы хранилища** в меню слева.

6.  Выберите **iSCSI**, а затем ссылку **Чтобы создать виртуальный диск iSCSI, запустите мастер создания виртуальных дисков iSCSI** в правой области. Выберите его. Откроется мастер.

7.  На странице **Выбор расположения виртуального диска iSCSI** выберите переключатель **Type a custom path** (Ввести пользовательский путь) и перейдите к **C:\\iSCSI**, а затем выберите **Далее**.

8.  Присвойте виртуальному диску iSCSI имя **iSCSIdisk1** и введите описание (необязательно), а затем нажмите кнопку **Далее**.

9.  Задайте для размера виртуального диска значение **10 ГБ** и выберите **Фиксированный размер**, а затем нажмите кнопку **Далее**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image11.png)

10) Так как это новый целевой объект, выберите **New iSCSI target** (Создать цель iSCSI), а затем нажмите кнопку **Далее**.

11) На странице **Выбор имени цели** введите **TARGET1** и нажмите кнопку **Далее**.

12) На странице **Назначение серверов доступа** выберите **Добавить**. Откроется диалоговое окно для ввода конкретных **инициаторов**, которые будут иметь права на подключение к цели iSCSI.

13) В окне **Добавление ИД инициатора** выберите **Enter a value for the selected type** (Ввести значение для выбранного типа) и в поле **Тип** выберите IQN в раскрывающемся меню. Введите **iqn.1991-05.com.microsoft:\<имя_компьютера>** , где \<имя_компьютера> — это **имя компьютера** **VM001**, а затем выберите **Далее**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image12.png)

14) На странице **включения проверки подлинности** оставьте поля пустыми, а затем нажмите кнопку **Далее**.

15) Подтвердите выбранные параметры и выберите **Создать**, а затем закройте. В диспетчере сервера должен появиться созданный виртуальный диск iSCSI.

    ![](./media/azure-stack-network-howto-extend-datacenter/image13.png)

### <a name="configure-the-windows-server-2019-iscsi-initiator-and-mpio"></a>Настройка инициатора iSCSI Windows Server 2019 и MPIO

Чтобы настроить инициатор iSCSI, сначала войдите на **пользовательский портал Azure Stack Hub** в системе **Azure Stack Hub** и перейдите в колонку **Обзор** для **VM001**.

1.  Установите RDP-подключение к VM001. После подключения откройте **диспетчер сервера**.

2.  Выберите **Добавить роли и компоненты** и принимайте значения по умолчанию до тех пор, пока не достигнете страницы **Компоненты**.

3.  На странице **Компоненты** добавьте **Multipath I/O** и нажмите кнопку **Далее**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image14.png)

4.  Установите флажок **Автоматический перезапуск конечного сервера, если требуется**, и нажмите кнопку **Установить**, а затем — **Закрыть**. Скорее всего, потребуется перезагрузка, поэтому после ее завершения повторно подключитесь к VM001.

5.  Вернитесь в **диспетчер сервера**, дождитесь **завершения установки MPIO**, выберите **Закрыть**, а затем выберите **Инструменты** и **MPIO**.

6.  Перейдите на вкладку **Обнаружение многопутевых устройств**, установите флажок **Добавить поддержку для iSCSI-устройств** и выберите **Добавить**, а затем выберите **Да** для **перезагрузки** VM001. Если окно не получено, нажмите кнопку **ОК**, а затем перезагрузите вручную.

    ![](./media/azure-stack-network-howto-extend-datacenter/image15.png)

7.  После перезагрузки установите **новое RDP-подключение к VM001**.

8.  После подключения откройте **диспетчер сервера** и выберите **Инструменты** и **Инициатор iSCSI**.

9.  Выберите **Да**, когда откроется окно Microsoft iSCSI для разрешения запуска службы iSCSI по умолчанию.

    ![](./media/azure-stack-network-howto-extend-datacenter/image16.png)

10. В окне свойств инициатора iSCSI выберите вкладку **Обнаружение**.

11. Теперь вы добавите 2 цели, поэтому сначала выберите **Discover Portal** (Обнаружить портал).

12. Введите первый IP-адрес целевого сервера iSCSI и выберите **Дополнительно**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image17.png)

13. В окне **Дополнительные параметры** выберите следующее, а затем нажмите кнопку **ОК**.

    а.  **Локальный адаптер**: инициатор iSCSI (Майкрософт).

    b.  **IP-адрес инициатора**: 10.10.10.4.

14. Вернитесь в окно **Обнаружение целевого портала**, нажмите кнопку **ОК**.

15. Повторите процесс со следующими значениями:

    а. ** IP-адрес**: второй целевой IP-адрес iSCSI.

    b.  **Локальный адаптер**: инициатор iSCSI (Майкрософт).

    c.  **IP-адрес инициатора**: 10.10.11.4.

16. Ваши целевые порталы должны выглядеть, как показано ниже, с вашими собственными целевыми IP-адресами iSCSI в столбце **Адрес**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image18.png)

17. Вернитесь на вкладку **Цели**, выберите цель iSCSI в середине окна и **Подключить**.

18. В окне **Подключение к конечному объекту** установите флажок **Включить поддержку многопутевых накопителей**, а затем щелкните **Дополнительно**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image19.png)

19. Введите следующие сведения и нажмите кнопку **ОК**, а затем в окне **Подключение к конечному объекту** нажмите кнопку **ОК**.

    а.  **Локальный адаптер**: инициатор iSCSI (Майкрософт).

    b.  **IP-адрес инициатора**: 10.10.10.4.

    c.  **IP-адрес конечного портала**: \<свой первый целевой IP-адрес iSCSI / 3260>.

![](./media/azure-stack-network-howto-extend-datacenter/image20.png)

1.  Повторите процесс для второго сочетания "инициатор — цель".

    а. ** Локальный адаптер**: инициатор iSCSI (Майкрософт).

    b.  **IP-адрес инициатора**: 10.10.11.4.

    c.  **IP-адрес конечного портала**: \<свой второй целевой IP-адрес iSCSI / 3260>.

        ![](./media/azure-stack-network-howto-extend-datacenter/image21.png)

2.  Перейдите на вкладку **Тома и устройства**, а затем выберите **Автонастройка**. Вы увидите том MPIO.

    ![](./media/azure-stack-network-howto-extend-datacenter/image22.png)

3.  Вернитесь на вкладку **Цели**, выберите **Устройства** и вы увидите 2 подключения к единому виртуальному жесткому диску iSCSI, созданному ранее.

    ![](./media/azure-stack-network-howto-extend-datacenter/image23.png)

4.  Нажмите кнопку **MPIO**, чтобы просмотреть дополнительные сведения о политике балансировки нагрузки и путях.

    ![](./media/azure-stack-network-howto-extend-datacenter/image24.png)

5.  Выберите **ОК** три раза, чтобы выйти из окон и инициатора iSCSI.

6.  Откройте оснастку "Управление дисками" (diskmgmt.msc), и в окне будет предложено **инициализировать диск**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image25.png)

7.  Нажмите кнопку **ОК**, чтобы принять значения по умолчанию, а затем прокрутите вниз до нового диска, щелкните его правой кнопкой мыши и выберите пункт **New Simple Volume** (Создать простой том).

8.  Следуйте инструкциям мастера, принимая значения по умолчанию. Измените метку тома на **iSCSIdisk1**, а затем выберите **Готово**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image26.png)

9.  Затем диск отформатируется и будет представлен буквой диска.

10. Откройте **проводник** и выберите **Этот компьютер**, чтобы увидеть новый диск, подключенный к VM001.

### <a name="testing-external-storage-connectivity"></a>Проверка подключения к внешнему хранилищу

Чтобы проверить связь и выполнить элементарный тест копирования файлов, сначала войдите на **пользовательский портал Azure Stack Hub** в системе **Azure Stack Hub** и перейдите в колонку **Обзор** для **VM001**.

1.  Выберите **Подключить**, чтобы установить RDP-подключение к **VM001**.

2.  Откройте **диспетчер задач**, выберите вкладку **Производительность**, а затем привязку окна к правой части сеанса RDP.

3.  Откройте **интегрированную среду сценариев Windows PowerShell** от имени администратора и прикрепите окно к левой части сеанса RDP. В правой части интегрированной среды сценариев (ISE) закройте область **Команды** и нажмите кнопку **Сценарий**, чтобы развернуть белую область сценария в верхней части окна ISE.

4.  В этой виртуальной машине нет собственных модулей PowerShell для создания VHD, который будет использоваться в качестве большого файла для проверки перемещения файла в цель iSCSI. В этом случае для создания VHD-файла нужно запустить DiskPart. В интегрированной среде сценариев выполните следующую команду:

    1. `Start-Process Diskpart`

    2. После того как откроется новое окно CMD, введите:  
        `**Create vdisk file="c:\\test.vhd" type=fixed maximum=5120**`
    
    ![](./media/azure-stack-network-howto-extend-datacenter/image27.png)
    
    3.  На создание уйдет несколько секунд. После этого, чтобы проверить созданное, откройте **проводник** и перейдите к C:\\. Там вы увидите новый файл test.vhd размером 5 ГБ.

    ![](./media/azure-stack-network-howto-extend-datacenter/image28.png)

    4. Закройте окно CMD и вернитесь в интегрированную среду сценариев, а затем введите в окне скрипта следующую команду. Замените F:\\ на букву диска цели iSCSI, которую применяли ранее.

    5. `Copy-Item "C:\\test.vhd" -Destination "F:\\"`

    6. Выберите строку в окне скрипта и нажмите клавишу F8 для запуска.

    7. Во время выполнения команды понаблюдайте за двумя сетевыми адаптерами, через которые идет передача данных в VM001. Вы также должны увидеть, что каждый сетевой адаптер должен равномерно распределять нагрузку.

    ![](./media/azure-stack-network-howto-extend-datacenter/image29.png)

Этот сценарий разработан для демонстрации подключения между рабочей нагрузкой, запущенной в Azure Stack Hub, и массивом внешнего хранилища (целевым объектом iSCSI Windows Server, в нашем случае). Он не предназначался для тестирования производительности и может неточно отражать необходимые шаги, если вы использовали другое устройство на основе iSCSI. Однако здесь представлены основные рекомендации, которым можно следовать при развертывании рабочих нагрузок в Azure Stack Hub и подключении их к системам хранения за пределами среды Azure Stack Hub.

## <a name="next-steps"></a>Дальнейшие действия

[Сети Azure Stack Hub: различия и рекомендации](azure-stack-network-differences.md)
