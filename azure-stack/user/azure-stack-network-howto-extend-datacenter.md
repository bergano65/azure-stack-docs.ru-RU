---
title: Сведения о расширении центра обработки данных в Azure Stack Hub | Документация Майкрософт
description: Узнайте, как расширить центр обработки данных в Azure Stack.
services: azure-stack
author: mattbriggs
ms.service: azure-stack
ms.topic: how-to
ms.date: 11/07/2019
ms.author: mabrigg
ms.reviewer: sijuman
ms.lastreviewed: 11/07/2019
ms.openlocfilehash: 92e82f549cddf51b1cbd6764cc122acc3ca8fdfc
ms.sourcegitcommit: ed44d477b9fd11573d1e0d1ed3a3c0ef4512df53
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2019
ms.locfileid: "73845982"
---
# <a name="how-to-extend-the-data-center-on--azure-stack-hub"></a>Сведения о расширении центра обработки данных в Azure Stack Hub

*Область применения: интегрированные системы Azure Stack Hub и Пакет средств разработки Azure Stack Hub*

В этой статье приводятся сведения об инфраструктуре хранилища Azure Stack Hub, которые помогут решить, как интегрировать Azure Stack с существующей сетевой средой. После общего обсуждения вопроса о расширении вашего центра обработки данных в статье представлены два различных сценария. Вы можете подключиться к серверу хранилища файлов Windows. Также можно подключиться к серверу iSCSI Windows.

## <a name="overview-of-extending-storage-to-azure-stack-hub"></a>Общие сведения о расширении хранилища в Azure Stack Hub

В некоторых сценариях данных, расположенных в общедоступном облаке, недостаточно. Возможно, имеется зависимая от задержек виртуализированная рабочая нагрузка базы данных с большим объемом вычислений, а время приема-передачи в общедоступное облако может повлиять на производительность рабочей нагрузки базы данных. Возможно, есть локальные данные, хранящиеся на файловом сервере, запоминающем устройстве, подключаемом к сети, или в массиве хранения iSCSI, которые должны быть доступны локальным рабочим нагрузкам, и их нужно размещать в локальной среде в соответствии с нормативными и корпоративными требованиями.  Это лишь два сценария, в которых данные находятся в локальной среде, что очень важно для многих организаций.

Итак, почему бы просто не разместить эти данные в учетных записях хранения в Azure Stack или внутри виртуализированных файловых серверов, работающих в системе Azure Stack? В отличие от Azure, хранилище Azure Stack ограничено. Емкость, доступная для использования, полностью зависит от емкости каждого узла, которую вы приобрели, а также от количества имеющихся узлов. А поскольку Azure Stack — это гиперконвергентное решение, если вы хотите увеличить емкость хранилища в соответствии с требованиями к ресурсам, вам также необходимо увеличить объем вычислительных ресурсов за счет добавления узлов.  Это может быть неэкономично, особенно если требуется дополнительная емкость для холодного архивного хранилища, которую можно добавить по низкой стоимости за пределами системы Azure Stack.

Это подталкивает к сценарию, который будет рассмотрен ниже. Как можно просто и эффективно подключить системы Azure Stack (работающие в Azure Stack виртуализированные рабочие нагрузки) к системам хранения за пределами Azure Stack через сеть.

## <a name="design-for-extending-storage"></a>Схема расширения хранилища

На схеме показан сценарий, при котором одна виртуальная машина, выполняющая рабочую нагрузку, подключается к внешнему (к виртуальной машине и самому Azure Stack) хранилищу и использует его для чтения/записи данных и т. д. В этой статье вы сосредоточитесь на простом извлечении файлов, однако вы можете расширить этот пример для более сложных сценариев, таких как удаленное хранение файлов баз данных.

![Расширение хранилища Azure Stack](./media/azure-stack-network-howto-extend-datacenter/image1.png)

На схеме видно, что виртуальная машина в системе Azure Stack была развернута с несколькими сетевыми картами. Как с точки зрения избыточности, так и с точки зрения рекомендуемого хранилища, важно иметь несколько путей между целью и конечным пунктом. Ситуация усложняется, когда у виртуальных машин в Azure Stack есть общедоступные и частные IP-адреса, как в Azure. Если для доступа к виртуальной машине необходимо внешнее хранилище, это можно сделать только через общедоступный IP-адрес, поскольку частные IP-адреса в основном используются в системах Azure Stack, в виртуальных сетях и подсетях. Внешнее хранилище не сможет взаимодействовать с пространством частного IP-адреса виртуальной машины, если оно не будет проходить через VPN типа "сеть-сеть" для подключения к самой виртуальной сети. Таким образом, в этом примере основное внимание уделяется обмену данными через пространство общедоступного IP-адреса. Обратите внимание, что на графике видно, что в пространстве общедоступного IP-адреса существует две различные общедоступные подсети пула IP-адресов. По умолчанию, Azure Stack требует всего один пул для общедоступного IP-адреса, но для избыточной маршрутизации необходимо добавить второй пул. Вы можете остановится на модели с общедоступными IP-адресами с того же пула через несколько виртуальных сетевых карт, поскольку выбрать IP-адрес из определенного пула невозможно.

В этом примере можно предположить, что маршрутизация между границами устройств и внешним хранилищем выполнена, и трафик может правильно проходить через сеть. Например, не имеет значения, является ли магистраль на 1 GbE, 10 GbE, 25 GbE или даже быстрее, однако это важно учитывать при планировании интеграции, чтобы удовлетворить потребности в производительности любых приложений, имеющих доступ к этому внешнему хранилищу.

## <a name="connect-to-a-windows-server-file-server-storage"></a>Подключение к хранилищу файловых серверов Windows Server

В этом сценарии вы развернете и настроите виртуальную машину Windows Server 2019 в Azure Stack и подготовите ее к подключению к внешнему файловому серверу, на котором также может работать Windows Server 2019. При необходимости установите ключевые функции, такие как SMB Multichannel для оптимизации производительности и подключения между виртуальной машиной и внешним накопителем.

### <a name="deploy-the-windows-server-2019-vm-on-azure-stack"></a>Развертывание виртуальной машины Windows Server 2019 в Azure Stack

1.  На**портале администратора Azure Stack**, если предположить, что эта система была правильно зарегистрирована и подключена к рынку, выберите **Управление Marketplace,** , а затем, если у вас еще нет образа Windows Server 2019, выберите **Добавить из Azure** и выполните поиск **Windows Server 2019**, добавив образ **Центр обработки данных Windows Server 2019**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image2.png)

    Загрузка образа Windows Server 2019 может занять некоторое время.

2.  Получив образ Windows Server 2019 в среде Azure Stack, войдите на пользовательский портал Azure Stack**.

3.  После входа на пользовательский портал Azure Stack убедитесь, что у вас есть [подписка на предложение](https://docs.microsoft.com/azure-stack/operator/azure-stack-subscribe-plan-provision-vm?view=azs-1908), позволяющее предоставлять ресурсы IaaS (вычисления, хранилище и сеть).

4.  Получив доступ к подписке, вернитесь на **панель мониторинга** на пользовательском портале Azure Stack, выберите **Создать ресурс**, **Вычисления**, а затем — **элемент коллекции Центра обработки данных Windows Server 2019**.

5.  В колонке **Основы** :

    a.  **Имя.** VM001

    b.  **Username**: localadmin

    c.  **Пароль** и **Подтвердите пароль**: \<пароль по вашему выбору>

    d.  **Подписка**: \<Подписка по вашему выбору, с ресурсами вычислений/хранения/сети>

    д. **Группа ресурсов.** Создать новый: Тестирование хранилища

    Е.  Нажмите кнопку **ОК**

6.  В колонке **Выбор размера** выберите **Standard_F8s_v2**.

7.  В колонке **Настройки** выберите **Виртуальная сеть** и в колонке **Создать виртуальную сеть**, настройте адресное пространство на **10.10.10.0/23**, обновите диапазон адресов подсети на **10.10.10.0/24** и нажмите **OK**.

8.  Выберите **Общедоступный IP-адрес**, а в колонке **Создать общедоступный IP-адрес** выберите колонку **Статический**.

9.  В разделе **Выберите общедоступные входящие порты** выберите **RDP (3389)** .

10. Оставьте значения по умолчанию, а затем нажмите **OK**.
    
    ![](./media/azure-stack-network-howto-extend-datacenter/image3.png)

11. Прочитайте сводку, дождитесь подтверждения, затем выберите **OK**, чтобы начать развертывание. Развертывание должно завершиться примерно через 10 минут.

12. После завершения развертывания в разделе **Ресурс** выберите имя виртуальной машины, **VM001**, чтобы перейти к колонке *Обзор*.
    
    ![](./media/azure-stack-network-howto-extend-datacenter/image4.png)

13. В разделе "DNS-имя" выберите **Настроить**, укажите метку DNS-имени **vm001 и нажмите кнопку **Сохранить**, а затем выберите **VM001** в строке навигации, чтобы вернуться к колонке *Обзор*.

14. В правой части колонки "Обзор" выберите **storagetesting-vnet/default** в тексте виртуальной сети или подсети.

15. В колонке "storagetesting-vnet" выберите **Подсети** затем **Добавить подсеть**, после чего в колонке "Новая подсеть" введите следующие сведения: 

    a.  **Имя**: subnet2

    b.  **Диапазон адресов (блок CIDR)** . 10.10.11.0/24

    c. **Группа безопасности сети**: Нет

    d.  **Таблица маршрутов**. Нет

    д. Нажмите кнопку **ОК**.

16. После сохранения выберите **VM001** в строке навигации, чтобы вернуться к колонке обзора.

17. Выберите **Сети**.

18. Выберите **Подключить сетевой интерфейс** а затем выберите **Создать сетевой интерфейс**.

19. В колонке **Создание сетевого интерфейса**:

    a.  **Имя**: vm001nic2

    b.  **Подсеть.** Убедитесь, что подсеть: 10.10.11.0/24

    c. **Группа безопасности сети**. VM001 — NSG

    d.  **Группа ресурсов**: storagetesting

20. После успешного создания выберите **VM001** в строке навигации и выберите **Остановить**, чтобы завершить работу виртуальной машины.

21. После остановки (освобождения) виртуальной машины выберите **Сеть**, нажмите **Подключить сетевой интерфейс**, выберите **vm001nic2**, а затем нажмите **ОК**. Через несколько секунд вы добавите в виртуальную машину дополнительный сетевой адаптер.

22. В колонке **Сеть** перейдите на вкладку **vm001nic2**, а затем выберите **Сетевой интерфейс: vm001nic2**.

23. В колонке интерфейса vm001nic выберите **конфигурации IP-адресов** и в центре колонки выберите **ipconfig1**.

24. В колонке параметров "ipconfig1" выберите **Включено** для общедоступного IP-адреса и выберите **Настроить обязательные параметры**, **Создать,** и введите "vm001nic2pip" в поле имя, выберите **Статический**, нажмите **ОК**, а затем **Сохранить**.

25. После успешного сохранения вернитесь в колонку "Обзор VM001" и выберите **Запустить**, чтобы запустить настроенную виртуальную машину Windows Server 2019.

### <a name="configure-the-windows-server-2019-file-server-storage"></a>Настройка хранилища файлового сервера Windows Server 2019

В первом примере выполняется проверка конфигурации, в которой файловый сервер Windows Server 2019 является виртуальной машиной, работающей на Hyper-V. Эта виртуальная машина будет настроена с использованием восьми виртуальных процессоров, одного VHDX-файла и, что наиболее важно, двух виртуальных сетевых адаптеров. В идеальном сценарии эти сетевые адаптеры будут иметь разные маршрутизируемые подсети, но в этом тесте они будут иметь сетевые адаптеры в одной подсети.

![](./media/azure-stack-network-howto-extend-datacenter/image5.png)

Для файлового сервера это может быть Windows Server 2016 или 2019, физический или виртуальный, работающий в Hyper-V, VMware или альтернативная платформа на ваше усмотрение. Ключевым моментом здесь является подключение к системе Azure Stack и обратно, однако предпочтительно иметь несколько путей между источником и получателем, поскольку это обеспечивает дополнительную надежность и позволяет использовать более совершенные возможности для повышения производительности, такие как SMB Multichannel.

Обновите файловый сервер, используя последние накопительные обновления и исправления, перезагрузку, прежде чем продолжить настройку файловых ресурсов.

После обновления и перезагрузки этот сервер можно настроить в качестве файлового сервера.

1) На компьютере с файловым сервером запустите **ipconfig/all** из **CMD** и запишите **DNS-сервер**, который использует ваш файловый сервер.

2)  Откройте **Диспетчер сервера** и выберите **Управление**, затем **Добавить роли и возможности**.

3)  Выберите **Далее**, затем **Установка на основе ролей или функций** и просмотрите выбранные элементы, пока не достигнете страницы **Выбрать роли сервера**.

4)  Разверните **Файловые службы и службы хранилища**, разверните **Файловые службы и службы iSCSI** и выберите **Файловый сервер**. После завершения закройте **Диспетчер сервера**.

5)  Откройте **Диспетчер сервера** снова и выберите **Файловые службы и службы хранилища**.

6)  Выберите **Общие ресурсы**.

7)  В поле **Общие ресурсы**выберите ссылку, **чтобы создать общую папку, запустите мастер создания общего ресурса**.

8)  В поле **Мастер создания общего ресурса** выберите **Общий ресурс SMB — быстрый профиль**, затем выберите **Далее** и перейдите к мастеру, выбрав команду **C:\\\\. Том**.

9)  Присвойте имя общему ресурсу, **TestStorage** затем выберите **Далее**.

10) Вернитесь в **Мастер создания общего ресурса**, последовательно выберите **Далее**, **Создать**, **Закрыть**.

Теперь вы создали свой файловый ресурс на вашем файловом сервере.

### <a name="testing-file-storage-performance-and-connectivity"></a>Тестирование производительности файлового хранилища и возможностей подключения

Чтобы проверить связь и выполнить некоторые элементарные тесты, войдите на пользовательский портал Azure Stack в системе **Azure Stack** и перейдите в колонку **Обзор** для **VM001**.

1)  Выберите **Подключить**, чтобы установить RDP-подключение к VM001.

2)  Для взаимодействия через Hostname вы собираетесь изменить **Узлы** файла. Однако в рабочей среде DNS будет оптимально настроена таким образом, что имена будут разрешены автоматически. Также можно использовать IP-адреса. Но в нашем примере вы измените файл **Узлы**.

3)  Откройте **Блокнот**, убедитесь, что выполняете **Запуск от имени администратора**.

4)  После открытия Блокнота выберите **Файл**, **Открыть** и перейдите в раздел c:\\Windows\System32\Drivers\etc\, и выберите **Все файлы** в правом нижнем углу открытого диалогового окна. Выберите файл **Узлы** и нажмите **Открыть**.

5)  Измените файл узлов, добавив IP-адрес и DNS-имя для файлового сервера.

    ![](./media/azure-stack-network-howto-extend-datacenter/image6.png)

6)  Сохраните файл и закройте Блокнот.

7)  Откройте **CMD** и выполните проверку связи по имени файлового сервера, который вы ввели в файл узлов. Он должен вернуть IP-адрес одного из сетевых адаптеров на файловом сервере, поэтому вручную протестируйте связь с другим адаптером с помощью проверки связи по IP-адресу.

## <a name="connect-to-a-windows-server-iscsi-target-server"></a>Подключение к целевому серверу iSCSI Windows Server

В этом сценарии вы развернете и настроите виртуальную машину Windows Server 2019 в Azure Stack и подготовите ее к подключению к целевому серверу iSCSI, на котором также будет работать Windows Server 2019.

> [!Note]  
> Если вы уже выполнили сценарий, переходите к настройке компьютеров.

### <a name="deploy-the-windows-server-2019-vm-on-azure-stack"></a>Развертывание виртуальной машины Windows Server 2019 в Azure Stack

Если вы еще не развернули виртуальную машину Windows Server 2019 в Azure Stack, выполните действия, описанные в разделе [Развертывание виртуальной машины Windows Server 2019 в Azure Stack](#deploy-the-windows-server-2019-vm-on-azure-stack). Затем можно настроить целевой сервер iSCSI Windows Server 2019.

### <a name="configure-the-windows-server-2019-iscsi-target"></a>Настройка целевого сервера iSCSI Windows Server 2019

В целях этого второго сценария проверьте конфигурацию, в которой целевой сервер iSCSI Windows Server 2019 является виртуальной машиной, работающей в Hyper-V. Эта виртуальная машина будет настроена с использованием восьми виртуальных процессоров, одного VHDX-файла и, что наиболее важно, двух виртуальных сетевых адаптеров. В идеальном сценарии эти сетевые адаптеры будут иметь разные маршрутизируемые подсети, но в этом тесте вы будете иметь сетевые адаптеры в одной подсети.

![](./media/azure-stack-network-howto-extend-datacenter/image5.png)

Для целевого сервера iSCSI это может быть Windows Server 2016 или 2019, физический или виртуальный, работающий в Hyper-V, VMware или альтернативная платформа на ваше усмотрение. Ключевым моментом здесь является подключение к системе Azure Stack и обратно, однако предпочтительно иметь несколько путей между источником и получателем, поскольку это обеспечивает дополнительную надежность и пропускную способность.

Обновите файловый сервер, используя последние накопительные обновления и исправления, перезагрузку, прежде чем продолжить настройку целевого сервера iSCSI.

После обновления и перезагрузки этот сервер можно настроить в качестве целевого сервера iSCSI.

1. Откройте **Диспетчер сервера** > **Управление** > **Добавить роли и компоненты**.

2. После этого выберите **Далее**, затем **Установка ролей или компонентов** и просмотрите выбранные элементы, пока не достигнете страницы **Выбор ролей сервера**.

3. Разверните **Файловые службы и службы хранилища**, а затем **Файловые службы и службы iSCSI** и выберите **целевой сервер iSCSI**, примите запросы на добавление новых компонентов, а затем выполняйте шаги до завершения.

    ![](./media/azure-stack-network-howto-extend-datacenter/image8.png)
    
    После завершения закройте **диспетчер сервера**.

4. Откройте **проводник**, перейдите к `C:\\` и **создайте папку** с именем `iSCSI`.

5. Повторно откройте **диспетчер сервера** >  и выберите **Файловые службы и службы хранилища** в меню слева.

6. Выберите **iSCSI**, а затем **Чтобы создать виртуальный диск iSCSI, запустите мастер создания виртуальных дисков iSCSI**.

7. На странице **Выбор расположения виртуального диска iSCSI** выберите **Type a custom path** (Ввести пользовательский путь) и перейдите к `C:\\iSCSI`. Щелкните **Далее**.

8. Присвойте виртуальному диску iSCSI имя `iSCSIdisk1` и введите описание (необязательно), а затем нажмите кнопку **Далее**.

9. Задайте размер виртуального диска `10GB` и выберите **Фиксированный размер**, а затем нажмите кнопку **Далее**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image9.png)

10. Так как это новый целевой объект, выберите **New iSCSI target** (Создать цель iSCSI), а затем нажмите кнопку **Далее**.

11. На странице **Выбор имени цели** введите **TARGET1** и нажмите кнопку **Далее**.

12. На странице **Назначение серверов доступа** выберите **Добавить**. Откроется диалоговое окно для ввода конкретных **инициаторов**, которые будут иметь права на подключение к цели iSCSI.

13. Выберите **Enter a value for the selected type** (Ввести значение для выбранного типа) в окне **Добавление ИД инициатора** и в поле **Тип** выберите IQN в раскрывающемся меню. Введите `iqn.1991-05.com.microsoft:<computername>`, где `<computername>` — **имя компьютера** **VM001**. Щелкните **Далее**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image10.png)

14. На странице **включения проверки подлинности** оставьте поля пустыми, а затем нажмите кнопку **Далее**.

15. Подтвердите выбранные параметры и выберите **Создать**, а затем закройте.

    ![](./media/azure-stack-network-howto-extend-datacenter/image11.png)

В диспетчере сервера должен появиться созданный виртуальный диск iSCSI.

### <a name="configure-the-windows-server-2019-iscsi-initiator-and-mpio"></a>Настройка инициатора iSCSI Windows Server 2019 и MPIO

Чтобы настроить инициатор iSCSI, войдите на **пользовательский портал** в системе **Azure Stack** и перейдите в колонку **Обзор** для **VM001**.

1.  Установите RDP-подключение к VM001. После подключения откройте **диспетчер сервера**.

2.  Выберите **Добавить роли и компоненты** и принимайте значения по умолчанию до тех пор, пока не достигнете страницы **Компоненты**.

3.  На странице **Компоненты** добавьте **Multipath I/O** и нажмите кнопку **Далее**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image12.png)

4.  Установите флажок **Restart the destination server automatically if necessary** (Автоматический перезапуск конечного сервера, если требуется) и нажмите кнопку **Установить**, а затем — **Закрыть**. Скорее всего, потребуется перезагрузка, поэтому после ее завершения повторно подключитесь к VM001.

5.  Вернитесь в **диспетчер сервера**, дождитесь **завершения установки MPIO**, выберите **Закрыть**, а затем выберите **Инструменты** и **MPIO**.

6.  Перейдите на вкладку **Обнаружение многопутевых устройств** и установите флажок **Добавить поддержку для iSCSI-устройств** > **Добавить**, а затем выберите **Да** для **перезагрузки** VM001. Нажмите кнопку **ОК**, а затем перезагрузите систему вручную.

    ![](./media/azure-stack-network-howto-extend-datacenter/image13.png)

1.  После перезагрузки установите **новое RDP-подключение к VM001**.

2.  После подключения откройте **диспетчер сервера** и выберите **Инструменты** > **Инициатор iSCSI**.

3.  Выберите **Да** при открытии Microsoft iSCSI для разрешения запуска службы iSCSI по умолчанию.

    ![](./media/azure-stack-network-howto-extend-datacenter/image17.png)

4.  Щелкните вкладку **Обнаружение**.

5.  Нажмите кнопку **Обнаружить портал**. Теперь вы добавите два целевых объекта.

6.  Введите первый IP-адрес целевого сервера iSCSI и выберите **Дополнительно**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image15.png)

7. Укажите следующие **дополнительные параметры**:

    - Локальный адаптер: инициатор iSCSI (Майкрософт).

    - IP-адрес инициатора: 10.10.10.4.

    - Когда все будет готово, нажмите кнопку **ОК**.

8.  Нажмите кнопку **ОК** в диалоговом окне **Обнаружение целевого портала**.

9.  Повторите процесс со следующими значениями:

    - IP-адрес: второй целевой IP-адрес iSCSI.

    - Локальный адаптер: инициатор iSCSI (Майкрософт).

    - IP-адрес инициатора: 10.10.11.4.

10. Ваши целевые порталы должны выглядеть, как показано ниже, с вашими собственными целевыми IP-адресами iSCSI в столбце **Адрес**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image16.png)

11. Перейдите на вкладку **Цели**, а затем выберите цель iSCSI. Нажмите кнопку **Подключиться**.

12. В окне **Подключение к конечному объекту** выберите **Включить поддержку многопутевых накопителей** и выберите **Дополнительно**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image17.png)

13. В окне **Подключение к конечному объекту** введите следующие значения:

    - Локальный адаптер: инициатор iSCSI (Майкрософт).

    - IP-адрес инициатора: 10.10.10.4.

    - IP-адрес целевого портала: \<свой первый целевой IP-адрес iSCSI / 3260>.

    - Нажмите кнопку **ОК**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image18.png)

1.  Повторите процесс для второго сочетания "инициатор — цель".

    - Локальный адаптер: инициатор iSCSI (Майкрософт).

    - IP-адрес инициатора: 10.10.11.4.

    - IP-адрес целевого портала: \<свой второй целевой IP-адрес iSCSI / 3260>.

    ![](./media/azure-stack-network-howto-extend-datacenter/image19.png)

1.  Перейдите на вкладку **Тома и устройства**, а затем выберите **Автонастройка**. Вы увидите том MPIO.

    ![](./media/azure-stack-network-howto-extend-datacenter/image20.png)

2.  Вернитесь на вкладку **Цели**, выберите **Устройства**, и вы увидите два подключения к единому виртуальному жесткому диску iSCSI, созданному ранее.

    ![](./media/azure-stack-network-howto-extend-datacenter/image20.png)

3.  Нажмите кнопку **MPIO**, чтобы просмотреть дополнительные сведения о политике балансировки нагрузки и путях.

    ![](./media/azure-stack-network-howto-extend-datacenter/image21.png)

4.  Выберите **ОК** три раза, чтобы выйти из окон и инициатора iSCSI.

5.  Откройте оснастку "Управление дисками" (diskmgmt.msc), и во всплывающем окне будет предложено **инициализировать диск**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image22.png)

6.  Нажмите кнопку **ОК**, чтобы принять значения по умолчанию, а затем прокрутите вниз до нового диска, щелкните его правой кнопкой мыши и выберите пункт **Создать простой том**.

7.  Следуйте инструкциям мастера, принимая значения по умолчанию. Измените метку тома на **iSCSIdisk1**, а затем выберите **Готово**.

    ![](./media/azure-stack-network-howto-extend-datacenter/image23.png)

8.  Затем диск отформатируется и будет представлен буквой диска.

9.  Откройте **проводник** > **Этот компьютер**, чтобы увидеть новый диск, подключенный к VM001.

### <a name="test-external-storage-connectivity"></a>Проверка подключения ко внешнему хранилищу

Чтобы проверить связь и выполнить элементарный тест копирования файлов, войдите на **пользовательский портал** в системе **Azure Stack** и перейдите в колонку **Обзор** для **VM001**.

1. Выберите **Подключить**, чтобы установить RDP-подключение к **VM001**.

2. Откройте **диспетчер задач**, а затем выберите вкладку **Производительность**. Прикрепите окно к правой части сеанса RDP.

3. Откройте **интегрированную среду сценариев Windows PowerShell** от имени администратора и прикрепите окно к левой части сеанса RDP. В правой части интегрированной среды сценариев (ISE) закройте область **Команды** и нажмите кнопку **Сценарий**, чтобы развернуть белую область сценария в верхней части окна ISE.

4. В этой виртуальной машине нет собственных модулей PowerShell для создания VHD, который будет использоваться в качестве большого файла для проверки перемещения файла в цель iSCSI. В этом случае для создания VHD-файла нужно запустить DiskPart. В интегрированной среде сценариев выполните следующую команду:

    1. `Start-Process Diskpart`

    2. Откроется новая командная строка. Введите следующее:<br>`Create vdisk file="c:\\test.vhd" type=fixed maximum=5120`

    ![](./media/azure-stack-network-howto-extend-datacenter/image24.png)

    На создание уйдет несколько секунд. После этого, чтобы проверить созданное, откройте **проводник** и перейдите к C:\\. Там вы увидите новый файл test.vhd размером 5 ГБ.

    ![](./media/azure-stack-network-howto-extend-datacenter/image25.png)

    Закройте командную строку. Вернитесь в интегрированную среду сценариев и там введите следующую команду. Замените F:\\ на букву диска цели iSCSI, которую применяли ранее.

    1. `Copy-Item "C:\\test.vhd" -Destination "F:\\"`

    2. Выберите строку в интегрированной среде сценариев. Нажмите клавишу **F8** на клавиатуре.

    3. Во время выполнения команды понаблюдайте за двумя сетевыми адаптерами, через которые идет передача данных в VM001. Вы также должны увидеть, что каждый сетевой адаптер должен равномерно распределять нагрузку.

        ![](./media/azure-stack-network-howto-extend-datacenter/image26.png)

Этот сценарий разработан для демонстрации подключения между рабочей нагрузкой, запущенной в Azure Stack, и массивом внешнего хранилища, которым в данном случае является цель iSCSI Windows Server. Сценарий не предназначался для тестирования производительности, и вам не придется делать именно эти шаги, если вы использовали другое устройство на основе iSCSI. Однако здесь представлены основные рекомендации, которым можно следовать при развертывании рабочих нагрузок в Azure Stack и подключении их к системам хранения за пределами среды Azure Stack.

## <a name="next-steps"></a>Дальнейшие действия

[Сети Azure Stack: различия и рекомендации](azure-stack-network-differences.md)  