---
title: Шаблон для создания приложения, которое выполняет масштабирование в нескольких облаках с использованием локальных данных, в Azure и Azure Stack Hub.
description: Узнайте, как с помощью Azure и Azure Stack Hub создать приложение, выполняющее масштабирование в нескольких облаках с использованием локальных данных.
author: BryanLa
ms.topic: article
ms.date: 11/05/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 11/05/2019
ms.openlocfilehash: f492eba4cd2fae28162eb47b990737a8f5b21c53
ms.sourcegitcommit: 4ac711ec37c6653c71b126d09c1f93ec4215a489
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2020
ms.locfileid: "77689534"
---
# <a name="cross-cloud-scaling-on-premises-data-pattern"></a>Шаблон решения для масштабирования в разных облаках (локальные данные)

Узнайте, как создать гибридное приложение, охватывающее Azure и Azure Stack Hub. Этот шаблон также показывает, как использовать один источник локальных данных для обеспечения соответствия.

## <a name="context-and-problem"></a>Контекст и проблема

Многие организации собирают и хранят значительные объемы конфиденциальных данных клиента. Часто им запрещено хранить конфиденциальные данные в общедоступном облаке из-за корпоративных нормативных требований или политики правительства. Эти организации также хотят воспользоваться преимуществами масштабируемости общедоступного облака. Общедоступное облако может справляться с сезонными пиковыми нагрузками трафика, что позволяет клиентам платить только за требуемое оборудование по мере необходимости.

## <a name="solution"></a>Решение

Решение обеспечивает преимущества соответствия частного облака, сочетая их с масштабируемостью общедоступного облака. Гибридное облако Azure и Azure Stack Hub обеспечивает согласованную работу для разработчиков. Такая согласованность позволяет им применять свои навыки в общедоступных облачных и локальных средах.

Используя руководство по развертыванию решения, можно развернуть идентичное веб-приложение в общедоступном и частном облаке. Вы также можете получить доступ к маршрутизируемой сети, недоступной из Интернета и размещенной в частном облаке. В веб-приложениях отслеживается нагрузка. При значительном увеличении трафика программа управляет записями DNS, чтобы перенаправить трафик в общедоступное облако. При снижении трафика записи DNS обновляются, чтобы направить трафик обратно в частное облако.

[![Шаблон решения для масштабирования в разных облаках (локальные данные)](media/pattern-cross-cloud-scale-onprem-data/solution-architecture.png)](media/pattern-cross-cloud-scale-onprem-data/solution-architecture.png)

## <a name="components"></a>Components

Это решение использует следующие компоненты.

| Уровень | Компонент | Описание |
|----------|-----------|-------------|
| Azure | Служба приложений Azure | [Служба приложений Azure](/azure/app-service/) позволяет создавать и размещать веб-приложения, приложения RESTful API и Функции Azure. Все на любом языке программирования без необходимости управления инфраструктурой. |
| | Виртуальная сеть Azure| [Виртуальная сеть (VNET) Azure](/azure/virtual-network/virtual-networks-overview) — это стандартный строительный блок для вашей частной сети в Azure. Виртуальная сеть позволяет ресурсам Azure различных типов (например, Виртуальным машинам) обмениваться данными друг с другом через локальные сети и через Интернет. В решении также демонстрируется использование дополнительных сетевых компонентов:<br>— подсети приложения и шлюза;<br>— локальный сетевой шлюз;<br>— шлюз виртуальной сети, который выступает в качестве подключения VPN-шлюза типа "сеть — сеть";<br>— общедоступный IP-адрес;<br>— VPN-подключение "точка — сеть";<br>— Azure DNS для размещения доменов DNS и предоставления разрешения имен. |
| | Azure Traffic Manager | [Диспетчер трафика Azure](/azure/traffic-manager/traffic-manager-overview) — это балансировщик нагрузки трафика на основе DNS. Он позволяет управлять распределением пользовательского трафика между конечными точками службы в разных центрах обработки данных. |
| | Azure Application Insights | [Application Insights](/azure/azure-monitor/app/app-insights-overview) — это расширяемая служба управления производительностью приложений, предназначенная для веб-разработчиков, создающих приложения и управляющих ими на нескольких платформах.|
| | Функции Azure | Решение [Функции Azure](/azure/azure-functions/) позволяет выполнять код в бессерверной среде, в которой не нужно создавать виртуальную машину или публиковать веб-приложение. |
| | Автомасштабирование Azure | [Автомасштабирование](/azure/azure-monitor/platform/autoscale-overview) является встроенной функцией Облачных служб, Виртуальных машин и веб-приложений. Эта функция позволяет приложениям бесперебойно работать при изменении нагрузки. Приложения будут корректировать свою работу при пиках трафика, уведомляя вас об изменении метрик и при необходимости выполняя масштабирование. |
| Azure Stack Hub | Вычисления IaaS | Azure Stack Hub позволяет использовать модель приложения, портал самообслуживания и интерфейсы API, доступные с помощью Azure. Azure Stack Hub IaaS обеспечивает широкий спектр технологий с открытым кодом для согласованного развертывания гибридного облака. В примере решения используется виртуальная машина Windows Server для SQL Server.|
| | Служба приложений Azure | Как и в веб-приложении Azure, в решении используется [Служба приложений Azure в Azure Stack Hub](/azure-stack/operator/azure-stack-app-service-overview) для размещения веб-приложения. |
| | Сеть | Виртуальная сеть Azure Stack Hub работает точно так же, как и виртуальная сеть Azure. В ней используются множество тех же сетевых компонентов, включая пользовательские имена узлов. 
| Azure DevOps Services | Регистрация | Выполните быструю настройку непрерывной интеграции для сборки, тестирования и развертывания. Дополнительные сведения см. в статье [Quickstart: Sign up, sign in to Azure DevOps](/azure/devops/user-guide/sign-up-invite-teammates?view=azure-devops) (Краткое руководство. Регистрация и вход в Azure DevOps). |
| | Azure Pipelines | Используйте [Azure Pipelines](/azure/devops/pipelines/agents/agents?view=azure-devops) для непрерывной интеграции и поставки. Azure Pipelines позволяет управлять размещенными агентами сборок и выпусков, а также определениями. |
| | Репозиторий кода | Используйте несколько репозиториев кода, чтобы оптимизировать конвейер разработки, в том числе имеющиеся репозитории кода в GitHub, BitBucket, Dropbox, OneDrive и Azure Repos. |

## <a name="issues-and-considerations"></a>Проблемы и рекомендации

Во время выбора варианта реализации этого решения необходимо учитывать приведенные ниже моменты.

### <a name="scalability"></a>Масштабируемость 

Azure и Azure Stack Hub уникально подходят для удовлетворения потребностей современных глобально распределенных бизнес-процессов.

**Гибридное облако без трудностей**

Корпорация Майкрософт предлагает непревзойденную интеграцию локальных ресурсов с Azure Stack Hub и Azure в едином решении. Эта интеграция устраняет трудности управления многоточечными решениями и сочетанием поставщиков облачных служб. Благодаря масштабированию в нескольких облаках воспользоваться возможностями Azure можно всего лишь в несколько щелчков мыши. Просто подключите Azure Stack Hub к Azure с помощью выхода в облако, и ваши данные и приложения будут доступны в Azure, когда это потребуется.

- Устраните необходимость в создании и обслуживании дополнительного сайта аварийного восстановления.
- Сэкономьте время и деньги, избавившись от резервного копирования на магнитную ленту и перейдя на хранение данных резервного копирования в Azure до 99 лет.
- С легкостью переносите рабочие нагрузки Hyper-V, Physical (предварительная версия) и VMware (предварительная версия) в Azure, чтобы воспользоваться экономичностью и эластичностью облака.
- Запускайте отчеты или аналитику с ресурсоемкими вычислениями по реплицированной копии локального ресурса в Azure, не оказывая влияние на рабочие нагрузки.
- Войдите в облако и выполняйте локальные рабочие нагрузки в Azure, используя при необходимости более крупные шаблоны вычислений. Гибридная среда предоставляет необходимые возможности, когда это необходимо.
- Создавайте многоуровневые среды разработки в Azure в несколько щелчков мыши — выполняйте репликацию текущих производственных данных в среду разработки и тестирования для синхронизации практически в реальном времени.

**Экономия масштабирования в нескольких облаках с помощью Azure Stack Hub**

Ключевым преимуществом выхода в облако является экономичность. Вы платите за дополнительные ресурсы, только когда в них возникает потребность. Больше не нужно тратиться на дополнительную емкость, которая не используется, или пытаться предугадать пиковые нагрузки и колебания.

**Снижение высокого уровня нагрузки в облаке**

Масштабирование в нескольких облаках можно также использовать для обработки. Нагрузка распределяется за счет перемещения основных приложений в общедоступное облако, чтобы освободить локальные ресурсы для критически важных для бизнеса приложений. Приложение можно разместить в частном облаке, а затем осуществить выход в общедоступное облако, только когда понадобится справиться с нагрузками.


### <a name="availability"></a>Доступность

Глобальное развертывание сопровождается рядом трудностей, например неустойчивые подключения и законодательные требования, отличающиеся в разных регионах. Разработчики могут разработать только одно приложение, а затем развертывать его, руководствуясь различными соображениями и различными требованиями.  Разверните приложение в общедоступном облаке Azure, а затем разверните дополнительные экземпляры или компоненты локально. Вы можете управлять трафиком между всеми экземплярами с помощью Azure.

### <a name="manageability"></a>Управляемость

**Единый, согласованный подход к разработке**

Azure и Azure Stack Hub позволяют использовать согласованный набор средств разработки во всей организации. Такая согласованность упрощает реализацию непрерывной интеграции и разработки (CI/CD). Многие приложения и службы, развертываемые в Azure или Azure Stack Hub, взаимозаменяемы и могут эффективно выполняться в любом расположении.

С помощью гибридного конвейера CI/CD можно сделать следующее:
- инициировать новую сборку при фиксации кода в вашем репозитории;
- Автоматически развернуть созданный код в Azure для пользовательского приемочного тестирования.
- как только ваш код прошел тестирование, автоматически развернуть его в Azure Stack Hub.

**Единое решение целостного управления идентификацией**

Azure Stack Hub работает с Azure Active Directory или службами федерации Active Directory (ADFS). Azure Stack Hub работает с Azure Active Directory в сценариях с подключением. Для сред без подключения ADFS можно использовать в качестве отключенного решения. Субъекты-службы используются для предоставления доступа к приложениям, благодаря чему они смогут развертывать или настраивать ресурсы с помощью Azure Resource Manager. 

### <a name="security"></a>Безопасность

**Обеспечение соответствия и независимости данных**

Azure Stack Hub позволяет запускать одну и ту же службу в нескольких странах, как при использовании общедоступного облака. Развертывание одного приложения в центрах обработки данных в каждой стране позволяет обеспечить соблюдение требований к независимости данных. Эта возможность гарантирует хранение персональных данных в пределах каждой страны.

**Состояние безопасности в Azure Stack Hub**

Уровень безопасности можно обеспечить только с помощью надежного непрерывного процесса обслуживания. По этой причине корпорация Майкрософт вкладывает средства в механизм оркестрации, который с легкостью применяет исправления и обновления для всей инфраструктуры.

Благодаря сотрудничеству с OEM-партнерами Azure Stack Hub корпорация Майкрософт расширяет те же возможности обеспечения безопасности на компоненты изготовителя оборудования. Например, узел жизненного цикла оборудования и программное обеспечение, работающее на его основе. Это сотрудничество гарантирует, что Azure Stack Hub предусматривает единый и надежный уровень безопасности во всей инфраструктуре. Клиенты, в свою очередь, могут создавать и защищать рабочие нагрузки приложений.

**Использование субъектов-служб с помощью PowerShell, интерфейса командной строки и портала Azure**

Чтобы предоставить доступ к ресурсам скрипту или приложению, вы можете настроить для вашего приложения идентификатор и выполнить для него проверку подлинности с помощью собственных учетных данных. Такой идентификатор известен как субъект-служба и позволяет сделать следующее:

- Назначить для идентификатора приложения разрешения, которые отличаются от ваших разрешений и ограничиваются только потребностями приложения.
- Использовать сертификат для аутентификации при выполнении автоматического сценария. 

Дополнительные сведения о создании субъекта-службы и использовании сертификата для учетных данных см. в статье [Использование удостоверения приложения для доступа к ресурсам](/azure-stack/operator/azure-stack-create-service-principals).

## <a name="when-to-use-this-pattern"></a>Когда следует использовать этот шаблон 

- Моя организация уже использует подход DevOps или намерена применить его в ближайшем будущем.
- Я хочу реализовать методы CI/CD для своей реализации Azure Stack Hub и общедоступного облака.
- Я хочу объединить конвейеры CI/CD, размещенные в облачных и локальных средах.
- Мне нужна возможность простой разработки приложений в облачной или локальной службе.
- Я хочу единообразно применять навыки разработки для облачных и локальных приложений.
- Я использую Azure, но у меня есть разработчики, работающие в локальном облаке Azure Stack Hub.
- Мои локальные приложения сталкиваются с пиковыми нагрузками при сезонных, циклических или непредсказуемых колебаниях.
- У меня есть локальные компоненты, и я хочу использовать облако для эффективного масштабирования.
- Мне нужна облачная масштабируемость, но при этом требуется, чтобы приложение выполнялось в локальной среде как можно больше.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения по темам, описанным в этой статье:
- Обзор использования этого шаблона см. в видеоролике о [динамическом масштабировании приложений между центрами обработки данных и общедоступным облаком](https://www.youtube.com/watch?v=2lw8zOpJTn0).
- Рекомендации по проектированию гибридных приложений и ответы на дополнительные вопросы см. в [этой статье](overview-app-design-considerations.md).
- В этом шаблоне используется семейство продуктов Azure Stack, включая Azure Stack Hub. См. сведения о [полном семействе продуктов и решений Azure Stack](/azure-stack).

Когда вы будете готовы протестировать пример решения, продолжите работу с руководством по развертыванию [решения масштабирования в нескольких облаках (локальные данные)](solution-deployment-guide-cross-cloud-scaling-onprem-data.md). В этом руководстве содержатся пошаговые инструкции по развертыванию и тестированию компонентов.