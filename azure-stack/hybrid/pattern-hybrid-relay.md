---
title: Шаблон для реализации решения гибридного ретранслятора с помощью Azure и Azure Stack Hub.
description: Узнайте, как с помощью служб Azure и Azure Stack Hub подключиться к пограничным ресурсам или устройствам, защищенным брандмауэрами.
author: BryanLa
ms.service: azure-stack
ms.topic: article
ms.date: 11/05/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 11/05/2019
ms.openlocfilehash: 9b9defd4a6aec6dab3511425089e7395649d8087
ms.sourcegitcommit: 5c92a669007ab4aaffe4484f1d8836a40340dde1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2019
ms.locfileid: "73640127"
---
# <a name="hybrid-relay-pattern"></a>Шаблон гибридного ретранслятора

Узнайте, как подключаться к ресурсам или устройствам с пограничных устройств, защищенных брандмауэрами с помощью ретрансляторов служебной шины Azure.

## <a name="context-and-problem"></a>Контекст и проблема

Пограничные устройства часто находятся за корпоративным брандмауэром или устройством NAT. Хотя они безопасны, у них может не быть возможности взаимодействовать с общедоступным облаком или пограничными устройствами в других корпоративных сетях. Возможно, понадобится предоставить пользователям безопасный доступ к определенным портам и функциональным возможностям в общедоступном облаке. 

## <a name="solution"></a>Решение

В шаблоне гибридного ретранслятора с помощью ретрансляторов служебной шины Azure между двумя конечными точками, которые не могут напрямую обмениваться данными, устанавливается туннель WebSocket. Устройства, не находящиеся в локальной среде, которые необходимо подключить к локальной конечной точке, будут подключены к конечной точке в общедоступном облаке. Эта конечная точка перенаправит трафик на стандартные маршруты по безопасному каналу. Конечная точка в локальной среде получает трафик и направляет его в нужное место назначения. 

![Архитектура решения гибридного ретранслятора](media/pattern-hybrid-relay/solution-architecture.png)

Решение работает следующим образом: 

1. Устройство подключается к виртуальной машине в Azure по заранее определенному порту.
2. Трафик перенаправляется в ретранслятор служебной шины в Azure.
3. Виртуальная машина в Azure Stack Hub, которая уже установила длительное подключение к ретранслятору служебной шины, получает трафик и перенаправляет его в место назначения.
4. Локальная служба или конечная точка обрабатывает запрос. 

## <a name="components"></a>Компоненты

Это решение использует следующие компоненты.

| Слой | Компонент | ОПИСАНИЕ |
|----------|-----------|-------------|
| Azure | Azure | Виртуальная машина Azure предоставляет общедоступную конечную точку для локального ресурса. |
| | Ретрансляция служебной шины Azure | [Ретранслятор служебной шины Azure](/azure/service-bus-relay/) предоставляет инфраструктуру для обслуживания туннеля и подключения между виртуальной машиной Azure и виртуальной машиной Azure Stack Hub.|
| Azure Stack Hub | Службы вычислений | Виртуальная машина Azure Stack Hub предоставляет серверную часть туннеля гибридного ретранслятора. |
| | Хранилище | Кластер обработчика AKS, развернутый в Azure Stack Hub, предоставляет масштабируемый отказоустойчивый механизм для запуска контейнера API Распознавания лиц.|

## <a name="issues-and-considerations"></a>Проблемы и рекомендации

Во время выбора варианта реализации этого решения необходимо учитывать приведенные ниже моменты.

### <a name="scalability"></a>Масштабируемость 

Этот шаблон разрешает только сопоставление портов 1:1 в клиенте и на сервере. Например, если порт 80 туннелирован для одной службы в конечной точке Azure, его нельзя использовать для другой службы. Сопоставления портов следует планировать соответствующим образом. Ретранслятор и виртуальные машины служебной шины следует соответствующим образом масштабировать для обработки трафика.

### <a name="availability"></a>Доступность

Эти туннели и соединения не являются избыточными. Для обеспечения высокой доступности может потребоваться реализовать код проверки ошибок. Кроме того, можно использовать пул виртуальных машин, подключенных к ретранслятору служебной шины, за подсистемой балансировки нагрузки.

### <a name="manageability"></a>Управляемость

Это решение может масштабироваться на множество устройств и расположений, что может оказаться неудобным. Службы Интернета вещей Azure могут автоматически переводить новые расположения и устройства в оперативный режим и обновлять их.

### <a name="security"></a>Безопасность

Этот шаблон, как показано ниже, обеспечивает свободный доступ к порту на внутреннем устройстве с пограничного устройства. Рассмотрите возможность добавления механизма проверки подлинности в службу на внутреннем устройстве или перед конечной точкой гибридного ретранслятора. 

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения по темам, описанным в этой статье:
- В этом шаблоне используются ретрансляторы служебной шины Azure. Дополнительные сведения см. в [документации по ретрансляторам служебной шины Azure](/azure/service-bus-relay/).
- Рекомендации по проектированию гибридных приложений и ответы на дополнительные вопросы см. в [этой статье](overview-app-design-considerations.md).
- См. сведения о [полном семействе продуктов и решений Azure Stack](/azure-stack).

Когда вы будете готовы протестировать пример решения, продолжите работу с [руководством по развертыванию решения гибридного ретранслятора](https://aka.ms/hybridrelaydeployment). В этом руководстве содержатся пошаговые инструкции по развертыванию и тестированию компонентов.