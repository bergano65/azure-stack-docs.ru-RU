---
title: Управление инфраструктурой хранения для Azure Stack Hub
titleSuffix: Azure Stack
description: Сведения об управлении инфраструктурой хранения для Azure Stack Hub.
author: IngridAtMicrosoft
ms.topic: article
ms.date: 1/22/2020
ms.author: inhenkel
ms.lastreviewed: 03/11/2019
ms.reviewer: jiaha
ms.openlocfilehash: 6bfdca8487a5725417f88b5fcf0fb1acce26635a
ms.sourcegitcommit: 4ac711ec37c6653c71b126d09c1f93ec4215a489
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2020
ms.locfileid: "77697099"
---
# <a name="manage-storage-infrastructure-for-azure-stack-hub"></a>Управление инфраструктурой хранения для Azure Stack Hub

В этой статье описываются состояния работоспособности и рабочие состояния ресурсов инфраструктуры хранения Azure Stack Hub. К этим ресурсам относятся диски и тома. Сведения в этой статье помогут вам устранять разные проблемы, например ошибку при добавлении диска в пул.

## <a name="understand-drives-and-volumes"></a>Общие сведения о дисках и томах

### <a name="drives"></a>Диски

Azure Stack Hub под управлением Windows Server определяет возможности хранения данных на основе Локальных дисковых пространств (S2D) и отказоустойчивой кластеризации Windows Server. Такая комбинация представляет собой эффективную, масштабируемую и отказоустойчивую службу хранилища.

Партнеры по интегрированной системе Azure Stack Hub предлагают множество вариантов решений, в том числе гибких возможностей хранения. В настоящее время можно выбрать комбинацию из трех типов дисков: NVMe (энергонезависимая память Express), SSD (твердотельный накопитель) SATA/SAS или HDD (жесткий диск).

Локальные дисковые пространства включают в себя кэш, позволяющий увеличить производительность хранилища. На устройстве Azure Stack Hub с одним или несколькими типами дисков Локальные дисковые пространства автоматически используют все диски самых производительных типов (NVMe &gt; SSD &gt; HDD) для кэширования. Остальные диски используются для хранения. Диски можно сгруппировать в гибридное развертывание или развертывание, полностью реализованное на базе флэш-технологии:

![Инфраструктура хранилища Azure Stack Hub](media/azure-stack-storage-infrastructure-overview/image1.png)

Развертывания на базе флэш-технологий предназначены для обеспечения максимальной производительности хранилища, поэтому в них не используются вращающиеся диски.

![Инфраструктура хранилища Azure Stack Hub](media/azure-stack-storage-infrastructure-overview/image2.png)

Гибридные развертывания предназначены для поддержания баланса между производительностью и емкостью, а также для обеспечения максимальной емкость, поэтому в них используются вращающиеся диски.

Поведение кэша определяется автоматически на основе типов дисков, которые кэшируются. При кэшировании твердотельных накопителей (например, кэширование NVMe для дисков SSD) кэшируются только операции записи. Это уменьшает износ дисков емкости, сокращая суммарный трафик на таких дисках и продлевая срок их службы. Сейчас операции чтения не кэшируются. Это связано с тем, что операции чтения не оказывают существенного влияния на срок службы флэш-памяти, а задержка при чтении для твердотельных накопителей невелика. При кэшировании жестких дисков (например, кэшировании SSD для дисков HDD) кэшируются и операции чтения, и операции записи, чтобы обеспечить сравнимую с уровнем флэш-памяти задержку (с ускорением до 10 раз) для обеих типов операций.

![Инфраструктура хранилища Azure Stack Hub](media/azure-stack-storage-infrastructure-overview/image3.png)

Доступную конфигурацию хранилища можно узнать у партнера OEM Azure Stack Hub (https://azure.microsoft.com/overview/azure-stack/partners/) ).

> [!Note]  
> Устройство Azure Stack Hub может поставляться с гибридным развертыванием с дисками HDD и SSD (или NVMe). Но более быстродействующие диски будут использоваться для кэширования, а все остальные диски — в качестве дисков емкости в виде пула. Данные клиента (большие двоичные объекты, таблицы, очереди и диски) будут размещены на дисках емкости. Таким образом, предоставление дисков категории "Премиум" или выбор типа учетной записи хранения категории "Премиум" не гарантирует, что все объекты будут размещены на дисках SSD или NVMe.

### <a name="volumes"></a>Тома

*Служба хранения* разделяет доступное хранилище на отдельные тома, которые выделены для хранения данных клиента и системы. Тома объединяют диски в пул хранения, чтобы обеспечить отказоустойчивость, масштабируемость и производительность Локальных дисковых пространств.

![Инфраструктура хранилища Azure Stack Hub](media/azure-stack-storage-infrastructure-overview/image4.png)

В пуле хранения Azure Stack Hub создаются три типа томов.

- Инфраструктура: содержит файлы, используемые виртуальными машинами инфраструктуры и основными службами Azure Stack Hub.

- Временное пространство виртуальной машины: размещает временные диски, подключенные к виртуальным машинам клиента, и хранящиеся на этих дисках данные.

- Хранилище объектов: размещает данные клиента в форматах больших двоичных объектов, таблиц, очередей и дисков виртуальных машин.

В развертывании с несколькими узлами вы увидите три тома инфраструктуры, а количество томов временного пространства виртуальной машины и хранилища объектов будет совпадать с количеством узлов в развертывании Azure Stack Hub.

- В развертывании с четырьмя узлами существует четыре равных тома временного пространства виртуальной машины и четыре равных тома хранилища объектов.

- Когда вы добавляете новый узел в кластер, создаются новые тома обоих типов.

- Количество томов остается неизменным, даже если узел работает со сбоями или удален.

- Если вы используете Пакет средств разработки Azure Stack, предоставляется один том с несколькими общими ресурсами.

Тома в Локальных дисковых пространствах обеспечивают отказоустойчивость для предотвращения проблем с оборудованием, таких как сбои дисков или серверов. Они также обеспечивают постоянную доступность в течение всего времени обслуживания сервера, например во время обновления программного обеспечения. Развертывание Azure Stack Hub использует трехстороннее зеркальное отображение для обеспечения устойчивости данных. Три копии данных клиента записываются на разные серверы, где они попадают в кэш:

![Инфраструктура хранилища Azure Stack Hub](media/azure-stack-storage-infrastructure-overview/image5.png)

Зеркальное отображение обеспечивает отказоустойчивость, сохраняя несколько копий всех данных. Эти данные распределяются и размещаются нестандартно, но любые данные, хранящиеся с использованием зеркального отображения, полностью записываются несколько раз. Каждая копия записывается на разное физическое оборудование (разные диски на разных серверах), которые, как предполагается, выходят из строя независимо друг от друга. Трехстороннее зеркальное отображение может безопасно выдержать по крайней мере два сбоя оборудования (диска или сервера) одновременно. Например, в случае перезагрузки одного сервера при внезапном сбое другого диска или сервера все данные остаются в целостности и постоянно доступными.

## <a name="volume-states"></a>Состояния тома

Чтобы узнать, в каком состоянии находятся тома, используйте следующие команды PowerShell:

```powershell
$scaleunit_name = (Get-AzsScaleUnit)[0].name

$subsystem_name = (Get-AzsStorageSubSystem -ScaleUnit $scaleunit_name)[0].name

Get-AzsVolume -ScaleUnit $scaleunit_name -StorageSubSystem $subsystem_name | Select-Object VolumeLabel, HealthStatus, OperationalStatus, RepairStatus, Description, Action, TotalCapacityGB, RemainingCapacityGB
```

Вот пример выходных данных, где показаны отсоединенный том и неполный том или том с пониженной производительностью:

| VolumeLabel | HealthStatus | OperationalStatus |
|-------------|--------------|------------------------|
| ObjStore_1 | Неизвестно | Отсоединен |
| ObjStore_2 | Предупреждение | {Деградация, неполный} |

В следующих разделах перечислены состояния работоспособности и рабочие состояния.

### <a name="volume-health-state-healthy"></a>Состояние работоспособности тома: Healthy

| Состояние работы | Описание |
|---|---|
| OK | Том работоспособен. |
| Suboptimal (Неоптимальное) | Данные не записываются на диски равномерно.<br> <br>**Действие:** Обратитесь в службу поддержки, чтобы оптимизировать использование дисков в пуле хранения. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. Возможно, потребуется использовать резервную копию после восстановления неудачного подключения. |

### <a name="volume-health-state-warning"></a>Состояние работоспособности тома: Предупреждение

Если том находится в состоянии работоспособности "Предупреждение", это означает, что одна или несколько копий данных недоступны, но Azure Stack Hub может считывать хотя бы одну копию данных.

| Состояние работы | Описание |
|---|---|
| Обслуживается | Azure Stack Hub восстанавливает том, например, после добавления или удаления диска. После исправления том должен вернуться в состояние нормальной работоспособности.<br> <br>**Действие:** Подождите, пока Azure Stack Hub завершит восстановление тома, а затем проверьте состояние. |
| Неполный | Отказоустойчивость тома снижается из-за сбоя или отсутствия одного или нескольких дисков. Однако отсутствующие диски содержат обновленные копии ваших данных.<br> <br>**Действие:** Повторно подключите все отсутствующие диски, замените все неисправные диски и переведите в оперативный режим все серверы, которые находятся в автономном режиме. |
| Деградация | Устойчивость тома снижена из-за сбоя или отсутствия одного или нескольких дисков или устаревших копий данных на этих дисках.<br> <br>**Действие:** Повторно подключите все отсутствующие диски, замените все неисправные диски и переведите в оперативный режим все серверы, которые находятся в автономном режиме. |

### <a name="volume-health-state-unhealthy"></a>Состояние работоспособности тома: Unhealthy;

Когда том находится в неработоспособном состоянии, некоторые или все данные на томе недоступны.

| Состояние работы | Описание |
|---|---|
| No redundancy (Нет избыточности) | Данные на томе были утеряны из-за сбоя слишком большого количества дисков.<br> <br>**Действие:** Обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. |

### <a name="volume-health-state-unknown"></a>Состояние работоспособности тома: Неизвестно

Том также может находиться в состоянии работоспособности"Неизвестно", если виртуальный диск отключен.

| Состояние работы | Описание |
|---|---|
| Отсоединен | Произошел сбой устройства хранения, что может привести к недоступности тома. Некоторые данные могут быть утеряны.<br> <br>**Действие:** <br>1. Проверьте физическое и сетевое подключение всех устройств хранения.<br>2. Если все устройства подключены правильно, обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. Возможно, потребуется использовать резервную копию после восстановления неудачного подключения. |

## <a name="drive-states"></a>Состояния диска

Для мониторинга состояния дисков используйте следующие команды PowerShell:

```powershell
$scaleunit_name = (Get-AzsScaleUnit)[0].name

$subsystem_name = (Get-AzsStorageSubSystem -ScaleUnit $scaleunit_name)[0].name

Get-AzsDrive -ScaleUnit $scaleunit_name -StorageSubSystem $subsystem_name | Select-Object StorageNode, PhysicalLocation, HealthStatus, OperationalStatus, Description, Action, Usage, CanPool, CannotPoolReason, SerialNumber, Model, MediaType, CapacityGB
```

В следующих разделах описываются возможные состояния работоспособности диска.

### <a name="drive-health-state-healthy"></a>Состояние работоспособности диска: Healthy

| Состояние работы | Описание |
|---|---|
| OK | Том работоспособен. |
| Обслуживается | Диск выполняет некоторые внутренние действия по обслуживанию. После завершения действия диск должен вернуться в состояние нормальной работоспособности. |

### <a name="drive-health-state-healthy"></a>Состояние работоспособности диска: Healthy

Диск в состоянии "Предупреждение" может выполнять операции чтения и записи данных, но с ним возникла проблема.

| Состояние работы | Описание |
|---|---|
| Связь потеряна | Связь с диском была потеряна.<br> <br>**Действие:** Переведите все серверы в оперативный режим. Если это не помогает, повторно подключите диск. Если это состояние сохранится, замените диск, чтобы обеспечить полную отказоустойчивость. |
| Прогнозируемый сбой | Предполагается, что в ближайшее время произойдет сбой диска.<br> <br>**Действие:** Как можно скорее замените диск, чтобы обеспечить полную отказоустойчивость. |
| Ошибка ввода-вывода | Произошла временная ошибка при доступе к диску.<br> <br>**Действие:** Если это состояние сохранится, замените диск, чтобы обеспечить полную отказоустойчивость. |
| Временная ошибка | Произошла временная ошибка с диском. Такая ошибка обычно означает, что диск не отвечает или защитный раздел Локальных дисковых пространств был некорректным образом удален с диска. <br> <br>**Действие:** Если это состояние сохранится, замените диск, чтобы обеспечить полную отказоустойчивость. |
| Abnormal latency (Аномальная задержка) | Диск иногда не отвечает и демонстрирует признаки сбоя.<br> <br>**Действие:** Если это состояние сохранится, замените диск, чтобы обеспечить полную отказоустойчивость. |
| Удаление из пула | В Azure Stack Hub выполняется удаление диска из пула носителей.<br> <br>**Действие:** Подождите, пока Azure Stack Hub завершит удаление диска, а затем проверьте состояние.<br>Если состояние сохранится, обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. |
| Starting maintenance mode (Запуск режима обслуживания) | В Azure Stack Hub выполняется перевод диска в режим обслуживания. Это временное состояние, и скоро диск будет в состоянии "В режиме обслуживания".<br> <br>**Действие:** Подождите, пока Azure Stack Hub завершит процесс, а затем проверьте состояние. |
| В режиме обслуживания | Диск находится в режиме обслуживания, в котором операции чтения и записи с диска останавливаются. Обычно это означает, что на диске выполняются такие задачи администрирования Azure Stack Hub, как PNU или FRU. Администратор также может перевести диск в режим обслуживания.<br> <br>**Действие:** Подождите, пока Azure Stack Hub завершит задачу администрирования, а затем проверьте состояние.<br>Если состояние сохранится, обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. |
| Stopping maintenance mode (Остановка режима обслуживания) | В Azure Stack Hub выполняется перевод диска в режим подключения. Это временное состояние, и скоро диск будет в работоспособном состоянии.<br> <br>**Действие:** Подождите, пока Azure Stack Hub завершит процесс, а затем проверьте состояние. |

### <a name="drive-health-state-unhealthy"></a>Состояние работоспособности диска: Unhealthy;

Диск в неработоспособном состоянии не может выполнять операции записи или чтения.

| Состояние работы | Описание |
|---|---|
| Split | Диск отделен от пула.<br> <br>**Действие:** Замените диск на новый. Если вам необходимо использовать этот диск, извлеките его из системы, убедитесь, что на нем нет полезных данных, выполните очистку, а затем заново установите его. |
| Не годен для использования | Физический диск помещен в карантин, потому что он не поддерживается используемым поставщиком решений. Поддерживаются только диски, которые одобрены для решения и имеют правильное встроенное ПО диска.<br> <br>**Действие:** Замените накопитель на диск с утвержденным производителем и номером модели для решения. |
| Устаревшие метаданные | Заменяемый диск использовался ранее и может содержать данные из неизвестной системы хранения. Диск помещен в карантин. <br> <br>**Действие:** Замените диск на новый. Если вам необходимо использовать этот диск, извлеките его из системы, убедитесь, что на нем нет полезных данных, выполните очистку, а затем заново установите его. |
| Нераспознанные метаданные | На диске обнаружены нераспознанные метаданные. Обычно это означает, что на диске есть метаданные из другого пула.<br> <br>**Действие:** Замените диск на новый. Если вам необходимо использовать этот диск, извлеките его из системы, убедитесь, что на нем нет полезных данных, выполните очистку, а затем заново установите его. |
| Неисправный носитель | Диск вышел из строя и больше не будет использоваться дисковыми пространствами.<br> <br>**Действие:** Как можно скорее замените диск, чтобы обеспечить полную отказоустойчивость. |
| Device hardware failure (Сбой оборудования устройства) | На этом диске произошел сбой оборудования. <br> <br>**Действие:** Как можно скорее замените диск, чтобы обеспечить полную отказоустойчивость. |
| Обновление встроенного ПО | Azure Stack Hub обновляет встроенное ПО на диске. Это временное состояние, которое обычно длится менее минуты и в течение которого другие диски в пуле обрабатывают все операции чтения и записи.<br> <br>**Действие:** Подождите, пока Azure Stack Hub завершит обновление, а затем проверьте состояние. |
| Запуск | Диск подготавливается к работе. Это состояние должно быть временным. После завершения подготовки диск должен перейти в другое рабочее состояние.<br> <br>**Действие:** Подождите, пока Azure Stack Hub завершит операцию, а затем проверьте состояние. |

## <a name="reasons-a-drive-cant-be-pooled"></a>Причины, по которым диски невозможно объединить в пул

Некоторые диски не готовы к добавлению в пул хранения Azure Stack Hub. Вы можете узнать, почему диск не подходит для объединения в пул, просмотрев свойство `CannotPoolReason` для такого диска. В следующей таблице подробно описаны все причины.

| Причина | Описание |
|---|---|
| Несоответствие оборудования | Диск отсутствует в списке разрешенных моделей хранения, указанных службой работоспособности.<br> <br>**Действие:** Замените диск на новый. |
| Несоответствие встроенного ПО | Встроенное ПО, установленное на физическом диске, отсутствует в списке утвержденный версий ПО, указанных службой работоспособности.<br> <br>**Действие:** Замените диск на новый. |
| Используется кластером | Диск в настоящее время используется отказоустойчивым кластером.<br> <br>**Действие:** Замените диск на новый. |
| Съемные носители | Диск классифицируется как съемный. <br> <br>**Действие:** Замените диск на новый. |
| Неработоспособен | Диск находится в неработоспособном состоянии, его может потребоваться заменить.<br> <br>**Действие:** Замените диск на новый. |
| Недостаточная емкость | На диске есть разделы, занимающие свободное место.<br> <br>**Действие:** Замените диск на новый. Если вам необходимо использовать этот диск, извлеките его из системы, убедитесь, что на нем нет полезных данных, выполните очистку, а затем заново установите его. |
| Выполняется проверка | Служба работоспособности проверяет, утвержден ли для использования диск или встроенное ПО на нем.<br> <br>**Действие:** Подождите, пока Azure Stack Hub завершит процесс, а затем проверьте состояние. |
| Сбой проверки | Служба работоспособности не смогла проверить, утвержден ли для использования диск или встроенное ПО на нем.<br> <br>**Действие:** Обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. |
| Вне сети | Диск находится в автономном режиме. <br> <br>**Действие:** Обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. |

## <a name="next-step"></a>Следующий шаг

[Управление емкостью хранилища для Azure Stack](azure-stack-manage-storage-shares.md) 
