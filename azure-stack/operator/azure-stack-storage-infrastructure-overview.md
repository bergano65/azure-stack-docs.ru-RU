---
title: Управление инфраструктурой хранения для Azure Stack | Документация Майкрософт
description: Управление инфраструктурой хранения для Azure Stack.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: ''
ms.topic: article
ms.date: 08/27/2019
ms.author: mabrigg
ms.lastreviewed: 03/11/2019
ms.reviewer: jiahan
ms.openlocfilehash: c2a61e165ee64c4b0ee91fbe387973aaa5039f46
ms.sourcegitcommit: 9cb82df1eccb0486bcabec0bd674162d4820c00c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2019
ms.locfileid: "70060217"
---
# <a name="manage-storage-infrastructure-for-azure-stack"></a>Управление инфраструктурой хранения для Azure Stack

*Область применения: интегрированные системы Azure Stack и Пакет средств разработки Azure Stack*

В этой статье описываются состояния работоспособности и рабочие состояния ресурсов инфраструктуры хранения Azure Stack. К этим ресурсам относятся диски и тома. Сведения в этой статье могут иметь важное значение при попытке устранения различных неполадок, таких как невозможность добавления диска в пул.

## <a name="understand-drives-and-volumes"></a>Общие сведения о дисках и томах

### <a name="drives"></a>Диски

Azure Stack на платформе Windows Server определяет возможности хранения данных и, используя сочетание локальных дисковых пространств (S2D) и отказоустойчивой кластеризации Windows Server, обеспечивает эффективную, масштабируемую и отказоустойчивую службу хранения.

Партнеры по интегрированной системе Azure Stack предлагают множество вариантов решения, включая широкий спектр гибких возможностей хранения. В настоящее время можно выбрать комбинацию из трех типов дисков: NVMe (энергонезависимая память Express), SSD (твердотельный накопитель) SATA/SAS или HDD (жесткий диск).

Локальные дисковые пространства включают в себя кэш, позволяющий увеличить производительность хранилища. На устройстве Azure Stack с одним или несколькими типами дисков локальные дисковые пространства автоматически используют все самые производительные типы дисков (NVMe &gt; SSD &gt; HDD) для кэширования. Остальные диски используются для хранения. Диски можно сгруппировать в гибридное развертывание или развертывание, полностью реализованное на базе флэш-технологии:

![Инфраструктура хранения Azure Stack](media/azure-stack-storage-infrastructure-overview/image1.png)

Развертывания на базе флэш-технологии ориентированны на максимальную производительность хранилища и не используют вращающиеся жесткие диски (HDD).

![Инфраструктура хранения Azure Stack](media/azure-stack-storage-infrastructure-overview/image2.png)

Гибридные развертывания предназначены для обеспечения баланса производительности и емкости или увеличения емкости и включают в себя вращающиеся жесткие диски (HDD).

Поведение кэша определяется автоматически на основе типов дисков, которые кэшируются. При кэшировании твердотельных накопителей (например, кэширование NVMe для дисков SSD) кэшируются только операции записи. Это уменьшает износ дисков емкости, сокращая суммарный трафик на таких дисках и продлевая срок их службы. В то же время, так как операции чтения существенно не влияют на срок службы устройств флэш-памяти и твердотельные накопители повсеместно обеспечивают низкую задержку чтения, операции чтения не кэшируется. При кэшировании жестких дисков (например, кэширование SSD для жестких дисков) кэшируются и операции чтения, и операции записи, чтобы обеспечить низкую задержку (часто до 10 раз ниже) для обеих операций.

![Инфраструктура хранения Azure Stack](media/azure-stack-storage-infrastructure-overview/image3.png)

Доступную конфигурацию хранилища можно узнать у партнера OEM Azure Stack (https://azure.microsoft.com/overview/azure-stack/partners/) ).

> [!Note]  
> Устройство Azure Stack может поставляться в гибридном развертывании с дисками HDD и SSD (или NVMe). Но более быстродействующие диски будут использоваться для кэширования, а все остальные диски — в качестве дисков емкости в виде пула. Данные клиента (большие двоичные объекты, таблицы, очереди и диски) будут размещены на дисках емкости. Таким образом, предоставление дисков категории "Премиум" или выбор типа учетной записи хранения категории "Премиум" не означает, что объекты гарантированно будут размещены на дисках SSD или NVMe и получат более высокую производительность.

### <a name="volumes"></a>Тома

*Служба хранения* разделяет доступное хранилище на отдельные тома, которые выделены для хранения данных клиента и системы. Тома объединяют диски в пул хранения, чтобы обеспечить отказоустойчивость, масштабируемость и производительность локальных дисковых пространств.

![Инфраструктура хранения Azure Stack](media/azure-stack-storage-infrastructure-overview/image4.png)

В пуле хранения Azure Stack создаются три типа томов:

-   Инфраструктура: содержит файлы, используемые виртуальными машинами инфраструктуры Azure Stack и основными службами.

-   Временное пространство виртуальной машины: размещает временные диски, подключенные к виртуальным машинам клиента, и хранящиеся на этих дисках данные.

-   Хранилище объектов: размещает данные клиента и используется для больших двоичных объектов, таблиц, очередей и дисков виртуальных машин.

В развертывании с несколькими узлами вы увидите три тома инфраструктуры, в то время как количество томов временного пространства виртуальной машины и томов хранилища объектов равно количеству узлов в развертывании Azure Stack:

-   В развертывании с четырьмя узлами существует четыре равных тома временного пространства виртуальной машины и четыре равных тома хранилища объектов.

-   Если вы добавите новый узел в кластер, будет создан новый том для обоих типов.

-   Количество томов остается неизменным, даже если узел работает со сбоями или удален.

-   Если вы используете комплект разработчика Azure Stack, существует один том с несколькими общими ресурсами.

Тома в локальных дисковых пространствах обеспечивают отказоустойчивость для защиты от проблем с оборудованием, таких как сбои дисков или серверов, и для обеспечения постоянной доступности в течение всего времени обслуживания сервера, например во время обновления программного обеспечения. Развертывание Azure Stack использует трехстороннее зеркальное отображение для обеспечения устойчивости данных. Три копии данных клиента записываются на разные серверы, где они попадают в кэш:

![Инфраструктура хранения Azure Stack](media/azure-stack-storage-infrastructure-overview/image5.png)

Зеркальное отображение обеспечивает отказоустойчивость, сохраняя несколько копий всех данных. Эти данные распределяются и размещаются нестандартно, но мы можем точно сказать, что любые данные, хранящиеся с использованием зеркального отображения, полностью записываются несколько раз. Каждая копия записывается на разное физическое оборудование (разные диски на разных серверах), которые, как предполагается, выходят из строя независимо друг от друга. Трехстороннее зеркальное отображение может безопасно выдержать по крайней мере два сбоя оборудования (диска или сервера) одновременно. Например, в случае перезагрузки одного сервера при внезапном сбое другого диска или сервера все данные остаются в целостности и постоянно доступными.

## <a name="volume-states"></a>Состояния тома

Чтобы узнать, в каком состоянии находятся тома, используйте следующие команды PowerShell:

```powershell
$scaleunit_name = (Get-AzsScaleUnit)[0].name

$subsystem_name = (Get-AzsStorageSubSystem -ScaleUnit $scaleunit_name)[0].name

Get-AzsVolume -ScaleUnit $scaleunit_name -StorageSubSystem $subsystem_name | Select-Object VolumeLabel, HealthStatus, OperationalStatus, RepairStatus, Description, Action, TotalCapacityGB, RemainingCapacityGB
```

Вот пример выходных данных, где показаны отсоединенный том и неполный том или том с пониженной производительностью:

| VolumeLabel | HealthStatus | OperationalStatus |
|-------------|--------------|------------------------|
| ObjStore_1 | Unknown | Отсоединен |
| ObjStore_2 | Предупреждение | {Деградация, неполный} |

В следующих разделах перечислены состояния работоспособности и рабочие состояния.

### <a name="volume-health-state-healthy"></a>Состояние работоспособности тома: Healthy

| Рабочее состояние | ОПИСАНИЕ |
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ОК | Том работоспособен. |
| Suboptimal (Неоптимальное) | Данные не записываются на диски равномерно.<br> <br>**Действие:** Обратитесь в службу поддержки для оптимизации использования дисков в пуле хранения. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. Возможно, потребуется использовать резервную копию после восстановления неудачного подключения. |


### <a name="volume-health-state-warning"></a>Состояние работоспособности тома: Предупреждение

Если том находится в состоянии работоспособности "Предупреждение", это означает, что одна или несколько копий данных недоступны, но Azure Stack все равно может считать хотя бы одну копию данных.

| Рабочее состояние | ОПИСАНИЕ |
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Обслуживается | Azure Stack восстанавливает том, например, после добавления или удаления диска. После исправления том должен вернуться в состояние нормальной работоспособности.<br> <br>**Действие:** Подождите, пока Azure Stack завершит восстановление тома, а затем проверьте состояние. |
| Неполный | Отказоустойчивость тома снижается из-за сбоя или отсутствия одного или нескольких дисков. Однако отсутствующие диски содержат обновленные копии ваших данных.<br> <br>**Действие:** Повторно подключите все отсутствующие диски, замените все неисправные диски и переведите в оперативный режим все серверы, которые находятся в автономном режиме. |
| Деградация | Устойчивость тома снижена из-за сбоя или отсутствия одного или нескольких дисков и наличия устаревших копий данных на этих дисках.<br> <br>**Действие:** Повторно подключите все отсутствующие диски, замените все неисправные диски и переведите в оперативный режим все серверы, которые находятся в автономном режиме. |

 

### <a name="volume-health-state-unhealthy"></a>Состояние работоспособности тома: Unhealthy;

Когда том находится в неработоспособном состоянии, некоторые или все данные на томе недоступны.

| Рабочее состояние | ОПИСАНИЕ |
|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| No redundancy (Нет избыточности) | Данные на томе были утеряны из-за сбоя слишком большого количества дисков.<br> <br>**Действие:** Обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. |


### <a name="volume-health-state-unknown"></a>Состояние работоспособности тома: Unknown

Том также может находиться в состоянии работоспособности"Неизвестно", если виртуальный диск отключен.

| Рабочее состояние | ОПИСАНИЕ |
|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Отсоединен | Произошел сбой устройства хранения, что может привести к недоступности тома. Некоторые данные могут быть утеряны.<br> <br>**Действие:** <br>1. Проверьте физическое и сетевое подключение всех устройств хранения.<br>2. Если все устройства подключены правильно, обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. Возможно, потребуется использовать резервную копию после восстановления неудачного подключения. |

## <a name="drive-states"></a>Состояния диска

Для мониторинга состояния дисков используйте следующие команды PowerShell:

```powershell
$scaleunit_name = (Get-AzsScaleUnit)[0].name

$subsystem_name = (Get-AzsStorageSubSystem -ScaleUnit $scaleunit_name)[0].name

Get-AzsDrive -ScaleUnit $scaleunit_name -StorageSubSystem $subsystem_name | Select-Object StorageNode, PhysicalLocation, HealthStatus, OperationalStatus, Description, Action, Usage, CanPool, CannotPoolReason, SerialNumber, Model, MediaType, CapacityGB
```

В следующих разделах описываются состояния работоспособности диска.

### <a name="drive-health-state-healthy"></a>Состояние работоспособности диска: Healthy

| Рабочее состояние | ОПИСАНИЕ |
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| ОК | Том работоспособен. |
| Обслуживается | Диск выполняет некоторые внутренние действия по обслуживанию. После завершения действия диск должен вернуться в состояние нормальной работоспособности. |

### <a name="drive-health-state-healthy"></a>Состояние работоспособности диска: Healthy

Диск в состоянии "Предупреждение" может выполнять операции чтения и записи данных, но с ним возникла проблема.

| Рабочее состояние | ОПИСАНИЕ |
|---------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Связь потеряна | Связь с диском была потеряна.<br> <br>**Действие:** Переведите все серверы в оперативный режим. Если это не помогает, повторно подключите диск. Если этот сбой повторяется, замените диск, чтобы обеспечить полную отказоустойчивость. |
| Прогнозируемый сбой | Предполагается, что в ближайшее время произойдет сбой диска.<br> <br>**Действие:** Как можно скорее замените диск, чтобы обеспечить полную отказоустойчивость. |
| Ошибка ввода-вывода | Произошла временная ошибка при доступе к диску.<br> <br>**Действие:** Если этот сбой повторяется, замените диск, чтобы обеспечить полную отказоустойчивость. |
| Временная ошибка | Произошла временная ошибка с диском. Обычно это означает, что диск не отвечает, но это также может означать, что защитный раздел локальных дисковых пространств был ненадлежащим образом удален с диска. <br> <br>**Действие:** Если этот сбой повторяется, замените диск, чтобы обеспечить полную отказоустойчивость. |
| Abnormal latency (Аномальная задержка) | Диск иногда не отвечает и демонстрирует признаки сбоя.<br> <br>**Действие:** Если этот сбой повторяется, замените диск, чтобы обеспечить полную отказоустойчивость. |
| Удаление из пула | Azure Stack находится в процессе удаления диска из его пула хранения.<br> <br>**Действие:** Подождите, пока Azure Stack завершит удаление диска, а затем проверьте состояние.<br>Если состояние не изменяется, обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. |
|  |  |
| Starting maintenance mode (Запуск режима обслуживания) | Azure Stack находится в процессе перевода диска в режим обслуживания. Это временное состояние, и скоро диск будет в состоянии "В режиме обслуживания".<br> <br>**Действие:** Подождите, пока Azure Stack завершит процесс, а затем проверьте состояние. |
| В режиме обслуживания | Диск находится в режиме обслуживания, в котором операции чтения и записи с диска останавливаются. Обычно это означает, что на диске выполняются такие задачи администрирования Azure Stack, как PNU или FRU. Администратор также может перевести диск в режим обслуживания.<br> <br>**Действие:** Подождите, пока Azure Stack завершит задачу администрирования, а затем проверьте состояние.<br>Если состояние не изменяется, обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. |
|  |  |
| Stopping maintenance mode (Остановка режима обслуживания) | Azure Stack находится в процессе перевода диска в оперативный режим. Это временное состояние, и скоро диск будет в работоспособном состоянии.<br> <br>**Действие:** Подождите, пока Azure Stack завершит процесс, а затем проверьте состояние. |

 

### <a name="drive-health-state-unhealthy"></a>Состояние работоспособности диска: Unhealthy;

Диск в неработоспособном состоянии не может выполнять операции записи или чтения.

| Рабочее состояние | ОПИСАНИЕ |
|-------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| разделение; | Диск отделен от пула.<br> <br>**Действие:** Замените диск на новый. Если вам необходимо использовать этот диск, извлеките его из системы, убедитесь, что на нем нет полезных данных, сотрите диск, а затем заново установите его. |
| Не годен для использования | Физический диск помещен в карантин, потому что он не поддерживается используемым поставщиком решений. Поддерживаются только диски, которые одобрены для решения и имеют правильное встроенное ПО диска.<br> <br>**Действие:** Замените накопитель на диск с утвержденным производителем и номером модели для решения. |
| Устаревшие метаданные | Заменяемый диск использовался ранее и может содержать данные из неизвестной системы хранения. Диск помещен в карантин.        <br> <br>**Действие:** Замените диск на новый. Если вам необходимо использовать этот диск, извлеките его из системы, убедитесь, что на нем нет полезных данных, сотрите диск, а затем заново установите его. |
| Нераспознанные метаданные | На диске обнаружены нераспознанные метаданные. Обычно это означает, что на диске есть метаданные из другого пула.<br> <br>**Действие:** Замените диск на новый. Если вам необходимо использовать этот диск, извлеките его из системы, убедитесь, что на нем нет полезных данных, сотрите диск, а затем заново установите его. |
| Неисправный носитель | Диск вышел из строя и больше не будет использоваться дисковыми пространствами.<br> <br>**Действие:** Как можно скорее замените диск, чтобы обеспечить полную отказоустойчивость. |
| Device hardware failure (Сбой оборудования устройства) | На этом диске произошел сбой оборудования. <br> <br>**Действие:** Как можно скорее замените диск, чтобы обеспечить полную отказоустойчивость. |
| Обновление встроенного ПО | Azure Stack обновляет встроенного ПО на диске. Это временное состояние, которое обычно длится менее минуты и в течение которого другие диски в пуле обрабатывают все операции чтения и записи.<br> <br>**Действие:** Подождите, пока Azure Stack завершит обновление, а затем проверьте состояние. |
| Запуск | Диск подготавливается к работе. Это должно быть временное состояние. После завершения подготовки диск должен перейти в другое рабочее состояние.<br> <br>**Действие:** Подождите, пока Azure Stack завершит операцию, а затем проверьте состояние. |
 

## <a name="reasons-a-drive-cant-be-pooled"></a>Причины, по которым диски невозможно объединить в пул

Некоторые диски не готовы к добавлению в пул хранения Azure Stack. Вы можете узнать, почему диск не подходит для объединения в пул, просмотрев свойство CannotPoolReason для такого диска. В следующей таблице подробно описаны все причины.

| Причина | ОПИСАНИЕ |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Несоответствие оборудования | Диск отсутствует в списке разрешенных моделей хранения, указанных службой работоспособности.<br> <br>**Действие:** Замените диск на новый. |
| Несоответствие встроенного ПО | Встроенное ПО, установленное на физическом диске, отсутствует в списке утвержденный версий ПО, указанных службой работоспособности.<br> <br>**Действие:** Замените диск на новый. |
| Используется кластером | Диск в настоящее время используется отказоустойчивым кластером.<br> <br>**Действие:** Замените диск на новый. |
| Съемные носители | Диск классифицируется как съемный. <br> <br>**Действие:** Замените диск на новый. |
| Неработоспособен | Диск находится в неработоспособном состоянии, его может потребоваться заменить.<br> <br>**Действие:** Замените диск на новый. |
| Недостаточная емкость | На диске есть разделы, занимающие свободное место.<br> <br>**Действие:** Замените диск на новый. Если вам необходимо использовать этот диск, извлеките его из системы, убедитесь, что на нем нет полезных данных, сотрите диск, а затем заново установите его. |
| Выполняется проверка | Служба работоспособности проверяет, утвержден ли для использования диск или встроенное ПО на нем.<br> <br>**Действие:** Подождите, пока Azure Stack завершит процесс, а затем проверьте состояние. |
| Сбой проверки | Служба работоспособности не смогла проверить, утвержден ли для использования диск или встроенное ПО на нем.<br> <br>**Действие:** Обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. |
| Автономно | Диск находится в автономном режиме. <br> <br>**Действие:** Обратитесь в службу поддержки. Прежде чем отправить запрос в службу поддержки, запустите процесс сбора файлов журнала, следуя рекомендациям в статье https://aka.ms/azurestacklogfiles. |

## <a name="next-step"></a>Дальнейшие действия

[Управление емкостью хранилища для Azure Stack](azure-stack-manage-storage-shares.md) 
