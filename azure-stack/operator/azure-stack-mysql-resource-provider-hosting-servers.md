---
title: Добавление серверов размещения MySQL в Azure Stack Hub
description: Узнайте, как добавить серверы размещения MySQL для подготовки через поставщик ресурсов адаптера MySQL.
author: bryanla
ms.topic: article
ms.date: 11/06/2019
ms.author: bryanla
ms.reviewer: xiaofmao
ms.lastreviewed: 11/06/2019
ms.openlocfilehash: b02ea9e241faea3aeaad76b85dbde9616e1edea5
ms.sourcegitcommit: 20d10ace7844170ccf7570db52e30f0424f20164
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79295547"
---
# <a name="add-mysql-hosting-servers-in-azure-stack-hub"></a>Добавление серверов размещения MySQL в Azure Stack Hub

Вы можете разместить экземпляр сервера размещения MySQL на виртуальной машине в [Azure Stack Hub](azure-stack-overview.md) или на виртуальной машине за пределами среды Azure Stack Hub при условии, что поставщик ресурсов MySQL может подключаться к этому экземпляру.

> [!NOTE]
> Поставщик ресурсов MySQL необходимо создать в подписке поставщика по умолчанию, а серверы размещения MySQL — в оплачиваемых пользовательских подписках. Сервер поставщика ресурсов не следует использовать для размещения баз данных пользователя.

Для серверов размещения можно использовать версии MySQL 5.6, 5.7 и 8.0. Поставщик ресурсов MySQL не поддерживает проверку подлинности caching_sha2_password. Серверы MySQL 8.0 должны быть настроены для использования mysql_native_password.

## <a name="configure-external-access-to-the-mysql-hosting-server"></a>Настройка внешнего доступа к серверу размещения MySQL

Прежде чем добавлять сервер MySQL в качестве узла размещения сервера MySQL для Azure Stack Hub, необходимо включить внешний доступ. Рассмотрим это на примере BitNami MySQL из Azure Stack Hub Marketplace. Внешний доступ можно настроить, выполнив описанные ниже действия.

1. Войдите на сервер MySQL с компьютера, который имеет доступ к общедоступному IP-адресу, используя любой SSH-клиент (в нашем примере это [PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)).

    По общедоступному IP-адресу войдите на виртуальную машину с именем пользователя **bitnami** и созданным ранее паролем приложения без специальных символов.

   ![LinuxLogin](media/azure-stack-tutorial-mysqlrp/bitnami1.png)

2. Используйте следующую команду в окне клиента SSH, чтобы убедиться, что служба bitnami включена и запущена. При появлении запроса введите пароль bitnami снова:

   `sudo service bitnami status`

   ![Проверка службы bitnami](media/azure-stack-tutorial-mysqlrp/bitnami2.png)

3. Создайте учетную запись удаленного доступа, которая будет использоваться сервером размещения MySQL Azure Stack Hub для подключения к MySQL, затем выйдите из клиента SSH.

    Выполните приведенные ниже команды, чтобы войти в MySQL с правами привилегированного пользователя, используя созданный ранее пароль. Создайте нового пользователя с правами администратора и укажите для него *\<имя_пользователя\>* и *\<пароль\>* , соответствующие требованиям для вашей среды. В нашем примере создается пользователь с именем **sqlsa** и паролем высокой надежности:

   ```mysql
   mysql -u root -p
   create user <username>@'%' identified by '<password>';
   grant all privileges on *.* to <username>@'%' with grant option;
   flush privileges;
   ```

   ![Создание пользователя-администратора](media/azure-stack-tutorial-mysqlrp/bitnami3.png)

4. Запишите новые сведения о пользователе MySQL.

Эти имя пользователя и пароль оператор Azure Stack Hub будет использовать при создании сервера размещения MySQL с помощью этого сервера MySQL.

## <a name="connect-to-a-mysql-hosting-server"></a>Подключение к серверу размещения MySQL

Убедитесь, что у вас есть учетные данные для учетной записи с правами системного администратора.

> [!NOTE]
> Для MySQL 8.0 и более поздних версий удаленный доступ не включен по умолчанию. Вам нужно создать новую учетную запись пользователя и предоставить права удаленного доступа к этой учетной записи пользователя, чтобы добавлять ее в качестве сервера размещения.

Чтобы добавить сервер размещения, выполните следующие действия.

1. Войдите на портал администратора Azure Stack Hub с правами администратора службы.
2. Выбор пункта **Все службы**.
3. В категории **АДМИНИСТРАТИВНЫЕ РЕСУРСЫ** выберите **Серверы размещения MySQL** >  **+Добавить**. Откроется диалоговое окно **Добавить сервер размещения MySQL**, показанное на следующем снимке экрана.

   ![Настройка сервера размещения MySQL](./media/azure-stack-mysql-rp-deploy/mysql-add-hosting-server-2.png)

4. Введите сведения о подключении своего экземпляра MySQL Server.

   * В поле **MySQL Hosting Server Name** (Имя сервера размещения MySQL) укажите полное доменное имя (FQDN) или допустимый IPv4-адрес. Не используйте короткое имя виртуальной машины.
   * По умолчанию образы Bitnami MySQL, доступные в Azure Stack Hub Marketplace, имеют **имя администратора** *root*.
   * Если вы не знаете **пароль** учетной записи root, ознакомьтесь с [документацией Bitnami](https://docs.bitnami.com/azure/faq/#how-to-find-application-credentials), чтобы узнать, как получить его.
   * Экземпляр MySQL по умолчанию отсутствует, поэтому необходимо указать значение в поле **Size of Hosting Server in GB** (Размер сервера размещения в ГБ). Значение должно быть близким к емкости сервера базы данных.
   * В поле **Подписка** оставьте значение по умолчанию.
   * В разделе **Группа ресурсов** можно создать новую группу или использовать имеющуюся.

   > [!NOTE]
   > Если экземпляр MySQL может быть доступен Azure Resource Manager клиента и администратора, его можно передать под контроль поставщика ресурсов. Но экземпляр MySQL **должен** быть выделен исключительно для поставщика ресурсов.

5. Выберите **Номера SKU**, чтобы открыть диалоговое окно **Создание номера SKU**.

   ![Создание SKU MySQL](./media/azure-stack-mysql-rp-deploy/mysql-new-sku.png)

   **Имя** номера SKU должно отражать свойства номера SKU, чтобы пользователи могли развертывать базы данных на соответствующий номер SKU.

6. Нажмите кнопку **ОК**, чтобы создать номер SKU.
   > [!NOTE]
   > Отображение номеров SKU на портале может занять до часа. Вы не можете создать базу данных до развертывания и запуска SKU.

7. В разделе **Добавить сервер размещения MySQL** нажмите кнопку **Создать**.

При добавлении серверов их необходимо назначать новым или имеющимся номерам SKU для дифференциации предложений служб. Например, в организации может существовать корпоративный экземпляр MySQL для поддержки объемных резервных копий баз данных и автоматических резервных копий. Этот высокопроизводительный сервер можно зарезервировать для разных отделов в вашей организации.

## <a name="security-considerations-for-mysql"></a>Вопросы безопасности для MySQL

Следующие сведения применимы к поставщикам ресурсов и серверам размещения MySQL:

* Убедитесь, что все серверы размещения настроены для обмена данными через TLS 1.1. См. раздел [Настройка MySQL для использования зашифрованных соединений](https://dev.mysql.com/doc/refman/5.7/en/using-encrypted-connections.html).
* Используйте [прозрачное шифрование данных](https://dev.mysql.com/doc/mysql-secure-deployment-guide/5.7/en/secure-deployment-data-encryption.html).
* Поставщик ресурсов MySQL не поддерживает проверку подлинности caching_sha2_password.

## <a name="increase-backend-database-capacity"></a>Увеличение емкости серверной базы данных

Чтобы увеличить емкость серверной базы данных, разверните дополнительные серверы MySQL на портале Azure Stack Hub. Добавьте эти серверы в новый или существующий номер SKU. При добавлении сервера в существующий номер SKU, убедитесь, что характеристики сервера совпадают с характеристиками других серверов в номере SKU.

## <a name="sku-notes"></a>Примечания номеров SKU
Используйте имя номера SKU, которое описывает возможности серверов в номере SKU, такие как емкость и производительность. Имя предоставляет возможность пользователям развернуть свои базы данных в соответствующем номере SKU. Например, имена номеров SKU можно использовать для дифференциации предложений служб по следующим характеристикам:
  
* Большая емкость
* Высокая производительность
* высокий уровень доступности

Как показала лучшая методика, все серверы размещения в номере SKU должны иметь одинаковые ресурсы и характеристики производительности.

Номера SKU невозможно назначать определенным пользователям или группам.

Чтобы изменить номер SKU, перейдите к разделу **Все службы** > **MySQL Adapter** (Адаптер MySQL)  > **Номера SKU**. Выберите номер SKU, который нужно изменить, внесите необходимые изменения и нажмите кнопку **Сохранить** для сохранения изменений. 

Для удаления ненужного номера SKU, перейдите к разделу **Все службы** > **Адаптер MySQL** > **Номера SKU**. Щелкните правой кнопкой мыши имя номера SKU и выберите **Удалить** для его удаления.

> [!IMPORTANT]
> Отображение новых номеров SKU на пользовательском портале может занять до одного часа.

## <a name="make-mysql-database-servers-available-to-your-users"></a>Предоставление пользователям доступа к серверам баз данных MySQL

Создайте планы и предложения, чтобы сделать серверы баз данных MySQL доступными для пользователей. Добавьте службу Microsoft.SqlAdapter в план и создайте квоту. MySQL не позволяет ограничивать размер баз данных.

> [!IMPORTANT]
> Отображение новых квот на пользовательском портале или применение измененных квот может занять до двух часов.

## <a name="next-steps"></a>Дальнейшие действия

[Создание базы данных MySQL](azure-stack-mysql-resource-provider-databases.md)
