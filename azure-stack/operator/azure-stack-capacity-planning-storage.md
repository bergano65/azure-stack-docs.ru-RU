---
title: Планирование емкости хранилища для Azure Stack Hub
description: Сведения о планировании емкости хранилища для развертываний Azure Stack Hub.
author: ihenkel
ms.topic: article
ms.date: 05/31/2019
ms.author: inhenkel
ms.reviewer: prchint
ms.lastreviewed: 05/31/2019
ms.openlocfilehash: 8aa3bbb2c3b859ff98c8dd68fe4d24036ec18a4a
ms.sourcegitcommit: 0a3c8b0bf9c116a5caaeca453a2bbc6e7f7cbfb9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2020
ms.locfileid: "77147670"
---
# <a name="azure-stack-hub-storage-capacity-planning"></a>Планирование емкости хранилища для Azure Stack Hub

В следующих разделах приводятся сведения о планировании ресурсов хранилища для Azure Stack Hub, которые помогут спланировать потребности решения в ресурсах хранения.

## <a name="uses-and-organization-of-storage-capacity"></a>Использование и организация емкости хранилища

Гиперконвергентная конфигурация Azure Stack Hub позволяет совместно использовать физические устройства хранения. Доступные ресурсы хранилища делятся в первую очередь между инфраструктурой, временным хранилищем для виртуальных машин арендатора и хранилищем, используемым службами Azure Consistent Storage (ACS) для больших двоичных объектов, таблиц и очередей.

## <a name="storage-spaces-direct-cache-and-capacity-tiers"></a>Кэш и уровни емкости локальных дисковых пространств

Часть емкости хранилища используется для операционной системы, локальных журналов, дампов и других временных потребностей инфраструктуры. Это локальное хранилище (устройства и ресурсы) отделено от устройств хранения, находящихся под управлением конфигурации локальных дисковых пространств. Остальные устройства хранения помещаются в единый пул хранения вне зависимости от числа серверов в единице масштабирования.

Эти устройства бывают двух типов: кэши и емкость. Локальные дисковые пространства используют устройства кэша для кэширования операций обратной записи и чтения. Емкость устройств кэша не включается в видимую емкость отформатированных виртуальных дисков. Напротив, локальные дисковые пространства используют устройства емкости для этой цели, предоставляя место размещения управляемых данных.

Вся емкость хранилища выделяется и управляется непосредственно инфраструктурой Azure Stack Hub. Оператору не нужно принимать решения касательно конфигурации, выделения или увеличения емкости. В Azure Stack Hub эти проектные решения принимаются автоматически в соответствии с требованиями решения во время начальной установки или развертывания, либо при увеличении емкости. При разработке Azure Stack Hub принимает в расчет особенности, касающиеся устойчивости, резервной емкости для повторных сборок, а также другие факторы.

Оператор может выбрать хранилище на основе *исключительно флэш-памяти* или *гибридную* конфигурацию хранилища:

![Схема планирования емкости хранилища Azure](media/azure-stack-capacity-planning/storage.png)

Все конфигурации флэш-памяти делятся на одно- или двухуровневые. Если конфигурация является одноуровневой, вся пропускная способность устройства будет иметь один тип (например, *NVMe*, *SATA SSD* или *SAS SSD*), а кэш устройства использоваться не будет. В двухуровневой конфигурации флэш-памяти NVMe является типичной конфигурацией в качестве устройств кэширования, а затем SATA или SAS SSD в качестве пропускной способности устройств.

В гибридной двухуровневой конфигурации для кэша можно выбрать NVMe, SATA или SSD SATA, а емкость основана на жестких дисках (HDD).

Ниже приведен краткий обзор локальных дисковых пространств и конфигурации хранилища Azure Stack Hub.
- Один пул локальных дисковых пространств на единицу масштабирования (все устройства хранения настраиваются в одном пуле).
- Виртуальные диски создаются в виде трех зеркальных копий для оптимальной производительности и устойчивости.
- Каждый виртуальный диск отформатирован в файловой системе ReFS.
- Емкость виртуальных дисков рассчитывается и выделяется так, чтобы емкость данных, соответствующая одному устройству емкости, оставалась в пуле невыделенной. Это равносильно одному диску емкости на сервер.
- В каждой файловой системе ReFS включена функция BitLocker для шифрования неактивных данных. 

Виртуальные диски создаются автоматически и имеют приведенную ниже емкость.

|Имя|Расчет емкости|Описание|
|-----|-----|-----|
|Локальное или загрузочное устройство|Не менее 340 ГБ <sup>1</sup>|Хранилище на отдельных серверах для образов операционной системы и локальных виртуальных машин инфраструктуры.|
|Инфраструктура|3,5 ТБ|Общее использование инфраструктуры Azure Stack Hub.|
|VmTemp|См. ниже <sup>2</sup>|К виртуальным машинам арендатора подключены временные диски, на которых хранятся эти данные.|
|ACS|См. ниже <sup>3</sup>|Емкость Azure Consistent Storage для служб больших двоичных объектов, таблиц и очередей.|

<sup>1</sup> Минимальная емкость хранилища, которая требуется от партнера по решению Azure Stack Hub.

<sup>2</sup> Размер виртуального диска, используемого для временных дисков виртуальных машин арендатора, рассчитывается как доля физической памяти сервера. Размер временного диска представляет собой долю физической памяти, назначенной виртуальной машине. Выделение ресурсов хранилища для временного диска в Azure Stack Hub осуществляется так, чтобы охватить большинство сценариев использования, но при этом могут не удовлетворяться все потребности в хранении для временного диска. При выборе этой доли ставилась задача обеспечить доступность временного хранилища, но в то же время не допустить отведения большей части емкости, имеющейся в решении, под временный диск. Для каждого сервера в единице масштабирования создается один временный диск. Емкость временного хранилища не может превышать 10 % от общей доступной емкости хранилища в пуле носителей единицы масштабирования. Расчет производится примерно так:

```
  DesiredTempStoragePerServer = PhysicalMemory * 0.65 * 8
  TempStoragePerSolution = DesiredTempStoragePerServer * NumberOfServers
  PercentOfTotalCapacity = TempStoragePerSolution / TotalAvailableCapacity
  If (PercentOfTotalCapacity <= 0.1)
      TempVirtualDiskSize = DesiredTempStoragePerServer
  Else
      TempVirtualDiskSize = (TotalAvailableCapacity * 0.1) / NumberOfServers
```

<sup>3</sup> Размер виртуальных дисков, создаваемых для использования службами ACS, получается в результате деления оставшейся емкости без остатка. Как отмечалось, все виртуальные диски представляют собой три зеркальные копии, и для каждого сервера остается невыделенной емкость, соответствующая одному диску емкости. Сначала выделяются различные виртуальные диски, перечисленные выше, а оставшаяся емкость используется для виртуальных дисков ACS.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте больше о [планировщике ресурсов Azure Stack Hub](azure-stack-capacity-planner.md).
