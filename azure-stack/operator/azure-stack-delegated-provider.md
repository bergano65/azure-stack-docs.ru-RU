---
title: Делегирование предложений в Azure Stack Hub
description: Узнайте, как делегировать задачи, например по созданию предложений и регистрации пользователей.
author: sethmanheim
ms.topic: article
ms.date: 01/27/2020
ms.author: sethm
ms.reviewer: alfredop
ms.lastreviewed: 05/07/2019
ms.openlocfilehash: 95b7ca9d6ed5bf0c8fed0019b4b3954fd3a7d458
ms.sourcegitcommit: 4ac711ec37c6653c71b126d09c1f93ec4215a489
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2020
ms.locfileid: "77700244"
---
# <a name="delegate-offers-in-azure-stack-hub"></a>Делегирование предложений в Azure Stack Hub

Как оператору Azure Stack Hub вам может понадобиться привлечь других людей к регистрации пользователей и созданию подписок. Например, если вы являетесь поставщиком услуг, посредники должны регистрировать клиентов и управлять ими от вашего имени. Или, например, ваше подразделение является частью центральной ИТ-группы предприятия, и вам нужно делегировать обязанности по входу пользователей другому ИТ-специалисту.

Делегирование упрощает охват и управление большим количеством пользователей по сравнению с самостоятельным выполнением, как показано на рисунке.

![Уровни делегирования в Azure Stack Hub](media/azure-stack-delegated-provider/image1.png)

При использовании делегирования делегированный поставщик управляет предложением (т. н. *делегированным предложением*), а пользователи получают подписки в рамках этого предложения без участия системного администратора.

## <a name="delegation-roles"></a>Роли делегирования

Следующие роли являются частью делегирования:

* *Оператор Azure Stack Hub* управляет инфраструктурой Azure Stack Hub, создает шаблон предложения и делегирует другим пользователям возможность предлагать его своим клиентам.

* Делегированные операторы Azure Stack Hub c правами *владельца* или *участника* в подписках называются *делегированными поставщиками*. Они могут относиться к другим организациям (например, к другим клиентам Azure Active Directory).

* *Пользователи* регистрируются для получения предложений и используют их для управления своими рабочими нагрузками, создания виртуальных машин, хранения данных и т. д.

## <a name="delegation-steps"></a>Действия делегирования

Существуют два основных действия по настройке делегирования.

1. **Создание подписки делегированного поставщика**. Подписка пользователя на предложение содержит только службу подписок. Таким образом делегированный поставщик сможет расширить делегированные предложения на других пользователей путем их подписки на них.

2. **Делегирование предложения делегированному поставщику**. Это предложение позволяет делегированному поставщику создавать подписки или расширять предложение для пользователей. Теперь делегированный поставщик может принимать предложение и предлагать его другим пользователям.

На следующем рисунке показаны действия по настройке делегирования.

![Шаги по созданию делегированного поставщика и предоставлению ему возможности регистрировать пользователей в Azure Stack Hub](media/azure-stack-delegated-provider/image2.png)

### <a name="delegated-provider-requirements"></a>Требования к делегированному поставщику

Чтобы выступать в качестве делегированного поставщика, пользователь устанавливает связь с основным поставщиком, создавая подписки. Подписка позволяет делегированному поставщику предоставлять делегированные предложения от имени основного поставщика.

После установления этой связи оператор Azure Stack Hub может делегировать предложение делегированному поставщику. Делегированный поставщик может принять предложение, переименовать его (но не изменять его содержание) и предложить своим клиентам.

## <a name="delegation-walkthrough"></a>Пошаговое руководство по делегированию

Следующие разделы содержат пошаговое руководство по настройке делегированного поставщика, делегированию предложения и проверке того, могут ли пользователи зарегистрироваться для получения делегированного предложения.

### <a name="set-up-roles"></a>Настройка ролей

Для использования этого пошагового руководства требуется две учетные записи Azure AD в дополнение к учетной записи оператора Azure Stack Hub. Если их нет, необходимо создать две такие учетные записи. Учетные записи могут принадлежать любому пользователю Azure AD. Они называются учетными записями делегированного поставщика и пользователя.

| **Роль** | **Права в организации** |
| --- | --- |
| Делегированный поставщик |Пользователь |
| Пользователь |Пользователь |

 > [!NOTE]
 > В случае торгового посредника CSP для создания этого делегированного поставщика потребуется задать этих пользователей в каталоге клиента (Azure AD пользователя). Оператору Azure Stack Hub необходимо [сначала подключить](azure-stack-enable-multitenancy.md) Azure AD клиента, а затем настроить потребление и выставление счетов, выполнив [эти действия](azure-stack-csp-howto-register-tenants.md).

### <a name="identify-the-delegated-provider"></a>Идентификация делегированного поставщика

1. Войдите на портал администратора с учетной записью оператора Azure Stack Hub.

1. Чтобы создать предложение, которое позволяет пользователю стать делегированным поставщиком, выполните следующие действия.

   а.  [Создайте план](azure-stack-create-plan.md).
       Этот план должен содержать только службу подписки. В этой статье в качестве примера используется план с именем **PlanForDelegation**.

   b.  [Создайте предложение](azure-stack-create-offer.md) на основе этого плана. В этой статье в качестве примера используется предложение с именем **OfferToDP**.

   c.  Добавьте делегированного поставщика в качестве подписчика на это предложение, выбрав **Подписки**, затем **Добавить** и **Новая подписка клиента**.

   ![Добавление делегированного поставщика в качестве подписчика с помощью портала администрирования Azure Stack Hub](media/azure-stack-delegated-provider/image3.png)

   > [!NOTE]
   > Как и для всех предложений Azure Stack Hub, у вас есть два варианта действий. Вы можете сделать предложение общедоступным и разрешить пользователям регистрироваться в нем или оставить его частным и позволить оператору Azure Stack Hub управлять регистрациями. Делегированные поставщики, как правило, представляют собой небольшую группу. Вам нужно будет контролировать допуск в эту группу. Поэтому в большинстве случаев целесообразнее вариант частного доступа.

### <a name="azure-stack-hub-operator-creates-the-delegated-offer"></a>Создание делегированного предложения оператором Azure Stack Hub

Следующим шагом является создание плана и предложения, которое необходимо делегировать и которое будут использовать клиенты. Рекомендуем сразу определить это предложение так, как его должны видеть клиенты — делегированный поставщик не может изменить включаемые планы и квоты.

1. Как оператор Azure Stack Hub [создайте план](azure-stack-create-plan.md) и [предложение](azure-stack-create-offer.md) на его основе. В этой статье в качестве примера используется предложение с именем **DelegatedOffer**.

   > [!NOTE]
   > Это предложение не обязательно делать общедоступным, но это возможно. В большинстве случаев вам понадобится ограничить к нему доступ, то есть разрешить его только делегированным поставщикам. После делегирования частного предложения, как описано в представленных ниже инструкциях, делегированный поставщик получит к нему доступ.

2. Делегируйте предложение. Выберите предложение **DelegatedOffer**. В разделе **Параметры** выберите **Делегированные поставщики**, а затем **Добавить**.

3. Выберите подписку делегированного поставщика из раскрывающегося списка и нажмите кнопку **Делегировать**.

   ![Добавление делегированного поставщика на портале администрирования Azure Stack Hub](media/azure-stack-delegated-provider/image4.png)

### <a name="delegated-provider-customizes-the-offer"></a>Настройка предложения делегированным поставщиком

Войдите на портал пользователя в качестве делегированного поставщика и создайте предложение, используя делегированное предложение в качестве шаблона.

1. Выберите **+ Создать ресурс**, **Предложения и планы клиента**, а затем — **Предложение**.

    ![Создание предложения на портале администрирования Azure Stack Hub](media/azure-stack-delegated-provider/image5.png)

2. Присвойте имя предложению. В этом примере используется **ResellerOffer**. Выберите делегированное предложение для использования в качестве основы и нажмите кнопку **Создать**.

   ![Присвоение имени на портале администрирования Azure Stack Hub](media/azure-stack-delegated-provider/image6.png)

   >[!IMPORTANT]
   >Важно понимать, что делегированные поставщики могут выбирать только предложения, делегированные им. Делегированные поставщики не могут вносить изменения в эти предложения. Только оператор Azure Stack Hub может вносить в них изменения. Например, только оператор может изменять их планы и квоты. Делегированный поставщик не создает предложение на основе базовых и дополнительных планов.

3. Делегированный поставщик может сделать эти предложения общедоступными через собственный URL-адрес портала. Чтобы сделать предложение общедоступным, выберите **Обзор** и щелкните **Предложения**. Выберите предложение и нажмите **Изменить состояние**.

4. Теперь общедоступные делегированные предложения видимы только на делегированном портале. Чтобы найти и изменить этот URL-адрес:

    а.  Выберите **Обзор**, **Все службы**, а затем в категории **Общие** выберите **Подписки**. Выберите подписку делегированного поставщика; например **DPSubscription**, затем **Свойства**.

    b.  Скопируйте URL-адрес портала в отдельное расположение, например в Блокнот.

    ![Выбор подписки делегированного поставщика на пользовательском портале Azure Stack Hub](media/azure-stack-delegated-provider/dpportaluri.png)  

   Вы создали делегированное предложение от имени делегированного поставщика. Выйдите из системы как делегированный поставщик и закройте окно браузера.

### <a name="sign-up-for-the-offer"></a>Регистрация для получения предложения

1. В новом окне браузера перейдите по URL-адресу делегированного портала, сохраненному на предыдущем шаге. Войдите на портал в качестве пользователя.

   >[!NOTE]
   >Делегированные предложения отображаются только на делегированном портале.

1. На панели мониторинга выберите **Получить подписку**. Вы увидите, что для пользователя отображаются только делегированные предложения, созданные делегированным поставщиком.

   ![Просмотр и создание предложений на пользовательском портале Azure Stack Hub](media/azure-stack-delegated-provider/image8.png)

Процесс делегирования предложения завершен. Теперь пользователь может зарегистрироваться на это предложение, получив подписку на него.

## <a name="move-subscriptions-between-delegated-providers"></a>Перемещение подписок между делегированными поставщиками

При необходимости подписку можно перемещать между новыми или имеющимися подписками делегированного поставщика, которые принадлежат одному и тому же клиенту каталога. Вы можете переместить их с помощью командлета PowerShell [Move-AzsSubscription](/powershell/module/azs.subscriptions.admin).

Перемещение подписок полезно в следующих случаях.

* Нужно подключить нового члена команды, который получит роль делегированного поставщика, и этому члену нужно присвоить подписки пользователя, созданные ранее в рамках подписки поставщика по умолчанию.
* У вас есть несколько подписок делегированных поставщиков в одном клиенте каталога (AAD), и необходимо переместить между ними подписки пользователей. Такой сценарий может иметь место в том случае, когда члена перемещают между командами и его подписку нужно разместить в новой команде.

## <a name="next-steps"></a>Дальнейшие действия

* [Создание тестовой виртуальной машины в Azure Stack](../user/azure-stack-create-vm-template.md)
