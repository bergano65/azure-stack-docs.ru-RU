---
title: Восстановление после катастрофической потери данных в Azure Stack Hub
description: Узнайте, как восстановить данные инфраструктуры в Azure Stack Hub после катастрофической потери данных.
author: justinha
ms.topic: article
ms.date: 02/12/2019
ms.author: justinha
ms.reviewer: hectorl
ms.lastreviewed: 11/05/2019
ms.openlocfilehash: 245951e86128fb71e6820f3b57bdf2723506d4bc
ms.sourcegitcommit: 8198753ebafd69d0dbfc6b3548defbd70f4c79c1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2020
ms.locfileid: "78935062"
---
# <a name="recover-from-catastrophic-data-loss"></a>Восстановление после катастрофической потери данных

Azure Stack Hub выполняет службы Azure в вашем центре обработки данных и может работать в малых средах, которые состоят всего из четырех узлов в одной стойке, тогда как Azure функционирует в более чем 40 регионах с несколькими центрами обработки данных и несколькими зонами в каждом. Ресурсы пользователя могут охватывать несколько серверов, стоек, центров обработки данных и регионов. Сейчас Azure Stack Hub позволяет развертывать всю облачную инфраструктуру в одной стойке. Это ограничение подвергает облако риску при аварийных ситуациях в центре обработки данных или серьезных ошибках в программном продукте. При аварии экземпляр Azure Stack Hub переходит в автономный режим. Возникает вероятность потери всех данных без возможности восстановления.

В зависимости от первопричины потери данных, возможно, вам потребуется исправить только одну службу инфраструктуры или восстановить весь экземпляр Azure Stack Hub. Может потребоваться даже восстановление на различном оборудовании в том же или другом расположении.

Этот сценарий предназначен для восстановления всей установки в случае сбоя оборудования и повторного развертывания частного облака.

| Сценарий                                                           | Потеря данных                            | Рекомендации                                                             |
|--------------------------------------------------------------------|--------------------------------------|----------------------------------------------------------------------------|
| Восстановление после катастрофической потери данных из-за аварии или ошибки в программном продукте. | Все данные инфраструктуры, пользователей и приложений. | Приложение и данные пользователей защищаются отдельно от данных инфраструктуры. |

## <a name="workflows"></a>Рабочие процессы

Защита Azure Stack Hub начинается с раздельного резервного копирования данных инфраструктуры и данных приложения или клиента. Из этой статьи вы узнаете, как защитить инфраструктуру. 

![Рабочий процесс восстановления данных Azure Stack Hub — развертывание](media/azure-stack-backup/azure-stack-backup-workflow1.png)

В худшем случае при потере всех данных восстановление Azure Stack Hub — это процесс восстановления уникальных данных инфраструктуры для конкретного развертывания Azure Stack Hub и всех данных пользователя. 

![Рабочий процесс восстановления данных Azure Stack Hub — повторное развертывание](media/azure-stack-backup/azure-stack-backup-workflow2.png)

## <a name="restore"></a>Восстановить

Если все данные потеряны, но оборудование сохраняет работоспособность, нужно повторно развернуть Azure Stack Hub. Во время повторного развертывания можно указать место хранения и учетные данные, необходимые для доступа к резервным копиям. В таком случае нет необходимости указывать службы, которые нужно восстановить. Контроллер резервного копирования инфраструктуры внедряет состояние плоскости управления в рамках рабочего процесса развертывания.

В случае аварии, при которой оборудование выходит из строя, повторно развернуть систему можно только на новом оборудовании. Повторное развертывание может занять несколько недель, которые потребуются для заказа и доставки нового оборудования в центр обработки данных. Восстановить данные плоскости управления можно в любое время. Но восстановление не поддерживается, если версия повторно развернутого экземпляра более чем на один выпуск новее, чем версия, используемая в последней резервной копии.

| Режим развертывания | Начальная точка | Конечная точка                                                                                                                                                                                                     |
|-----------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Чистая установка   | Базовая сборка | Изготовитель оборудования развертывает Azure Stack Hub и обновляет инфраструктуру до последней поддерживаемой версии.                                                                                                                                          |
| Режим восстановления   | Базовая сборка | Изготовитель оборудования развертывает Azure Stack Hub в режиме восстановления и использует версию, которая соответствует требованиям, в зависимости от последней доступной резервной копии. Изготовитель оборудования выполняет развертывание и обновляет систему до последней поддерживаемой версии. |

## <a name="data-in-backups"></a>Данные в резервных копиях

Azure Stack Hub поддерживает тип развертывания, называемый режимом восстановления в облаке. Этот режим используется только для восстановления Azure Stack Hub после аварии или ошибки в программном продукте, при которых нет возможности восстановить решение. В этом режиме развертывания не восстанавливаются данные пользователей, которые хранятся в решении. Восстановление в этом режиме ограничено следующими данными:

 - входные данные развертывания;
 - внутренние данные службы идентификации (развертывания AD FS);
 - конфигурация федеративной идентификации (развертывания AD FS);
 - корневые сертификаты, используемые внутренним центром сертификации;
 - пользовательские данные конфигурации Azure Resource Manager, например подписки, планы, предложения, квоты для хранилища и сети, вычислительные ресурсы;
 - секреты и хранилища Key Vault;
 - назначения политик RBAC и назначения ролей.

Во время развертывания пользовательские ресурсы IaaS (инфраструктура как услуга) и PaaS (платформа как услуга) не восстанавливаются. К таким потерям относятся виртуальные машины IaaS, учетные записи хранения, большие двоичные объекты, таблицы, конфигурация сети и др. Восстановление в облаке предназначено для того, чтобы операторы и пользователи могли войти на портал по завершении развертывания. Ресурсы входящих на портал пользователей не сохраняются. Подписки пользователей восстанавливаются вместе с исходными политиками, планами и предложениями, определенными администратором. Для пользователей, которые входят в систему, действуют те же ограничения, что и в исходном решении до сбоя. Когда восстановление в облаке завершится, оператор может вручную восстановить важные поставщики ресурсов и поставщики ресурсов сторонних разработчиков, а также связанные с ними данные.

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с рекомендациями по [использованию службы резервного копирования инфраструктуры](azure-stack-backup-best-practices.md).
