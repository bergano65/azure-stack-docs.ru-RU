---
title: Восстановление после катастрофической потери данных в Azure Stack с помощью службы резервного копирования инфраструктуры | Документация Майкрософт
description: Если катастрофический сбой приводит к отказу Azure Stack, вы можете восстановить данные инфраструктуры при повторном развертывании Azure Stack.
services: azure-stack
documentationcenter: ''
author: justinha
manager: femila
editor: ''
ms.assetid: 2ECE8580-0BDE-4D4A-9120-1F6771F2E815
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/12/2019
ms.author: justinha
ms.reviewer: hectorl
ms.lastreviewed: 11/05/2018
ms.openlocfilehash: b6b6796f5d47189499e01c94b9c988dbf03091bb
ms.sourcegitcommit: f6ea6daddb92cbf458f9824cd2f8e7e1bda9688e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/25/2019
ms.locfileid: "68493999"
---
# <a name="recover-from-catastrophic-data-loss"></a>Восстановление после катастрофической потери данных

*Область применения: интегрированные системы Azure Stack*.

Azure Stack выполняет службы Azure в вашем центре обработки данных и может работать в малых средах, которые состоят всего из четырех узлов в одной стойке, тогда как Azure функционирует в более чем 40 регионах с несколькими центрами обработки данных и несколькими зонами в каждом. Ресурсы пользователя могут охватывать несколько серверов, стоек, центров обработки данных и регионов. Сейчас Azure Stack позволяет развертывать целое облако с использованием только одной стойки. Это представляет опасность для облака, такую как аварийные ситуации в центре обработки данных или сбои из-за серьезных ошибок в программном продукте. При аварии экземпляр Azure Stack переходит в автономный режим. Возникает вероятность потери всех данных без возможности восстановления.

В зависимости от первопричины потери данных, возможно, вам потребуется исправить только одну службу инфраструктуры или восстановить весь экземпляр Azure Stack. Может потребоваться даже восстановление на различном оборудовании в том же или другом расположении.

Этот сценарий предназначен для восстановления всей установки в случае сбоя оборудования и повторного развертывания частного облака.

| Сценарий                                                           | Потеря данных                            | Рекомендации                                                             |
|--------------------------------------------------------------------|--------------------------------------|----------------------------------------------------------------------------|
| Восстановление после катастрофической потери данных из-за аварии или ошибки в программном продукте | Все данные инфраструктуры, пользователей и приложений | Приложение и данные пользователя должны были защищены отдельно от данных инфраструктуры. |

## <a name="workflows"></a>Рабочие процессы

Защита Azure Stack начинается с раздельного резервного копирования данных инфраструктуры и данных приложения или клиента. Из этой статьи вы узнаете, как защитить инфраструктуру. 

![Первоначальное развертывание Azure Stack](media/azure-stack-backup/azure-stack-backup-workflow1.png)

В худшем случае при потере всех данных восстановление Azure Stack — это процесс восстановления уникальных данных инфраструктуры для конкретного развертывания Azure Stack и всех данных пользователя. 

![Повторное развертывание Azure Stack](media/azure-stack-backup/azure-stack-backup-workflow2.png)

## <a name="restore"></a>Восстановление

Если все данные потеряны, но оборудование по-прежнему можно использовать, нужно повторно развернуть Azure Stack. Во время повторного развертывания можно указать место хранения и учетные данные, необходимые для доступа к резервным копиям. В таком случае нет необходимости указывать службы, которые нужно восстановить. Контроллер резервного копирования инфраструктуры внедряет состояние плоскости управления в рамках рабочего процесса развертывания.

В случае аварии, при которой оборудование выходит из строя, повторно развернуть систему можно только на новом оборудовании. Повторное развертывание может занять несколько недель, которые потребуются для заказа и доставки нового оборудования в центр обработки данных. Восстановить данные плоскости управления можно в любое время. Но восстановление не поддерживается, если версия повторно развернутого экземпляра более чем на одну позицию выше, чем версия, используемая в последней резервной копии. 

| Режим развертывания | Начальная точка | Конечная точка                                                                                                                                                                                                     |
|-----------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Чистая установка   | Базовая сборка | Изготовитель оборудования развертывает Azure Stack и обновляет инфраструктуру до последней поддерживаемой версии.                                                                                                                                          |
| Режим восстановления   | Базовая сборка | Изготовитель оборудования развертывает Azure Stack в режиме восстановления и использует версию, которая соответствует требованиям, в зависимости от последней доступной резервной копии. Изготовитель оборудования выполняет развертывание и обновляет систему до последней поддерживаемой версии. |

## <a name="data-in-backups"></a>Данные в резервных копиях

Azure Stack поддерживает тип развертывания, называемый режимом восстановления в облаке. Этот режим используется только для восстановления Azure Stack после аварии или ошибки в программном продукте, при которых нет возможности восстановить решение. В этом режиме развертывания данные пользователя, которые хранятся в решении, не восстанавливаются. Восстановление в этом режиме ограничено следующими данными:

 - входные данные развертывания;
 - внутренние данные службы идентификации (развертывания AD FS);
 - конфигурация федеративной идентификации (развертывания AD FS);
 - корневые сертификаты, используемые внутренним центром сертификации;
 - пользовательские данные конфигурации Azure Resource Manager, например подписки, планы, предложения и квоты для хранилища, сети и вычислительных ресурсов;
 - секреты и хранилища Key Vault;
 - назначения политик RBAC и назначения ролей. 

Во время развертывания пользовательские ресурсы IaaS (инфраструктура как услуга) и PaaS (платформа как услуга) не восстанавливаются. То есть виртуальные машины, учетные записи хранения, большие двоичные объекты, таблицы, конфигурация сети и другие ресурсы IaaS будут потеряны. Восстановление в облаке предназначено для того, чтобы операторы и пользователи смогли входить на портал по завершении развертывания. Ресурсы входящих на портал пользователей не сохраняются. Подписки пользователей восстанавливаются вместе с исходными политиками планов и предложений, определенными администратором. Для пользователей, которые входят в систему, действуют те же ограничения, что и в исходном решении до сбоя. Когда восстановление в облаке завершится, оператор может вручную восстановить важные поставщики ресурсов и поставщики ресурсов сторонних разработчиков, а также связанные с ними данные.

## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь с рекомендациями по [использованию службы резервного копирования инфраструктуры](azure-stack-backup-best-practices.md).
