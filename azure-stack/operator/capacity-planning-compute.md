---
title: Планирование вычислительной емкости для Azure Stack | Документы Майкрософт
description: Сведения о планировании вычислительной емкости для развертываний Azure Stack.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/03/2019
ms.author: mabrigg
ms.reviewer: prchint
ms.lastreviewed: 04/03/2019
ms.custom: ''
ms.openlocfilehash: 907a10caa2a23b58d0c63ee1abb7f4e4a074d1a1
ms.sourcegitcommit: 2a4321a9cf7bef2955610230f7e057e0163de779
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2019
ms.locfileid: "65618924"
---
# <a name="azure-stack-compute-capacity-planning"></a>Планирование вычислительной емкости для Azure Stack
[Размеры виртуальных машин, поддерживаемые в Azure Stack](../user/azure-stack-vm-sizes.md), представляют собой подмножество размеров, поддерживаемых в Azure. В Azure используется несколько методов ограничения ресурсов. Это предотвращает их чрезмерное использование (на уровне локальных серверов и служб). Если не ограничить потребление ресурсов клиентом, его работа может ухудшиться при чрезмерном использовании ресурсов другими клиентами. Для исходящего трафика виртуальной машины в Azure Stack предусмотрены ограничения пропускной способности, соответствующие ограничениям в Azure. Для ресурсов хранилища в Azure Stack предусмотрены ограничения числа операций ввода-вывода в секунду. Это предотвращает чрезмерное использование ресурсов клиентами при доступе к хранилищу.  

## <a name="vm-placement-and-virtual-to-physical-core-overprovisioning"></a>Размещение виртуальных машин и избыточная подготовка виртуальных ядер относительно физических
В Azure Stack клиент не может указать, какой именно сервер следует использовать для размещения виртуальных машин. Единственный фактор, который учитывается при размещении виртуальных машин, — это достаточный объем памяти в узле для виртуальной машины данного типа. Azure Stack не перегружает память. Однако перегрузка в плане числа ядер допустима. Так как алгоритмы подготовки не учитывают избыточную подготовку виртуальных ядер относительно физических, это отношение в каждом узле может быть разным. 

Чтобы добиться высокого уровня доступности рабочих систем с несколькими виртуальными машинами в Azure, виртуальные машины размещаются в группе доступности и распределяются между несколькими доменами сбоя. В Azure Stack неисправный домен в группе доступности определяется как один узел в единице масштабирования.

Инфраструктура Azure Stack устойчива к сбоям, но базовая технология (отказоустойчивая кластеризация) по-прежнему приводит к некоторому времени простоя виртуальных машин на поврежденном физическом сервере в случае сбоя оборудования. В настоящее время Azure Stack поддерживает группы доступности с максимально тремя доменами сбоя, что гарантирует согласованность с Azure. Виртуальные машины, размещенные в группе доступности, физически изолированы друг от друга и как можно более равномерно распределяются по нескольким доменам сбоя (узлы Azure Stack). В случае сбоя оборудования виртуальные машины из поврежденного домена сбоя перезагружаются в других узлах, но, если это возможно, остаются в доменах сбоя, отдельных от других виртуальных машин в той же группе доступности. После восстановления работоспособности оборудования виртуальные машины перераспределяются, что обеспечивает высокий уровень доступности.

Еще одна концепция Azure, обеспечивающая высокий уровень доступности, — это домены обновления в группах доступности. Домен обновления — это логическая группа базового оборудования, которое может одновременно обслуживаться или перезагружаться. В Azure Stack виртуальные машины в реальном времени переносятся на другие доступные узлы в кластере до обновления их базового узла. Так как во время обновления узла клиент не простаивает, домен обновления в Azure Stack обеспечивает совместимость с Azure.

## <a name="azure-stack-resiliency-resources"></a>Ресурсы устойчивости Azure Stack
Чтобы обеспечить применение исправлений и обновлений к интегрированной системе Azure Stack, а также устойчивость к сбоям физического оборудования, часть общего объема памяти сервера резервируется и недоступна для размещения виртуальных машин клиента.

В случае сбоя сервера размещенные на нем виртуальные машины перезапускаются на остальных доступных серверах, что обеспечивает их доступность. Аналогичным образом, во время применения исправлений и обновлений все виртуальные машины динамически переносятся с данного сервера на другой доступный сервер. Управление виртуальными машинами или их перемещение возможно только при наличии зарезервированной емкости для перезапуска или миграции.

Ниже приведена формула расчета общего объема доступной памяти для размещения виртуальных машин в клиенте. Этот объем памяти предназначен для всей единицы масштабирования Azure Stack.

  Доступный объем памяти для размещения виртуальных машин = Общий объем памяти на сервере – Резерв для устойчивости – Объем памяти, используемый работающими виртуальными машинами – Объем памяти для служебных данных Azure Stack <sup>1</sup>

  Резерв устойчивости = H + R * ((N-1) * H) + V * (N-2)

> Описание
> - H = размер памяти на одном сервере
> - N = размер единицы масштабирования (число серверов)
> - R = резерв для накладных расходов операционной системы <sup>2</sup>
> - V = самая большая виртуальная машина в единице масштабирования

  <sup>1</sup> Служебные данные Azure Stack — 230 ГБ.

  <sup>2</sup> Резерв для накладных расходов операционной системы = 15 % памяти узла. Значение резерва операционной системы является приблизительным и зависит от объема физической памяти на сервере и общих накладных расходов операционной системы.

Значение V (самая большая виртуальная машина в единице масштабирования) меняется динамически в зависимости от максимального размера памяти виртуальной машины в клиенте. Например, оно может быть равно 7 ГБ, 112 ГБ или соответствовать другому размеру памяти виртуальной машины, поддерживаемому решением Azure Stack.

Приведенный выше расчет является приблизительным и может меняться в новых версиях Azure Stack. Возможность развертывания виртуальных машин и служб в клиенте зависит от особенностей развертываемого решения. Пример расчета приведен для справки и не позволяет с абсолютной точностью определить возможность развертывания виртуальных машин.



## <a name="next-steps"></a>Дополнительная информация
[Планирование ресурсов хранилища](capacity-planning-storage.md)
