---
title: Обновление 1904 для Azure Stack | Документация Майкрософт
description: Сведения о новых возможностях и известных проблемах в обновлении 1904 для интегрированных систем Azure Stack, а также о том, где можно скачать это обновление.
services: azure-stack
documentationcenter: ''
author: sethmanheim
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/06/2019
ms.author: sethm
ms.reviewer: ''
ms.lastreviewed: 05/06/2019
ms.openlocfilehash: 6d1170727f8dccca98d68f2363a44b2c1cc2d210
ms.sourcegitcommit: ccd86bd0862c45de1f6a4993f783ea2e186c187a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65172553"
---
# <a name="azure-stack-1904-update"></a>Обновление 1904 для Azure Stack

*Область применения: интегрированные системы Azure Stack*

В этой статье описано содержимое пакета обновления 1904. Обновление содержит новые усовершенствования и исправления для этого выпуска Azure Stack. Эта статья содержит следующие сведения.

- [Новые возможности, улучшения, исправления и обновления для системы безопасности](azure-stack-release-notes-1904.md#whats-in-this-update)
- [Планирование обновлений](azure-stack-release-notes-1904.md#update-planning)

> [!IMPORTANT]  
> Этот пакет обновления предназначен только для интегрированных систем Azure Stack. Не применяйте этот пакет обновления к Пакету средств разработки Azure Stack.

## <a name="build-reference"></a>Указание сборки

Номер сборки обновления 1904 для Azure Stack — **1.1904.0.36**.

## <a name="whats-in-this-update"></a>Что нового в этом обновлении

<!-- The current theme (if any) of this release. -->

<!-- What's new, also net new experiences and features. -->

### <a name="improvements"></a>Улучшения

<!-- Changes and product improvements with tangible customer-facing value. -->

- Полезные данные обновления 1904 содержат обновление для компонентов Azure Stack и не содержат обновлений операционной системы, в которой установлено решение Azure Stack. Это позволяет ограничить обновления определенной областью. Таким образом, выполнение обновления 1904 занимает меньше времени (около 16 часов, но точное время может быть другим). Такое уменьшение в среде выполнения похоже на обновление 1903 года. Однако последующие обновления могут содержать обновления для операционной системы и время их выполнения может быть другим. В описании последующих обновлений также будет сообщаться о предположительном времени выполнения в зависимости от их полезных данных.

- В обновлении 1904 в стек программных сетей (SDN) были внесены значительные улучшения. Эти улучшения повышают общий уровень обслуживания и надежность стека SDN в Azure Stack.

- Добавлено уведомление на портале администратора, когда у вошедшего в систему пользователя нет необходимых разрешений, что позволяет панели управления загружаться правильно. Он также содержит ссылку на документацию, где объясняется, какие учетные записи имеют соответствующие разрешения, в зависимости от поставщика удостоверений, используемого во время развертывания.

- В этом случае все виртуальные машины переходят в автономный режим, если в том хранилище имеются файлы конфигурации виртуальной машины, которые переходят в автономный режим.

<!-- 1901,2,3 related hotfix -->
- Добавлена ​​оптимизация для количества виртуальных машин, одновременно эвакуированных и ограничивающих потребляемую пропускную способность, для устранения отключений виртуальных машин, если сеть находится под большой нагрузкой. Это изменение увеличивает время работы виртуальной машины, при обновлении системы.

<!-- 1901,2,3 related hotfix -->
- Улучшенное регулирование ресурсов, когда система работает в масштабе, для защиты от внутренних процессов, истощающих ресурсы платформы, что приводит к сбоям в работе портала.

- Улучшенные возможности фильтрации позволяют операторам применить одновременно несколько фильтров. В новом пользовательском интерфейсе можно сортировать только по **имени** столбца.

- Улучшения в процессе удаления предложений, планов, квот и подписок. Теперь на портале администратора можно успешно удалить предложения, квоты, планы и подписки, если объект, который необходимо удалить не имеет зависимостей. Дополнительные сведения см. в [этой статье](azure-stack-delete-offer.md).  

<!-- this applies to bug 3725384 and bug #4225643 -->
- Увеличен объем сообщений системного журнала за счет фильтрации ненужных событий и предоставления параметра конфигурации для выбора желаемого уровня серьезности пересылаемых сообщений. Дополнительные сведения о том, как настроить уровень серьезности см. в разделе [Интеграция центра обработки данных Azure Stack. Перенаправление системного журнала](azure-stack-integrate-security.md).

- Инфраструктура Azure Stack использует дополнительные 12 ГБ + (4 ГБ* количество узлов для Azure Stack) с момента обновления 1904. Это означает, что при отметке в 4 узла будет дополнительно потребляться 28 ГБ (12 ГБ + 4 ГБ*4), что отражается на экране емкости портала администратора Azure Stack. Обновление до выпуска 1904 должно быть выполнено успешно, даже если при дополнительном потреблении памяти ваш штамп Azure Stack превысит емкость. Если ваш штамп Azure Stack перегружен памятью ПОСЛЕ завершения обновления, вы увидите предупреждение, отражающее это состояние, с шагами исправления для отмены выделения некоторых виртуальных машин.

<!--this applied to Bug 1473487 -->
- Добавлена новая возможность для командлета **Get-AzureStackLog** с помощью внедрения дополнительного параметра `-OutputSASUri`. Теперь вы можете собирать журналы Azure Stack из своей среды и сохранять их в указанном контейнере больших двоичных объектов хранилища Azure. Дополнительные сведения см. в статье [Диагностики Azure Stack](azure-stack-diagnostics.md#examples).

- Добавлена новая проверка памяти в группу **Test-AzureStack** `UpdateReadiness`, которая проверяет, достаточно ли в стеке памяти для успешного завершения обновления.

<!-- Bug/Task 4311058 -->
- Усовершенствования оценки **Test-AzureStack** работоспособности Service Fabric.

<!-- feature: 2976966 -->
- Улучшения в обновлении аппаратного обеспечения, которые сокращают время, необходимое для обновления встроенного программного обеспечения накопителя, до 2–4 часов. Механизм обновления динамически определяет, какие части обновления необходимо выполнить, на основе содержимого в пакете.

<!-- Feature 3906611 -->
- Добавлены надежные предварительные проверки операций для предотвращения нарушения операций экземпляра роли инфраструктуры, которые влияют на доступность.

<!-- Feature 3780326 -->
- Усовершенствования идемпотентности плана действия резервного копирования инфраструктуры.

<!--Bug/Task 3139609 -->
- Улучшения сбора журналов Azure Stack. Эти улучшения сокращают время, необходимое для получения набора журналов. Кроме того командлет [Get-AzureStackLog](azure-stack-diagnostics.md#run-get-azurestacklog-on-an-azure-stack-development-kit-asdk-system) больше не создает журналы по умолчанию для роли OEM. Необходимо выполнить командлет [Invoke AzureStackOnDemandLog](azure-stack-diagnostics.md#invoke-azurestackondemandlog), указав роли для получения журналов OEM. Дополнительные сведения см. в статье [Диагностики Azure Stack](azure-stack-diagnostics.md#run-get-azurestacklog-on-an-azure-stack-development-kit-asdk-system).

- Azure Stack теперь отслеживает URL-адрес данных федерации, предоставленный для интеграции центра обработки данных с ADFS. Это повышает надежность во время смены секретов экземпляра клиента AD FS или фермы.

### <a name="changes"></a>изменения

<!-- Feature 3906611 -->
- Удалена возможность для операторов Azure Stack отключать экземпляры ролей инфраструктуры на портале администратора. Функция перезапуска гарантирует чистую попытку завершения работы до перезапуска экземпляра роли инфраструктуры. Для расширенных сценариев функциональности API и PowerShell остаются доступными.

<!-- Feature ## 4199257 -->
- Существует новый опыт управления Marketplace с отдельными экранами для изображений Marketplace и поставщиков ресурсов. На данный момент окно **Поставщики ресурсов** пустое, но в будущих выпусках новые предложения услуг PaaS появятся и будут управляться в окне **Поставщики ресурсов**.

<!-- Feature ## 4199257 -->
- Изменения в опыте обновления на портале оператора. Имеется новая сетка для обновления поставщика ресурсов. Возможность обновления поставщиков ресурсов еще не доступна.

<!-- Task ## 3748423  -->
- Изменения в процессе установки обновления на портале оператора. Чтобы помочь операторам Azure Stack правильно реагировать на проблему с обновлением, портал теперь предоставляет более конкретные рекомендации, основанные на работоспособности модуля масштабирования, которые выводятся автоматически при запуске **Test-AzureStack** и анализе результатов. На основании результата он проинформирует оператора о необходимости выполнить одно из двух следующих действий.

  - На портале отображается "мягкое" предупреждение: "Последнее обновление требует внимания. Корпорация Майкрософт рекомендует открывать запрос на обслуживание в обычные рабочие часы. Test-AzureStack выполняется в рамках процесса обновления, и на основе результатов мы создаем наиболее подходящее предупреждение. В этом случае Test-AzureStack пройден."

  - На портале отображается "серьезное" предупреждение: "Последнее обновление завершилось сбоем. Корпорация Майкрософт рекомендует открыть запрос на обслуживание как можно скорее. Test-AzureStack выполняется в рамках процесса обновления, и на основе результатов мы создаем наиболее подходящее предупреждение. В этом случае Test-AzureStack также завершится сбоем."

- Обновление Агента Linux для Azure версии 2.2.38.0. Эта поддержка позволяет клиентам поддерживать согласование образов Linux между Azure и Azure Stack.

### <a name="fixes"></a>Исправления

<!-- Product fixes that came up from customer deployments worth highlighting, especially if there is an SR/ICM associated to it. -->

- Исправлена проблема, в которой конфигурация системного журнала не сохраняется в цикле обновления, поэтому клиент системного журнала теряет свою конфигурацию, а пересылка сообщений системного журнала останавливается. Конфигурация системного журнала теперь сохранена.

- Устранена проблема в CRP, заблокировавшая освобождение виртуальных машин. Ранее, если виртуальная машина содержала несколько больших управляемых дисков, освобождение виртуальной машины могло завершиться ошибкой времени ожидания.

- Исправлена ​​проблема с механизмом Защитника Windows, влияющая на доступ к хранилищу единиц измерения масштаба.

- Исправлена ​​проблема портала пользователя, из-за которой не удавалось загрузить окно политики доступа для учетных записей хранилища больших двоичных объектов.

- Исправлена ​​проблема как на портале администратора, так и на портале пользователя, отображения ошибочных уведомлений о глобальном портале Azure.

- Исправлена ​​проблема с порталом пользователя, из-за которой при выборе плитки **Отзывы** открывалась пустая вкладка браузера.

- Исправлена ​​проблема портала, из-за которой изменение статического IP-адреса для IP-конфигурации, которое было связано с сетевым адаптером, подключенным к экземпляру виртуальной машины, приводило к отображению сообщения об ошибке.

- Исправлена ​​проблема портала пользователя, из-за которой попытка **присоединить сетевой интерфейс** к существующей виртуальной машине через окно **Сеть** приводила к сбою операции с сообщением об ошибке.

- Исправлена проблема, в которой Azure Stack не поддерживал подключение более 4 сетевых интерфейсов (NIC) к экземплярам виртуальных машин.

- Исправлена проблема на портале, когда при добавлении правила безопасности входящего трафика и выборе в качестве источника **тега службы** отображаются несколько вариантов, которые недоступны для Azure Stack.

- Исправлена проблема, в которой группы безопасности сети (NSG) работали в Azure Stack не так, как в глобальной среде Azure.

- Исправлена ​​проблема в управлении Marketplace, которая скрывает все загруженные продукты, если регистрация удаляется или истекает срок ее действия.

- Исправлена проблема, из-за которой при выдаче команды **Set-AzureRmVirtualNetworkGatewayConnection** в PowerShell для существующего подключения к виртуальному сетевому шлюзу произошла ошибка с сообщением об ошибке **Неверно настроен общедоступный ключ...**.

- Исправлена ​​проблема, из-за которой поставщик сетевых ресурсов (NRP) не синхронизировался с сетевым контроллером, в результате чего запрашивались дублирующиеся ресурсы. В некоторых случаях это приводило к тому, что родительский ресурс оставлялся в состоянии ошибки.

- Исправлена ​​проблема, из-за которой, если пользователь, которому была назначена роль участника в подписке, но ему явно не были предоставлены разрешения на чтение, генерировалась ошибка, содержащая **... Клиент 'somelogonaccount@domain.com' с идентификатором объекта {GUID} не авторизован для выполнения действия...** при попытке сохранить изменение в ресурсе.

- Исправлена ​​ошибка, из-за которой экран управления рынком был пустым, если для загрузки изображений использовалось автономное средство синдикации, а на любом из них отсутствовали значки URI.

### <a name="security-updates"></a>обновления для системы безопасности;

Это обновление стека Azure не содержит обновления для системы безопасности для базовой операционной системы, в которой находится Azure Stack. Дополнительные сведения см. в разделе [Обновления для системы безопасности Azure Stack](azure-stack-release-notes-security-updates-1904.md).

## <a name="update-planning"></a>Планирование обновлений

Перед применением обновления, обязательно ознакомьтесь со следующими сведениями:

- [Известные проблемы](azure-stack-release-notes-known-issues-1904.md)
- [Обновления для системы безопасности](azure-stack-release-notes-security-updates-1904.md)
- [Контрольный список действий до и после применения обновления](azure-stack-release-notes-checklist.md)

> [!NOTE]
> Обязательно используйте последнюю версию [планировщика ресурсов Azure Stack](https://aka.ms/azstackcapacityplanner)  для планирования рабочей нагрузки и определения необходимых ресурсов. В последней версии исправлены известные ошибки и реализованы новые функции, что делается при каждом обновлении Azure Stack.

## <a name="download-the-update"></a>Скачивание обновления

Пакет обновления 1904 для Azure Stack можно скачать [на странице загрузки Azure Stack](https://aka.ms/azurestackupdatedownload).

## <a name="hotfixes"></a>Исправления

Azure Stack выпускает исправления на регулярной основе. Перед обновлением Azure Stack до версии 1904 обязательно установите последнее исправление Azure Stack для обновления 1903.

Исправления Azure Stack применимы только к интегрированным системам Azure Stack. Не устанавливайте исправления в пакете ASDK.

### <a name="before-applying-the-1904-update"></a>Перед применением обновления 1904 выполните следующее

Выпуск 1904 Azure Stack должен применяться к выпуску 1903 со следующими исправлениями.

<!-- One of these. Either no updates at all, nothing is required, or the LATEST hotfix that is required-->
- [Исправление Azure Stack 1.1903.2.39](https://support.microsoft.com/help/4500638)

### <a name="after-successfully-applying-the-1904-update"></a>После успешного применения обновления 1904

После установки этого обновления установите все применимые исправления. Дополнительные сведения см. в разделе [Политика обслуживания](azure-stack-servicing-policy.md).

<!-- One of these. Either no updates at all, nothing is required, or the LATEST hotfix that is required-->
- Нет доступных исправлений для выпуска 1904.

## <a name="automatic-update-notifications"></a>Автоматические уведомления об обновлениях

Клиенты с системами, которые могут получить доступ к Интернету из сети инфраструктуры, увидят сообщение **Обновление доступно** на портале оператора. Системы без доступа к Интернету могут загружать и импортировать ZIP-файл с соответствующим расширением .xml.

> [!TIP]  
> Подпишитесь на следующие веб-каналы *RSS* или *Atom*, чтобы следить за исправлениями Azure Stack:
>
> - [RSS](https://support.microsoft.com/app/content/api/content/feeds/sap/en-us/32d322a8-acae-202d-e9a9-7371dccf381b/rss)
> - [Atom](https://support.microsoft.com/app/content/api/content/feeds/sap/en-us/32d322a8-acae-202d-e9a9-7371dccf381b/atom)

## <a name="next-steps"></a>Дополнительная информация

- [Общие сведения об управлении обновлениями в Azure Stack](azure-stack-updates.md).  
- [Применение обновлений в Azure Stack](azure-stack-apply-updates.md).
- В [этой статье](azure-stack-servicing-policy.md) описаны политика обслуживания для интегрированных систем Azure Stack и действия, необходимые для сохранения поддерживаемого состояния системы.  
- Сведения об использовании привилегированной конечной точки (PEP) для отслеживания и возобновления обновлений см. в статье [Мониторинг обновлений в Azure Stack с помощью привилегированной конечной точки](azure-stack-monitor-update.md).  
- Заполните опрос, чтобы предоставить [отзывы о заметках о выпуске](https://forms.microsoft.com).
