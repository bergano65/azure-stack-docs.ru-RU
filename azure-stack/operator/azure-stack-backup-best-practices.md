---
title: Рекомендации по использованию Резервного копирования инфраструктуры для Azure Stack Hub
description: Следуйте этому набору рекомендаций при развертывании и администрировании Azure Stack Hub, чтобы снизить риск потери данных в случае катастрофического сбоя.
author: justinha
ms.topic: article
ms.date: 02/08/2019
ms.author: justinha
ms.reviewer: hectorl
ms.lastreviewed: 02/08/2019
ms.openlocfilehash: a141beed4df6b34175f37d9e1e60e694f3ab71f2
ms.sourcegitcommit: 4ac711ec37c6653c71b126d09c1f93ec4215a489
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2020
ms.locfileid: "77700516"
---
# <a name="infrastructure-backup-service-best-practices"></a>Рекомендации по службе резервного копирования инфраструктуры

Следуйте этому набору рекомендаций при развертывании и администрировании Azure Stack Hub, чтобы снизить риск потери данных в случае катастрофического сбоя.

Регулярно просматривайте рекомендации, чтобы удостовериться, что установка по-прежнему соответствует требованиям после внесения изменений в рабочий процесс. Если у вас возникнут проблемы при реализации этих рекомендаций, обратитесь за помощью в службу поддержки Майкрософт.

## <a name="configuration-best-practices"></a>Рекомендации по настройке

### <a name="deployment"></a>Развертывание

Включайте резервное копирование инфраструктуры после развертывания каждого облака Azure Stack Hub. С помощью Azure Stack Hub PowerShell можно планировать резервное копирование с любого клиента или сервера с доступом к конечной точке API для управления оператором.

### <a name="networking"></a>Сеть

В UNC-строке для пути необходимо использовать полное доменное имя (FQDN). Если разрешение имен не поддерживается, можно указать IP-адрес. UNC-строка указывает расположение ресурсов, например общих файлов или устройств.

### <a name="encryption"></a>Шифрование

#### <a name="version-1901-and-newer"></a>Версия 1901 и более поздняя

Сертификат шифрования используется для шифрования резервных копий данных, которые экспортируются во внешнее хранилище. Сертификат может быть самозаверяющий, поскольку он используется только для передачи ключей. С помощью New-SelfSignedCertificate получите дополнительную информацию о том, как создать сертификат.
  
Ключ должен храниться в надежном расположении (например, в сертификате глобального хранилища Azure Key Vault). Формат CER сертификата используется для шифрования данных. Формат PFX должен использоваться во время развертывания восстановления облака Azure Stack Hub для расшифровки данных резервных копий.

![Сертификат хранится в безопасном расположении.](media/azure-stack-backup/azure-stack-backup-encryption-store-cert.png)

#### <a name="1811-and-older"></a>1811 и более ранняя версия

Ключ шифрования используется для шифрования резервных копий, которые экспортируются во внешнее хранилище. Ключ создается в процессе [включения резервного копирования для Azure Stack Hub с помощью PowerShell](azure-stack-backup-enable-backup-powershell.md).

Ключ должен храниться в надежном расположении (например, в секрете глобального хранилища Azure Key Vault). Этот ключ нужно использовать во время повторного развертывания Azure Stack Hub.

![Сохранение ключа в безопасном расположении](media/azure-stack-backup/azure-stack-backup-encryption2.png)

## <a name="operational-best-practices"></a>Рекомендации по использованию

### <a name="backups"></a>Резервные копии

 - Задания резервного копирования выполняются во время работы системы. Это обеспечивает бесперебойное управление и функционирование пользовательских приложений. Выполнение заданий резервного копирования занимает 20–40 минут для решений с нормальной нагрузкой.
 - В соответствии с предоставляемыми изготовителем оборудования инструкциями, созданные вручную резервные копии сетевых коммутаторов и узла жизненного цикла оборудования (HLH) должны храниться в том же общем ресурсе резервного копирования, в котором контроллер резервного копирования инфраструктуры хранит резервные копии данных уровня управления. Рекомендуем сохранять конфигурации коммутаторов и HLH в папке региона. Если в одном регионе есть несколько экземпляров Azure Stack Hub, советуем использовать идентификатор для каждой конфигурации, которая относится к единице масштабирования.

### <a name="folder-names"></a>Имена папок

 - В инфраструктуре автоматически создается папка MASBACKUP. Это общий ресурс под управлением Майкрософт. Можно создавать общие ресурсы на том же уровне, что и MASBACKUP. Мы не рекомендуем создавать папки или хранить данные в папке MASBACKUP, если они созданы не в Azure Stack Hub.
 -  Используйте в имени папки полное доменное имя и название региона, чтобы различать резервные копии данных из разных облаков. Полное доменное имя (FQDN) развертывания Azure Stack Hub и конечных точек состоит из значений параметров региона и имени внешнего домена. Дополнительные сведения см. в статье [Интеграция DNS центра обработки данных Azure Stack Hub](azure-stack-integrate-dns.md).

Предположим, что общий ресурс резервного копирования AzSBackups размещен в fileserver01.contoso.com. В этом файловом ресурсе может содержаться папка каждого развертывания Azure Stack Hub, для которой используется внешнее доменное имя, и вложенная папка, для которой используется название региона.

Полное доменное имя: contoso.com  
Регион: nyc


    \\fileserver01.contoso.com\AzSBackups
    \\fileserver01.contoso.com\AzSBackups\contoso.com
    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc
    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc\MASBackup

В папке MASBackup хранятся резервные копии Azure Stack Hub. Не следует использовать эту папку для хранения собственных данных. Изготовители оборудования также не должны использовать эту папку для хранения резервных копий.

Изготовителям оборудования рекомендуется хранить резервные копии своих компонентов в папке региона. Данные каждого сетевого коммутатора, узла жизненного цикла оборудования (HLH) и т. д. должны храниться в отдельной вложенной папке. Пример:

    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc\HLH
    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc\Switches
    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc\DeploymentData
    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc\Registration

### <a name="monitoring"></a>Наблюдение

В системе поддерживаются следующие предупреждения:

| Предупреждение                                                   | Описание                                                                                     | Исправление                                                                                                                                |
|---------------------------------------------------------|-------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| Сбой резервного копирования: исчерпана емкость файлового ресурса. | Емкость файлового ресурса исчерпана, и контроллеру резервного копирования не удается экспортировать резервные копии в указанное расположение. | Увеличьте емкость хранилища и повторите попытку резервного копирования. Удалите существующие резервные копии (начиная с самых старых), чтобы освободить место.                    |
| Сбой резервного копирования: проблемы с подключением             | В сети между Azure Stack Hub и файловым ресурсом возникли проблемы.                          | Устраните проблему с сетью и повторите попытку резервного копирования.                                                                                            |
| Сбой резервного копирования: ошибка пути.                | Не удается разрешить путь к файловому ресурсу.                                                          | Сопоставьте общий ресурс с другого компьютера, чтобы убедиться в наличии доступа к ресурсу. Возможно, потребуется изменить путь, если он недействителен.       |
| Сбой резервного копирования: проблема с аутентификацией.               | Проблема с учетными данными или сетью, влияющая на процесс аутентификации.    | Сопоставьте общий ресурс с другого компьютера, чтобы убедиться в наличии доступа к ресурсу. Возможно, потребуется изменить учетные данные, если они недействительны. |
| Сбой резервного копирования: общий сбой.                    | Сбой выполнения запроса может быть вызван временной проблемой. Повторите попытку резервного копирования.                    | Обратитесь в службу поддержки.                                                                                                                               |

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь со справочными материалами по [службе резервного копирования инфраструктуры](azure-stack-backup-reference.md).

Ознакомьтесь с инструкциями по включению [службы резервного копирования инфраструктуры](azure-stack-backup-enable-backup-console.md).
