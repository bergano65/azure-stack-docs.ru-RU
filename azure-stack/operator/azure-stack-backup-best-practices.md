---
title: Рекомендации по службе резервного копирования инфраструктуры для Azure Stack | Документация Майкрософт
description: Следуйте этому набору рекомендаций при развертывании и администрировании Azure Stack в вашем центре обработки данных, чтобы снизить риск потери данных в случае катастрофического сбоя.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.assetid: 221FDE40-3EF8-4F54-A075-0C4D66EECE1A
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/08/2019
ms.author: mabrigg
ms.reviewer: hectorl
ms.lastreviewed: 02/08/2019
ms.openlocfilehash: d2f62fd7a3a6253a077ad4cce2030b5165dc76cd
ms.sourcegitcommit: 2a4321a9cf7bef2955610230f7e057e0163de779
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2019
ms.locfileid: "65618338"
---
# <a name="infrastructure-backup-service-best-practices"></a>Рекомендации по службе резервного копирования инфраструктуры

*Область применения: интегрированные системы Azure Stack и Пакет средств разработки Azure Stack*

Следуйте этим рекомендациям при развертывании и администрировании Azure Stack в вашем центре обработки данных, чтобы снизить риск потери данных в случае катастрофического сбоя.

Регулярно просматривайте рекомендации, чтобы удостовериться, что установка по-прежнему соответствует требованиям после внесения изменений в рабочий процесс. Если у вас возникнут проблемы при реализации этих рекомендаций, обратитесь за помощью в службу поддержки Майкрософт.

## <a name="configuration-best-practices"></a>Рекомендации по настройке

### <a name="deployment"></a>Развертывание

Включайте резервное копирование инфраструктуры после развертывания каждого облака Azure Stack. С помощью Azure Stack PowerShell можно планировать резервное копирование с любого клиента или сервера с доступом к конечной точке программного интерфейса управления оператором.

### <a name="networking"></a>Сеть

В UNC-строке для пути необходимо использовать полное доменное имя (FQDN). Если разрешение имен не поддерживается, можно указать IP-адрес. UNC-строка указывает расположение ресурсов, например общих файлов или устройств.

### <a name="encryption"></a>Шифрование

#### <a name="version-1901-and-newer"></a>Версия 1901 и более поздняя

Сертификат шифрования используется для шифрования резервных копий данных, которые экспортируются во внешнее хранилище. Сертификат может быть самозаверяющий, поскольку он используется только для передачи ключей. С помощью New-SelfSignedCertificate получите дополнительную информацию о том, как создать сертификат.  
Ключ должен храниться в надежном расположении (например, в сертификате глобального хранилища Azure Key Vault). Формат CER сертификата используется для шифрования данных. Формат PFX должен использоваться во время развертывания восстановления облака Azure Stack для расшифровки данных резервных копий.

![Сертификат хранится в безопасном расположении.](media/azure-stack-backup/azure-stack-backup-encryption-store-cert.png)

#### <a name="1811-and-older"></a>1811 и более ранняя версия

Ключ шифрования используется для шифрования резервных копий, которые экспортируются во внешнее хранилище. Ключ создается в процессе [включения резервного копирования для Azure Stack с помощью PowerShell](azure-stack-backup-enable-backup-powershell.md).

Ключ должен храниться в надежном расположении (например, в секрете глобального хранилища Azure Key Vault). Этот ключ нужно использовать во время повторного развертывания Azure Stack. 

![Сохранение ключа в безопасном расположении](media/azure-stack-backup/azure-stack-backup-encryption2.png)

## <a name="operational-best-practices"></a>Рекомендации по использованию

### <a name="backups"></a>Резервные копии

 - Задания резервного копирования выполняются во время работы системы. Это обеспечивает бесперебойное управление и функционирование пользовательских приложений. Выполнение заданий резервного копирования занимает 20–40 минут для решений с нормальной нагрузкой.
 - В соответствии с предоставляемыми изготовителем оборудования инструкциями, созданные вручную резервные копии сетевых коммутаторов и узла жизненного цикла оборудования (HLH) должны храниться в том же общем ресурсе резервного копирования, где контроллер резервного копирования инфраструктуры хранит резервные копии данных уровня управления. Рекомендуем сохранять конфигурации коммутаторов и HLH в папке региона. Если в одном регионе есть несколько экземпляров Azure Stack, советуем использовать идентификатор для каждой конфигурации, которая относится к единице масштабирования.

### <a name="folder-names"></a>Имена папок

 - В инфраструктуре автоматически создается папка MASBACKUP. Это общий ресурс под управлением Майкрософт. Можно создавать общие ресурсы на том же уровне, что и MASBACKUP. Не рекомендуем создавать папки или хранить данные в папке MASBACKUP, если они созданы не в Azure Stack. 
 -  Используйте в имени папки полное доменное имя и название региона, чтобы различать резервные копии данных из разных облаков. Полное доменное имя (FQDN) развертывания Azure Stack и конечных точек представляет собой сочетание параметра региона и имени внешнего домена. Дополнительные сведения см. в статье [Интеграция центра обработки данных Azure Stack — DNS](azure-stack-integrate-dns.md).

Предположим, что общий ресурс резервного копирования AzSBackups размещен в fileserver01.contoso.com. В этом файловом ресурсе может содержаться папка каждого развертывания Azure Stack, для которой используется внешнее доменное имя, и вложенная папка, для которой используется название региона. 

Полное доменное имя: contoso.com  
Регион: nyc


    \\fileserver01.contoso.com\AzSBackups
    \\fileserver01.contoso.com\AzSBackups\contoso.com
    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc
    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc\MASBackup

В папке MASBackup хранятся резервные копии Azure Stack. Не следует использовать эту папку для хранения личных данных. Изготовители оборудования также не должны использовать эту папку для хранения резервных копий. 

Изготовителям оборудования рекомендуется хранить резервные копии своих компонентов в папке региона. Данные каждого сетевого коммутатора, узла жизненного цикла оборудования (HLH) и т. д. должны храниться в отдельной вложенной папке. Например: 

    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc\HLH
    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc\Switches
    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc\DeploymentData
    \\fileserver01.contoso.com\AzSBackups\contoso.com\nyc\Registration

### <a name="monitoring"></a>Мониторинг

В системе поддерживаются следующие предупреждения:

| Предупреждение                                                   | ОПИСАНИЕ                                                                                     | Исправление                                                                                                                                |
|---------------------------------------------------------|-------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| Сбой резервного копирования: исчерпана емкость файлового ресурса | Емкость файлового ресурса исчерпана, и контроллеру резервного копирования не удается экспортировать резервные копии в расположение. | Увеличьте емкость хранилища и повторите попытку резервного копирования. Удалите существующие резервные копии (начиная с самых старых), чтобы освободить место.                    |
| Сбой резервного копирования: проблемы с подключением             | В сети между Azure Stack и файловым ресурсом возникли проблемы.                          | Устраните проблему с сетью и повторите попытку резервного копирования.                                                                                            |
| Сбой резервного копирования: ошибка пути                | Не удается разрешить путь к файловому ресурсу.                                                          | Сопоставьте общий ресурс с другого компьютера, чтобы убедиться в наличии доступа к ресурсу. Возможно, потребуется обновить путь, если он недействителен.       |
| Сбой резервного копирования: проблема с аутентификацией               | Проблема с учетными данными или сетью, влияющая на процесс аутентификации.    | Сопоставьте общий ресурс с другого компьютера, чтобы убедиться в наличии доступа к ресурсу. Возможно, потребуется обновить учетные данные, если они недействительны. |
| Сбой резервного копирования: общий сбой                    | Сбой выполнения запроса может быть вызван временной проблемой. Повторите попытку резервного копирования.                    | Обратитесь в службу поддержки.                                                                                                                               |

## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь со справочными материалами по службе резервного копирования инфраструктуры в [этой статье](azure-stack-backup-reference.md).

Ознакомьтесь с инструкциями по включению службы резервного копирования инфраструктуры в [этой статье](azure-stack-backup-enable-backup-console.md).
