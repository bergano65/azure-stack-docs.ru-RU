---
title: Подготовка сертификатов инфраструктуры открытых ключей Azure Stack для смены секретов и развертывания интегрированных систем Azure Stack | Документация Майкрософт
description: В этой статье описано, как подготовить сертификаты PKI Azure Stack для интегрированных систем Azure Stack.
services: azure-stack
documentationcenter: ''
author: justinha
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/16/2019
ms.author: justinha
ms.reviewer: ppacent
ms.lastreviewed: 09/16/2019
ms.openlocfilehash: 38175eee8be9b8f678405e0ad1ec6f01bdba8b77
ms.sourcegitcommit: ca5025fb04250271fe0b2b2df8ad0b3b9ed3e604
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "71020846"
---
# <a name="prepare-azure-stack-pki-certificates-for-use-in-deployment-or-rotation"></a>Подготовка сертификатов PKI Azure Stack для развертывания или смены секретов

Файлы сертификатов, [полученные из выбранного центра сертификации](azure-stack-get-pki-certs.md), необходимо импортировать и экспортировать со свойствами, которые соответствуют требованиям к сертификату Azure Stack.

## <a name="prepare-certificates-for-deployment"></a>Подготовка сертификатов к развертыванию

Для подготовки и проверки сертификатов PKI Azure Stack, которые будут использоваться для развертывания новой среды Azure Stack или для смены секретов в имеющейся среде Azure Stack, выполните следующие действия. 


### <a name="import-the-certificate"></a>Импорт сертификата

1. Скопируйте исходные версии сертификатов, [полученные из выбранного центра сертификации](azure-stack-get-pki-certs.md), в каталог на узле развертывания. 
   > [!WARNING]
   > Не копируйте файлы, которые уже были импортированы, экспортированы или изменены каким-либо образом относительно файлов, предоставленных непосредственно центром сертификации.

1. Щелкните правой кнопкой мыши сертификат и выберите **Установить сертификат** или **Установить PFX**, в зависимости от того, как был доставлен сертификат из ЦС.

1. В окне **Мастер импорта сертификатов** выберите **Локальный компьютер** в качестве расположения импорта. Щелкните **Далее**. На следующем экране еще раз нажмите кнопку "Далее".

    ![Расположение импорта на локальном компьютере](./media/prepare-pki-certs/1.png)

1. Выберите **Place all certificate in the following store** (Поместить все сертификаты в следующее хранилище), а затем укажите **Доверительные отношения в предприятии** в качестве расположения. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно выбора хранилища сертификатов, а затем нажмите кнопку **Далее**.

   ![Настройка хранилища сертификатов](./media/prepare-pki-certs/3.png)

   a. При импорте PFX-файла отобразится дополнительное диалоговое окно. На странице **Защита с помощью закрытого ключа** введите пароль для файлов сертификатов, а затем установите флажок **Пометить этот ключ как доступный для экспорта. Это позволит позднее создать резервную копию ваших ключей или перенести их** Щелкните **Далее**.

   ![Пометка ключа доступным для экспорта](./media/prepare-pki-certs/2.png)

1. Нажмите кнопку "Готово" для завершения импорта.

> [!NOTE]
> После импорта сертификата для Azure Stack закрытый ключ сертификата хранится в виде файла PKCS 12 (PFX) в системе хранения данных кластера.

### <a name="export-the-certificate"></a>Экспорт сертификата

Откройте консоль MMC "Диспетчер сертификатов" и подключитесь к хранилищу сертификатов "Локальный компьютер".

1. Откройте консоль управления (MMC). В Windows 10 щелкните правой кнопкой мыши меню "Пуск", а затем щелкните "Выполнить". Введите **mmc** нажмите кнопку "ОК".

1. Щелкните "Файл" > "Добавить или удалить оснастку", затем выберите "Сертификаты" и нажмите кнопку "Добавить".

    ![Добавление оснастки "Сертификаты"](./media/prepare-pki-certs/mmc-2.png)
 
1. Выберите учетную запись "Компьютер", нажмите кнопку "Далее", затем выберите "Локальный компьютер" и нажмите кнопку "Готово". Нажмите кнопку "ОК", чтобы закрыть страницу "Добавить или удалить оснастку".

    ![Добавление оснастки "Сертификаты"](./media/prepare-pki-certs/mmc-3.png)

1. Выберите "Сертификаты" > "Доверительные отношения в предприятии" > "Расположение сертификата". Убедитесь, что сертификат отображается в области справа.

1. На панели задач консоли "Диспетчер сертификатов" выберите **Действия** > **Все задачи** > **Экспорт**. Щелкните **Далее**.

   > [!NOTE]
   > В зависимости от того, сколько у вас сертификатов Azure Stack, может потребоваться выполнить этот процесс более одного раза.

1. Выберите **Yes, Export the Private Key** (Да, экспортировать закрытый ключ), а затем нажмите кнопку **Далее**.

1. В разделе "Формат экспортируемого файла":
    
   - Выберите **Include all certificates in the certificate if possible** (Включить, по возможности, все сертификаты в сертификат).  
   - Выберите **Export all Extended Properties** (Экспортировать все расширенные свойства).  
   - Выберите **Включить конфиденциальность сертификата**.  
   - Щелкните **Далее**.  
    
     ![Мастер экспорта сертификатов с выбранными параметрами](./media/prepare-pki-certs/azure-stack-save-cert.png)

1. Выберите **Пароль** и укажите пароль для сертификатов. Создайте пароль, отвечающий следующим требованиям сложности пароля. Минимальная длина — 8 знаков. Пароль содержит по крайней мере три знака из перечисленных групп: прописные буквы, строчные буквы, цифры от 0 до 9, специальные символы, алфавитный символ, не являющийся прописным или строчным. Запишите этот пароль. Вы будете использовать его в качестве параметра развертывания.

1. Щелкните **Далее**.

1. Выберите имя и расположение для экспортируемого PFX-файла. Щелкните **Далее**.

1. Выберите **Готово**.

## <a name="next-steps"></a>Дополнительная информация

[Validate Azure Stack PKI certificates](azure-stack-validate-pki-certs.md) (Проверка сертификатов PKI Azure Stack)