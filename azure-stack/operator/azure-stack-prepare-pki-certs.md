---
title: Подготовка сертификатов PKI Azure Stack Hub для развертывания или смены секретов
titleSuffix: Azure Stack Hub
description: Узнайте, как подготавливать сертификаты PKI для развертывания интегрированных систем Azure Stack Hub или для смены секретов в существующей среде Azure Stack Hub.
author: IngridAtMicrosoft
ms.topic: article
ms.date: 09/16/2019
ms.author: inhenkel
ms.reviewer: ppacent
ms.lastreviewed: 09/16/2019
ms.openlocfilehash: 321ceff84ec24997866366c533eb31939acde2dd
ms.sourcegitcommit: 97806b43314d306e0ddb15847c86be2c92ae001e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2020
ms.locfileid: "77509727"
---
# <a name="prepare-azure-stack-hub-pki-certificates-for-deployment-or-rotation"></a>Подготовка сертификатов PKI Azure Stack Hub для развертывания или смены секретов

Файлы сертификатов, [полученные из выбранного центра сертификации](azure-stack-get-pki-certs.md), необходимо импортировать и экспортировать со свойствами, которые соответствуют требованиям к сертификату Azure Stack Hub.

## <a name="prepare-certificates-for-deployment"></a>Подготовка сертификатов к развертыванию

Для подготовки и проверки сертификатов PKI Azure Stack Hub, которые будут использоваться для развертывания новой среды Azure Stack Hub или для смены секретов в имеющейся среде Azure Stack Hub, выполните следующие действия.

### <a name="import-the-certificate"></a>Импорт сертификата

1. Скопируйте исходные версии сертификатов, [полученные из выбранного центра сертификации](azure-stack-get-pki-certs.md), в каталог на узле развертывания. 
   > [!WARNING]
   > Не копируйте файлы, которые уже были импортированы, экспортированы или изменены каким-либо образом относительно файлов, предоставленных непосредственно центром сертификации.

1. Щелкните правой кнопкой мыши сертификат и выберите **Установить сертификат** или **Установить PFX**, в зависимости от того, как был доставлен сертификат из ЦС.

1. В окне **Мастер импорта сертификатов** выберите **Локальный компьютер** в качестве расположения импорта. Выберите **Далее**. На следующем экране еще раз выберите "Далее".

    ![Расположение импорта на локальном компьютере для сертификата](./media/prepare-pki-certs/1.png)

1. Выберите **Place all certificate in the following store** (Поместить все сертификаты в следующее хранилище), а затем укажите **Доверительные отношения в предприятии** в качестве расположения. Выберите **ОК**, чтобы закрыть диалоговое окно выбора хранилища сертификатов, а затем нажмите кнопку **Далее**.

   ![Настройка хранилища сертификатов для импорта сертификатов](./media/prepare-pki-certs/3.png)

   а. При импорте PFX-файла отобразится дополнительное диалоговое окно. На странице **Защита с помощью закрытого ключа** введите пароль для файлов сертификатов, а затем установите флажок **Пометить этот ключ как доступный для экспорта. Это позволит позднее создать резервную копию ваших ключей или перенести их** Выберите **Далее**.

   ![Пометка ключа доступным для экспорта](./media/prepare-pki-certs/2.png)

1. Выберите **Готово** для завершения импорта.

> [!NOTE]
> После импорта сертификата для Azure Stack Hub закрытый ключ сертификата хранится в виде файла PKCS 12 (PFX) в системе хранения данных кластера.

### <a name="export-the-certificate"></a>Экспорт сертификата

Откройте консоль MMC "Диспетчер сертификатов" и подключитесь к хранилищу сертификатов "Локальный компьютер".

1. Откройте консоль управления (MMC). Чтобы открыть консоль в Windows 10, правой кнопкой мыши щелкните меню **Пуск**, выберите **Выполнить**, а затем введите **mmc** и нажмите клавишу ВВОД.

2. Выберите **Файл** > **Добавить или удалить оснастку**, затем выберите **Сертификаты** и **Добавить**.

    ![Добавление оснастки сертификатов в консоль управления (MMC)](./media/prepare-pki-certs/mmc-2.png)

3. Выберите **учетную запись компьютера** и нажмите кнопку **Далее**. Выберите **Локальный компьютер**, а затем **Готово**. Выберите **ОК**, чтобы закрыть страницу "Добавить или удалить оснастку".

    ![Выбор учетной записи для добавления оснастки "Сертификаты" в консоли управления (MMC)](./media/prepare-pki-certs/mmc-3.png)

4. Выберите **Сертификаты** > **Доверительные отношения в предприятии** > **Расположение сертификата**. Убедитесь, что сертификат отображается в области справа.

5. На панели задач консоли "Диспетчер сертификатов" выберите **Действия** > **Все задачи** > **Экспорт**. Выберите **Далее**.

   > [!NOTE]
   > В зависимости от того, сколько у вас сертификатов Azure Stack Hub, может потребоваться выполнить этот процесс более одного раза.

6. Выберите **Yes, Export the Private Key** (Да, экспортировать закрытый ключ), а затем нажмите кнопку **Далее**.

7. В разделе "Формат экспортируемого файла":
    
   - Выберите **Include all certificates in the certificate if possible** (Включить, по возможности, все сертификаты в сертификат).  
   - Выберите **Export all Extended Properties** (Экспортировать все расширенные свойства).  
   - Выберите **Включить конфиденциальность сертификата**.  
   - Щелкните **Далее**.  
    
     ![Мастер экспорта сертификатов с выбранными параметрами](./media/prepare-pki-certs/azure-stack-save-cert.png)

8. Выберите **Пароль** и укажите пароль для сертификатов. Создайте пароль, отвечающий следующим требованиям сложности пароля:

    * Минимальная длина — 8 знаков.
    * По крайней мере три из следующих символов: прописная буква, строчная буква, цифры 0–9, специальные символы, алфавитный символ, не являющийся прописным или строчным.

    Запишите этот пароль. Вы будете использовать его в качестве параметра развертывания.

9. Выберите **Далее**.

10. Выберите имя и расположение для экспортируемого PFX-файла. Выберите **Далее**.

11. Нажмите кнопку **Готово**.

## <a name="next-steps"></a>Дальнейшие действия

[Validate Azure Stack PKI certificates](azure-stack-validate-pki-certs.md) (Проверка сертификатов PKI Azure Stack)