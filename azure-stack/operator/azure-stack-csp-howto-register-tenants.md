---
title: Добавление клиентов для контроля потребления и выставления счетов в Azure Stack | Документация Майкрософт
description: Пошаговое руководство по добавлению пользователей в Azure Stack под управлением поставщика облачных служб (CSP).
services: azure-stack
documentationcenter: ''
author: sethmanheim
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/07/2019
ms.author: sethm
ms.reviewer: alfredop
ms.lastreviewed: 06/07/2019
ms.openlocfilehash: edc6fc17e426e5e391eb61d510097101ddcfce58
ms.sourcegitcommit: af63214919e798901399fdffef09650de4176956
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2019
ms.locfileid: "66828344"
---
# <a name="add-tenant-for-usage-and-billing-to-azure-stack"></a>Добавление клиентов для контроля потребления и выставления счетов в Azure Stack

*Область применения: интегрированные системы Azure Stack*

В этой статье описывается процесс добавления пользователей в развертывание Azure Stack под управлением поставщика облачных служб (CSP). Когда новый клиент потребляет ресурсы, Azure Stack передает информацию об этом в соответствующую подписку CSP.

При развертывании Azure Stack, поставщики облачных служб (CSP) часто предлагают службы сразу нескольким пользователям. Клиентов следует добавить в регистрацию Azure Stack, чтобы информация о потреблении и выставлении счетов правильно передавалась в подписки CSP. Если вы не выполните шаги из этой статьи, плата за потребленные клиентом ресурсы будет взиматься с подписки, которую вы использовали при первоначальной регистрации Azure Stack. Чтобы получить возможность добавлять пользователей в Azure Stack для отслеживания потребления и управления клиентами, следует настроить для Azure Stack роль CSP. Этот процесс и необходимые ресурсы описаны в статье [Управление потреблением и оплатой для Azure Stack в роли поставщика облачных служб](azure-stack-add-manage-billing-as-a-csp.md).

На изображении ниже показаны действия, которые позволяют CSP создать нового пользователя в Azure Stack и настроить для него отслеживание потребления. Добавив пользователя, вы также сможете управлять для него ресурсами Azure Stack. Для управления ресурсами доступны два варианта действий.

- Вы можете поддержать пользователя и предоставить ему учетные данные для доступа к локальной подписке Azure Stack.  
- Пользователь также может использовать подписку локально, добавив в своей среде гостевой доступ для CSP с правами владельца.  

## <a name="add-an-end-customer"></a>Добавление клиента

Выполните следующие действия, чтобы добавить клиента, как показано на рисунке ниже.

![Настройка отслеживания потребления и управления учетной записью клиента для поставщика облачных служб](media/azure-stack-csp-enable-billing-usage-tracking/process-csp-enable-billing.png)

### <a name="create-a-new-customer-in-partner-center"></a>Создание клиента в Центре партнеров

В Центре партнеров создайте для клиента новую подписку Azure. Этот процесс описан в статье [Добавление нового клиента](/partner-center/add-a-new-customer).

### <a name="create-an-azure-subscription-for-the-end-customer"></a>Создание подписки Azure для клиента

Создав для пользователя запись в Центре партнеров, вы сможете продавать ему подписки на продукты, включенные в каталог. Этот процесс описан в статье [Создание новой подписки](/partner-center/create-a-new-subscription).

### <a name="create-a-guest-user-in-the-end-customer-directory"></a>Создание гостевого пользователя в каталоге клиента

По умолчанию вы как поставщик облачных служб не имеете доступа к подписке Azure Stack клиента. Но если клиент хочет, чтобы вы управляли его ресурсами, он может добавить вашу учетную запись к своей подписке Azure Stack в качестве владельца или участника. Для этого клиенту нужно добавить вашу учетную запись к своему клиенту AAD в качестве гостя. Мы рекомендуем вам использовать другую учетную запись (отличную от учетной записи поставщика облачных служб Azure) для управления подпиской Azure Stack клиента, чтобы вы не потеряли доступ к подписке Azure клиента.

### <a name="update-the-registration-with-the-end-customer-subscription"></a>Добавление подписки клиента в регистрацию

Добавьте сведения о новой подписке пользователя в регистрацию. Теперь Azure будет передавать данные клиента о потреблении ресурсов, используя указанный в центре партнеров идентификатор клиента. Благодаря этому данные каждого пользователя о потреблении ресурсов будут относиться к его подписке CSP. Так будет проще отслеживать потребление и выставлять счета за него.

> [!NOTE]  
> Чтобы выполнить этот шаг, нужно [зарегистрировать Azure Stack](azure-stack-registration.md).

1. Откройте Windows PowerShell из командной строки с повышенными привилегиями и выполните следующую команду:  
    `Add-AzureRmAccount`
2. Введите учетные данные Azure.
3. В сеансе PowerShell выполните следующую команду:

   ```powershell
   New-AzureRmResource -ResourceId "subscriptions/{registrationSubscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.AzureStack/registrations/{registrationName}/customerSubscriptions/{customerSubscriptionId}" -ApiVersion 2017-06-01 -Properties <PSObject>
   ```

### <a name="new-azurermresource-powershell-parameters"></a>Параметры команды New-AzureRmResource в PowerShell

В следующем разделе описаны параметры командлета **New-AzureRmResource**:

| Параметр | ОПИСАНИЕ |
| --- | --- |
|registrationSubscriptionID | Подписка Azure, которая использовалась для первоначальной регистрации Azure Stack.|
| customerSubscriptionID | Подписка Azure (не Azure Stack), принадлежащая клиенту, для которого выполняется регистрация. Она должна быть создана в предложении поставщика облачных служб, то есть через Центр партнеров. Если для клиента создано несколько учетных записей в Azure Active Directory, подписку нужно создать в той из них, которая будет использоваться для входа в Azure Stack. Идентификатор подписки клиента должен состоять из строчных букв. |
| resourceGroup | Группа ресурсов Azure, в которой хранятся данные об этой регистрации. |
| registrationName | Имя регистрации Azure Stack. Это объект, который хранится в Azure. |
| properties | Задает свойства для ресурса. Используйте этот параметр, чтобы задать значения свойств, которые соответствуют типу ресурса.

> [!NOTE]  
> Клиенты должны быть зарегистрированы в каждом используемом ими экземпляре Azure Stack. Если у вас есть два развертывания Azure Stack и клиент будет использовать оба, сведения о подписке клиента нужно внести в начальные регистрации для обоих развертываний.

### <a name="onboard-tenant-to-azure-stack"></a>Подключение клиента к Azure Stack

Настройте в Azure Stack поддержку пользователей из нескольких клиентов Azure AD, чтобы они могли использовать службы в Azure Stack. Дополнительные сведения см. в статье [Поддержка мультитенантности в Azure Stack](azure-stack-enable-multitenancy.md).

### <a name="create-a-local-resource-in-the-end-customer-tenant-in-azure-stack"></a>Создание локального ресурса в клиенте Azure Stack для клиента

Когда вы добавите нового клиента в Azure Stack или представители клиента предоставят права владельца вашей гостевой учетной записи, проверьте возможность создавать ресурсы для этого клиента. Например, можно [создать виртуальную машину Windows на портале Azure Stack](../user/azure-stack-quick-windows-portal.md).

## <a name="next-steps"></a>Дополнительная информация

- Если в процессе регистрации возникнут ошибки, изучите их с помощью этой [инструкции по ошибкам регистрации клиента](azure-stack-csp-ref-infrastructure.md#usage-and-billing-error-codes).
- Дополнительные сведения см. в статье о [потреблении ресурсов и выставлении счетов в Azure Stack](azure-stack-billing-and-chargeback.md).
- Чтобы помочь пользователю добавить вашу учетную запись (CSP) с правами менеджера в клиенте Azure Stack, изучите статью [Предоставление поставщику облачных служб возможности управлять подпиской Azure Stack](../user/azure-stack-csp-enable-billing-usage-tracking.md).
