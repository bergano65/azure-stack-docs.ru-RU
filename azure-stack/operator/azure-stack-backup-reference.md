---
title: Справочник по службе резервного копирования инфраструктуры Azure Stack | Документация Майкрософт
description: Эта статья содержит справочные материалы по службе резервного копирования инфраструктуры Azure Stack.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.assetid: D6EC0224-97EA-446C-BC95-A3D32F668E2C
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/12/2019
ms.author: mabrigg
ms.reviewer: hectorl
ms.lastreviewed: 10/25/2018
ms.openlocfilehash: 890eb9a6f5b817c3bf77e18ce7019b9e99709d49
ms.sourcegitcommit: 85c3acd316fd61b4e94c991a9cd68aa97702073b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/01/2019
ms.locfileid: "64983615"
---
# <a name="infrastructure-backup-service-reference"></a>Справочник по службе резервного копирования инфраструктуры

## <a name="azure-backup-infrastructure"></a>Резервное копирование инфраструктуры Azure

*Область применения: интегрированные системы Azure Stack и Пакет средств разработки Azure Stack*

Azure Stack состоит из множества служб, в число которых входят портал, Azure Resource Manager и служба управления инфраструктурой. Подход к управлению Azure Stack аналогичен применяемому к устройствам. Он облегчает работу оператора решения.

Служба резервного копирования инфраструктуры предназначена для упрощения резервного копирования и восстановления данных для служб инфраструктуры. Благодаря этому операторы могут сосредоточиться на управлении решением и соблюдении условий соглашения об уровне обслуживания для пользователей.

Чтобы резервные копии не хранились на том же компьютере, нужно экспортировать их во внешнюю общую папку. Это позволяет администратору определить место хранения данных в зависимости от применяемых в компании политик BCDR. 

### <a name="infrastructure-backup-components"></a>Компоненты службы резервного копирования инфраструктуры

Эта служба содержит следующие компоненты:

 - **Контроллер резервного копирования инфраструктуры.**  
 В каждом облаке Azure Stack создается и размещается экземпляр контроллера резервного копирования инфраструктуры.
 - **Поставщик ресурсов резервного копирования.**  
 Поставщик ресурсов (RP) резервного копирования состоит из пользовательского интерфейса и программных интерфейсов (API), которые предоставляют базовый набор функций резервного копирования для инфраструктуры Azure Stack.

#### <a name="infrastructure-backup-controller"></a>Контроллер резервного копирования инфраструктуры

Контроллером резервного копирования инфраструктуры является служба Service Fabric, экземпляр которой создается для облака Azure Stack. Ресурсы резервного копирования создаются на уровне регионов и охватывают региональные данные служб из AD, ЦС, Azure Resource Manager, CRP, SRP, NRP, KeyVault и RBAC. 

### <a name="backup-resource-provider"></a>Поставщик ресурсов резервного копирования

Поставщик ресурсов резервного копирования предоставляет пользовательский интерфейс на портале Azure Stack для базовой конфигурации, а также список ресурсов резервного копирования. В пользовательском интерфейсе оператор может выполнять следующие действия:

 - включить резервное копирование в первый раз, указав внешнее место хранения, учетные данные и ключ шифрования;
 - просматривать сведения о созданных ресурсах резервного копирования и состоянии ресурсов в процессе создания;
 - изменить место хранения, в котором контроллер резервного копирования размещает резервные копии данных;
 - изменить учетные данные, используемые контроллером резервного копирования для доступа к внешнему месту хранения;
 - изменить ключ шифрования, используемый контроллером резервного копирования для шифрования резервных копий. 


## <a name="backup-controller-requirements"></a>Требования для контроллера резервного копирования

В этом разделе описаны важные требования службы резервного копирования инфраструктуры. Прежде чем включить резервное копирование для экземпляра Azure Stack, советуем внимательно ознакомиться с приведенной ниже информацией и при необходимости перечитывать ее во время развертывания и последующих действий.

Требования:

  - **Требования к программному обеспечению.** Указания, касающиеся размера и поддерживаемых мест хранения. 
  - **Требования к сети.** Требования к сети для различных мест хранения.  

### <a name="software-requirements"></a>Требования к программному обеспечению

#### <a name="supported-storage-locations"></a>Поддерживаемые места хранения

| Расположение хранения                                                                 | Сведения                                                                                                                                                  |
|----------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| Файловый ресурс SMB, размещенный на устройстве хранения в доверенной сетевой среде | Общий ресурс SMB в центре обработки данных, где развернут экземпляр Azure Stack, или в другом центре обработки данных. Для нескольких экземпляров Azure Stack можно использовать один файловый ресурс. |
| Файловый ресурс SMB в Azure                                                          | Сейчас не поддерживается.                                                                                                                                 |
| Хранилище BLOB-объектов в Azure                                                            | Сейчас не поддерживается.                                                                                                                                 |

#### <a name="supported-smb-versions"></a>Поддерживаемые версии SMB

| SMB | Version (версия) |
|-----|---------|
| SMB | 3.x     |

#### <a name="storage-location-sizing"></a>Определение размера для места хранения 

Контроллер резервного копирования инфраструктуры выполняет резервное копирование данных по требованию. Рекомендуем проводить резервное копирование как минимум дважды в день и хранить резервные копии не более семи дней. 

**1811 и выше**

| Масштаб среды | Планируемый размер резервной копии | Общий объем необходимого пространства |
|-------------------|--------------------------|--------------------------------|
| 4–16 узлов        | 20 ГБ                    | 280 ГБ                        |
| ASDK              | 10 ГБ                    | 140 ГБ                        |

**До 1811**

| Масштаб среды | Планируемый размер резервной копии | Общий объем необходимого пространства |
|-------------------|--------------------------|--------------------------------|
| 4–16 узлов, ASDK  | 10 ГБ                     | 140 ГБ                        |

### <a name="network-requirements"></a>Требования к сети

| Расположение хранения                                                                 | Сведения                                                                                                                                                                                 |
|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Файловый ресурс SMB, размещенный на устройстве хранения в доверенной сетевой среде | Если экземпляр Azure Stack размещен в среде с брандмауэром, необходимо использовать порт 445. Контроллер резервного копирования инфраструктуры будет инициировать подключение к файловому серверу SMB через порт 445. |
| Чтобы использовать полное доменное имя файлового сервера, имя должно разрешаться из PEP             |                                                                                                                                                                                         |

> [!Note]  
> Не требуется открывать какие-либо входящие порты.

### <a name="encryption-requirements"></a>Требования к шифрованию

Начиная с версии 1901 в службе резервного копирования инфраструктуры будет использоваться сертификат с открытым ключом (CER) для шифрования данных резервного копирования и сертификат с закрытым ключом (PFX) для дешифрования данных резервного копирования во время восстановления в облаке.   
 - Сертификат применяется для транспортировки ключей. Он не предназначен для установления безопасного соединения с проверкой подлинности. Поэтому можно использовать самозаверяющий сертификат. Для этого сертификата в Azure Stack не требуется проверять корневой узел или список доверительных узлов — доступ к Интернету не требуется.
 
Самозаверяющий сертификат состоит из двух частей — с открытым ключом и закрытым ключом:
 - Шифрование данных резервного копирования: Сертификат с открытым ключом (экспортированный в CER-файл) используется для шифрования данных резервного копирования.
 - Расшифровка данных резервного копирования: Сертификат с закрытым ключом (экспортированный в PFX-файл) используется для расшифровки данных резервного копирования.

Сертификат с открытым ключом (CER) не управляется внутренней ротацией секрета. Для ротации сертификата создайте самозаверяющий сертификат и обновите параметры резервного копирования с помощью нового файла (CER).  
 - Все существующие резервные копии остаются зашифрованными с использованием предыдущего открытого ключа. Для шифрования новых резервных копий будет применяться новый открытый ключ. 
 
Сертификат с закрытым ключом (PFX), используемый во время восстановления облака, не сохраняется в Azure Stack в целях безопасности. Во время восстановления облака этот файл необходимо явно указать.  

**Режим обратной совместимости.** Начиная с версии 1901 ключ шифрования не поддерживается. В следующем выпуске он будет удален. Если вы обновили приложение с версии 1811 с включенным резервным копированием с использованием ключа шифрования, Azure Stack продолжит использовать ключ шифрования. Обратная совместимость будет поддерживаться по крайней мере в течение 3 выпусков. Затем нужно будет обязательно использовать сертификат. 
 * Переход с ключа шифрования на сертификат является односторонней операцией.  
 * Все существующие резервные копии останутся зашифрованными с помощью ключа шифрования. Для шифрования новых резервных копий будет применяться сертификат. 

## <a name="infrastructure-backup-limits"></a>Ограничения резервного копирования инфраструктуры

Учитывайте эти ограничения, когда планируете либо развертываете экземпляры Microsoft Azure Stack или выполняете операции с ними. Ограничения описаны в приведенной ниже таблице.

### <a name="infrastructure-backup-limits"></a>Ограничения резервного копирования инфраструктуры

| Идентификатор ограничения                                                 | Ограничение        | Комментарии                                                                                                                                    |
|------------------------------------------------------------------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| Тип резервных копий                                                      | Только полные    | Контроллер резервного копирования инфраструктуры поддерживает только полные резервные копии. Добавочные резервные копии не поддерживаются.                                          |
| Резервное копирование по расписанию                                                | По расписанию и вручную  | Контроллер резервного копирования поддерживает резервное копирование по расписанию и по запросу                                                                                 |
| Максимальное число параллельных заданий резервного копирования                                   | 1            | Для одного экземпляра контроллера резервного копирования поддерживается только одно активное задание резервного копирования.                                                                  |
| Конфигурация сетевого коммутатора                                     | За пределами области | Администратор должен создать резервную копию конфигурации сетевого коммутатора с помощью средств OEM. См. документацию по Azure Stack, предоставляемую каждым поставщиком OEM. |
| Узел жизненного цикла оборудования                                          | За пределами области | Администратор должен создать резервную копию узла жизненного цикла оборудования с помощью средств OEM. См. документацию по Azure Stack, предоставляемую каждым поставщиком OEM.      |
| Максимальное количество файловых ресурсов                                    | 1            | Для хранения резервных копий можно использовать только один файловый ресурс.                                                                                        |
| Резервное копирование данных для поставщиков ресурсов в службах приложений, решении "Функции", SQL и MySQL | За пределами области | См. руководство по развертыванию и администрированию важных поставщиков ресурсов, созданных в корпорации Майкрософт.                                                  |
| Поставщики ресурсов резервного копирования сторонних производителей                              | За пределами области | См. руководство по развертыванию и администрированию важных поставщиков ресурсов, созданных сторонними производителями.                                          |

## <a name="next-steps"></a>Дополнительная информация

 - Дополнительные сведения о службе резервного копирования инфраструктуры см. в статье [Backup and data recovery for Azure Stack with the Infrastructure Backup Service](azure-stack-backup-infrastructure-backup.md) (Резервное копирование и восстановление данных для Azure Stack с помощью службы резервного копирования инфраструктуры).
