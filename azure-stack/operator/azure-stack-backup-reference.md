---
title: Справочник по службе резервного копирования инфраструктуры
description: Справочные материалы по службе "Резервное копирование инфраструктуры" в Azure Stack Hub.
author: justinha
ms.topic: article
ms.date: 02/12/2019
ms.author: justinha
ms.reviewer: hectorl
ms.lastreviewed: 10/25/2018
ms.openlocfilehash: ee18141d01805b498a5f9fa1856d226b6738691c
ms.sourcegitcommit: fd5d217d3a8adeec2f04b74d4728e709a4a95790
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76878332"
---
# <a name="infrastructure-backup-service-reference"></a>Справочник по службе резервного копирования инфраструктуры

## <a name="azure-backup-infrastructure"></a>Резервное копирование инфраструктуры Azure

Azure Stack Hub состоит из множества служб, в число которых входят портал (Azure Resource Manager) и общая система управления инфраструктурой. Подход к управлению Azure Stack Hub аналогичен применяемому к устройствам и нацелен в первую очередь на упрощение работы оператора решения.

Служба "Резервное копирование инфраструктуры" предназначена для упрощения резервного копирования и восстановления данных служб инфраструктуры. Благодаря этому операторы могут сосредоточиться на управлении решением и выполнении условий соглашения об уровне обслуживания для пользователей.

Чтобы резервные копии не хранились на том же компьютере, нужно экспортировать их во внешнюю общую папку. Это позволяет администратору гибко определять место хранения данных в зависимости от применяемых в компании политик резервного копирования и аварийного восстановления.

### <a name="infrastructure-backup-service-components"></a>Компоненты службы "Резервное копирование инфраструктуры"

Служба "Резервное копирование инфраструктуры" содержит следующие компоненты:

 - **Контроллер резервного копирования инфраструктуры.**  
 В каждом облаке Azure Stack Hub создается и размещается экземпляр контроллера резервного копирования инфраструктуры.
 - **Поставщик ресурсов резервного копирования.**  
 Поставщик ресурсов резервного копирования состоит из пользовательского интерфейса и API, которые предоставляют базовый набор функций резервного копирования для инфраструктуры Azure Stack Hub.

#### <a name="infrastructure-backup-controller"></a>Контроллер резервного копирования инфраструктуры

Контроллером резервного копирования инфраструктуры является служба Service Fabric, экземпляр которой создается для облака Azure Stack Hub. Ресурсы резервного копирования создаются на уровне регионов и охватывают региональные данные служб из AD, ЦС, Azure Resource Manager, CRP, SRP, NRP, Key Vault и RBAC.

### <a name="backup-resource-provider"></a>Поставщик ресурсов резервного копирования

Поставщик ресурсов резервного копирования предоставляет пользовательский интерфейс на портале Azure Stack Hub для базовой конфигурации, а также список ресурсов резервного копирования. В этом пользовательском интерфейсе оператор может выполнять следующие действия:

 - включить резервное копирование в первый раз, указав внешнее место хранения, учетные данные и ключ шифрования;
 - просматривать сведения о созданных ресурсах резервного копирования и состоянии ресурсов в процессе создания;
 - изменить место хранения, в котором контроллер резервного копирования размещает резервные копии данных;
 - изменить учетные данные, используемые контроллером резервного копирования для доступа к внешнему месту хранения;
 - изменить ключ шифрования, используемый контроллером резервного копирования для шифрования резервных копий.


## <a name="backup-controller-requirements"></a>Требования для контроллера резервного копирования

В этом разделе описаны важные требования службы "Резервное копирование инфраструктуры". Прежде чем включить резервное копирование для экземпляра Azure Stack Hub, советуем внимательно ознакомиться с приведенной ниже информацией и при необходимости перечитывать ее во время развертывания и последующих действий.

Требования:

  - **Требования к программному обеспечению.** Указания, касающиеся размера и поддерживаемых мест хранения. 
  - **Требования к сети.** Требования к сети для различных мест хранения.  

### <a name="software-requirements"></a>Требования к программному обеспечению

#### <a name="supported-storage-locations"></a>Поддерживаемые места хранения

| Расположение хранения                                                                 | Сведения                                                                                                                                                  |
|----------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| Общий файловый ресурс SMB, размещенный на устройстве хранения в доверенной сетевой среде. | Общий ресурс SMB в центре обработки данных, где развернут экземпляр Azure Stack Hub, или в другом центре обработки данных. Для нескольких экземпляров Azure Stack Hub можно использовать один файловый ресурс. |
| Общий файловый ресурс SMB в Azure.                                                          | Не поддерживается в текущей версии.                                                                                                                                 |
| Хранилище BLOB-объектов в Azure.                                                            | Не поддерживается в текущей версии.                                                                                                                                 |

#### <a name="supported-smb-versions"></a>Поддерживаемые версии SMB

| SMB | Версия |
|-----|---------|
| SMB | 3.x     |

#### <a name="smb-encryption"></a>Шифрование SMB

**Выпуск 1907 и более поздние версии**

Служба "Резервное копирование инфраструктуры" поддерживает передачу данных резервных копий во внешнее хранилище с включенным шифрованием SMB на стороне сервера. Если сервер не поддерживает шифрование SMB или оно не включено, служба "Резервное копирование инфраструктуры" перейдет на незашифрованную передачу данных. Данные резервных копий, размещенные во внешнем хранилище, всегда шифруются в самом хранилище и не зависят от шифрования SMB.

#### <a name="storage-location-sizing"></a>Определение размера для места хранения

Мы рекомендуем проводить резервное копирование как минимум дважды в день и хранить резервные копии не более семи дней. Это поведение по умолчанию, когда в Azure Stack Hub включено резервное копирование инфраструктуры.

**Выпуск 1907 и более поздние версии**

***Система, подключенная к поставщику удостоверений Azure AD***

| Масштаб среды | Планируемый размер резервной копии | Общий объем необходимого пространства |
|-------------------|--------------------------|--------------------------------|
| 4–16 узлов, ASDK   | 1 ГБ                     | 20 ГБ                          |

***Система, подключенная к корпоративному поставщику удостоверений AD посредством AD FS***

| Масштаб среды | Планируемый размер резервной копии | Общий объем необходимого пространства |
|-------------------|--------------------------|--------------------------------|
| 4–16 узлов        | 20 ГБ                    | 280 ГБ                        |
| ASDK              | 10 ГБ                    | 140 ГБ                        |

**До выпуска 1907**

| Масштаб среды | Планируемый размер резервной копии | Общий объем необходимого пространства |
|-------------------|--------------------------|--------------------------------|
| 4–16 узлов        | 20 ГБ                    | 280 ГБ                        |
| ASDK              | 10 ГБ                    | 140 ГБ                        |

### <a name="network-requirements"></a>Требования к сети

| Расположение хранения                                                                 | Сведения                                                                                                                                                                                 |
|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Общий файловый ресурс SMB, размещенный на устройстве хранения в доверенной сетевой среде. | Если экземпляр Azure Stack Hub размещен в среде с брандмауэром, необходимо использовать порт 445. Контроллер резервного копирования инфраструктуры будет инициировать подключение к файловому серверу SMB через порт 445. |
| Чтобы использовать полное доменное имя файлового сервера, имя должно разрешаться из PEP.             |                                                                                                                                                                                         |

> [!Note]  
> Не требуется открывать какие-либо входящие порты.

### <a name="encryption-requirements"></a>Требования к шифрованию

Начиная с версии 1901 в службе резервного копирования инфраструктуры будет использоваться сертификат с открытым ключом (CER) для шифрования данных резервного копирования и сертификат с закрытым ключом (PFX) для дешифрования данных резервного копирования во время восстановления в облаке.

 - Этот сертификат применяется для транспортировки ключей. Он не предназначен для установления безопасного соединения с проверкой подлинности. Поэтому можно использовать самозаверяющий сертификат. Для этого сертификата в Azure Stack Hub не требуется проверять корневой узел или список доверительных узлов, а значит доступ к Интернету не требуется.

Самозаверяющий сертификат состоит из двух частей — с открытым ключом и закрытым ключом:

 - Шифрование данных резервного копирования: Сертификат с открытым ключом (экспортированный в CER-файл) используется для шифрования данных резервного копирования.
 - Расшифровка данных резервного копирования: Сертификат с закрытым ключом (экспортированный в PFX-файл) используется для расшифровки данных резервного копирования.

Сертификат с открытым ключом (CER) не затрагивается внутренней ротацией секретов. Для ротации этого сертификата создайте самозаверяющий сертификат и включите новый файл (CER) в параметры резервного копирования. 
 
 - Все существующие резервные копии остаются зашифрованными с использованием предыдущего открытого ключа. Для шифрования новых резервных копий применяется новый открытый ключ.
 
Сертификат с закрытым ключом (PFX), используемый во время восстановления облака, не сохраняется в Azure Stack Hub в целях безопасности. Во время восстановления облака этот файл необходимо явно указать.  

**Режим обратной совместимости.** Начиная с версии 1901 ключ шифрования не поддерживается. В следующем выпуске он будет удален. Если вы обновили приложение с версии 1811 с включенным резервным копированием с использованием ключа шифрования, Azure Stack Hub продолжит использовать ключ шифрования. Обратная совместимость будет поддерживаться по крайней мере в течение 3 выпусков. Затем нужно будет обязательно использовать сертификат.

 * Переход с ключа шифрования на сертификат является односторонней операцией.  
 * Все существующие резервные копии останутся зашифрованными с помощью ключа шифрования. Для шифрования новых резервных копий будет применяться сертификат. 

## <a name="infrastructure-backup-limits"></a>Ограничения резервного копирования инфраструктуры

Учитывайте эти ограничения, когда планируете либо развертываете экземпляры Microsoft Azure Stack Hub или выполняете операции с ними. Ограничения описаны в приведенной ниже таблице.

### <a name="infrastructure-backup-limits"></a>Ограничения резервного копирования инфраструктуры

| Идентификатор ограничения                                                 | Ограничение        | Комментарии                                                                                                                                    |
|------------------------------------------------------------------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| Тип резервных копий                                                      | Только полные    | Контроллер резервного копирования инфраструктуры поддерживает только полные резервные копии. Добавочные резервные копии не поддерживаются.                                          |
| Резервное копирование по расписанию                                                | По расписанию и вручную  | Контроллер резервного копирования поддерживает резервное копирование по расписанию и по запросу.                                                                                 |
| Максимальное число параллельных заданий резервного копирования                                   | 1            | Для одного экземпляра контроллера резервного копирования поддерживается только одно активное задание резервного копирования.                                                                  |
| Конфигурация сетевого коммутатора                                     | За пределами области | Администратор должен создать резервную копию конфигурации сетевого коммутатора с помощью средств OEM. Обратитесь к документации по Azure Stack Hub, предоставляемой каждым поставщиком OEM. |
| Узел жизненного цикла оборудования                                          | За пределами области | Администратор должен создать резервную копию узла жизненного цикла оборудования с помощью средств OEM. Обратитесь к документации по Azure Stack Hub, предоставляемой каждым поставщиком OEM.      |
| Максимальное количество файловых ресурсов                                    | 1            | Для хранения резервных копий можно использовать только один файловый ресурс.                                                                                        |
| Резервное копирование данных для поставщиков ресурсов в службах приложений, решении "Функции", SQL и MySQL | За пределами области | См. руководство по развертыванию и администрированию важных поставщиков ресурсов, созданных в корпорации Майкрософт.                                                  |
| Поставщики ресурсов резервного копирования сторонних производителей                              | За пределами области | См. руководство по развертыванию и администрированию важных поставщиков ресурсов, созданных сторонними производителями.                                          |

## <a name="next-steps"></a>Дальнейшие действия

 - Дополнительные сведения об использовании службы "Резервное копирование инфраструктуры" для резервного копирования и восстановления данных для Azure Stack Hub см. в [этой статье](azure-stack-backup-infrastructure-backup.md).
