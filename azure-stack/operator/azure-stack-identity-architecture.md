---
title: Архитектура удостоверений Azure Stack | Документация Майкрософт
description: Сведения об архитектуре удостоверений, которые можно использовать с Azure Stack.
services: azure-stack
documentationcenter: ''
author: WenJason
manager: digimobile
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
origin.date: 02/11/2019
ms.date: 03/04/2019
ms.author: v-jay
ms.reviewer: fiseraci
ms.lastreviewed: 02/11/2019
ms.openlocfilehash: 9ae8a55d04c34ec65d964927fd25c3bc01adeae4
ms.sourcegitcommit: 0973dddb81db03cf07c8966ad66526d775ced8b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "64310028"
---
# <a name="identity-architecture-for-azure-stack"></a>Архитектура удостоверений Azure Stack

При выборе поставщика удостоверений для использования с Azure Stack необходимо ознакомиться с существенными различиями между вариантами Azure Active Directory (Azure AD) и службы федерации Active Directory (AD FS).

## <a name="capabilities-and-limitations"></a>Возможности и ограничения 
Выбранный поставщик удостоверений может ограничить некоторые возможности, включая поддержку мультитенантности. 

  

|Возможность или сценарий        |Azure AD  |AD FS  |
|------------------------------|----------|-------|
|С подключением к Интернету     |Yes       |Необязательно|
|Поддержка мультитенантности     |Yes       |Нет       |
|Элементы предложения в Marketplace |Yes       |Да. Требуется использовать инструмент [автономной синдикации Marketplace](azure-stack-download-azure-marketplace-item.md#disconnected-or-a-partially-connected-scenario).|
|Поддержка библиотеки проверки подлинности Active Directory (ADAL) |Yes |Yes|
|Поддержка таких средств, как Azure CLI, Visual Studio и PowerShell  |Yes |Yes|
|Создание субъектов-служб с помощью портала Azure     |Yes |Нет |
|Создание субъектов-служб с помощью сертификатов      |Yes |Yes|
|Создание субъектов-служб с помощью секретов (ключей)    |Yes |Нет |
|Приложения могут использовать службу Graph           |Yes |Нет |
|Приложения могут использовать поставщика удостоверений для входа в систему |Yes |Да. Требуется, чтобы приложения создавали федерацию с локальными экземплярами федерации Active Directory (AD FS). |

## <a name="topologies"></a>Топологии
В следующих разделах рассматриваются различные топологии удостоверений, которые можно использовать.

### <a name="azure-ad-single-tenant-topology"></a>Однотенантная топология Azure Active Directory 
По умолчанию при установке Azure Stack и использовании Azure AD Azure Stack использует однотенантную топологию. 

Однотенантная топология полезна в следующих случаях:
- Все пользователи входят в состав одного клиента.
- Экземпляр Azure Stack для организации размещен в поставщике услуг. 

![Однотенантная топология Azure Stack с Azure AD](media/azure-stack-identity-architecture/single-tenant.png)

Характеристики этой топологии:
- Azure Stack регистрирует все приложения и службы в одном каталоге клиента Azure AD. 
- В Azure Stack выполняется аутентификация пользователей и приложений из этого каталога, в частности маркеров. 
- Удостоверения администраторов (операторы облака) и пользователей находятся в одном клиенте каталога. 
- Чтобы предоставить пользователю из другого каталога доступ к среде Azure Stack, необходимо [пригласить пользователя в качестве гостя](azure-stack-identity-overview.md#guest-users) в каталог клиента. 

### <a name="azure-ad-multi-tenant-topology"></a>Мультитенантная топология Azure AD
Операторы облака могут настроить Azure Stack, разрешив доступ к приложениям клиентам из одной или нескольких организаций. Пользователи получают доступ к приложениям через портал пользователей. В этой конфигурации портал администратора (используемый оператором облака) ограничен для пользователей из одного каталога. 

Топология с несколькими клиентами полезна, если:
- Поставщик услуг хочет предоставить доступ к Azure Stack пользователям из нескольких организаций.

![Мультитенантная топология Azure Stack с Azure AD](media/azure-stack-identity-architecture/multi-tenant.png)

Характеристики этой топологии:
- Доступ к ресурсам необходимо предоставлять отдельно для каждой организации. 
- Пользователи из одной организации не должны иметь возможность предоставлять доступ к ресурсам пользователям за пределами этой организации. 
- Удостоверения администраторов (операторов облака) и пользователей могут находиться в разных клиентах каталога. Подобное разделение обеспечивает изоляцию учетной записи на уровне поставщика удостоверений. 
 
### <a name="ad-fs"></a>AD FS  
Топология AD FS необходима в следующих случаях:
- Azure Stack не подключен к Интернету.
- Azure Stack можно подключить к Интернету, но вы решили использовать AD FS в качестве поставщика удостоверений.
  
![Топология Azure Stack, использующая AD FS](media/azure-stack-identity-architecture/adfs.png)

Характеристики этой топологии:
- Для использования этой топологии в рабочей среде нужно интегрировать встроенный экземпляр Azure Stack AD FS с существующим экземпляром AD FS, поддерживаемым Active Directory (AD) с помощью отношения доверия федерации. 
- Также можно интегрировать службу Graph в Azure Stack с существующим экземпляром Active Directory. Кроме того, вы можете использовать протокол OData на основе службы API Graph, который поддерживает программные интерфейсы, совместимые с API Graph Azure AD. 

  Для взаимодействия с экземпляром Active Directory API Graph требуются учетные данные пользователя из Active Directory с разрешением только для чтения: 
  - Встроенный экземпляр AD FS должен работать на основе Windows Server 2016. 
  - Экземпляры AD FS и Active Directory должны работать на основе Windows Server 2012 или более поздней версии. 
  
  Взаимодействие между экземпляром Active Directory и встроенным экземпляром AD FS не ограничено только OpenID Connect. Поэтому вы можете использовать любой поддерживаемый протокол. 
  - Учетные записи пользователей создаются и управляются в локальном экземпляре Active Directory.
  - Субъекты-службы и регистрации для приложений управляются встроенным экземпляром Active Directory.



## <a name="next-steps"></a>Дополнительная информация
- [Общие сведения об удостоверениях Azure Stack](azure-stack-identity-overview.md)   
- [Интеграция центра обработки данных Azure Stack: идентификация](azure-stack-integrate-identity.md)
<!-- Update_Description: link update -->