---
title: Архитектура удостоверений Azure Stack Hub
description: Сведения об архитектуре идентификации для Azure Stack Hub и различиях между Azure Active Directory и AD FS.
author: IngridAtMicrosoft
ms.topic: conceptual
ms.date: 05/09/2019
ms.author: inhenkel
ms.reviewer: fiseraci
ms.lastreviewed: 05/09/2019
ms.openlocfilehash: 528e008c5c3c166979ba4c3d4fa15d6a94cc0f87
ms.sourcegitcommit: 97806b43314d306e0ddb15847c86be2c92ae001e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2020
ms.locfileid: "77509931"
---
# <a name="identity-architecture-for-azure-stack-hub"></a>Архитектура удостоверений Azure Stack Hub

При выборе поставщика удостоверений для использования с Azure Stack Hub необходимо ознакомиться с существенными различиями между вариантами Azure Active Directory (Azure AD) и службы федерации Active Directory (AD FS).

## <a name="capabilities-and-limitations"></a>Возможности и ограничения

Выбранный поставщик удостоверений может ограничить некоторые возможности, включая поддержку мультитенантности.

|Возможность или сценарий        |Azure AD  |AD FS  |
|------------------------------|----------|-------|
|С подключением к Интернету     |Да       |Необязательно|
|Поддержка мультитенантности     |Да       |нет      |
|Элементы предложения в Marketplace |Да       |Да. Требует использования инструмента [автономной синдикации Marketplace](azure-stack-download-azure-marketplace-item.md#disconnected-or-a-partially-connected-scenario).|
|Поддержка библиотеки проверки подлинности Active Directory (ADAL) |Да |Да|
|Поддержка таких средств, как Azure CLI, Visual Studio и PowerShell  |Да |Да|
|Создание субъектов-служб с помощью портала Azure     |Да |нет|
|Создание субъектов-служб с помощью сертификатов      |Да |Да|
|Создание субъектов-служб с помощью секретов (ключей)    |Да |Да|
|Приложения могут использовать службу Graph           |Да |нет|
|Приложения могут использовать поставщика удостоверений для входа в систему |Да |Да. Требуется, чтобы приложения создавали федерацию с локальными экземплярами федерации AD FS. |

## <a name="topologies"></a>Топологии

В следующих разделах рассматриваются разные топологии удостоверений, которые можно использовать.

### <a name="azure-ad-single-tenant-topology"></a>Однотенантная топология Azure Active Directory

По умолчанию при установке Azure Stack Hub и использовании Azure AD Azure Stack Hub использует однотенантную топологию.

Однотенантная топология полезна в следующих случаях:
- Все пользователи входят в состав одного клиента.
- Экземпляр Azure Stack Hub для организации размещен в поставщике услуг.

![Однотенантная топология Azure Stack Hub с Azure AD](media/azure-stack-identity-architecture/single-tenant.png)

Характеристики этой топологии:

- Azure Stack Hub регистрирует все приложения и службы в одном каталоге клиента Azure AD.
- В Azure Stack Hub выполняется проверка подлинности пользователей и приложений из этого каталога, в частности маркеров.
- Удостоверения администраторов (операторы облака) и пользователей находятся в одном клиенте каталога.
- Чтобы предоставить пользователю из другого каталога доступ к среде Azure Stack Hub, необходимо [пригласить пользователя в качестве гостя](azure-stack-identity-overview.md#guest-users) в каталог клиента.

### <a name="azure-ad-multi-tenant-topology"></a>Мультитенантная топология Azure AD

Операторы облака могут настроить Azure Stack Hub, разрешив доступ к приложениям клиентам из одной или нескольких организаций. Пользователи получают доступ к приложениям через портал пользователей Azure Stack Hub. В этой конфигурации доступ к порталу администратора (используемый оператором облака) ограничен пользователями из одного каталога.

Топология с несколькими клиентами полезна, если:

- Поставщик услуг хочет предоставить доступ к Azure Stack Hub пользователям из нескольких организаций.

![Мультитенантная топология Azure Stack Hub с Azure AD](media/azure-stack-identity-architecture/multi-tenant.png)

Характеристики этой топологии:

- Доступ к ресурсам необходимо предоставлять отдельно для каждой организации.
- Пользователи из одной организации не должны иметь возможность предоставлять доступ к ресурсам пользователям за пределами этой организации.
- Удостоверения администраторов (операторов облака) и пользователей могут находиться в разных клиентах каталога. Подобное разделение обеспечивает изоляцию учетной записи на уровне поставщика удостоверений.
 
### <a name="ad-fs"></a>AD FS

Топология AD FS необходима в следующих случаях:

- В Azure Stack Hub нет подключения к Интернету.
- Azure Stack Hub можно подключить к Интернету, но вы решили использовать AD FS в качестве поставщика удостоверений.
  
![Топология Azure Stack Hub, использующая AD FS](media/azure-stack-identity-architecture/adfs.png)

Характеристики этой топологии:

- Для использования этой топологии в рабочей среде нужно интегрировать встроенный экземпляр Azure Stack Hub AD FS с существующим экземпляром AD FS, поддерживаемым Active Directory (AD) с помощью отношения доверия федерации.
- Кроме того, можно интегрировать службу Graph в Azure Stack Hub с существующим экземпляром Active Directory. Кроме того, вы можете использовать протокол OData на основе службы API Graph, который поддерживает программные интерфейсы, совместимые с API Graph Azure AD.

  Для взаимодействия с экземпляром Active Directory API Graph требуются учетные данные пользователя из Active Directory с разрешением только для чтения:
  - Встроенный экземпляр AD FS должен работать на основе Windows Server 2016.
  - Экземпляры AD FS и Active Directory должны работать на основе Windows Server 2012 или более поздней версии.
  
  Взаимодействие между экземпляром Active Directory и встроенным экземпляром AD FS не ограничено только OpenID Connect. Поэтому вы можете использовать любой поддерживаемый протокол.
  - Учетные записи пользователей создаются и управляются в локальном экземпляре Active Directory.
  - Субъекты-службы и регистрации для приложений управляются встроенным экземпляром Active Directory.

## <a name="next-steps"></a>Дальнейшие действия

- [Общие сведения об удостоверениях Azure Stack](azure-stack-identity-overview.md)
- [Интеграция центра обработки данных Azure Stack: идентификация](azure-stack-integrate-identity.md)
