---
title: Планирование интеграции сети для Azure Stack Hub
description: Из этой статьи вы узнаете, как спланировать интеграцию сети центра обработки данных с интегрированными системами Azure Stack Hub.
author: ihenkel
ms.topic: article
ms.date: 10/23/2019
ms.author: inhenkel
ms.reviewer: wamota
ms.lastreviewed: 06/04/2019
ms.openlocfilehash: 42529e5757100ed2ad1334b62bf4e58e1266f561
ms.sourcegitcommit: fd5d217d3a8adeec2f04b74d4728e709a4a95790
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76881701"
---
# <a name="network-integration-planning-for-azure-stack-hub"></a>Планирование интеграции сети для Azure Stack Hub

В этой статье приводятся сведения об инфраструктуре сети Azure Stack Hub, которые помогут решить, как лучше всего интегрировать Azure Stack Hub с существующей сетевой средой. 

> [!NOTE]
> Чтобы разрешать внешние имена DNS (например, www\.bing.com) из Azure Stack Hub, необходимо предоставить DNS-серверы для переадресации DNS-запросов. Дополнительные сведения о требованиях к DNS для Azure Stack Hub см. в статье [Интеграция DNS центра обработки данных Azure Stack](azure-stack-integrate-dns.md).

## <a name="physical-network-design"></a>Структура физической сети

Чтобы поддерживать выполнение операций и работу служб, решению Azure Stack Hub требуется гибкая и высокодоступная физическая инфраструктура. Каналы исходящей связи от коммутаторов ToR к пограничным коммутаторам ограничены носителями SFP+ или SFP28 и скоростями 1 ГБ, 10 ГБ или 25 ГБ. Обратитесь к поставщику оборудования OEM, чтобы получить сведения о доступности. На следующей диаграмме представлена наша рекомендуемая архитектура:

![Рекомендуемая структура сети Azure Stack Hub](media/azure-stack-network/recommended-design.png)


## <a name="logical-networks"></a>Логические сети

Логические сети представляют собой абстракцию базовой инфраструктуры физической сети. Они используются, чтобы упорядочить и упростить назначение сетей для узлов, виртуальных машин и служб. При создании логической сети создаются и сайты сети. Они определяют виртуальные локальные сети, IP-подсети и пары из IP-подсетей и виртуальных локальных сетей, связанные с логической сетью в каждом физическом расположении.

В следующей таблице показаны логические сети и соответствующие диапазоны подсети IPv4, которые необходимо выбрать.

| Логические сети | Описание | Размер | 
| -------- | ------------- | ------------ | 
| Общедоступный виртуальный IP-адрес | Всего в Azure Stack Hub используется 31 адрес из этой сети. Восемь общедоступных IP-адресов предназначены для небольшого набора служб Azure Stack Hub, а остальные используются виртуальными машинами клиента. Если вы планируете использовать службу приложений и поставщики ресурсов SQL, потребуется еще 7 адресов. Оставшиеся 15 IP-адресов зарезервированы для будущих служб Azure. | /26 (62 узла) –/22 (1022 узла)<br><br>Рекомендуется —  /24 (254 узла) | 
| Инфраструктура коммутаторов | IP-адреса типа "точка —точка" для целей маршрутизации, выделенные интерфейсы управления коммутаторами и петлевые адреса, назначенные коммутатору. | /26 | 
| Инфраструктура | Используется для обмена данными между внутренними компонентами Azure Stack Hub. | /24 |
| Private | Используется для сети хранения данных, частных виртуальных IP-адресов, контейнеров инфраструктуры и других внутренних функций. Начиная с версии 1910, размер этой подсети изменен на /20. Дополнительные сведения см. в разделе [Частная сеть](#private-network) этой статьи. | /20 | 
| Контроллер управления основной платой (BMC) | Используется для обмена данными с BMC на физических узлах. | /26 | 
| | | |

> [!NOTE]
> При обновлении системы до версии 1910 оповещение на портале будет напоминать оператору о необходимости выполнения нового командлета PEP **Set-AzsPrivateNetwork**, чтобы добавить новое пространство частных IP-адресов /20. Инструкции по запуску командлета см. в [заметках о выпуске 1910](release-notes.md). Дополнительные сведения и рекомендации по выбору пространства частных IP-адресов /20 см. в разделе [Частная сеть](#private-network) этой статьи.

## <a name="network-infrastructure"></a>Сетевая инфраструктура

Сетевая инфраструктура для Azure Stack Hub состоит из нескольких логических сетей, настроенных на коммутаторах. На следующей схеме показаны эти логические сети и их интеграция с коммутаторами верхнего уровня (TOR), контроллером управления основной платой (BMC) и граничным коммутатором (клиентская сеть).

![Логическая схема сети и подключения коммутаторов](media/azure-stack-network/NetworkDiagram.png)

### <a name="bmc-network"></a>Сеть BMC

Эта сеть предназначена для подключения всех контроллеров управления основной платой (также называются BMC или служебными процессорами) к сети управления. Например: iDRAC, iLO, iBMC и т. д. Для взаимодействия с любым узлом BMC используется только одна учетная запись BMC. Узел жизненного цикла оборудования (HLH) (при наличии) размещается в этой сети и может предоставлять предназначенное для изготовителей оборудования программное обеспечение для обслуживания или мониторинга оборудования.

Также в HLH размещена виртуальная машина для развертывания (DVM). DVM используется при развертывании Azure Stack Hub и удаляется по завершении развертывания. Для DVM требуется доступ к Интернету в сценариях развертывания с подключением для тестирования, проверки и доступа к нескольким компонентам. Такие компоненты могут находиться в корпоративной сети и за ее пределами (например, NTP, DNS и Azure). Требования к подключению см. в [разделе "Преобразование сетевых адресов" статьи "Интеграция брандмауэра Azure Stack"](azure-stack-firewall.md#network-address-translation).

### <a name="private-network"></a>Частная сеть

Эта сеть типа /20 (4096 IP-адресов) является частной в регионе Azure Stack Hub (не маршрутизируется через граничные коммутаторы системы Azure Stack Hub) и делится на несколько подсетей. Ниже приведен ряд примеров.

- **Сеть хранилища**. Сеть типа /25 (128 IP-адресов) поддерживает использование локальных дисковых пространств, передачу трафика по протоколу SMB и динамическую миграцию виртуальных машин.
- **Внутренняя виртуальная IP-сеть**. Сеть типа /25, предназначенная только для виртуальных IP-адресов для подсистемы балансировки нагрузки программного обеспечения (SLB).
- **Сеть контейнеров**. Сеть типа /23 (512 IP-адресов), предназначенная только для внутреннего трафика между контейнерами, на которых выполняются службы инфраструктуры.

Начиная с версии 1910, размер частной сети изменится на /20 (4096 IP-адресов) для пространства частных IP-адресов. Эта сеть будет частной для системы Azure Stack Hub (не маршрутизируется через граничные коммутаторы системы Azure Stack Hub), и ее можно повторно использовать в нескольких системах Azure Stack Hub в центре обработки данных. Хотя сеть является частной для Azure Stack Hub, она не должна перекрываться с другими сетями в центре обработки данных. Если происходит перекрытие, Azure Stack Hub может потерять возможность маршрутизировать трафик из внешней корпоративной сети. Инструкции по пространству частных IP-адресов см. в [RFC 1918](https://tools.ietf.org/html/rfc1918).

Это пространство частных IP-адресов /20 будет разделено на несколько сетей, что позволит в будущих выпусках запускать внутреннюю инфраструктуру системы Azure Stack Hub в контейнерах. Дополнительные сведения см. в [заметках о выпуске 1910](release-notes.md). Это новое пространство частных IP-адресов также позволяет уменьшить требуемое пространство маршрутизируемых IP-адресов перед развертыванием.

Для систем, развернутых с версиями до 1910, эта подсеть /20 будет дополнительной сетью для ввода в системы после обновления до версии 1910. Дополнительную сеть потребуется предоставить системе с помощью командлета PEP **Set-AzsPrivateNetwork**. Рекомендации по этому командлету см. в [заметках о выпуске 1910](release-notes.md).

### <a name="azure-stack-hub-infrastructure-network"></a>Сеть инфраструктуры Azure Stack Hub

Эта сеть /24 предназначена для внутренних компонентов Azure Stack Hub, чтобы обеспечить связь и обмен данными между ними. Эту подсеть можно маршрутизировать за пределы решения Azure Stack Hub в центр обработки данных. В этой подсети не рекомендуется использовать общедоступные IP-адреса или IP-адреса с маршрутизацией через Интернет. Эту сеть объявлено до границы, но большинство ее IP-адресов защищены списками управления доступом (ACL). IP-адреса, с которых разрешен доступ, находятся в небольшом диапазоне, эквивалентном по размеру сети /27, и размещают такие службы, как [привилегированная конечная точка (PEP)](azure-stack-privileged-endpoint.md) и [резервное копирование Azure Stack Hub](azure-stack-backup-reference.md).

### <a name="public-vip-network"></a>Открытая сеть VIP

Открытая сеть VIP назначается для сетевого контроллера в Azure Stack Hub. Это не логическая сеть на коммутаторах. SLB использует пул адресов и назначает сети типа /32 для рабочих нагрузок клиента. В таблице маршрутизации коммутатора эти IP-адреса сети типа /32 объявляются как маршруты, доступные по протоколу BGP. Эта сеть содержит доступные внешние или открытые IP-адреса. Инфраструктура Azure Stack Hub резервирует первый 31 адрес из этой открытой сети VIP, а остальные адреса отдаются под виртуальные машины клиентов. Размер сети в этой подсети может варьироваться от минимум /26 (64 узла) до максимального значения /22 (1022 узла). Рекомендуется планировать сеть размера /24.

### <a name="switch-infrastructure-network"></a>Сеть инфраструктуры коммутаторов

Это подсеть типа /26, содержащая IP-подсети "точка-точка" типа /30 (2 IP-адреса узлов) с поддержкой маршрутизации, и подсети с замыканием на себя, представляющие выделенные подсети типа /32 для управления коммутаторами в основной сети и идентификатора маршрутизатора BGP. Этот диапазон IP-адресов должен маршрутизироваться за пределы решения Azure Stack Hub в центр обработки данных. Это могут быть частные или общедоступные IP-адреса.

### <a name="switch-management-network"></a>Сеть управления коммутаторами

Эта сеть /29 (6 IP-адресов узлов) выделена для подключения портов управления коммутаторами. Она также предоставляет доступ по внештатному каналу для развертывания, управления и устранения неполадок. Она вычисляется на основе сети инфраструктуры коммутаторов, упомянутой выше.

## <a name="permitted-networks"></a>Разрешенные сети

Начиная с версии 1910, на листе развертывания появится новое поле, позволяющее оператору изменить некоторые списки управления доступом (ACL), чтобы разрешить доступ к интерфейсам управления сетевыми устройствами и узлу жизненного цикла оборудования (HLH) из доверенного диапазона номеров сети центра обработки данных. С помощью изменения списка управления доступом оператор может разрешить виртуальным машинам управления Jumpbox в определенном диапазоне номеров сети доступ к интерфейсу управления коммутатором, а также ОС и BMC узла жизненного цикла оборудования (HLH). Оператор может ввести в этот список одну или несколько подсетей. Если оставить это поле пустым, по умолчанию подсетям будет отказано в доступе. Эта новая функция заменяет необходимость вмешательства вручную после развертывания, описанную в статье [Изменение определенных параметров в конфигурации коммутатора Azure Stack](azure-stack-customer-defined.md#access-control-list-updates).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительная информация о планировании сети: [Пограничное подключение](azure-stack-border-connectivity.md).
