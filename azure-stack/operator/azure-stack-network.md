---
title: Рекомендации по интеграции сетей для интегрированных систем Azure Stack | Документация Майкрософт
description: Узнайте, как запланировать интеграцию центра обработки данных с системой Azure Stack с несколькими узлами.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/12/2019
ms.author: mabrigg
ms.reviewer: wamota
ms.lastreviewed: 08/30/2018
ms.openlocfilehash: a839faa7ec5a93a506ad967f3449ee1788f1a21a
ms.sourcegitcommit: 2a4321a9cf7bef2955610230f7e057e0163de779
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2019
ms.locfileid: "65618496"
---
# <a name="network-connectivity"></a>Сетевое подключение
В этой статье приводятся сведения об инфраструктуре сети Azure Stack, которые помогут решить, как лучше всего интегрировать Azure Stack с существующей сетевой средой. 

> [!NOTE]
> Чтобы разрешить внешние имена DNS из Azure Stack (например, www\.bing.com), необходимо предоставить DNS-серверы для переадресации DNS-запросов. Дополнительные сведения о требованиях к DNS Azure Stack см. в статье [Интеграция центра обработки данных Azure Stack — DNS](azure-stack-integrate-dns.md).

## <a name="physical-network-design"></a>Структура физической сети
Чтобы поддерживать выполнение операций и служб, решению Azure Stack требуется гибкая и высокодоступная физическая инфраструктура. Каналы исходящей связи от коммутаторов ToR к пограничным коммутаторам ограничены носителями SFP + или SFP28 и скоростями 1 ГБ, 10 ГБ или 25 ГБ. Обратитесь к поставщику оборудования OEM, чтобы получить сведения о доступности. На следующей диаграмме представлена наша рекомендуемая архитектура:

![Рекомендуемая структура сети Azure Stack](media/azure-stack-network/recommended-design.png)


## <a name="logical-networks"></a>Логические сети
Логические сети представляют собой абстракцию базовой инфраструктуры физической сети. Они используются, чтобы упорядочить и упростить назначение сетей для узлов, виртуальных машин и служб. При создании логической сети создаются и сайты сети. Они определяют виртуальные локальные сети, IP-подсети и пары из IP-подсетей и виртуальных локальных сетей, связанные с логической сетью в каждом физическом расположении.

В следующей таблице показаны логические сети и соответствующие диапазоны подсети IPv4, которые необходимо выбрать.

| Логические сети | ОПИСАНИЕ | Размер | 
| -------- | ------------- | ------------ | 
| Общедоступный виртуальный IP-адрес | Всего из этой сети в Azure Stack используется 31 адрес. Восемь общедоступных IP-адресов предназначены для небольшого набора служб Azure Stack, а остальные используются виртуальными машинами клиента. Если вы планируете использовать службу приложений и поставщики ресурсов SQL, потребуется еще 7 адресов. Оставшиеся 15 IP-адресов зарезервированы для будущих служб Azure. | /26 (62 узла) –/22 (1022 узла)<br><br>Рекомендуется —  /24 (254 узла) | 
| Инфраструктура коммутаторов | IP-адреса типа "точка —точка" для целей маршрутизации, выделенные интерфейсы управления коммутаторами и петлевые адреса, назначенные коммутатору. | /26 | 
| Инфраструктура | Используется для обмена данными между внутренними компонентами Azure Stack. | /24 |
| Private | Используется для сети хранения данных и частных виртуальных IP-адресов. | /24 | 
| Контроллер управления основной платой (BMC) | Используется для обмена данными с BMC на физических узлах. | /26 | 
| | | |

## <a name="network-infrastructure"></a>Сетевая инфраструктура
Сетевая инфраструктура для Azure Stack состоит из нескольких логических сетей, которые настроены на коммутаторах. На следующей схеме показаны эти логические сети и их интеграция с коммутаторами верхнего уровня (TOR), контроллером управления основной платой (BMC) и граничным коммутатором (клиентская сеть).

![Логическая схема сети и подключения коммутаторов](media/azure-stack-network/NetworkDiagram.png)

### <a name="bmc-network"></a>Сеть BMC
Эта сеть предназначена для подключения всех контроллеров управления основной платой (также называются служебными процессорами, например iDRAC, iLO, iBMC и т. д.) к сети управления. Узел жизненного цикла оборудования (HLH) (при наличии) размещается в этой сети и может предоставлять предназначенное для изготовителей оборудования программное обеспечение для обслуживания или мониторинга оборудования. 

Также в HLH размещена виртуальная машина для развертывания (DVM). DVM используется при развертывании Azure Stack и удаляется по завершении развертывания. Для DVM требуется доступ к Интернету в сценариях развертывания с подключением для тестирования, проверки и доступа к нескольким компонентам. Такие компоненты могут находиться в корпоративной сети и за ее пределами ( например, NTP, DNS и Azure). Требования к подключению см. в [разделе о NAT статьи "Интеграция брандмауэра Azure Stack"](azure-stack-firewall.md#network-address-translation). 

### <a name="private-network"></a>Частная сеть
Эта сеть типа /24 (254 IP-адреса узлов) является частной в регионе Azure Stack (не распространяется на граничные коммутаторы за пределами региона Azure Stack) и делится на две подсети:

- **Сеть хранилища**. Сеть типа /25 (126 IP-адресов узлов) поддерживает использование локальных дисковых пространств, передачу трафика по протоколу SMB и динамическую миграцию виртуальных машин. 
- **Внутренняя виртуальная IP-сеть**. Сеть типа /25, предназначенная только для виртуальных IP-адресов для подсистемы балансировки нагрузки программного обеспечения (SLB).

### <a name="azure-stack-infrastructure-network"></a>Сеть инфраструктуры Azure Stack
Эта сеть типа /24 предназначена для внутренних компонентов Azure Stack, чтобы обеспечить обмен данными между ними. Для этой подсети требуются маршрутизируемые IP-адреса, но она остается частной для решения за счет использования списков управления доступом (ACL). Она не поддерживает маршрутизацию за пределами пограничных коммутаторов, за исключением небольшого диапазона, эквивалентного размеру сети типа /27, используемого в некоторых службах, когда им нужен доступ к внешним ресурсам и (или) Интернету. 

### <a name="public-vip-network"></a>Открытая сеть VIP
Открытая сеть VIP назначается для сетевого контроллера в Azure Stack. Это не логическая сеть на коммутаторах. SLB использует пул адресов и назначает сети типа /32 для рабочих нагрузок клиента. В таблице маршрутизации коммутатора эти IP-адреса сети типа /32 объявляются как маршруты, доступные по протоколу BGP. Эта сеть содержит доступные внешние или открытые IP-адреса. Инфраструктура Azure Stack резервирует первый 31 адрес из этой открытой сети VIP, а остальные адреса используют виртуальные машины клиентов. Размер этой подсети может быть от /26 (64 узла) до /22 (1022 узла). Мы рекомендуем вам при планировании учесть сеть типа /24.

### <a name="switch-infrastructure-network"></a>Сеть инфраструктуры коммутаторов
Это подсеть типа /26, содержащая IP-подсети "точка-точка" типа /30 (2 IP-адреса узлов) с поддержкой маршрутизации, и подсети с замыканием на себя, представляющие выделенные подсети типа /32 для управления коммутаторами в основной сети и идентификатора маршрутизатора BGP. IP-адреса в этом диапазоне должны поддерживать внешнюю маршрутизацию из решения Azure Stack в центр обработки данных. Эти IP-адреса могут быть частными или общедоступными.

### <a name="switch-management-network"></a>Сеть управления коммутаторами
Эта сеть /29 (6 IP-адресов узлов) выделена для подключения портов управления коммутаторами. Она также предоставляет доступ по внештатному каналу для развертывания, управления и устранения неполадок. Она вычисляется на основе сети инфраструктуры коммутаторов, упомянутой выше.

## <a name="publish-azure-stack-services"></a>Публикация служб Azure Stack
Вам нужно будет сделать службы Azure Stack доступными пользователям извне Azure Stack. Azure Stack настраивает несколько разных конечных точек для ролей инфраструктуры. Этим конечным точкам назначаются виртуальные IP-адреса из пула общедоступных IP-адресов. Для каждой конечной точки создается DNS-запись во внешней зоне DNS, которая указана во время развертывания. Например, пользовательскому порталу назначается запись DNS-узла portal.*&lt;регион>.&lt;полное доменное имя>*.

### <a name="ports-and-urls"></a>URL-адреса и порты
Чтобы службы Azure Stack (такие как порталы, Azure Resource Manager, DNS и т. д.) были доступны для внешних сетей, необходимо разрешить входящий трафик к этим конечным точкам для определенных URL-адресов, портов и протоколов.
 
Если в вашем развертывании прозрачный прокси-сервер перенаправляет соединения к традиционному прокси-серверу, необходимо разрешить определенные порты и URL-адреса для [исходящего](azure-stack-integrate-endpoints.md#ports-and-protocols-inbound) и [входящего](azure-stack-integrate-endpoints.md#ports-and-urls-outbound) трафика. К ним относятся порты и URL-адреса для идентификации и marketplace, а также для исправления и обновления, регистрации и использования данных.

## <a name="next-steps"></a>Дополнительная информация
[Подключения к пограничной сети](azure-stack-border-connectivity.md)
