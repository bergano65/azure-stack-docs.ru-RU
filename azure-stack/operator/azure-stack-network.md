---
title: Планирование интеграции сети для Azure Stack Hub
description: Из этой статьи вы узнаете, как спланировать интеграцию сети центра обработки данных с интегрированными системами Azure Stack Hub.
author: IngridAtMicrosoft
ms.topic: conceptual
ms.date: 03/04/2020
ms.author: inhenkel
ms.reviewer: wamota
ms.lastreviewed: 06/04/2019
ms.openlocfilehash: 3c7a68376ddb57d9e7fad1f936c8990243203b9c
ms.sourcegitcommit: 20d10ace7844170ccf7570db52e30f0424f20164
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79295475"
---
# <a name="network-integration-planning-for-azure-stack"></a>Планирование интеграции сети для Azure Stack

В этой статье приводятся сведения об инфраструктуре сети Azure Stack, которые помогут решить, как лучше всего интегрировать Azure Stack с существующей сетевой средой. 

> [!NOTE]
> Чтобы разрешить внешние имена DNS из Azure Stack (например, www\.bing.com), необходимо предоставить DNS-серверы для переадресации DNS-запросов. Дополнительные сведения о требованиях к DNS Azure Stack см. в статье [Интеграция центра обработки данных Azure Stack — DNS](azure-stack-integrate-dns.md).

## <a name="physical-network-design"></a>Структура физической сети

Чтобы поддерживать выполнение операций и служб, решению Azure Stack требуется гибкая и высокодоступная физическая инфраструктура. Для интеграции Azure Stack с сетью нужны каналы исходящей связи между коммутаторами верхнего уровня (ToR) и ближайшим коммутатором или маршрутизатором (в этой документации он называется границей). Коммутаторы ToR можно соединить через каналы исходящей связи с одной или двумя границами. Коммутатор ToR предварительно настроен нашим средством автоматизации. Предполагается, что будет установлено как минимум одно подключение между ToR и границей при маршрутизации BGP и как минимум два подключения (по одному на ToR) между ToR и границей при статической маршрутизации. Для каждого варианта маршрутизации можно установить не более четырех подключений. Такие подключения ограничены носителями SFP+ или SFP28, а также скоростью в 1, 10 или 25 ГБ. Обратитесь к поставщику оборудования OEM, чтобы получить сведения о доступности. На следующей диаграмме представлена рекомендуемая архитектура:

![Рекомендуемая структура сети Azure Stack](media/azure-stack-network/physical-network.png)


## <a name="logical-networks"></a>Логические сети

Логические сети представляют собой абстракцию базовой инфраструктуры физической сети. Они используются, чтобы упорядочить и упростить назначение сетей для узлов, виртуальных машин и служб. При создании логической сети создаются и сайты сети. Они определяют виртуальные локальные сети, IP-подсети и пары из IP-подсетей и виртуальных локальных сетей, связанные с логической сетью в каждом физическом расположении.

В следующей таблице показаны логические сети и соответствующие диапазоны подсети IPv4, которые необходимо выбрать.

| Логические сети | Описание | Размер | 
| -------- | ------------- | ------------ | 
| Общедоступный виртуальный IP-адрес | Всего из этой сети в Azure Stack используется 31 адрес. Восемь общедоступных IP-адресов предназначены для небольшого набора служб Azure Stack, а остальные используются виртуальными машинами клиента. Если вы планируете использовать службу приложений и поставщики ресурсов SQL, потребуется еще 7 адресов. Оставшиеся 15 IP-адресов зарезервированы для будущих служб Azure. | /26 (62 узла) –/22 (1022 узла)<br><br>Рекомендуется —  /24 (254 узла) | 
| Инфраструктура коммутаторов | IP-адреса типа "точка —точка" для целей маршрутизации, выделенные интерфейсы управления коммутаторами и петлевые адреса, назначенные коммутатору. | /26 | 
| Инфраструктура | Используется для обмена данными между внутренними компонентами Azure Stack. | /24 |
| Private | Используется для сети хранения данных, частных виртуальных IP-адресов, контейнеров инфраструктуры и других внутренних функций. Начиная с версии 1910, размер для этой подсети изменен на /20. Дополнительные сведения см. в разделе этой статьи [Частная сеть](#private-network). | /20 | 
| Контроллер управления основной платой (BMC) | Используется для обмена данными с BMC на физических узлах. | /26 | 
| | | |

> [!NOTE]
> При обновлении системы до версии 1910 оповещение на портале будет напоминать оператору о необходимости выполнить новый командлет PEP **Set-AzsPrivateNetwork**, чтобы добавить новое пространство частных IP-адресов /20. Инструкции по выполнению командлета см. в [заметках о выпуске версии 1910](release-notes.md). Дополнительные сведения и рекомендации по выбору пространства частных IP-адресов /20 см. в разделе этой статьи [Частная сеть](#private-network).

## <a name="network-infrastructure"></a>Сетевая инфраструктура

Сетевая инфраструктура для Azure Stack состоит из нескольких логических сетей, которые настроены на коммутаторах. На следующей схеме показаны эти логические сети и их интеграция с коммутаторами верхнего уровня (TOR), контроллером управления основной платой (BMC) и граничным коммутатором (клиентская сеть).

![Логическая схема сети и подключения коммутаторов](media/azure-stack-network/NetworkDiagram.png)

### <a name="bmc-network"></a>Сеть BMC

Эта сеть предназначена для подключения всех контроллеров управления основной платой (также называются BMC или служебными процессорами) к сети управления. Например: iDRAC, iLO, iBMC и т. д. Для взаимодействия с любым узлом BMC используется только одна учетная запись BMC. Узел жизненного цикла оборудования (HLH) (при наличии) размещается в этой сети и может предоставлять предназначенное для изготовителей оборудования программное обеспечение для обслуживания или мониторинга оборудования.

Также в HLH размещена виртуальная машина для развертывания (DVM). DVM используется при развертывании Azure Stack и удаляется по завершении развертывания. Для DVM требуется доступ к Интернету в сценариях развертывания с подключением для тестирования, проверки и доступа к нескольким компонентам. Такие компоненты могут находиться в корпоративной сети и за ее пределами (например, NTP, DNS и Azure). Требования к подключению см. в [разделе о NAT статьи "Интеграция брандмауэра Azure Stack"](azure-stack-firewall.md#network-address-translation).

### <a name="private-network"></a>Частная сеть

Эта сеть типа /20 (4096 IP-адресов) является частной в регионе Azure Stack (не выполняет маршрутизацию на граничные коммутаторы за пределами системы Azure Stack) и делится на несколько подсетей. Ниже приведены некоторые примеры:

- **Сеть хранилища**. Сеть типа /25 (128 IP-адресов) поддерживает использование локальных дисковых пространств, передачу трафика по протоколу SMB и динамическую миграцию виртуальных машин.
- **Внутренняя виртуальная IP-сеть**. Сеть типа /25, предназначенная только для виртуальных IP-адресов для подсистемы балансировки нагрузки программного обеспечения (SLB).
- **Сеть контейнеров**. Сеть типа /23 (512 IP-адресов), предназначенная только для внутреннего трафика между контейнерами, на которых выполняются службы инфраструктуры.

Начиная с версии 1910, размер частной сети изменится на /20 (4096 IP-адресов) для пространства частных IP-адресов. Эта сеть будет частной для системы Azure Stack (не выполняет маршрутизацию на граничные коммутаторы за пределами системы Azure Stack) и может быть использована повторно на нескольких системах Azure Stack в центре обработки данных. Хотя сеть является частной для Azure Stack, она не должна пересекаться с другими сетями в центре обработки данных. Инструкции по пространству частных IP-адресов см. в [RFC 1918](https://tools.ietf.org/html/rfc1918).

Это пространство частных IP-адресов /20 будет разделено на несколько сетей. В будущих выпусках они позволят запускать внутреннюю инфраструктуру системы Azure Stack в контейнерах. Дополнительные сведения см. в [заметках о выпуске версии 1910](release-notes.md). Кроме того, новое пространство частных IP-адресов позволяет уменьшить требуемое пространство маршрутизируемых IP-адресов перед развертыванием.

Для систем, развернутых с версиями до 1910, эта подсеть /20 будет дополнительной сетью для ввода в системы после обновления до версии 1910. Дополнительную сеть потребуется предоставить системе с помощью командлета PEP **Set-AzsPrivateNetwork**. Рекомендации по этому командлету см. в [заметках о выпуске версии 1910](release-notes.md).

### <a name="azure-stack-infrastructure-network"></a>Сеть инфраструктуры Azure Stack
Эта сеть типа /24 предназначена для внутренних компонентов Azure Stack, чтобы обеспечить обмен данными между ними. Эта подсеть может быть маршрутизируемой извне решения Azure Stack к вашему центру данных. В этой подсети мы не рекомендуем использовать общедоступные или Интернет-маршрутизируемые IP-адреса. Эту сеть объявлено до границы, но большинство ее IP-адресов защищены Списками управления доступом (ACL). IP-адреса, разрешенные для доступа, находятся в небольшом диапазоне, эквивалентном по размеру сети /27 и службам размещения, таким как [привилегированная конечная точка (PEP)](azure-stack-privileged-endpoint.md) и [Azure Stack Backup](azure-stack-backup-reference.md).

### <a name="public-vip-network"></a>Открытая сеть VIP

Открытая сеть VIP назначается для сетевого контроллера в Azure Stack. Это не логическая сеть на коммутаторах. SLB использует пул адресов и назначает сети типа /32 для рабочих нагрузок клиента. В таблице маршрутизации коммутатора эти IP-адреса сети типа /32 объявляются как маршруты, доступные по протоколу BGP. Эта сеть содержит доступные внешние или открытые IP-адреса. Инфраструктура Azure Stack резервирует первый 31 адрес из этой открытой сети VIP, а остальные адреса используют виртуальные машины клиентов. Размер сети в этой подсети может варьироваться от минимум /26 (64 узла) до максимального значения /22 (1022 узла). Рекомендуется планировать сеть размера /24.

### <a name="switch-infrastructure-network"></a>Сеть инфраструктуры коммутаторов

Это подсеть типа /26, содержащая IP-подсети "точка-точка" типа /30 (2 IP-адреса узлов) с поддержкой маршрутизации, и подсети с замыканием на себя, представляющие выделенные подсети типа /32 для управления коммутаторами в основной сети и идентификатора маршрутизатора BGP. Этот диапазон IP-адресов должен маршрутизироваться за пределами решения Azure Stack до центра обработки данных. Это могут быть частные или общедоступные IP-адреса.

### <a name="switch-management-network"></a>Сеть управления коммутаторами

Эта сеть /29 (6 IP-адресов узлов) выделена для подключения портов управления коммутаторами. Она также предоставляет доступ по внештатному каналу для развертывания, управления и устранения неполадок. Она вычисляется на основе сети инфраструктуры коммутаторов, упомянутой выше.

## <a name="permitted-networks"></a>Разрешенные сети

Начиная с версии 1910, на листе развертывания появится новое поле. С его помощью оператор сможет изменить некоторые списки управления доступом (ACL), чтобы разрешить доступ к интерфейсам управления сетевыми устройствами и узлу жизненного цикла оборудования (HLH) из доверенного диапазона номеров сети центра обработки данных. С помощью изменения списка управления доступом оператор может разрешить виртуальным машинам управления Jumpbox в определенном диапазоне номеров сети доступ к интерфейсу управления коммутатором, а также ОС и BMC узла жизненного цикла оборудования (HLH). Оператор может ввести в этот список одну или несколько подсетей. Если оставить это поле пустым, по умолчанию подсетям будет отказано в доступе. Эта новая функция заменяет необходимость вмешательства вручную после развертывания, описанную в статье [Изменение определенных параметров в конфигурации коммутатора Azure Stack](https://docs.microsoft.com/azure-stack/operator/azure-stack-customer-defined#access-control-list-updates).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительная информация о планировании сети: [Пограничное подключение](azure-stack-border-connectivity.md).