---
title: Настройка телеметрии Azure Stack Hub
titleSuffix: Azure Stack
description: Сведения о телеметрии Azure Stack Hub и о том, как настроить параметры телеметрии с помощью PowerShell.
author: IngridAtMicrosoft
ms.topic: conceptual
ms.date: 1/16/2020
ms.author: inhenkel
ms.reviewer: comartin
ms.lastreviewed: 10/15/2018
ms.openlocfilehash: cc2a0a17c2bce21a46132dde503d0461430a6064
ms.sourcegitcommit: 97806b43314d306e0ddb15847c86be2c92ae001e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2020
ms.locfileid: "77509472"
---
# <a name="configure-azure-stack-hub-telemetry"></a>Настройка телеметрии Azure Stack Hub

Служба телеметрии Azure Stack Hub автоматически отправляет данные о системе в корпорацию Майкрософт, используя компонент "Функциональные возможности для подключенных пользователей". Сотрудники корпорации Майкрософт используют собранные данные телеметрии Azure Stack Hub для улучшения взаимодействия с клиентами. Также эти данные применяются для анализа безопасности, работоспособности, качества и производительности.

Благодаря телеметрии оператор Azure Stack Hub может получить ценную информацию о корпоративных развертываниях и возможность повлиять на развитие будущих версий Azure Stack Hub.

> [!NOTE]
> Вы также можете настроить в Azure Stack Hub автоматическую передачу в Azure информации о потреблении для выставления счетов. Это является обязательным для клиентов, использующих Azure Stack Hub с несколькими узлами, которые выбрали оплату по мере использования. Отчеты об использовании контролируются независимо от телеметрии и не требуются для клиентов, использующих несколько узлов и выбравших модель на основе емкости, или для пользователей Пакета средств разработки Azure Stack. В таких сценариях отчеты об использовании можно отключить [с помощью скрипта регистрации](azure-stack-usage-reporting.md).

Телеметрия Azure Stack Hub основана на компоненте "Функциональные возможности для подключенных пользователей и телеметрия" Windows Server 2016. Этот компонент использует технологию ведения журнала [трассировки событий Windows](https://msdn.microsoft.com/library/dn904632(v=vs.85).aspx) для сбора, а также хранения событий и данных. Компоненты Azure Stack используют одну и ту же технологию для публикации событий и данных, собранных с помощью общедоступных журналов событий операционной системы и API трассировки. Вот несколько примеров таких компонентов Azure Stack Hub: сетевой ресурс, ресурс хранилища, ресурс мониторинга и ресурс обновления. Компонент "Функциональные возможности для подключенных пользователей и телеметрия" шифрует данные с помощью SSL и использует закрепление сертификата для передачи данных по протоколу HTTPS в службу управления данными Майкрософт.

> [!IMPORTANT]
> Для передачи потока данных телеметрии в сети должен быть открыт порт 443 (HTTPS). Компонент "Функциональные возможности для подключенных пользователей и телеметрия" подключается к службе управления данными Майкрософт по адресу `https://v10.events.data.microsoft.com`. Компонент "Функциональные возможности для подключенных пользователей и телеметрия" также подключается к `https://settings-win.data.microsoft.com`, чтобы скачать информацию о конфигурации. Другие службы диагностических данных подключают `https://watson.telemetry.microsoft.com` для отчетов об ошибках.

## <a name="privacy-considerations"></a>Рекомендации по конфиденциальности

Служба трассировки событий Windows направляет данные телеметрии в защищенное облачное хранилище. Доступ к данным телеметрии предоставляется по принципу наименьших привилегий. Данные телеметрии доступны только тем сотрудникам Майкрософт, которым они нужны для выполнения бизнес-задач. Корпорация Майкрософт не передает личные данные клиентов третьим лицам, кроме как по указанию клиента или для ограниченных целей, описанных в [заявлении о конфиденциальности корпорации Майкрософт](https://privacy.microsoft.com/PrivacyStatement). Бизнес-отчеты, к которым есть доступ у изготовителей оборудования и партнеров, содержат только агрегированные и анонимизированные данные. Решения о предоставлении общего доступа к данным принимаются внутренней группой корпорации Майкрософт, включая решения о конфиденциальности и правах, а также заинтересованными лицами управления данными.

Корпорация Майкрософт исповедует принцип минимизации информации и придерживается его. Мы стараемся собирать только необходимую информацию и сохранять ее только до тех пор, пока она нужна для работы служб или для анализа. Большинство сведений о работе системы Azure Stack Hub и служб Azure удаляется в течение 6 месяцев. Сводные или объединенные данные будут храниться в течение более длительного периода.

Мы понимаем, что конфиденциальность и безопасность информации клиентов важна.  Корпорация Майкрософт применяет продуманный и комплексный подход к конфиденциальности и защите данных клиентов, собираемых в Azure Stack Hub. У ИТ-администраторов есть средства для настройки компонентов и параметров конфиденциальности в любое время. Наша приверженность прозрачности и доверию очевидна:

- мы не скрываем от клиентов типы данных, которые мы собираем;
- мы предоставляем корпоративным клиентам возможность управлять параметрами конфиденциальности;
- конфиденциальность и безопасность клиента — наш приоритет;
- мы не скрываем, как используются данные телеметрии;
- мы используем данные телеметрии для улучшения качества функциональных возможностей.

Корпорация Майкрософт не намерена собирать конфиденциальную информацию, например номера кредитных карт, имена пользователей и пароли, адреса электронной почты и т. п. Если мы обнаружим, что случайно получили конфиденциальную информацию, мы удалим ее.

## <a name="examples-of-how-microsoft-uses-the-telemetry-data"></a>Примеры использования телеметрии в корпорации Майкрософт

Телеметрия играет важную роль, помогая быстро выявлять и устранять критические проблемы с надежностью в развертываниях и конфигурациях клиентов. Анализ собираемых данных телеметрии помогает выявлять проблемы со службами или конфигурациями оборудования. Возможность корпорации Майкрософт получать эти данные от клиентов и вносить улучшения в экосистему помогает повысить качество работы интегрированных решений Azure Stack Hub.

Телеметрия также помогает Майкрософт лучше понять, как клиенты развертывают компоненты, а также используют возможности и службы для достижения своих бизнес-целей. Эти выводы помогают определить приоритетные области для технических изменений, которые могут напрямую влиять на условия работы клиентов и рабочие нагрузки.

Например, это относится к использованию клиентами контейнеров, хранилищ и сетевых конфигураций, связанных с ролями Azure Stack Hub. Мы также используем аналитику, чтобы оптимизировать решения для управления и мониторинга Azure Stack Hub, а также внедрения новых методов анализа. Эти улучшения помогают клиентам диагностировать проблемы и экономить деньги, реже обращаясь в службу поддержки Майкрософт.

## <a name="manage-telemetry-collection"></a>Управление коллекцией телеметрии

Мы не рекомендуем отключать телеметрию в вашей организации. Но в некоторых сценариях это может быть необходимо.

В таких случаях вы можете настроить уровень телеметрии, отправляемой в корпорацию Майкрософт, изменив параметры реестра перед развертыванием Azure Stack Hub или настроив конечные точки телеметрии после развертывания Azure Stack Hub.

### <a name="telemetry-levels-and-data-collection"></a>Уровни телеметрии и сбор данных

Прежде чем изменять настройки телеметрии, изучите доступные уровни телеметрии и собираемые на каждом из них данные.

Параметры телеметрии сгруппированы в четыре уровня (0–3), каждый из которых включает в себя все предыдущие, как описано далее.

**0 (безопасность)**</br>
Только данные безопасности. Сведения, необходимые для защиты операционной системы. Сюда относятся данные настройках компонента "Функциональные возможности для подключенных пользователей и телеметрии" и Защитника Windows. На этом уровне данные телеметрии для Azure Stack Hub не передаются.

**1 (базовый)**</br>
Данные безопасности, базовые данные работоспособности и качества. Базовая информация об устройстве, включая данные, связанные с качеством; совместимость приложений; данные об использовании приложения и данные уровня **Безопасность**. Настройка базового уровня телеметрии позволяет использовать телеметрию Azure Stack Hub. Данные, собранные на этом уровне, включают:

- *Базовую информацию об устройстве*, которая дает представление о типах и конфигурациях собственных и виртуализированных экземпляров Windows Server 2016, используемых в экосистеме. В том числе:

  - атрибуты компьютера, такие как OEM и модель;
  - атрибуты сети, такие как число сетевых адаптеров и скорость их работы;
  - атрибуты процессора и памяти, такие как число ядер и объем установленной памяти;
  - атрибуты хранилища, такие как число дисков, тип дисков и размер дисков.

- *Функциональные возможности телеметрии*, в том числе процент отправленных событий, удаленных событий и последнее время отправки данных.
- *Сведения, связанные с качеством*, позволяют накопить базовые представления о работе Azure Stack Hub. Например, число критических оповещений в конкретной конфигурации оборудования.
- *Данные о совместимости* помогают составить представление о том, какие поставщики ресурсов установлены в системе и на виртуальной машине. Это позволяет выявить потенциальные проблемы с совместимостью.

**2 (расширенный)**</br>
Дополнительные сведения, в том числе: как используется операционная система и службы Azure Stack Hub, насколько эффективно эти службы работают, расширенные данные о надежности и все данные уровней **Безопасность** и **Базовый**.

> [!NOTE]
> Это настройка для телеметрии по умолчанию.

**3 (полный)**</br>
Все данные, необходимые для определения и устранения проблем, а также данные с уровней **Безопасность**, **Базовый** и **Расширенный**.

> [!IMPORTANT]
> Эти уровни телеметрии применяются только к компонентам Microsoft Azure Stack Hub. Компоненты и службы стороннего программного обеспечения, которые выполняются в узле отслеживания жизненного цикла, предоставленным партнером по оборудованию Azure Stack Hub, могу взаимодействовать с облачными службами за пределами этих уровней телеметрии. Поставщик аппаратных решений Azure Stack Hub поможет вам разобраться в политике телеметрии и подскажет, как ее принять и (или) как отказаться от нее.

При отключении телеметрии Windows и телеметрии Azure Stack Hub автоматически отключается телеметрия SQL. Дополнительные сведения о последствиях настроек телеметрии Windows Server см. в [этом](https://aka.ms/winservtelemetry) техническом документе о телеметрии Windows.

### <a name="asdk-set-the-telemetry-level-in-the-windows-registry"></a>ASDK: настройка уровня телеметрии в реестре Windows

Редактор реестра Windows позволяет вручную установить уровень телеметрии на физическом компьютере узла перед развертыванием Azure Stack Hub. Если политика управления уже существует (например, групповая политика), она перезаписывает этот параметр реестра.

Прежде чем развертывать Azure Stack Hub на узле комплекта разработки, выполните загрузку в Cloudbuilder.vhdx и запустите следующий скрипт в окне PowerShell с повышенными привилегиями:

```powershell
### Get current AllowTelemetry value on DVM Host
(Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection" `
-Name AllowTelemetry).AllowTelemetry
### Set & Get updated AllowTelemetry value for ASDK-Host
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection" `
-Name "AllowTelemetry" -Value '0' # Set this value to 0,1,2,or3.  
(Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection" `
-Name AllowTelemetry).AllowTelemetry
```

### <a name="asdk-and-multi-node-enable-or-disable-telemetry-after-deployment"></a>ASDK и несколько узлов: включение и отключение телеметрии после развертывания

Чтобы включить или отключить телеметрию после развертывания, требуется доступ к привилегированной конечной точке (PEP), которая предоставляется на виртуальных машинах ERCS.

- Чтобы включить, выполните функцию `Set-Telemetry -Enable`.
- Чтобы отключить, выполните функцию `Set-Telemetry -Disable`.

Сведения о параметрах:
- `.PARAMETER Enable` — включает сбор данных телеметрии;
- `.PARAMETER Disable` — выключает сбор данных телеметрии.  

**Скрипт, позволяющий включить телеметрию:**

```powershell
$ip = "<IP ADDRESS OF THE PEP VM>" # You can also use the machine name instead of IP here.
$pwd= ConvertTo-SecureString "<CLOUD ADMIN PASSWORD>" -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential ("<DOMAIN NAME>\CloudAdmin", $pwd)
$psSession = New-PSSession -ComputerName $ip -ConfigurationName PrivilegedEndpoint -Credential $cred
Invoke-Command -Session $psSession {Set-Telemetry -Enable}
if($psSession)
{
    Remove-PSSession $psSession
}
```

**Скрипт, позволяющий отключить телеметрию:**

```powershell
$ip = "<IP ADDRESS OF THE PEP VM>" # You can also use the machine name instead of IP here.
$pwd= ConvertTo-SecureString "<CLOUD ADMIN PASSWORD>" -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential ("<DOMAIN NAME>\CloudAdmin", $pwd)
$psSession = New-PSSession -ComputerName $ip -ConfigurationName PrivilegedEndpoint -Credential $cred
Invoke-Command -Session $psSession {Set-Telemetry -Disable}
if($psSession)
{
    Remove-PSSession $psSession
}
```

## <a name="next-steps"></a>Дальнейшие действия

[Регистрация Azure Stack Hub в Azure](azure-stack-registration.md)