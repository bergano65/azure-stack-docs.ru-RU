---
title: Развертывание Службы приложений в Azure Stack Hub
description: Сведения о том, как развернуть Службу приложений в Azure Stack Hub.
author: mattbriggs
ms.topic: article
ms.date: 01/13/2020
ms.author: anwestg
ms.reviewer: anwestg
ms.lastreviewed: 01/13/2020
ms.openlocfilehash: 55d42471f56b17fe2016c7a7ac05f0b688773128
ms.sourcegitcommit: fd5d217d3a8adeec2f04b74d4728e709a4a95790
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76874864"
---
# <a name="deploy-app-service-in-azure-stack-hub"></a>Развертывание Службы приложений в Azure Stack Hub

В этой статье описано, как развернуть Службу приложений в Azure Stack Hub.

> [!IMPORTANT]
> Прежде чем развертывать Службу приложений Azure 1.8, примените обновление 1910 к интегрированной системе Azure Stack Hub или разверните последнюю версию Пакета средств разработки Azure Stack Hub (ASDK).

Вы можете предоставить пользователям возможность создавать веб-приложения и приложения API. Чтобы разрешить пользователям создавать эти приложения, сделайте следующее:

- Добавьте [поставщик ресурсов службы приложений](azure-stack-app-service-overview.md) к развертыванию Azure Stack Hub, следуя шагам, которые указаны в этой статье.
- Установив поставщик ресурсов службы приложений, можно включить его в свои предложения и планы. Затем пользователи смогут подписаться на службу и приступить к созданию приложений.

> [!IMPORTANT]
> Прежде чем запускать установщик поставщика ресурсов, обязательно выполните рекомендации по [началу работы](azure-stack-app-service-before-you-get-started.md) и ознакомьтесь с [заметками о выпуске 1.8](azure-stack-app-service-release-notes-update-eight.md). Это содержимое поможет вам узнать о новых функциях, исправлениях и любых известных проблемах, которые могут повлиять на развертывание.

## <a name="run-the-app-service-resource-provider-installer"></a>Запуск установщика поставщика ресурсов службы приложений

Установка поставщика ресурсов службы приложений занимает не менее часа. Необходимое время зависит от того, сколько экземпляров ролей нужно развернуть. Во время развертывания программа установки выполняет следующие задачи:

- создание контейнера больших двоичных объектов в указанной учетной записи хранения Azure Stack Hub;
- создание зоны DNS и записей для службы приложений;
- регистрацию поставщика ресурсов службы приложений;
- регистрацию элементов коллекции службы приложений.

Чтобы развернуть поставщик ресурсов службы приложений, выполните следующие действия:

1. Запустите файл AppService.exe от имени администратора на компьютере с доступом к конечной точке Azure Resource Manager для администратора в Azure Stack Hub.

2. Выберите **Развернуть службу приложений или провести обновление до последней версии**.

    ![Установщик службы приложений][1]

3. Просмотрите и примите условия лицензионного соглашения об использовании программного обеспечения Майкрософт, а затем выберите **Далее**.

4. Просмотрите и примите условия лицензии сторонних поставщиков и выберите **Далее**.

5. Убедитесь, что сведения о конфигурации облачной службы приложений верны. Если во время развертывания ASDK использовались настройки по умолчанию, вы можете сохранить значения по умолчанию. Но если при развертывании ASDK вы указали другие значения или выполняете развертывание в интегрированной системе Azure Stack Hub, в этом окне необходимо изменить значения соответствующим образом.

   Например, если используется суффикс домена mycloud.com, для конечной точки Azure Resource Manager клиента в Azure Stack Hub нужно указать значение management.&lt;регион&gt;.mycloud.com. Просмотрите параметры, а затем выберите **Далее** для их сохранения.

   ![Установщик службы приложений][2]

6. На следующей странице установщика Службы приложений вы установите подключение к Azure Stack Hub.

    1. Выберите предпочитаемый метод подключения — с помощью **учетных данных** или **субъекта-службы**.
 
        - **Учетные данные**
            - При использовании Azure Active Directory (Azure AD) введите учетную запись администратора Azure AD и пароль, указанный при развертывании Azure Stack Hub Выберите **Подключиться**.
            - Если вы используете службы федерации Active Directory (AD FS), предоставьте соответствующую учетную запись администратора. Например, cloudadmin@azurestack.local. Введите пароль и затем щелкните **Подключить**.

        - **Субъект-служба**
            - Используемый субъект-служба **должен** иметь права **владельца** в **подписке поставщика по умолчанию**.
            - Укажите значения для параметров **Идентификатор субъект-службы**, **Файл сертификата**, **Пароль** и щелкните **Подключить**.

    1. В разделе **Azure Stack Hub Subscriptions** (Подписки Azure Stack Hub) выберите **Default Provider Subscription** (Подписка поставщика по умолчанию).  Служба приложений Azure в Azure Stack Hub **должна** быть развернута в **подписке поставщика по умолчанию**.

    1. В поле **Azure Stack Hub Locations** (Расположения Azure Stack Hub) выберите расположение, соответствующее региону, в который выполняется развертывание. Например, для развертывания в ASDK выберите **локальное расположение**.

    ![Установщик службы приложений][3]

7. Теперь вы можете развернуть в существующую настроенную вами виртуальную сеть [используя эти шаги](azure-stack-app-service-before-you-get-started.md#virtual-network) или позволить установщику службы приложений создать новую виртуальную сеть и подсети. Чтобы создать виртуальную сеть, выполните следующие действия.

   а. Выберите **Create VNet with default settings** (создать виртуальную сеть с параметрами по умолчанию), примите параметры по умолчанию и выберите **Далее**.

   b. Можно также выбрать **Use existing VNet and Subnets** (Использовать имеющуюся виртуальную сеть и подсети). Выполните следующие действия.

     - Выберите **группу ресурсов**, которая содержит нужную виртуальную сеть.
     - Выберите имя **виртуальной сети**, в которую вы хотите провести развертывание.
     - Выберите правильные значения **подсети** для каждой из требуемых подсетей роли.
     - Выберите **Далее**.

   ![Установщик службы приложений][4]

8. Введите данные для общего файлового ресурса и щелкните **Далее**. В адресе файлового ресурса нужно указать полное доменное имя (FQDN) или IP-адрес файлового сервера. Например, \\\appservicefileserver.local.cloudapp.azurestack.external\websites или \\\10.0.0.1\websites.  Если вы используете присоединенный к домену файловый сервер, необходимо указать полное имя пользователя, включая домен. Например, myfileserverdomain\FileShareOwner.

   >[!NOTE]
   >Прежде чем продолжить, программа установки попытается проверить связь с общей папкой. Но если вы выполняете развертывание в существующей виртуальной сети, этот тест подключения может завершиться сбоем. Вам придет предупреждение и приглашение продолжить. Если информация об общей папке правильная, продолжайте развертывание.

   ![Установщик службы приложений][7]

9. На следующей странице установщика службы приложений выполните следующие действия.

   а. В поле **Identity Application ID** (Идентификатор приложения идентификации) введите GUID приложения, которое вы используете для идентификации (из Azure AD).

   b. В поле **Identity Application certificate file** (Файл сертификата приложения идентификации) введите расположение файла сертификата или перейдите к нему.

   c. В поле **Identity Application certificate password** (Пароль сертификата приложения идентификации) введите пароль для сертификата. Это пароль, который вы сохранили при выполнении скрипта для создания сертификатов.

   d. В поле **Azure Resource Manager root certificate file** (Файл корневого сертификата Azure Resource Manager) введите расположение файла сертификата или перейдите к нему.

   д) Выберите **Далее**.

   ![Установщик службы приложений][9]

10. В каждом из трех полей файла сертификата выберите **Обзор** и перейдите к нужному файлу сертификата. Необходимо указать пароль для каждого сертификата. Это те сертификаты, которые вы создали на шаге [создания требуемых сертификатов](azure-stack-app-service-before-you-get-started.md#get-certificates). Когда вы введете всю информацию, выберите **Далее**.

    | Box | Пример имени файла сертификата |
    | --- | --- |
    | **Файл SSL-сертификата по умолчанию для службы приложений** | \_.appservice.local.AzureStack.external.pfx |
    | **Файл SSL-сертификата API для службы приложений** | api.appservice.local.AzureStack.external.pfx |
    | **Файл SSL-сертификата издателя для службы приложений** | ftp.appservice.local.AzureStack.external.pfx |

    Если при создании сертификатов использовался другой суффикс домена, имена файлов сертификатов не будут содержать *local.AzureStack.external*. Вместо этого используйте сведения о личном домене.

    ![Установщик службы приложений][10]

11. Введите сведения об SQL Server для экземпляра сервера, используемого для размещения баз данных поставщика ресурсов Службы приложений, и щелкните **Далее**. Установщик проверит свойства подключения SQL.<br><br>Установщик Службы приложений попытается проверить связь с SQL Server, прежде чем продолжить. Если вы выполняете развертывание в имеющейся виртуальной сети, этот тест подключения может завершиться сбоем. Вам придет предупреждение и приглашение продолжить. Если сведения об SQL Server правильные, продолжайте развертывание.

    ![Установщик службы приложений][11]

12. Просмотрите параметры номера SKU и экземпляра роли. По умолчанию указываются минимальное число экземпляров и минимальный номер SKU для каждой роли в развертывании ASDK. Ниже приведена сводка требований к виртуальным ЦП и памяти, чтобы помочь вам спланировать развертывание. Выбрав необходимые значения, нажмите **Далее**.

    >[!NOTE]
    >Для развертываний в рабочей среде следуйте инструкциям из руководства [Планирование ресурсов для ролей сервера Службы приложений в Azure Stack Hub](azure-stack-app-service-capacity-planning.md).

    | Роль | Минимальное количество экземпляров | Минимальный номер SKU | Примечания |
    | --- | --- | --- | --- |
    | Контроллер | 1 | Standard_A2 (2 виртуальных ЦП, 3584 МБ) | Управляет состоянием работоспособности облачной службы приложений и поддерживает его. |
    | Управление | 1 | Standard_A2 (2 виртуальных ЦП, 3584 МБ) | Управляет конечными точками API и Azure Resource Manager для службы приложений и расширениями портала (порталы администратора, клиента и Функций), а также службой данных. Чтобы поддерживать отработку отказа, увеличьте число экземпляров до 2. |
    | Издатель | 1 | Standard_A1 (1 виртуальный ЦП, 1792 МБ) | Публикует содержимое через FTP и веб-развертывание. |
    | FrontEnd | 1 | Standard_A1 (1 виртуальный ЦП, 1792 МБ) | Направляет запросы в приложения Службы приложений. |
    | Общая рабочая роль | 1 | Standard_A1 (1 виртуальный ЦП, 1792 МБ) | Размещает веб-приложения или приложения API и приложения Функций Azure. Могут потребоваться дополнительные экземпляры. Оператор может по своему усмотрению сформировать предложение и выбрать любой уровень SKU. Уровни должны иметь как минимум один виртуальный ЦП. |

    ![Установщик службы приложений][13]

    >[!NOTE]
    >**Служба приложений Azure в Azure Stack Hub не поддерживает образ платформы Windows Server 2016 Core.  Не используйте образы пробной версии при развертывании в рабочей среде.**

13. В поле **Select Platform Image** (Выбор образа платформы) выберите развертываемый образ виртуальной машины Windows Server 2016 из доступных в поставщике вычислительных ресурсов для облачной Службы приложений. Выберите **Далее**.

14. На следующей странице установщика службы приложений выполните следующие действия.

     а. Введите имя пользователя и пароль администратора виртуальной машины с рабочей ролью.

     b. Введите имя пользователя и пароль администратора виртуальной машины с другими ролями.

     c. Выберите **Далее**.

    ![Установщик службы приложений][15]

15. На странице сводки установщика службы приложений выполните следующие действия.

    а. Проверьте выбранные параметры. Чтобы внести изменения, используйте кнопки **Назад** для перехода на предыдущие страницы.

    b. Если настройки указаны правильно, установите флажок.

    c. Чтобы начать развертывание, выберите **Далее**.

    ![Установщик службы приложений][16]

16. На следующей странице установщика службы приложений выполните следующие действия.

    а. Отслеживайте ход выполнения установки. Развертывание Службы приложений Azure в Azure Stack Hub может занять до 240 минут в зависимости от выбранных значений по умолчанию и возраста базового образа Центра обработки данных Windows 2016.

    b. После успешного завершения установки выберите **Выход**.

    ![Установщик службы приложений][17]

## <a name="post-deployment-steps"></a>Действия, выполняемые после развертывания

> [!IMPORTANT]
> Если вы указали план восстановления Службы приложений с помощью экземпляра SQL Always On, к группе доступности **нужно** [добавить базы данных appservice_hosting и appservice_metering](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/availability-group-add-a-database), а затем синхронизировать эти базы данных, чтобы работа службы не прерывалась в случае отработки отказа.

Если развертывание происходит в имеющуюся виртуальную сеть и используется внутренний IP-адрес для подключения к файловому серверу, необходимо добавить правило безопасности для исходящего трафика. Это правило разрешает SMB-трафик между рабочей подсетью и файловым сервером. На портале администрирования перейдите к группе безопасности сети WorkersNsg и добавьте правило безопасности для исходящего трафика со следующими свойствами:

- Источник: Любой
- Диапазон исходных портов: *.
- Назначение: IP-адреса
- Диапазон конечных IP-адресов: диапазон IP-адресов для файлового сервера
- Диапазон конечных портов: 445
- Протокол: TCP
- Действие: Allow
- Приоритет: 700
- Имя: Outbound_Allow_SMB445

## <a name="validate-the-app-service-on-azure-stack-hub-installation"></a>Проверка установки Службы приложений в Azure Stack Hub

1. На портале администрирования Azure Stack Hub выберите **Администрирование > Служба приложений**.

2. В общих сведениях в разделе **Состояние** должно отображаться **Все роли готовы**.

    ![Администрирование Службы приложений](media/azure-stack-app-service-deploy/image12.png)

## <a name="test-drive-app-service-on-azure-stack-hub"></a>Тестовая эксплуатация Службы приложений в Azure Stack Hub

После развертывания и регистрации поставщика ресурсов службы приложений проверьте его, чтобы убедиться в том, что пользователи могут развертывать веб-приложения и приложения API.

>[!NOTE]
>Необходимо создать предложение плана с пространством имен Microsoft.Web. Также вам потребуется подписка клиента, основанная на этом предложении. См. сведения о [создании предложения](azure-stack-create-offer.md) и [создании плана](azure-stack-create-plan.md).
>
>Для создания приложений, использующих Службу приложений в Azure Stack Hub, *нужна* подписка клиента. Задачи, которые администратор службы может выполнить на портале администратора, связаны с администрированием поставщика ресурсов Службы приложений. Сюда относятся добавление емкости, настройка источников развертывания и добавление уровней рабочей роли и номеров SKU.
>
>Для создания веб-приложения, приложения API и приложения службы "Функции Azure" потребуется пользовательский портал и подписка клиента.
>

Чтобы создать тестовое веб-приложение, выполните следующие действия.

1. На портале Azure Stack Hub последовательно выберите **+Создать ресурс** > **Интернет и мобильные устройства** > **Веб-приложение**.

2. В разделе **Веб-приложение**, введите имя в поле **Веб-приложение**.

3. В разделе **Группа ресурсов** выберите **Создать**. Введите имя для **Группы ресурсов**.

4. Выберите **Расположение или план службы приложений** > **Создать**.

5. В разделе **План служб приложений** введите имя **плана службы приложений**.

6. Выберите **Ценовая категория** > **Free-Shared** (бесплатный — общий) или **Shared-Shared** (общий — общий) > **Выбрать** > **OK** > **Создать**.

7. На панели инструментов появится плитка нового веб-приложения. Выберите плитку.

8. В **Веб-приложении** выберите **Обзор**, чтобы просмотреть веб-сайт по умолчанию для этого приложения.

## <a name="deploy-a-wordpress-dnn-or-django-website-optional"></a>Развертывание веб-сайта WordPress, DNN или Django (необязательно)

1. На пользовательском портале Azure Stack Hub выберите **+** , перейдите к Azure Marketplace, разверните веб-сайт Django и дождитесь завершения развертывания. Веб-платформа Django использует базу данных на основе файловой системы. Дополнительные поставщики ресурсов, такие как SQL или MySQL, не требуются.

2. Если вы уже развернули поставщик ресурсов MySQL, можно развернуть из Marketplace веб-сайт WordPress. Когда появится запрос на ввод параметров базы данных, введите имя пользователя в формате *Пользователь1\@Сервер1*, указав имя пользователя и имя сервера по своему усмотрению.

3. Если вы уже развернули поставщик ресурсов SQL Server, можно развернуть из Marketplace веб-сайт DNN. Когда появится запрос на ввод параметров базы данных, выберите базу данных на компьютере, где работает подключенный к поставщику ресурсов SQL Server.

## <a name="next-steps"></a>Дальнейшие действия

Подготовьтесь к операциям администрирования для Службы приложений в Azure Stack Hub:

- [планирование ресурсов](azure-stack-app-service-capacity-planning.md);
- [настройка источников развертывания](azure-stack-app-service-configure-deployment-sources.md).

<!--Image references-->
[1]: ./media/azure-stack-app-service-deploy/app-service-installer.png
[2]: ./media/azure-stack-app-service-deploy/app-service-azure-stack-arm-endpoints.png
[3]: ./media/azure-stack-app-service-deploy/app-service-azure-stack-subscription-information.png
[4]: ./media/azure-stack-app-service-deploy/app-service-default-VNET-config.png
[5]: ./media/azure-stack-app-service-deploy/app-service-custom-VNET-config.png
[6]: ./media/azure-stack-app-service-deploy/app-service-custom-VNET-config-with-values.png
[7]: ./media/azure-stack-app-service-deploy/app-service-fileshare-configuration.png
[8]: ./media/azure-stack-app-service-deploy/app-service-fileshare-configuration-error.png
[9]: ./media/azure-stack-app-service-deploy/app-service-identity-app.png
[10]: ./media/azure-stack-app-service-deploy/app-service-certificates.png
[11]: ./media/azure-stack-app-service-deploy/app-service-sql-configuration.png
[12]: ./media/azure-stack-app-service-deploy/app-service-sql-configuration-error.png
[13]: ./media/azure-stack-app-service-deploy/app-service-cloud-quantities.png
[14]: ./media/azure-stack-app-service-deploy/app-service-windows-image-selection.png
[15]: ./media/azure-stack-app-service-deploy/app-service-role-credentials.png
[16]: ./media/azure-stack-app-service-deploy/app-service-azure-stack-deployment-summary.png
[17]: ./media/azure-stack-app-service-deploy/app-service-deployment-progress.png
