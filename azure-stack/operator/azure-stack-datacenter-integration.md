---
title: Общие рекомендации по интеграции центра обработки данных для интегрированных систем Azure Stack | Документация Майкрософт
description: Узнайте, как запланировать и подготовить интеграцию центра обработки данных с системой Azure Stack с несколькими узлами.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/23/2019
ms.author: mabrigg
ms.reviewer: wfayed
ms.lastreviewed: 09/12/2018
ms.openlocfilehash: 07191c95ede4f9a3ce80117bfeca9b5a02cfc0b1
ms.sourcegitcommit: b95983e6e954e772ca5267304cfe6a0dab1cfcab
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2019
ms.locfileid: "68417368"
---
# <a name="datacenter-integration-considerations-for-azure-stack-integrated-systems"></a>Рекомендации по интеграции центра обработки данных для интегрированных систем Azure Stack

Если вы заинтересованы в интегрированной системе Azure Stack, ознакомьтесь с основными рекомендациями по планированию развертывания и внедрению системы в центр обработки данных. В этой статье приводится общий обзор таких рекомендаций, которые помогут при принятии важных решений об инфраструктуре для системы Azure Stack с нескольким узлами. Понимание этих рекомендаций поможет при работе с поставщиком оборудования OEM, так как он будет развертывать Azure Stack в вашем центре обработки данных.  

> [!NOTE]  
> Системы Azure Stack с несколькими узлами можно приобрести только у уполномоченных поставщиков оборудования. 

Для развертывания Azure Stack необходимо предоставить информацию о планировании поставщику решений перед началом развертывания, чтобы процесс прошел быстро и беспрепятственно. Необходимая информация включает сведения о сети, безопасности и удостоверениях, а также важные решения, для принятия которых требуются знания из разных сфер. Таким образом, возможно, вам потребуется привлечь сотрудников из разных команд в организации, чтобы получить всю необходимую информацию перед началом развертывания. Вы можете обратиться к поставщику оборудования при сборе этой информации. Возможно, он сможет дать вам совет, который будет полезным при принятии решений.

В процессе поиска и сбора необходимой информации, возможно, потребуется внести некоторые изменения в сетевую среду перед развертыванием. Это может включать резервирование диапазона IP-адресов для решения Azure Stack, настройку маршрутизаторов, коммутаторов и брандмауэров, чтобы подготовиться к подключению к новым коммутаторам решения Azure Stack. Найдите специалиста в этой области, готового помочь вам в планировании.

## <a name="capacity-planning-considerations"></a>Рекомендации относительно планирования ресурсов
При оценке решения Azure Stack для приобретения необходимо выбрать конфигурацию оборудования, которая непосредственно влияет на общую емкость решения Azure Stack. Можно выбирать среди классических вариантов ЦП, плотности памяти, конфигурации хранилища и общего масштаба решения (например, число серверов). В отличие от традиционных решений виртуализации, простой подсчет этих компонентов для определения емкости не сработает. Первая причина — решение Azure Stack спроектировано для размещения компонентов инфраструктуры и управления в пределах всего решения. Вторая причина — часть ресурсов решений резервируется для поддержки устойчивости. Устойчивость — это обновление программного обеспечения, при котором перерыв в рабочих нагрузках клиентов сводится к минимуму. 

[Лист планировщика ресурсов Azure Stack](https://aka.ms/azstackcapacityplanner), который помогает принимать обоснованные решения, относительно планирования емкости предлагает два подхода. Первый: вы выбираете предложение оборудования и пытаетесь подстроиться под комбинацию ресурсов. Второй: вы определяете рабочую нагрузку, которая будет выполняться в Azure Stack, и выбираете доступные номера SKU оборудования, которые могут поддерживать ее. Кроме того, лист является руководством, которое помогает принимать решения, связанные с планированием и конфигурацией Azure Stack. 

Этот лист не должен заменять ваши собственные наблюдения и анализ.  Корпорация Майкрософт не дает никаких представлений, явных или подразумеваемых гарантий в отношении информации, которую содержит лист.



## <a name="management-considerations"></a>Рекомендации по управлению
Azure Stack является закрытой системой, в которой инфраструктура заблокирована как с точки зрения разрешений, так и с точки зрения сети. Для блокировки всего несанкционированного входящего трафика и всей ненужной связи между компонентами инфраструктуры применяются списки управления доступом к сети (ACL). Это затрудняет несанкционированный доступ к системе.

Администратору не предоставляется неограниченный доступ к инфраструктуре для ежедневного управления и совершения операций. Операторы Azure Stack должны управлять системой через портал администратора или через Azure Resource Manager (с помощью PowerShell или REST API). К системе нельзя получить доступ с помощью других средств управления, таких как диспетчер Hyper-V или диспетчер отказоустойчивости кластеров. Чтобы защитить систему, сторонние программы (например, агенты) не могут быть установлены внутри компонентов инфраструктуры Azure Stack. Взаимодействие с внешним программным обеспечением управления и безопасности происходит с помощью PowerShell или REST API.

Когда требуется более высокий уровень доступа для устранения неполадок, которые не удается исправить, управляя оповещениями, обратитесь в службу поддержки Майкрософт. Служба поддержки может временно предоставить полный доступ администратора к системе для выполнения более сложных операций. 

## <a name="identity-considerations"></a>Вопросы относительно удостоверений

### <a name="choose-identity-provider"></a>Выбор поставщика удостоверений
Необходимо решить, какого поставщика удостоверений вы хотите использовать для развертывания Azure Stack: Azure AD или AD FS. Поставщики удостоверений нельзя изменить после развертывания без повторного развертывания всей системы. Если у вас нет учетной записи Azure AD (вы используете учетную запись, предоставленную поставщиком облачных служб) и вы решили сменить поставщик и использовать другую учетную запись Azure AD, то вам необходимо будет обратиться к поставщику решения, чтобы повторно развернуть решение за ваш счет.

Выбор поставщика удостоверений данных не имеет отношения к виртуальным машинам клиента, системе идентификации и учетным записям, которые они используют, возможности их подключения к домену Active Directory и т. д. Это отдельные аспекты.

Дополнительные сведения о выборе поставщика удостоверений см. в статье о [планировании развертываний для интегрированных систем Azure Stack](./azure-stack-connection-models.md).

### <a name="ad-fs-and-graph-integration"></a>Интеграция AD FS и Graph
Если требуется выполнить развертывание Azure Stack с использованием AD FS в качестве поставщика удостоверений, вы должны интегрировать экземпляр AD FS в Azure Stack с существующим экземпляром AD FS с помощью доверия федерации. Это позволяет удостоверениям в существующем лесу Active Directory проходить проверку в ресурсах Azure Stack.

Можно также интегрировать службу Graph в Azure Stack с существующей службой Active Directory. Это позволяет управлять доступом на основе ролей (RBAC) в Azure Stack. При делегировании доступа к ресурсу компонент Graph ищет учетную запись пользователя в существующем лесу Active Directory, используя протокол LDAP.

На схеме ниже показан поток трафика при интеграции AD FS и Graph.
![Схема, отображающая поток трафика AD FS и Graph](media/azure-stack-datacenter-integration/ADFSIntegration.PNG)

## <a name="licensing-model"></a>Модель лицензирования
Необходимо решить, какую модель лицензирования использовать. Доступность параметров зависит от того, подключен ли к Интернету развертываемый экземпляр Azure Stack.
- Для [подключенных развертываний](azure-stack-connected-deployment.md) можно выбрать лицензирование с оплатой по мере использования или на основе емкости. Модель оплаты по мере использования требует соединения с Azure для уведомления об использовании, которое затем оплачивается через коммерческое предложение Azure. 
- При [развертывании без подключения](azure-stack-disconnected-deployment.md) к Интернету поддерживается только лицензирование на основе емкости. 

Дополнительные сведения о модели лицензирования см. [на странице с информацией о пакетах и ценах Microsoft Azure Stack](https://azure.microsoft.com/mediahandler/files/resourcefiles/5bc3f30c-cd57-4513-989e-056325eb95e1/Azure-Stack-packaging-and-pricing-datasheet.pdf).


## <a name="naming-decisions"></a>Решения именования

Вам нужно подумать о том, какое пространство имен вы будете использовать в Azure Stack, особенно имя региона и имя внешнего домена. Внешнее полное доменное имя развертывания Azure Stack для общедоступных конечных точек представляет собой комбинацию этих двух имен, &lt;*регион*&gt;&lt;*полное_доменное_имя*&gt;. Например, *east.cloud.fabrikam.com*. В этом примере порталы Azure Stack будут находиться по следующим URL-адресам:

- https://portal.east.cloud.fabrikam.com
- https://adminportal.east.cloud.fabrikam.com

> [!IMPORTANT]
> Имя региона, выбранное для развертывания Azure Stack, должно быть уникальным. Оно будет отображаться в адресах на портале. 

В следующей таблице перечислены эти решения именования домена.

| ИМЯ | ОПИСАНИЕ | 
| -------- | ------------- | 
|Имя региона | Имя первого региона, где размещается Azure Stack. Это имя используется как часть полного доменного имени для общедоступных виртуальных IP-адресов, которыми управляет Azure Stack. Как правило, имя региона будет идентификатором физического расположения, например расположения центра обработки данных.<br><br>Имя региона должно содержать только буквы и числа от 0 до 9. Специальные символы, например "-" или "#" — запрещены.| 
| Имя внешнего домена | Имя зоны службы доменных имен (DNS) для конечных точек с внешними виртуальными IP-адресами. Используется в FQDN для этих общедоступных виртуальных IP-адресов. | 
| Имя (внутреннего) частного домена | Имя домена (и внутренней зоны DNS), созданного в Azure Stack для управления инфраструктурой. 
| | |

## <a name="certificate-requirements"></a>Требования к сертификатам

Для развертывания необходимо предоставить сертификаты SSL для общедоступных конечных точек. На высоком уровне к сертификатам существуют следующие требования:

- Вы можете использовать один групповой сертификат или набор выделенных сертификатов и использовать групповые сертификаты только для конечных точек, таких как хранилище и хранилище ключей.
- Сертификаты могут быть выданы общедоступным доверенным центром сертификации (ЦС) или ЦС, управляемым клиентом.

Дополнительные сведения о том, какие PKI-сертификаты требуются для развертывания Azure Stack и как их получить, см. в статье [Требования к сертификатам инфраструктуры открытых ключей Azure Stack](azure-stack-pki-certs.md).  


> [!IMPORTANT]
> Приведенную информацию о PKI-сертификатах следует рассматривать как общие рекомендации. Прежде чем приобретать какие-либо PKI-сертификаты для Azure Stack, обратитесь к вашему поставщику оборудования OEM. Он предоставит более подробные требования и инструкции по выбору сертификатов.


## <a name="time-synchronization"></a>Синхронизация времени
Вам нужно выбрать определенный сервер времени, который будет использоваться для синхронизации Azure Stack.  Синхронизация времени очень важна для инфраструктуры Azure Stack и ее ролей. Она требуется для создания билетов Kerberos, которые используются для аутентификации между внутренними службами.

Необходимо указать IP-адрес для сервера синхронизации времени. Хотя большинство компонентов в инфраструктуре могут разрешать URL-адреса, некоторые поддерживают только IP-адреса. Если вы выбрали вариант развертывания без подключения, вам потребуется указать сервер времени в корпоративной сети, к которой гарантированно можно получить доступ из сети инфраструктуры в Azure Stack.

## <a name="connect-azure-stack-to-azure"></a>Подключение Azure Stack к Azure

Для гибридных облачных сценариев вам нужно будет спланировать, как вы хотите подключить Azure Stack к Azure. Виртуальные сети в Azure Stack можно подключить к виртуальным сетям в Azure двумя способами: 
- **Подключение типа "сеть — сеть"** . VPN-подключение по протоколу IPsec (протоколы IKE v1 и IKE v2). Для этого типа подключения требуется VPN-устройство или служба маршрутизации и удаленного доступа (RRAS). Дополнительные сведения о VPN-шлюзах в Azure см. в [этой статье](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways). Связь через этот туннель шифруется и защищена. Тем не менее пропускная способность ограничена максимальной пропускной способностью туннеля (100–200 Мбит/с).
- **NAT для исходящего трафика**. По умолчанию все виртуальные машины в Azure Stack будут подключаться к внешним сетям через NAT для исходящего трафика. Каждой виртуальной сети, созданной в Azure Stack, назначается общедоступный IP-адрес. Независимо от того, назначен ли виртуальной машине общедоступный IP-адрес или находится ли она за балансировщиком нагрузки с общедоступным IP-адресом, она будет иметь исходящий доступ через NAT для исходящего трафика, используя виртуальный IP-адрес виртуальной сети. Это работает только для связи, которая инициируется виртуальной машиной и предназначена для внешних сетей (Интернет или интрасеть). Это нельзя использовать для взаимодействия с виртуальной машиной извне.

### <a name="hybrid-connectivity-options"></a>Гибридные варианты подключений

Для гибридного подключения важно рассмотреть, какое развертывание вы хотите предложить и где оно будет развернуто. Необходимо определить, нужна ли изоляция сетевого трафика для каждого клиента и тип связи с развертывании (в интрасети или Интернете).

- **Azure Stack с одним клиентом**. Развертывание Azure Stack, которое с точки зрения сети выглядит, как будто это — один клиент. Существует много подписок клиентов, но, как и любая служба интрасети, весь трафик проходит по тем же сетям. Сетевой трафик из одной подписки перемещается по тому же сетевому подключению, что и другая подписка, и его не нужно изолировать через зашифрованный туннель.

- **Azure Stack с несколькими клиентами**. Развертывание Azure Stack, в котором трафик подписки каждого клиента, привязанный к сетям, являющимися внешними для Azure Stack, должен быть изолирован от сетевого трафика других клиентов.
 
- **Развертывание в интрасети**. Развертывание Azure Stack, которое находится в корпоративной интрасети, обычно на частном IP-адресе и за одним или несколькими брандмауэрами. Общедоступные IP-адреса не являются общедоступными, так как они не могут быть перенаправлены непосредственно через Интернет.

- **Развертывание в Интернете**. Развертывание Azure Stack, подключенное к общедоступному Интернету и использующее общедоступные IP-адреса для диапазона общедоступных виртуальных IP-адресов. Развертывание по-прежнему может находиться за брандмауэром, но диапазон общедоступных виртуальных IP-адресов напрямую доступен из общедоступного Интернета и Azure.
 
В следующей таблице приведены гибридные сценарии подключения, их преимущества, недостатки и варианты использования.

| Сценарий | Метод подключения | Преимущества | Недостатки | Подходит для |
| -- | -- | --| -- | --|
| Azure Stack с одним клиентом, развертывание в интрасети | NAT для исходящего трафика | Улучшенная пропускная способность для быстрой передачи. Простая реализация, шлюзы не требуются. | Трафик не шифруется, без изоляции или шифрования за пределами стека. | Корпоративные развертывания, где всем клиентам одинаково доверяют.<br><br>Для организаций, использующих канал Azure ExpressRoute для взаимодействия с Azure. |
| Azure Stack с несколькими клиентами, развертывание в интрасети | VPN "сайт — сайт" | Трафик от виртуальной сети клиента к сети назначения является безопасным. | Пропускная способность ограничена VPN-туннелем типа "сеть — сеть".<br><br>Требуется шлюз в виртуальной сети и VPN-устройство в сети назначения. | Корпоративные развертывания, где часть трафика клиента должна быть защищена от других клиентов. |
| Azure Stack с одним клиентом, развертывание в Интернете | NAT для исходящего трафика | Улучшенная пропускная способность для быстрой передачи. | Трафик не шифруется, без изоляции или шифрования за пределами стека. | Сценарии размещения, где клиент получает свое собственное развертывание Azure Stack и выделенный канал к среде Azure Stack. Например, ExpressRoute и MPLS.
| Azure Stack с несколькими клиентами, развертывание в Интернете | VPN "сайт — сайт" | Трафик от виртуальной сети клиента к сети назначения является безопасным. | Пропускная способность ограничена VPN-туннелем типа "сеть — сеть".<br><br>Требуется шлюз в виртуальной сети и VPN-устройство в сети назначения. | Сценарии размещения, в которых поставщик хочет предложить мультитенантное облако, где клиенты не доверяют друг другу и трафик должен быть зашифрован.
|  |  |  |  |  |

### <a name="using-expressroute"></a>Использование ExpressRoute

Вы можете подключить Azure Stack к Azure через [ExpressRoute](https://docs.microsoft.com/azure/expressroute/expressroute-introduction) для интрасети с одним клиентом и мультитенантных сценариев. Вам понадобится канал ExpressRoute, подготовленный через [поставщика услуг подключения](https://docs.microsoft.com/azure/expressroute/expressroute-locations).

На следующей схеме показано подключение с помощью ExpressRoute для сценария с одним клиентом (где Customer's connection (подключение клиента) — это канал ExpressRoute).

![Схема сценария ExpressRoute с одним клиентом](media/azure-stack-datacenter-integration/ExpressRouteSingleTenant.PNG)

На следующей схеме показано подключение ExpressRoute для мультитенантного сценария.

![Схема мультитенантного сценария с ExpressRoute](media/azure-stack-datacenter-integration/ExpressRouteMultiTenant.PNG)

## <a name="external-monitoring"></a>Внешний мониторинг
Чтобы получить единое представление обо всех оповещениях устройств и развертывания Azure Stack, а также интегрировать оповещения в существующие рабочие процессы управления ИТ-службами для отправки запросов, вы можете [интегрировать Azure Stack с внешними решениями мониторинга центров обработки данных](azure-stack-integrate-monitor.md).

Вместе с решением Azure Stack поставляется узел жизненного цикла аппаратного обеспечения. Это компьютер за пределами Azure Stack, который использует предоставленные поставщиком OEM средства для управления оборудованием. Вы можете использовать эти средства или другие решения, которые непосредственно интегрируются с существующими решениями мониторинга в вашем центре обработки данных.

В следующей таблице перечислены доступные на данный момент решения.

| Область | Внешнее решение для мониторинга |
| -- | -- |
| Программное обеспечение Azure Stack | [Пакет управления Azure Stack для Operations Manager](https://azure.microsoft.com/blog/management-pack-for-microsoft-azure-stack-now-available/)<br>[Подключаемый модуль Nagios](https://exchange.nagios.org/directory/Plugins/Cloud/Monitoring-AzureStack-Alerts/details)<br>Вызовы API на основе REST | 
| Физические серверы (BMC через IPMI) | Оборудование OEM — пакет управления поставщика Operations Manager<br>Предоставленное поставщиком оборудования OEM решение<br>Подключаемые модули Nagios поставщика оборудования<br>Решение для мониторинга, поддерживаемое партнером OEM (включено) | 
| Сетевые устройства (SNMP) | Обнаружение сетевых устройств Оperations Manager<br>Предоставленное поставщиком оборудования OEM решение<br>Подключаемый модуль коммутатора Nagios |
| Мониторинг работоспособности подписки клиента | [Пакет управления System Center для Windows Azure](https://www.microsoft.com/download/details.aspx?id=50013) | 
|  |  | 

Обратите внимание на следующие требования:
- Используемое решение должно быть без агента. Нельзя устанавливать сторонние агенты внутри компонентов Azure Stack. 
- Если вы хотите использовать System Center Operations Manager, вам потребуется Operations Manager 2012 R2 или Operations Manager 2016.

## <a name="backup-and-disaster-recovery"></a>Резервное копирование и аварийное восстановление

Планирование резервного копирования и аварийного восстановления включает в себя планирование как для базовой инфраструктуры Azure Stack, в которой размещаются виртуальные машины IaaS и службы PaaS, так и для приложений и данных клиента. Необходимо учесть их отдельно.

### <a name="protect-infrastructure-components"></a>Защита компонентов инфраструктуры

Можно [создавать резервные копии компонентов инфраструктуры Azure Stack](azure-stack-backup-back-up-azure-stack.md) в указанном общем ресурсе SMB.

- Вам потребуется внешний общий файловый ресурс SMB на существующем файловом сервере Windows или стороннем устройстве.
- Следует использовать этот же общий ресурс для резервного копирования сетевых коммутаторов и узла жизненного цикла оборудования. Ваш поставщик оборудования OEM предоставит рекомендации по резервному копированию и восстановлению компонентов, так как они являются внешними для Azure Stack. Вы отвечаете за выполнение рабочих процессов резервного копирования в соответствии с рекомендациями поставщика OEM.

Если происходит неустранимая потеря данных, вы можете использовать резервную копию инфраструктуры для повторной установки данных развертывания, таких как входные данные развертывания и идентификаторы, учетные записи служб, корневой сертификат ЦС, федеративные ресурсы (в развертываниях без подключения), планы, предложения, подписки, квоты, политика RBAC, назначения ролей и секреты хранилища ключей.
 
### <a name="protect-tenant-applications-on-iaas-virtual-machines"></a>Защита приложений клиента на виртуальных машинах IaaS

Azure Stack не создает резервную копию приложений и данных клиента. Необходимо предусмотреть резервное копирование и аварийное восстановление в среду вне Azure Stack. Защита клиента — это действие на основе клиента. Для виртуальных машин IaaS клиенты могут использовать гостевые технологии для защиты папок файлов, данных приложений и состояния системы. Однако как организация или поставщик услуг вы можете предложить решение для резервного копирования и восстановления в том же центре обработки данных или извне в облаке.

Чтобы создать резервную копию виртуальных машин IaaS Linux или Windows, необходимо использовать решения резервного копирования с доступом к гостевой операционной системе для защиты файлов, папок, состояния операционной системы и данных приложений. Вы можете использовать Azure Backup, System Center Data Center Protection Manager или поддерживаемые продукты сторонних производителей.

Для репликации данных во вторичное расположение и оркестрации отработки отказа приложений в случае сбоя можно использовать Azure Site Recovery или поддерживаемые продукты сторонних производителей. Кроме того, приложения, поддерживающие встроенную репликацию, например Microsoft SQL Server, могут реплицировать данные в другое расположение, где выполняется приложение.

## <a name="learn-more"></a>Подробнее

- Дополнительные сведения об использовании, покупке, партнерах и поставщиках оборудования OEM см. на странице продукта [Azure Stack](https://azure.microsoft.com/overview/azure-stack/).
- Сведения о стратегии развития и географической доступности интегрированных систем Azure Stack см. в технической документации [Azure Stack: An extension of Azure](https://azure.microsoft.com/resources/azure-stack-an-extension-of-azure/) (Azure Stack: расширение Azure). 

## <a name="next-steps"></a>Дополнительная информация
[Модели подключения для развертывания Azure Stack](azure-stack-connection-models.md)
