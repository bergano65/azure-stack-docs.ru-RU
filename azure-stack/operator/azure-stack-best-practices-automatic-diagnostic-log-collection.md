---
title: Рекомендации по автоматическому сбору журналов Azure Stack | Документация Майкрософт
description: Рекомендации по автоматическому сбору журналов в разделе "Справка и поддержка" в Azure Stack.
services: azure-stack
documentationcenter: ''
author: justinha
manager: femila
editor: ''
ms.assetid: a20bea32-3705-45e8-9168-f198cfac51af
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/25/2019
ms.author: justinha
ms.reviewer: prchint
ms.lastreviewed: 07/25/2019
ms.openlocfilehash: 03fb0550bfaa41a3336ff17dd1c44e03bcea1402
ms.sourcegitcommit: b752f4e6733d9ebe56dbd171a14528dcb9a693fd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2019
ms.locfileid: "68522047"
---
# <a name="best-practices-for-automatic-azure-stack-log-collection"></a>Рекомендации по автоматическому сбору журналов Azure Stack 

*Область применения: интегрированные системы Azure Stack*


В этом разделе приводятся рекомендации по управлению автоматическим сбором журналов диагностики для Azure Stack. 

## <a name="collecting-logs-from-multiple-azure-stack-systems"></a>Сбор журналов из нескольких систем Azure Stack

Настройте один контейнер больших двоичных объектов для каждой единицы масштабирования Azure Stack, из которой вы хотите получать журналы. Дополнительные сведения о том, как настроить контейнер больших двоичных объектов, см. в разделе [Настройка автоматического сбора журналов диагностики Azure Stack](azure-stack-configure-automatic-diagnostic-log-collection.md). Рекомендуется сохранять в одном контейнере больших двоичных объектов только журналы диагностики из одной единицы масштабирования Azure Stack. 

## <a name="retention-policy"></a>Политика хранения

Создайте [правило управления жизненным циклом](https://docs.microsoft.com/azure/storage/blobs/storage-lifecycle-management-concepts) хранилища BLOB-объектов Azure для управления политикой хранения журналов. Рекомендуется хранить журналы диагностики в течение 30 дней. Чтобы создать правило управления жизненным циклом в службе хранилища Azure, войдите на портал Azure, щелкните **Учетные записи хранения**, щелкните контейнер больших двоичных объектов, а затем в разделе **Служба BLOB-объектов** щелкните **Управление жизненным циклом**.

![Снимок экрана, показывающий управление жизненным циклом на портале Azure](media/azure-stack-automatic-log-collection/blob-storage-lifecycle-management.png)


## <a name="sas-token-expiration"></a>Срок действия маркера SAS

Задайте срок действия подписанного URL-адреса, равный двум годам. Если вы когда-либо обновите ключи учетной записи хранения, обязательно повторно создайте подписанный URL-адрес. Придерживайтесь рекомендаций по управлению маркерами SAS. Дополнительные сведения см. в разделе [Рекомендации по использованию SAS](https://docs.microsoft.com/azure/storage/common/storage-dotnet-shared-access-signature-part-1#best-practices-when-using-sas).


## <a name="bandwidth-consumption"></a>Использование пропускной способности

Средний размер коллекции журналов диагностики зависит от того, собрана ли она по запросу или автоматически. 

Размер коллекции журналов, собранной по запросу, зависит от количества охваченных часов. Можно выбрать любое скользящее окно продолжительностью в 1–4 часа за последние семь дней. 

Если включен автоматический сбор журналов диагностики, то служба отслеживает критические оповещения. После возникновения критического оповещения, которое сохраняется в течение 30 минут, служба собирает и передает соответствующие журналы. Размер такой коллекции журналов в среднем составляет порядка 2 ГБ. В случае сбоя установки исправления или обновления автоматический сбор журналов запускается, только если возникло критическое оповещение, которое не исчезает в течение 30 минут. Рекомендуется следовать [указаниям по мониторингу установки исправлений и обновлений](azure-stack-updates.md).
Мониторинг оповещений, сбор журналов и их передача прозрачны для пользователя. 



В работоспособной системе журналы вообще не будут собираться. В неработоспособной системе сбор журналов может выполняться два или три раза в день, но обычно это происходит один раз. В самом худшем случае он может быть выполнен до десяти раз в день.  

Следующая таблица поможет оценить влияние включения автоматического сбора журналов для сред, использующих ограниченные или лимитные подключения к Azure.

| Сетевое подключение | Влияние |
|--------------------|--------|
| Подключение с низкой пропускной способностью и высокой задержкой | Передача журнала займет продолжительное время. | 
| Общее подключение | Передача может также повлиять на работу других приложений и пользователей, совместно использующих сетевое подключение. |
| Лимитное подключение | Поставщик услуг Интернета может взимать дополнительную плату за дополнительное использование сети. |


## <a name="managing-costs"></a>Управление затратами

[Плата за хранилище BLOB-объектов](https://azure.microsoft.com/pricing/details/storage/blobs/) Azure зависит от объема данных, сохраняемых каждый месяц, и других факторов, таких как избыточность данных. Если у вас нет учетной записи хранения, вы можете войти на портал Azure, щелкнуть **Учетные записи хранения** и [создать подписанный URL-адрес контейнера больших двоичных объектов Azure](azure-stack-configure-automatic-diagnostic-log-collection.md).

Рекомендуется создать [политику управления жизненным циклом](https://docs.microsoft.com/azure/storage/blobs/storage-lifecycle-management-concepts) хранилища BLOB-объектов Azure, чтобы сократить текущие затраты на хранилище. Дополнительные сведения о том, как настроить учетную запись хранения, см. в разделе [Настройка автоматического сбора журналов диагностики Azure Stack](azure-stack-configure-automatic-diagnostic-log-collection.md).

## <a name="see-also"></a>См. также

[Настройка автоматического сбора журналов Azure Stack](azure-stack-best-practices-automatic-diagnostic-log-collection.md)

