---
title: Интеграция центра обработки данных Azure Stack — DNS
description: Узнайте, как интегрировать DNS Azure Stack из DNS центра обработки данных.
services: azure-stack
author: jeffgilb
manager: femila
ms.service: azure-stack
ms.topic: article
ms.date: 02/12/2019
ms.author: jeffgilb
ms.reviewer: wfayed
ms.lastreviewed: 10/15/2018
keywords: ''
ms.openlocfilehash: e14fa6c172fcf579acf28bc8f3ea20f34148b90c
ms.sourcegitcommit: 85c3acd316fd61b4e94c991a9cd68aa97702073b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/01/2019
ms.locfileid: "64985270"
---
# <a name="azure-stack-datacenter-integration---dns"></a>Интеграция центра обработки данных Azure Stack — DNS
Чтобы иметь возможность доступа к конечным точкам Azure Stack (**portal**, **adminportal**, **management**, **adminmanagement** и т. д.) из-за пределов Azure Stack, необходимо интегрировать службы DNS Azure Stack с DNS-серверами, на которых размещаются зоны DNS, которые нужно использовать в Azure Stack.

## <a name="azure-stack-dns-namespace"></a>Пространство имен DNS Azure Stack
При развертывании Azure Stack необходимо ввести некоторые важные сведения, связанные с DNS.


|Поле  |ОПИСАНИЕ  |Пример|
|---------|---------|---------|
|Регион|Географическое расположение развертывания Azure Stack.|`east`|
|Имя внешнего домена|Имя зоны, которую необходимо использовать для развертывания Azure Stack.|`cloud.fabrikam.com`|
|Имя внутреннего домена|Имя внутренней зоны, используемой службами инфраструктуры в Azure Stack.  Это интегрированная и закрытая служба каталогов (недоступная за пределами развертывания Azure Stack).|`azurestack.local`|
|DNS-сервер перенаправления|DNS-серверы, которые используются для перенаправления запросов DNS, зон и записей DNS, размещенных за пределами Azure Stack, либо в корпоративной интрасети, либо в общедоступном Интернете.|`10.57.175.34`<br>`8.8.8.8`|
|Префикс имени (необязательно)|Префикс имени, который будет иметь компьютер экземпляра роли инфраструктуры Azure Stack.  Если не указано, значение по умолчанию — `azs`.|`azs`|

Полное доменное имя (FQDN) развертывания Azure Stack и конечных точек представляет собой сочетание параметра региона и имени внешнего домена. Учитывая значения из примеров в предыдущей таблице, полное доменное имя (FQDN) для этого развертывания Azure Stack будет следующим:

`east.cloud.fabrikam.com`

Таким образом примеры некоторых конечных точек для этого развертывания будут выглядеть как следующие URL-адреса:

`https://portal.east.cloud.fabrikam.com`

`https://adminportal.east.cloud.fabrikam.com`

Чтобы использовать этот пример пространства имен DNS для развертывания Azure Stack, должны быть выполнены следующие условия:

- Зона `fabrikam.com` зарегистрирована с помощью регистратора доменных имен, внутреннего корпоративного DNS-сервера или обоих, в зависимости от требований разрешения имен.
- В зоне `fabrikam.com` имеется дочерний домен `cloud.fabrikam.com`.
- К DNS-серверам, на которых размещаются зоны `fabrikam.com` и `cloud.fabrikam.com`, можно получить доступ из Azure Stack.

Чтобы иметь возможность разрешать DNS-имена конечных точек и экземпляров Azure Stack извне Azure Stack, необходимо интегрировать DNS-серверы, где размещена внешняя зона DNS для Azure Stack, с DNS-серверами, где размещена родительская зона, которую требуется использовать.


## <a name="resolution-and-delegation"></a>Разрешение и делегирование

Существует два следующих типа DNS-серверов.

- Полномочный DNS-сервер содержит зоны DNS. Он отвечает на запросы DNS для записей только в этих зонах.
- Рекурсивный DNS-сервер не содержит зоны DNS. Он отвечает на все запросы DNS, вызывая полномочные DNS-серверы для сбора необходимых данных.

Azure Stack содержит и полномочный, и рекурсивный DNS-сервер. Рекурсивные серверы используются для разрешения имен всего, за исключением внутренней зоны и внешней общей зоны DNS для развертывания Azure Stack. 

![Архитектура DNS Azure Stack](media/azure-stack-integrate-dns/Integrate-DNS-01.png)

## <a name="resolving-external-dns-names-from-azure-stack"></a>Разрешение внешних DNS-имен из Azure Stack

Чтобы разрешить имена DNS для конечных точек за пределами Azure Stack (например, www.bing.com), вам необходимо предоставить DNS-серверы, которые Azure Stack может использовать для перенаправления DNS-запросов, для которых Azure Stack не является полномочным. Для развертывания DNS-серверы, на которые перенаправляются запросы Azure Stack, необходимо ввести в лист развертывания (в поле "DNS-сервер перенаправления"). Для обеспечения отказоустойчивости укажите по крайней мере два сервера в этом поле. Без этих значений развертывание Azure Stack завершается сбоем.

### <a name="configure-conditional-dns-forwarding"></a>Настройка условного перенаправления DNS

> [!IMPORTANT]
> Это применяется только к развертываниям AD FS.

Чтобы включить разрешение имен с помощью имеющейся инфраструктуры DNS, настройте условное перенаправление.

Для добавления сервера условного перенаправления необходимо использовать привилегированную конечную точку.

Для выполнения этой процедуры используйте компьютер в сети центра обработки данных, который может взаимодействовать с привилегированной конечной точкой в Azure Stack.

1. Откройте сеанс Windows PowerShell с повышенными правами (запуск от имени администратора) и подключитесь к IP-адресу привилегированной конечной точки. Используйте учетные данные для проверки подлинности администратора облака.

   ```
   $cred=Get-Credential 
   Enter-PSSession -ComputerName <IP Address of ERCS> -ConfigurationName PrivilegedEndpoint -Credential $cred
   ```

2. После подключения к привилегированной конечной точке выполните следующую команду PowerShell. Замените предоставленные примеры значений именем домена и IP-адресами DNS-серверов, которые необходимо использовать.

   ```
   Register-CustomDnsServer -CustomDomainName "contoso.com" -CustomDnsIPAddresses "192.168.1.1","192.168.1.2"
   ```

## <a name="resolving-azure-stack-dns-names-from-outside-azure-stack"></a>Разрешение имен DNS Azure Stack извне
Полномочные серверы — это серверы, которые содержат данные внешней зоны DNS и все созданные пользователем зоны. Выполните интеграцию с этими серверами для разрешения делегирования зоны или условного перенаправления, чтобы разрешать имена DNS Azure Stack извне.

## <a name="get-dns-server-external-endpoint-information"></a>Получение сведений о внешней конечной точке DNS-сервера

Чтобы интегрировать развертывание Azure Stack с инфраструктурой DNS, необходимы следующие сведения:

- полные доменные имена DNS-серверов;
- IP-адреса DNS-серверов.

Полные доменные имена DNS-серверов Azure Stack имеют следующий формат:

`<NAMINGPREFIX>-ns01.<REGION>.<EXTERNALDOMAINNAME>`

`<NAMINGPREFIX>-ns02.<REGION>.<EXTERNALDOMAINNAME>`

При использовании примеров значений полные доменные имена для DNS-серверов будут такими:

`azs-ns01.east.cloud.fabrikam.com`

`azs-ns02.east.cloud.fabrikam.com`


Эти сведения также создаются в конце всех развертываний Azure Stack в файле с именем `AzureStackStampInformation.json`. Этот файл находится в папке `C:\CloudDeployment\logs` на виртуальной машине развертывания. Если вы не знаете, какие значения были использованы для развертывания Azure Stack, эти значения можно получить здесь.

Если виртуальная машина развертывания недоступна, значения можно получить, подключившись к привилегированной конечной точке и выполнив командлет PowerShell `Get-AzureStackStampInformation`. Дополнительные сведения см. в статье [Использование привилегированной конечной точки в Azure Stack](azure-stack-privileged-endpoint.md).

## <a name="setting-up-conditional-forwarding-to-azure-stack"></a>Настройка условного перенаправления в Azure Stack

Наиболее простой и безопасный способ интеграции Azure Stack с инфраструктурой DNS — это добиться условного перенаправления зоны с сервера, на котором размещена родительская зона. Рекомендуется использовать этот метод, если у вас есть прямой контроль над DNS-серверами, на которых размещается родительская зона внешнего пространства имен DNS Azure Stack.

Если вы не знаете, как настроить условное перенаправление с помощью DNS, ознакомьтесь со статьей TechNet [Assign a Conditional Forwarder for a Domain Name](https://technet.microsoft.com/library/cc794735) (Назначение средства условной пересылки для доменного имени) или документацией, относящейся к вашему решению DNS.

Условное перенаправление не может быть использовано в сценариях, в которых внешняя зона DNS Azure Stack указана в качестве дочернего домена корпоративного доменного имени. Необходимо настроить делегирование DNS.

Пример:

- Имя корпоративного домена DNS: `contoso.com`.
- Имя внешнего домена DNS Azure Stack: `azurestack.contoso.com`.

## <a name="delegating-the-external-dns-zone-to-azure-stack"></a>Делегирование внешних зон DNS в Azure Stack

Для разрешения имен DNS извне развертывания Azure Stack необходимо настроить делегирование DNS.

У каждого регистратора есть собственные средства управления DNS для изменения записей серверов имен домена. На странице управления DNS регистратора замените записи NS для зоны на созданные в Azure Stack.

Большинству регистраторов DNS требуется предоставить как минимум два DNS-сервера для выполнения делегирования.

## <a name="next-steps"></a>Дополнительная информация

[Интеграция брандмауэра](azure-stack-firewall.md)
