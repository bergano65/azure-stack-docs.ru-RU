---
title: Развертывание ASDK из командной строки с помощью PowerShell
description: Узнайте, как развернуть ASDK из командной строки с помощью PowerShell.
author: justinha
ms.topic: article
ms.date: 05/06/2019
ms.author: justinha
ms.reviewer: misainat
ms.lastreviewed: 02/08/2019
ms.openlocfilehash: b31792ce210cfc7fc5c2d1ee4ba1b496b2d340f6
ms.sourcegitcommit: fd5d217d3a8adeec2f04b74d4728e709a4a95790
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76873810"
---
# <a name="deploy-asdk-from-the-command-line-using-powershell"></a>Развертывание ASDK из командной строки с помощью PowerShell

Пакет средств разработки Azure Stack (ASDK) — это среда тестирования и разработки, которую можно развернуть для оценки и демонстрации функций и служб Azure Stack. Для ее установки и запуска необходимо подготовить аппаратное обеспечение среды и выполнить ряд сценариев. Выполнение сценариев занимает несколько часов. После этого вы сможете войти на портал администратора и портал пользователя, чтобы приступить к работе с Azure Stack.

## <a name="prerequisites"></a>Предварительные требования

Подготовьте главный компьютер ASDK. Составьте план относительно структуры оборудования, программного обеспечения и сети. Компьютер, на котором размещается ASDK, должен соответствовать требованиям к оборудованию, программному обеспечению и сети. Выберите, что будете использовать: Azure Active Directory (Azure AD) или службы федерации Active Directory (AD FS). Прежде чем начинать развертывание, убедитесь в том, что выполнены предварительные требования, чтобы процесс установки прошел без проблем.

Перед развертыванием ASDK необходимо убедиться в том, что аппаратное обеспечение, операционная система, учетная запись и конфигурация сети главного компьютера, на котором устанавливает ASDK, соответствуют минимальным требованиям для установки ASDK.

**[Ознакомьтесь с требованиями и рекомендациями к развертыванию ASDK](asdk-deploy-considerations.md)** .

> [!TIP]
> Чтобы убедиться, что оборудование соответствует всем требованиям, после установки операционной системы можно использовать [Средство проверки на соответствие требованиям к развертыванию Azure Stack](https://gallery.technet.microsoft.com/Deployment-Checker-for-50e0f51b).

## <a name="download-and-extract-the-deployment-package"></a>Скачивание пакета развертывания и извлечение его содержимого
Убедившись, что главный компьютер ASDK соответствует базовым требованиям для установки ASDK, скачайте пакет развертывания ASDK и извлеките его содержимое. Пакет развертывания содержит файл Cloudbuilder.vhdx, который является виртуальным жестким диском с загружаемой операционной системой и файлами установки Azure Stack.

Пакет развертывания можно скачать на узел ASDK или на другой компьютер. Извлеченные файлы развертывания занимают до 60 ГБ дискового пространства, поэтому использование другого компьютера помогает снизить требования к оборудованию для узла ASDK.

**[Скачивание Пакета средств разработки Azure Stack (ASDK) и извлечение его содержимого](asdk-download.md)**

## <a name="prepare-the-asdk-host-computer"></a>Подготовка главного компьютера для ASDK
Перед установкой ASDK на главный компьютер необходимо подготовить среду и настроить загрузку системы с виртуального жесткого диска. После этого узел ASDK загрузится с диска Cloudbuilder.vhdx (виртуальный жесткий диск, содержащий загружаемую операционную систему и файлы установки Azure Stack).

Настройте главный компьютер с ASDK для загрузки с CloudBuilder.vhdx с помощью PowerShell. Эти команды настроят главный компьютер с ASDK для загрузки со скачанного и извлеченного виртуального жесткого диска Azure Stack (CloudBuilder.vhdx). После выполнения этих действий перезапустите главный компьютер ASDK.

Настройка главного компьютера с ASDK для загрузки с CloudBuilder.vhdx:

  1. Запустите командную строку от имени администратора.
  2. Выполните `bcdedit /copy {current} /d "Azure Stack"`.
  3. Скопируйте (клавишами CTRL+C) возвращенное значение CLSID, включая обязательные круглые скобки (`{}`). Это значение называется `{CLSID}`. Его нужно будет вставить (с помощью клавиш CTRL+V или щелчком правой кнопкой мыши) на оставшихся шагах.
  4. Выполните `bcdedit /set {CLSID} device vhd=[C:]\CloudBuilder.vhdx`.
  5. Выполните `bcdedit /set {CLSID} osdevice vhd=[C:]\CloudBuilder.vhdx`.
  6. Выполните `bcdedit /set {CLSID} detecthal on`.
  7. Выполните `bcdedit /default {CLSID}`.
  8. Чтобы проверить параметры загрузки, запустите `bcdedit`.
  9. Убедитесь, что файл CloudBuilder.vhdx перемещен в корень диска C:\ (`C:\CloudBuilder.vhdx`), и перезапустите главный компьютер ASDK. После перезапуска главный компьютер ASDK должен загрузиться с жесткого диска виртуальной машины CloudBuilder.vhdx, чтобы начать развертывание ASDK.

> [!IMPORTANT]
> Прежде чем перезапускать главный компьютер ASDK, убедитесь в наличии прямого физического или KVM-доступа к нему. При первом запуске виртуальной машины она предлагает завершить установку Windows Server. Укажите те же учетные данные администратора, что использовались для входа на главный компьютер ASDK.

### <a name="prepare-the-asdk-host-using-powershell"></a>Подготовка узла ASDK с помощью PowerShell 
После успешной загрузки главного компьютера ASDK с помощью образа CloudBuilder.vhdx выполните вход с теми же учетными данными локального администратора, которые использовались для входа на главный компьютер ASDK. Эти же учетные данные вы указали при завершении установки Windows Server, когда главный компьютер загружался с виртуального жесткого диска.

> [!NOTE]
> Кроме того, при необходимости можно также настроить [параметры телеметрии Azure Stack](asdk-telemetry.md#set-telemetry-level-in-the-windows-registry) *до* установки ASDK.

Откройте консоль PowerShell с повышенными привилегиями и выполните команды этого раздела, чтобы развернуть ASDK на узле ASDK.

> [!IMPORTANT]
> Установка ASDK поддерживает только один сетевой адаптер (NIC) для работы в сети. При наличии нескольких сетевых интерфейсов перед выполнением сценария развертывания включите только один из них, а все остальные отключите.

Вы можете развернуть Azure Stack с помощью Azure AD или AD FS Windows Server в качестве поставщика удостоверений. Azure Stack, поставщики ресурсов и другие приложения одинаково работают с обеими службами.

> [!TIP]
> Если вы не указали никаких параметров настройки (см. ниже раздел о дополнительных параметрах и примерах InstallAzureStackPOC.ps1), появится запрос на ввод необходимых параметров.

### <a name="deploy-azure-stack-using-azure-ad"></a>Развертывание Azure Stack с помощью Azure AD 
Чтобы развернуть Azure Stack **с использованием Azure AD в качестве поставщика удостоверений** , компьютер должен быть подключен к Интернету напрямую или через прозрачный прокси-сервер. 

Выполните следующие команды PowerShell, чтобы развернуть ASDK с использованием Azure AD.

  ```powershell
  cd C:\CloudDeployment\Setup     
  $adminpass = Get-Credential Administrator     
  .\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password
  ```

Через несколько минут после установки ASDK вам будет предложено ввести учетные данные Azure AD. Укажите учетные данные глобального администратора для клиента Azure AD.

После развертывания разрешение глобального администратора Azure Active Directory не требуется. Тем не менее для некоторых операций могут потребоваться учетные данные глобального администратора. К примерам таких операций можно отнести сценарий установки от поставщика ресурсов или новую функцию, для которой требуется получить разрешение. Можно временно восстановить разрешения глобального администратора или использовать отдельную глобальную учетную запись администратора, которая является владельцем *подписки поставщика по умолчанию*.

### <a name="deploy-azure-stack-using-ad-fs"></a>Развертывание Azure Stack с помощью AD FS 
Чтобы развернуть ASDK **с использованием AD FS в качестве поставщика удостоверений**, выполните следующие команды PowerShell (просто нужно добавить параметр -UseADFS).

  ```powershell
  cd C:\CloudDeployment\Setup     
  $adminpass = Get-Credential Administrator 
  .\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password -UseADFS
  ```

При развертывании служб федерации Active Directory служба каталогов по умолчанию используется в качестве поставщика удостоверений. Учетная запись по умолчанию для входа — azurestackadmin@azurestack.local, а в качестве пароля будет использоваться пароль, указанный с помощью команд настройки PowerShell.

Процесс развертывания может занять несколько часов, в течение которых система автоматически перезагрузится один раз. После завершения развертывания в окне консоли PowerShell отобразится следующее сообщение. **Завершено: Действие "Развертывание"** . Если развертывание завершилось сбоем, выполните сценарий снова, используя параметр -rerun. Вы также можете [повторно развернуть ASDK](asdk-redeploy.md) с нуля.

> [!IMPORTANT]
> Если вы хотите отслеживать ход развертывания после перезагрузки компьютера ASDK, войдите в систему как AzureStack\AzureStackAdmin. Если вы входите в систему как локальный администратор после перезапуска главного компьютера (и присоединения к домену azurestack.local), вы не увидите ход выполнения развертывания. Не выполняйте развертывание повторно. Вместо этого войдите в систему с учетной записью AzureStack\AzureStackAdmin с паролем учетной записи локального администратора, чтобы проверить выполнение установки.


#### <a name="azure-ad-deployment-script-examples"></a>Примеры сценария развертывания AAD
Полное развертывание AAD можно прописать в сценарии. Несколько примеров с комментариями, содержащими некоторые необязательные параметры.

Если удостоверение AAD связано только с **одним** каталогом AAD:
```powershell
cd C:\CloudDeployment\Setup 
$adminpass = Get-Credential Administrator 
$aadcred = Get-Credential "<Azure AD global administrator account name>" 
.\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password -InfraAzureDirectoryTenantAdminCredential $aadcred -TimeServer 52.168.138.145 #Example time server IP address.
```

Если удостоверение AAD связано только с **несколькими** каталогами AAD:
```powershell
cd C:\CloudDeployment\Setup 
$adminpass = Get-Credential Administrator 
$aadcred = Get-Credential "<Azure AD global administrator account name>" #Example: user@AADDirName.onmicrosoft.com 
.\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password -InfraAzureDirectoryTenantAdminCredential $aadcred -InfraAzureDirectoryTenantName "<Azure AD directory in the form of domainname.onmicrosoft.com or an Azure AD verified custom domain name>" -TimeServer 52.168.138.145 #Example time server IP address.
```

Если в вашей среде отключен протокол DHCP, в один из предоставленных примеров использования необходимо добавить приведенные ниже дополнительные параметры. 

```powershell
.\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password -InfraAzureDirectoryTenantAdminCredential $aadcred -TimeServer 10.222.112.26
```

### <a name="asdk-installazurestackpocps1-optional-parameters"></a>Необязательные параметры ASDK InstallAzureStackPOC.ps1

|Параметр|Обязательный/необязательный|Описание|
|-----|-----|-----|
|AdminPassword|Обязательно|Задает учетную запись локального администратора и другие учетные записи пользователей на всех виртуальных машинах, созданных в процессе развертывания ASDK. Этот пароль должен совпадать с текущим паролем локального администратора на узле.|
|InfraAzureDirectoryTenantName|Обязательно|Задает каталог клиента. Используйте этот параметр, чтобы указать конкретный каталог, где у учетной записи Azure AD есть разрешения на управление несколькими каталогами. Полное имя клиента Azure AD в формате .onmicrosoft.com или имя проверенного личного домена Azure AD.|
|TimeServer|Обязательно|Используйте этот параметр, чтобы указать определенный сервер времени. Этот параметр может быть предоставлен в качестве допустимого IP-адреса сервера времени. Имена серверов не поддерживаются.|
|InfraAzureDirectoryTenantAdminCredential|Необязательно|Задает имя пользователя и пароль Azure Active Directory. В качестве этих учетных данных Azure следует использовать идентификатор организации.|
|InfraAzureEnvironment|Необязательно|Выберите среду Azure, в которой вы хотите зарегистрировать это развертывание Azure Stack. Допустимые значения: глобальная служба Azure, Azure — Китай, Azure — US Government.|
|DNSForwarder|Необязательно|DNS-сервер, созданный в ходе развертывания Azure Stack. Чтобы разрешить компьютерам в решении разрешать имена, расположенные за пределами метки, укажите имеющийся DNS-сервер инфраструктуры. DNS-сервер, расположенный в этой метке, перенаправляет неизвестные запросы на сопоставление имен на этот DNS-сервер.|
|Rerun|Необязательно|Этот флажок используется для повторного выполнения развертывания. Используются все предыдущие входные данные. Повторный ввод ранее предоставленных данных не поддерживается, так как для развертывания создается и используется несколько уникальных значений.|


## <a name="perform-post-deployment-configurations"></a>Настройка после развертывания
После установки ASDK нужно выполнить несколько рекомендуемых проверок и внести некоторые изменения в конфигурацию. Проверьте правильность установки, использовав командлет test-AzureStack. Затем установите инструменты PowerShell и GitHub для Azure Stack.

Рекомендуется сбросить политику срока действия паролей, чтобы срок действия пароля для главного компьютера ASDK не завершился до окончания периода ознакомления.

> [!NOTE]
> Кроме того, при необходимости можно также настроить [параметры телеметрии Azure Stack](asdk-telemetry.md#enable-or-disable-telemetry-after-deployment) *после* установки ASDK.

**[Задачи, выполняемые после развертывания ASDK](asdk-post-deploy.md)**

## <a name="register-with-azure"></a>Регистрация в Azure
Azure Stack необходимо зарегистрировать в Azure, чтобы можно было [скачивать элементы Azure Marketplace](../operator/azure-stack-create-and-publish-marketplace-item.md) в Azure Stack.

**[Регистрация Azure Stack в Azure](asdk-register.md)**

## <a name="next-steps"></a>Дальнейшие действия
Поздравляем! После выполнения этих действий вы получите среду ASDK с порталом [администрирования](https://adminportal.local.azurestack.external) и [пользовательским](https://portal.local.azurestack.external) порталом. 

[Настройка, выполняемая после установки ASDK](asdk-post-deploy.md)

